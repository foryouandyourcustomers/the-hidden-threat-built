import{K as Qn,L as Un,M as Yn,S as we,i as Se,s as Te,k as C,N as Mt,a as Q,q as W,l as H,m as D,O as Pt,h as A,c as U,r as X,n as L,b as V,D as I,u as he,E as pe,o as hn,w as pt,P as _t,Q as pn,v as mt,R as _n,f as yt,g as K,d as N,F as ne,e as jt,y as Pe,z as je,A as Le,B as $e,T as mn,U as Zn,V as yn,p as Fe,W as _e,X as Kn,Y as Nn,Z as zn,G as ze,H as et,I as tt,J as nt}from"../chunks/index.8741fe9c.js";import{r as gn,w as er}from"../chunks/index.e0b1c8ed.js";function tr(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function nr(){var t=tr();if(t.__xstate__)return t.__xstate__}var rr=function(n){if(!(typeof window>"u")){var e=nr();e&&e.register(n)}},B;(function(t){t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication",t.ErrorPlatform="error.platform",t.ErrorCustom="xstate.error",t.Pure="xstate.pure",t.Choose="xstate.choose"})(B||(B={}));var Lt;(function(t){t.Parent="#_parent",t.Internal="#_internal"})(Lt||(Lt={}));var bn=B.Stop,ot=B.Raise,ir=B.Send,ar=B.Cancel,$t=B.Assign;B.After;B.DoneState;B.Log;var gt=B.Init,Ee=B.Invoke,or=B.ErrorExecution,sr=B.ErrorPlatform;B.ErrorCustom;B.Choose;var ur=B.Pure;function lr(t,n){if(typeof t!="object"||t===null)return t;var e=t[Symbol.toPrimitive];if(e!==void 0){var i=e.call(t,n||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(t)}function bt(t){var n=lr(t,"string");return typeof n=="symbol"?n:String(n)}function g(t,n,e){return n=bt(n),n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function Dt(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),e.push.apply(e,i)}return e}function S(t){for(var n=1;n<arguments.length;n++){var e=arguments[n]!=null?arguments[n]:{};n%2?Dt(Object(e),!0).forEach(function(i){g(t,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Dt(Object(e)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})}return t}function cr(t){if(Array.isArray(t))return t}function fr(t,n){var e=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(e!=null){var i,a,s,u,f=[],c=!0,d=!1;try{if(s=(e=e.call(t)).next,n===0){if(Object(e)!==e)return;c=!1}else for(;!(c=(i=s.call(e)).done)&&(f.push(i.value),f.length!==n);c=!0);}catch(v){d=!0,a=v}finally{try{if(!c&&e.return!=null&&(u=e.return(),Object(u)!==u))return}finally{if(d)throw a}}return f}}function st(t,n){(n==null||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function wt(t,n){if(t){if(typeof t=="string")return st(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return st(t,n)}}function dr(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function St(t,n){return cr(t)||fr(t,n)||wt(t,n)||dr()}function vr(t){if(Array.isArray(t))return st(t)}function hr(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function pr(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function M(t){return vr(t)||hr(t)||wt(t)||pr()}function w(t,n){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=wt(t))||n&&t&&typeof t.length=="number"){e&&(t=e);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(c){throw c},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,u=!1,f;return{s:function(){e=e.call(t)},n:function(){var c=e.next();return s=c.done,c},e:function(c){u=!0,f=c},f:function(){try{!s&&e.return!=null&&e.return()}finally{if(u)throw f}}}}function ue(t){return ue=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ue(t)}var wn=".",_r="",Sn="",mr="#",Ge="*";function Tn(t,n){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:wn,i=ut(t,e),a=ut(n,e);return Y(a)?Y(i)?a===i:!1:Y(i)?i in a:Object.keys(i).every(function(s){return s in a?Tn(i[s],a[s]):!1})}function An(t,n){try{return Ae(t)?t:t.toString().split(n)}catch{throw new Error("'".concat(t,"' is not a valid state path."))}}function yr(t){return ue(t)==="object"&&"value"in t&&"context"in t&&"event"in t}function ut(t,n){if(yr(t))return t.value;if(Ae(t))return Ct(t);if(typeof t!="string")return t;var e=An(t,n);return Ct(e)}function Ct(t){if(t.length===1)return t[0];for(var n={},e=n,i=0;i<t.length-1;i++)i===t.length-2?e[t[i]]=t[i+1]:(e[t[i]]={},e=e[t[i]]);return n}function Ht(t,n){for(var e={},i=Object.keys(t),a=0;a<i.length;a++){var s=i[a];e[s]=n(t[s],s,t,a)}return e}function lt(t){var n;return(n=[]).concat.apply(n,M(t))}function kn(t){return Ae(t)?t:[t]}function re(t){return t===void 0?[]:kn(t)}function xn(t,n,e){if(ie(t))return t({context:n,event:e});for(var i={},a={context:n,event:e},s=0,u=Object.keys(t);s<u.length;s++){var f=u[s],c=t[f];ie(c)?i[f]=c(a):i[f]=c}return i}var gr=function(){};function Ae(t){return Array.isArray(t)}function ie(t){return typeof t=="function"}function Y(t){return typeof t=="string"}function br(t){return typeof t.type=="string"&&(t.type===or||t.type.startsWith(sr))}function ae(t,n){var e=kn(n).map(function(i){return typeof i>"u"||typeof i=="string"?{target:i,event:t}:S(S({},i),{},{event:t})});return e}function In(t){if(!(t===void 0||t===_r))return re(t)}function wr(t,n){if(ue(t)==="object"){if("src"in t)return t;if("transition"in t)return{id:n,src:t}}return{id:n,src:t}}function Sr(t,n,e){var i=function(){},a=ue(t)==="object",s=a?t:null;return{next:((a?t.next:t)||i).bind(s),error:((a?t.error:n)||i).bind(s),complete:((a?t.complete:e)||i).bind(s)}}function Tr(t,n){return"".concat(t,":invocation[").concat(n,"]")}function qe(t){return t?"transition"in t?{src:t,input:void 0}:t:void 0}function ce(t,n){return{type:t.type,params:t.params,resolve:n}}function Tt(t){return ue(t)==="object"&&t!==null&&"resolve"in t}function De(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function Ft(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,bt(i.key),i)}}function Ce(t,n,e){return n&&Ft(t.prototype,n),e&&Ft(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var Gt=function(){function t(n){De(this,t),this._process=n,g(this,"_active",!1),g(this,"_current",null),g(this,"_last",null)}return Ce(t,[{key:"start",value:function(){this._active=!0,this.flush()}},{key:"clear",value:function(){this._current&&(this._current.next=null,this._last=this._current)}},{key:"prepend",value:function(e){if(!this._current){this.enqueue(e);return}this._current={value:e,next:this._current}}},{key:"enqueue",value:function(e){var i={value:e,next:null};if(this._current){this._last.next=i,this._last=i;return}this._current=i,this._last=i,this._active&&this.flush()}},{key:"flush",value:function(){for(;this._current;){var e=this._current;this._process(e.value),e===this._current&&(this._current=this._current.next)}this._last=null}}]),t}(),Ar=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),ct="xstate.stop";function kr(t){return!!t&&ue(t)==="object"&&typeof t.send=="function"}function xr(){var t=0,n=new Map,e=new Map,i=new WeakMap,a={_bookId:function(){return"x:".concat(t++)},_register:function(u,f){return n.set(u,f),u},_unregister:function(u){n.delete(u.sessionId);var f=i.get(u);f!==void 0&&(e.delete(f),i.delete(u))},get:function(u){return e.get(u)},_set:function(u,f){var c=e.get(u);if(c&&c!==f)throw new Error("Actor with system ID '".concat(u,"' already exists."));e.set(u,f),i.set(f,u)}};return a}var J;(function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(J||(J={}));var Ir={deferEvents:!0,clock:{setTimeout:function(t){function n(e,i){return t.apply(this,arguments)}return n.toString=function(){return t.toString()},n}(function(t,n){return setTimeout(t,n)}),clearTimeout:function(t){function n(e){return t.apply(this,arguments)}return n.toString=function(){return t.toString()},n}(function(t){return clearTimeout(t)})},logger:console.log.bind(console),devTools:!1},Er=function(){function t(n,e){var i,a=this;De(this,t),this.behavior=n,g(this,"_state",void 0),g(this,"clock",void 0),g(this,"options",void 0),g(this,"id",void 0),g(this,"mailbox",new Gt(this._process.bind(this))),g(this,"delayedEventsMap",{}),g(this,"observers",new Set),g(this,"logger",void 0),g(this,"status",J.NotStarted),g(this,"_parent",void 0),g(this,"ref",void 0),g(this,"_actorContext",void 0),g(this,"_systemId",void 0),g(this,"sessionId",void 0),g(this,"system",void 0),g(this,"_doneEvent",void 0),g(this,"src",void 0),g(this,"_deferred",[]);var s=S(S({},Ir),e),u=s.clock,f=s.logger,c=s.parent,d=s.id,v=s.systemId,r=this;this.system=(i=c==null?void 0:c.system)!==null&&i!==void 0?i:xr(),v&&(this._systemId=v,this.system._set(v,this)),this.sessionId=this.system._bookId(),this.id=d??this.sessionId,this.logger=f,this.clock=u,this._parent=c,this.options=s,this.src=s.src,this.ref=this,this._actorContext={self:r,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:function(l){a._deferred.push(l)},system:this.system,stopChild:function(l){if(l._parent!==a)throw new Error("Cannot stop child actor ".concat(l.id," of ").concat(a.id," because it is not a child"));l._stop()}},this.send=this.send.bind(this),this._initState()}return Ce(t,[{key:"_initState",value:function(){var e;this._state=this.options.state?this.behavior.restoreState?this.behavior.restoreState(this.options.state,this._actorContext):this.options.state:this.behavior.getInitialState(this._actorContext,(e=this.options)===null||e===void 0?void 0:e.input)}},{key:"update",value:function(e){var i,a,s,u;this._state=e;for(var f=this.getSnapshot(),c;c=this._deferred.shift();)c(e);var d=w(this.observers),v;try{for(d.s();!(v=d.n()).done;){var r,o=v.value;(r=o.next)===null||r===void 0||r.call(o,f)}}catch(h){d.e(h)}finally{d.f()}var l=(i=(a=this.behavior).getStatus)===null||i===void 0?void 0:i.call(a,e);switch(l==null?void 0:l.status){case"done":this._stopProcedure(),this._doneEvent=ri(this.id,l.data),(s=this._parent)===null||s===void 0||s.send(this._doneEvent),this._complete();break;case"error":this._stopProcedure(),(u=this._parent)===null||u===void 0||u.send(Et(this.id,l.data)),this._error(l.data);break}}},{key:"subscribe",value:function(e,i,a){var s=this,u=Sr(e,i,a);if(this.observers.add(u),this.status===J.Stopped){var f;(f=u.complete)===null||f===void 0||f.call(u),this.observers.delete(u)}return{unsubscribe:function(){s.observers.delete(u)}}}},{key:"onDone",value:function(e){var i=this;return this.status===J.Stopped&&this._doneEvent?e(this._doneEvent):this.observers.add({complete:function(){i._doneEvent&&e(i._doneEvent)}}),this}},{key:"start",value:function(){return this.status===J.Running?this:(this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this.status=J.Running,this.behavior.start&&this.behavior.start(this._state,this._actorContext),this.update(this._state),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this)}},{key:"_process",value:function(e){try{var i=this.behavior.transition(this._state,e,this._actorContext);this.update(i),e.type===ct&&(this._stopProcedure(),this._complete())}catch(a){if(this.observers.size>0)this.observers.forEach(function(s){var u;(u=s.error)===null||u===void 0||u.call(s,a)}),this.stop();else throw a}}},{key:"_stop",value:function(){return this.status===J.Stopped?this:(this.mailbox.clear(),this.status===J.NotStarted?(this.status=J.Stopped,this):(this.mailbox.enqueue({type:ct}),this))}},{key:"stop",value:function(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}},{key:"_complete",value:function(){var e=w(this.observers),i;try{for(e.s();!(i=e.n()).done;){var a,s=i.value;(a=s.complete)===null||a===void 0||a.call(s)}}catch(u){e.e(u)}finally{e.f()}this.observers.clear()}},{key:"_error",value:function(e){var i=w(this.observers),a;try{for(i.s();!(a=i.n()).done;){var s,u=a.value;(s=u.error)===null||s===void 0||s.call(u,e)}}catch(f){i.e(f)}finally{i.f()}this.observers.clear()}},{key:"_stopProcedure",value:function(){if(this.status!==J.Running)return this;for(var e=0,i=Object.keys(this.delayedEventsMap);e<i.length;e++){var a=i[e];this.clock.clearTimeout(this.delayedEventsMap[a])}return this.mailbox.clear(),this.mailbox=new Gt(this._process.bind(this)),this.status=J.Stopped,this.system._unregister(this),this}},{key:"send",value:function(e){if(typeof e=="string")throw new Error('Only event objects may be sent to actors; use .send({ type: "'.concat(e,'" }) instead'));if(this.status!==J.Stopped){if(this.status!==J.Running&&!this.options.deferEvents)throw new Error('Event "'.concat(e.type,'" was sent to uninitialized actor "').concat(this.id,`". Make sure .start() is called for this actor, or set { deferEvents: true } in the actor options.
Event: `).concat(JSON.stringify(e)));this.mailbox.enqueue(e)}}},{key:"delaySend",value:function(e){var i=this;this.delayedEventsMap[e.params.id]=this.clock.setTimeout(function(){"to"in e.params&&e.params.to?e.params.to.send(e.params.event):i.send(e.params.event)},e.params.delay)}},{key:"cancel",value:function(e){this.clock.clearTimeout(this.delayedEventsMap[e]),delete this.delayedEventsMap[e]}},{key:"attachDevTools",value:function(){var e=this.options.devTools;if(e){var i=typeof e=="function"?e:rr;i(this)}}},{key:"toJSON",value:function(){return{id:this.id}}},{key:"getPersistedState",value:function(){var e,i;return(e=(i=this.behavior).getPersistedState)===null||e===void 0?void 0:e.call(i,this._state)}},{key:Ar,value:function(){return this}},{key:"getSnapshot",value:function(){return this.behavior.getSnapshot?this.behavior.getSnapshot(this._state):this._state}}]),t}();function me(t,n){var e=new Er(t,n);return e}function En(t){var n=t;return ce({type:bn,params:{actor:n}},function(e,i){var a=i.state,s=ie(n)?n({context:a.context,event:e}):n,u=typeof s=="string"?a.children[s]:s;return[a,{type:"xstate.stop",params:{actor:u},execute:function(c){if(u){if(u.status!==J.Running){c.stopChild(u);return}c.defer(function(){c.stopChild(u)})}}}]})}function Or(t){return ce({type:ar,params:{sendId:t}},function(n,e){var i,a=e.state,s=e.actorContext,u=ie(t)?t({context:a.context,event:n,self:(i=s==null?void 0:s.self)!==null&&i!==void 0?i:{},system:s==null?void 0:s.system}):t;return[a,{type:"xstate.cancel",params:{sendId:u},execute:function(c){var d=c.self;d.cancel(u)}}]})}function Mr(t,n){if(t==null)return{};var e={},i=Object.keys(t),a,s;for(s=0;s<i.length;s++)a=i[s],!(n.indexOf(a)>=0)&&(e[a]=t[a]);return e}function Ue(t,n){if(t==null)return{};var e=Mr(t,n),i,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(a=0;a<s.length;a++)i=s[a],!(n.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(t,i)&&(e[i]=t[i])}return e}var Vt=new WeakMap;function oe(t,n,e){var i=Vt.get(t);return i?n in i||(i[n]=e()):(i=g({},n,e()),Vt.set(t,i)),i[n]}function At(t,n,e,i){var a,s,u,f=i.machine,c=(a=f==null||(s=f.options)===null||s===void 0||(u=s.guards)===null||u===void 0?void 0:u[t.type])!==null&&a!==void 0?a:t.predicate;if(!c)throw new Error("Guard '".concat(t.type,"' is not implemented.'."));return c({context:n,event:e,state:i,guard:t,evaluate:At})}function On(t,n){var e;return Y(t)?{type:t,predicate:(n==null?void 0:n(t))||void 0,params:{type:t}}:ie(t)?{type:t.name,predicate:t,params:{type:t.name,name:t.name}}:{type:t.type,params:t.params||t,children:(e=t.children)===null||e===void 0?void 0:e.map(function(i){return On(i,n)}),predicate:(n==null?void 0:n(t.type))||t.predicate}}function Pr(t,n,e){var i=t[0].machine,a=t.find(function(s){return s.type==="final"&&s.parent===i.root});return a&&a.output?xn(a.output,n,e):void 0}var Ye=function(n){return n.type==="atomic"||n.type==="final"};function le(t){return Object.values(t.states).filter(function(n){return n.type!=="history"})}function kt(t,n){for(var e=[],i=t.parent;i&&i!==n;)e.push(i),i=i.parent;return e}function Oe(t){var n=new Set(t),e=new Set(t),i=Pn(e),a=w(n),s;try{for(a.s();!(s=a.n()).done;){var u=s.value;if(u.type==="compound"&&(!i.get(u)||!i.get(u).length))Rt(u).forEach(function(p){return e.add(p)});else if(u.type==="parallel"){var f=w(le(u)),c;try{for(f.s();!(c=f.n()).done;){var d=c.value;if(d.type!=="history"&&!e.has(d))for(var v=0,r=Rt(d);v<r.length;v++){var o=r[v];e.add(o)}}}catch(p){f.e(p)}finally{f.f()}}}}catch(p){a.e(p)}finally{a.f()}var l=w(e),h;try{for(l.s();!(h=l.n()).done;)for(var _=h.value,m=_.parent;m;)e.add(m),m=m.parent}catch(p){l.e(p)}finally{l.f()}return e}function Mn(t,n){var e=n.get(t);if(!e)return{};if(t.type==="compound"){var i=e[0];if(i){if(Ye(i))return i.key}else return{}}var a={},s=w(e),u;try{for(s.s();!(u=s.n()).done;){var f=u.value;a[f.key]=Mn(f,n)}}catch(c){s.e(c)}finally{s.f()}return a}function Pn(t){var n=new Map,e=w(t),i;try{for(e.s();!(i=e.n()).done;){var a=i.value;n.has(a)||n.set(a,[]),a.parent&&(n.has(a.parent)||n.set(a.parent,[]),n.get(a.parent).push(a))}}catch(s){e.e(s)}finally{e.f()}return n}function jn(t,n){var e=Oe(n);return Mn(t,Pn(e))}function Ze(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t[0].machine.root;return n.type==="compound"?le(n).some(function(e){return e.type==="final"&&t.includes(e)}):n.type==="parallel"?le(n).every(function(e){return Ze(t,e)}):!1}var ye=function(n){return n[0]===mr};function jr(t,n){var e=t.transitions.filter(function(i){var a=i.eventType;if(a===n||a===Ge)return!0;if(!a.endsWith(".*"))return!1;for(var s=a.split("."),u=n.split("."),f=0;f<s.length;f++){var c=s[f],d=u[f];if(c==="*"){var v=f===s.length-1;return v}if(c!==d)return!1}return!0});return e}function Lr(t){var n=t.config.after;if(!n)return[];var e=function(s,u){var f=ie(s)?"".concat(t.id,":delay[").concat(u,"]"):s,c=ni(f,t.id);return t.entry.push(Nr({type:c},{delay:s})),t.exit.push(Or(c)),c},i=Ae(n)?n.map(function(a,s){var u=e(a.delay,s);return S(S({},a),{},{event:u})}):Object.keys(n).flatMap(function(a,s){var u=n[a],f=Y(u)?{target:u}:u,c=isNaN(+a)?a:+a,d=e(c,s);return re(f).map(function(v){return S(S({},v),{},{event:d,delay:c})})});return i.map(function(a){var s=a.delay;return S(S({},Ke(t,a)),{},{delay:s})})}function Ke(t,n){var e,i=In(n.target),a=(e=n.reenter)!==null&&e!==void 0?e:!1,s=t.machine.options.guards,u=Ln(t,i),f=S(S({},n),{},{actions:Qe(re(n.actions)),guard:n.guard?On(n.guard,function(c){return s[c]}):void 0,target:u,source:t,reenter:a,eventType:n.event,toJSON:function(){return S(S({},f),{},{source:"#".concat(t.id),target:u?u.map(function(d){return"#".concat(d.id)}):void 0})}});return f}function $r(t){var n=[];if(Array.isArray(t.config.on))n.push.apply(n,M(t.config.on));else if(t.config.on){for(var e=t.config.on,i=e[Ge],a=i===void 0?[]:i,s=Ue(e,[Ge].map(bt)),u=0,f=Object.keys(s);u<f.length;u++){var c=f[u];if(c===Sn)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');var d=ae(c,s[c]);n.push.apply(n,M(d))}n.push.apply(n,M(ae(Ge,a)))}var v=t.config.onDone?ae(String(vt(t.id)),t.config.onDone):[],r=t.invoke.flatMap(function(p){var y=[];return p.onDone&&y.push.apply(y,M(ae("done.invoke.".concat(p.id),p.onDone))),p.onError&&y.push.apply(y,M(ae("error.platform.".concat(p.id),p.onError))),p.onSnapshot&&y.push.apply(y,M(ae("xstate.snapshot.".concat(p.id),p.onSnapshot))),y}),o=t.after,l=[].concat(M(v),M(r),n).flatMap(function(p){return re(p).map(function(y){return Ke(t,y)})}),h=w(o),_;try{for(h.s();!(_=h.n()).done;){var m=_.value;l.push(m)}}catch(p){h.e(p)}finally{h.f()}return l}function Dr(t,n){if(Y(n)||Ae(n)){var e=re(n).map(function(s){var u=Y(s)?ye(s)?t.machine.getStateNodeById(s):t.states[s]:s;if(!u)throw new Error('Initial state node "'.concat(s,'" not found on parent state node #').concat(t.id));if(!fe(u,t))throw new Error("Invalid initial target: state node #".concat(u.id," is not a descendant of #").concat(t.id));return u}),i=Ln(t,e),a={source:t,actions:[],eventType:null,reenter:!1,target:i,toJSON:function(){return S(S({},a),{},{source:"#".concat(t.id),target:i?i.map(function(u){return"#".concat(u.id)}):void 0})}};return a}return Ke(t,{target:re(n.target).map(function(s){return Y(s)?ye(s)?s:"".concat(t.machine.delimiter).concat(s):s}),actions:n.actions,event:null})}function Ln(t,n){if(n!==void 0)return n.map(function(e){if(!Y(e))return e;if(ye(e))return t.machine.getStateNodeById(e);var i=e[0]===t.machine.delimiter;if(i&&!t.parent)return Xe(t,e.slice(1));var a=i?t.key+e:e;if(t.parent)try{var s=Xe(t.parent,a);return s}catch(u){throw new Error("Invalid transition definition for state node '".concat(t.id,`':
`).concat(u.message))}else throw new Error('Invalid target: "'.concat(e,'" is not a valid target from the root node. Did you mean ".').concat(e,'"?'))})}function $n(t){var n=In(t.target);return n?n.map(function(e){return typeof e=="string"?Xe(t.parent,e):e}):t.parent.initial.target}function We(t){return t.type==="history"}function Rt(t){var n=new Set;function e(i){if(!n.has(i)){if(n.add(i),i.type==="compound"){var a=w(i.initial.target),s;try{for(a.s();!(s=a.n()).done;){var u=s.value,f=w(kt(u,t)),c;try{for(f.s();!(c=f.n()).done;){var d=c.value;n.add(d)}}catch(l){f.e(l)}finally{f.f()}e(u)}}catch(l){a.e(l)}finally{a.f()}}else if(i.type==="parallel"){var v=w(le(i)),r;try{for(v.s();!(r=v.n()).done;){var o=r.value;e(o)}}catch(l){v.e(l)}finally{v.f()}}}}return e(t),M(n)}function ge(t,n){if(ye(n))return t.machine.getStateNodeById(n);if(!t.states)throw new Error("Unable to retrieve child state '".concat(n,"' from '").concat(t.id,"'; no child states exist."));var e=t.states[n];if(!e)throw new Error("Child state '".concat(n,"' does not exist on '").concat(t.id,"'"));return e}function Xe(t,n){if(typeof n=="string"&&ye(n))try{return t.machine.getStateNodeById(n)}catch{}for(var e=An(n,t.machine.delimiter).slice(),i=t;e.length;){var a=e.shift();if(!a.length)break;i=ge(i,a)}return i}function Me(t,n){var e=n instanceof se?n.value:ut(n,t.machine.delimiter);if(Y(e))return[t,t.states[e]];var i=Object.keys(e),a=i.map(function(s){return ge(t,s)}).filter(Boolean);return[t.machine.root,t].concat(a,i.reduce(function(s,u){var f=ge(t,u);if(!f)return s;var c=Me(f,e[u]);return s.concat(c)},[]))}function Cr(t,n,e,i){var a=ge(t,n),s=a.next(e,i);return!s||!s.length?t.next(e,i):s}function Hr(t,n,e,i){var a=Object.keys(n),s=ge(t,a[0]),u=xt(s,n[a[0]],e,i);return!u||!u.length?t.next(e,i):u}function Fr(t,n,e,i){for(var a=[],s=0,u=Object.keys(n);s<u.length;s++){var f=u[s],c=n[f];if(c){var d=ge(t,f),v=xt(d,c,e,i);v&&a.push.apply(a,M(v))}}return a.length?a:t.next(e,i)}function xt(t,n,e,i){return Y(n)?Cr(t,n,e,i):Object.keys(n).length===1?Hr(t,n,e,i):Fr(t,n,e,i)}function Gr(t){return Object.keys(t.states).map(function(n){return t.states[n]}).filter(function(n){return n.type==="history"})}function fe(t,n){for(var e=t;e.parent&&e.parent!==n;)e=e.parent;return e.parent===n}function Bt(t){for(var n=[],e=t.parent;e;)n.unshift(e),e=e.parent;return n}function Vr(t,n){var e=new Set(t),i=new Set(n),a=w(e),s;try{for(a.s();!(s=a.n()).done;){var u=s.value;if(i.has(u))return!0}}catch(v){a.e(v)}finally{a.f()}var f=w(i),c;try{for(f.s();!(c=f.n()).done;){var d=c.value;if(e.has(d))return!0}}catch(v){f.e(v)}finally{f.f()}return!1}function Dn(t,n,e){var i=new Set,a=w(t),s;try{for(a.s();!(s=a.n()).done;){var u=s.value,f=!1,c=new Set,d=w(i),v;try{for(d.s();!(v=d.n()).done;){var r=v.value;if(Vr(ft([u],n,e),ft([r],n,e)))if(fe(u.source,r.source))c.add(r);else{f=!0;break}}}catch(_){d.e(_)}finally{d.f()}if(!f){var o=w(c),l;try{for(o.s();!(l=o.n()).done;){var h=l.value;i.delete(h)}}catch(_){o.e(_)}finally{o.f()}i.add(u)}}}catch(_){a.e(_)}finally{a.f()}return Array.from(i)}function Rr(t){var n=St(t,1),e=n[0],i=Bt(e),a=[],s=w(t),u;try{var f=function(){var d=u.value,v=Bt(d);a=i.filter(function(r){return v.includes(r)}),i=a,a=[]};for(s.s();!(u=s.n()).done;)f()}catch(c){s.e(c)}finally{s.f()}return i[i.length-1]}function It(t,n){if(!t.target)return[];var e=new Set,i=w(t.target),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;if(We(s))if(n[s.id]){var u=w(n[s.id]),f;try{for(u.s();!(f=u.n()).done;){var c=f.value;e.add(c)}}catch(o){u.e(o)}finally{u.f()}}else{var d=w(It({target:$n(s)},n)),v;try{for(d.s();!(v=d.n()).done;){var r=v.value;e.add(r)}}catch(o){d.e(o)}finally{d.f()}}else e.add(s)}}catch(o){i.e(o)}finally{i.f()}return M(e)}function Cn(t,n){var e=It(t,n);if(!e)return null;if(!t.reenter&&t.source.type!=="parallel"&&e.every(function(a){return fe(a,t.source)}))return t.source;var i=Rr(e.concat(t.source));return i}function ft(t,n,e){var i=new Set,a=w(t),s;try{for(a.s();!(s=a.n()).done;){var u,f=s.value;if((u=f.target)!==null&&u!==void 0&&u.length){var c=Cn(f,e),d=w(n),v;try{for(d.s();!(v=d.n()).done;){var r=v.value;fe(r,c)&&i.add(r)}}catch(o){d.e(o)}finally{d.f()}}}}catch(o){a.e(o)}finally{a.f()}return M(i)}function Ve(t,n,e,i){var a=n.machine,s=n._initial||t.length>0,u=new Set(n.configuration);if(!n._initial&&!s){var f=be(n,{event:i,actions:[],transitions:[]});return f.changed=!1,f}var c=qr(n._initial?[{target:M(n.configuration).filter(Ye),source:a.root,reenter:!0,actions:[],eventType:null,toJSON:null}]:t,n,u,i,e),d=c.context,v=c.actions,r=Br(n,v),o=be(c,{value:{},transitions:t,children:r});return o.changed=n._initial?void 0:!Fn(o.value,n.value)||o.actions.length>0||d!==n.context,o}function Br(t,n){var e=S({},t.children),i=w(n),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;if(s.type===Ee&&s.params.ref){var u=s.params.ref;u&&(e[u.id]=u)}else if(s.type===bn){var f=s.params.actor;f&&delete e[f.id]}}}catch(c){i.e(c)}finally{i.f()}return e}function qr(t,n,e,i,a){var s=[],u=S({},n.historyValue),f=Dn(t,e,u),c=M(n._internalQueue);n._initial||Xr(f,e,u,s),s.push.apply(s,M(f.flatMap(function(_){return _.actions}))),Wr(f,e,s,c,n,u);var d=M(e),v=Ze(d);if(v){var r=d.sort(function(_,m){return m.order-_.order}).flatMap(function(_){return _.exit});s.push.apply(s,M(r))}try{var o=Je(s,i,n,a),l=o.nextState,h=v?Pr(d,l.context,i):void 0;return c.push.apply(c,M(l._internalQueue)),be(n,{actions:l.actions,configuration:d,historyValue:u,_internalQueue:c,context:l.context,event:i,done:v,output:h,children:l.children})}catch(_){throw _}}function Wr(t,n,e,i,a,s){var u=new Set,f=new Set;Hn(t,s,f,u),a._initial&&f.add(a.machine.root);var c=w(M(u).sort(function(x,P){return x.order-P.order})),d;try{for(c.s();!(d=c.n()).done;){var v=d.value;n.add(v);var r=w(v.invoke),o;try{for(r.s();!(o=r.n()).done;){var l=o.value;e.push(dt(l))}}catch(x){r.e(x)}finally{r.f()}if(e.push.apply(e,M(v.entry)),f.has(v)){var h=w(f),_;try{for(h.s();!(_=h.n()).done;){var m=_.value,p=m.initial.actions;e.push.apply(e,M(p))}}catch(x){h.e(x)}finally{h.f()}}if(v.type==="final"){var y=v.parent;if(!y.parent)continue;if(i.push(vt(y.id,v.output?xn(v.output,a.context,a.event):void 0)),y.parent){var b=y.parent;b.type==="parallel"&&le(b).every(function(x){return Ze(M(n),x)})&&i.push(vt(b.id))}}}}catch(x){c.e(x)}finally{c.f()}}function Hn(t,n,e,i){var a=w(t),s;try{for(a.s();!(s=a.n()).done;){var u=s.value,f=w(u.target||[]),c;try{for(f.s();!(c=f.n()).done;){var d=c.value;de(d,n,e,i)}}catch(_){f.e(_)}finally{f.f()}var v=Cn(u,n),r=It(u,n),o=w(r),l;try{for(o.s();!(l=o.n()).done;){var h=l.value;Re(h,v,i,n,e)}}catch(_){o.e(_)}finally{o.f()}}}catch(_){a.e(_)}finally{a.f()}}function de(t,n,e,i){if(We(t))if(n[t.id]){var a=n[t.id],s=w(a),u;try{for(s.s();!(u=s.n()).done;){var f=u.value;de(f,n,e,i)}}catch(G){s.e(G)}finally{s.f()}var c=w(a),d;try{for(c.s();!(d=c.n()).done;){var v=d.value;Re(v,t.parent,i,n,e);var r=w(e),o;try{for(r.s();!(o=r.n()).done;){var l=o.value;e.add(l)}}catch(G){r.e(G)}finally{r.f()}}}catch(G){c.e(G)}finally{c.f()}}else{var h=$n(t),_=w(h),m;try{for(_.s();!(m=_.n()).done;){var p=m.value;de(p,n,e,i)}}catch(G){_.e(G)}finally{_.f()}var y=w(h),b;try{for(y.s();!(b=y.n()).done;){var x=b.value;Re(x,t,i,n,e);var P=w(e),j;try{for(P.s();!(j=P.n()).done;){var $=j.value;e.add($)}}catch(G){P.e(G)}finally{P.f()}}}catch(G){y.e(G)}finally{y.f()}}else if(i.add(t),t.type==="compound"){e.add(t);var Z=t.initial.target,E=w(Z),ee;try{for(E.s();!(ee=E.n()).done;){var te=ee.value;de(te,n,e,i)}}catch(G){E.e(G)}finally{E.f()}var q=w(Z),O;try{for(q.s();!(O=q.n()).done;){var R=O.value;Re(R,t,i,n,e)}}catch(G){q.e(G)}finally{q.f()}}else if(t.type==="parallel"){var F=w(le(t).filter(function(G){return!We(G)})),ke;try{var He=function(){var xe=ke.value;M(i).some(function(Jn){return fe(Jn,xe)})||de(xe,n,e,i)};for(F.s();!(ke=F.n()).done;)He()}catch(G){F.e(G)}finally{F.f()}}}function Re(t,n,e,i,a){var s=kt(t,n),u=w(s),f;try{for(u.s();!(f=u.n()).done;){var c=f.value;if(e.add(c),c.type==="parallel"){var d=w(le(c).filter(function(o){return!We(o)})),v;try{var r=function(){var l=v.value;M(e).some(function(h){return fe(h,l)})||de(l,i,a,e)};for(d.s();!(v=d.n()).done;)r()}catch(o){d.e(o)}finally{d.f()}}}}catch(o){u.e(o)}finally{u.f()}}function Xr(t,n,e,i){var a=ft(t,n,e);a.sort(function(r,o){return o.order-r.order});var s=w(a),u;try{var f=function(){var o=u.value,l=w(Gr(o)),h;try{for(l.s();!(h=l.n()).done;){var _=h.value,m=void 0;_.history==="deep"?m=function(y){return Ye(y)&&fe(y,o)}:m=function(y){return y.parent===o},e[_.id]=Array.from(n).filter(m)}}catch(p){l.e(p)}finally{l.f()}};for(s.s();!(u=s.n()).done;)f()}catch(r){s.e(r)}finally{s.f()}var c=w(a),d;try{for(c.s();!(d=c.n()).done;){var v=d.value;i.push.apply(i,M(v.exit.flat()).concat(M(v.invoke.map(function(r){return En(r.id)})))),n.delete(v)}}catch(r){c.e(r)}finally{c.f()}}function Je(t,n,e,i){var a=e.machine,s=[],u=[],f=e;function c(l){if(s.push(l),(i==null?void 0:i.self.status)===J.Running){var h;(h=l.execute)===null||h===void 0||h.call(l,i),delete l.execute}}function d(l){var h=ei(l,a.options.actions);if(Tt(h)){var _,m=h.resolve(n,{state:f,action:l,actorContext:i}),p=St(m,2),y=p[0],b=p[1],x=(_=b.params)===null||_===void 0?void 0:_.actions;f=y,(b.type===ot||b.type===ir&&b.params.internal)&&typeof b.params.delay!="number"&&u.push(b),b.type!==ur&&c(b),Qe(x).forEach(d);return}c(h)}var v=w(t),r;try{for(v.s();!(r=v.n()).done;){var o=r.value;d(o)}}catch(l){v.e(l)}finally{v.f()}return{nextState:be(f,{actions:s,_internalQueue:u.map(function(l){return l.params.event})})}}function rt(t,n,e){var i=t,a=[];if(n.type===ct)return i=qt(n,i,e),a.push(i),{state:i,microstates:a};if(n.type!==gt){var s=Wt(n,i);i=Ve(s,t,e,n),a.push(i)}for(;!i.done;){var u=Jr(i);if(u.length===0)if(i.configuration.some(function(l){return l.always})&&(i.transitions=[]),i._internalQueue.length){var f,c=i.actions,d=i._internalQueue[0],v=Wt(d,i);i=Ve(v,i,e,d),i._internalQueue.shift(),(f=i.actions).unshift.apply(f,M(c)),a.push(i)}else break;if(u.length){var r,o=i.actions;i=Ve(u,i,e,i.event),(r=i.actions).unshift.apply(r,M(o)),a.push(i)}}return i.done&&qt(i.event,i,e),{state:i,microstates:a}}function qt(t,n,e){var i=[],a=w(n.configuration.sort(function(o,l){return l.order-o.order})),s;try{for(a.s();!(s=a.n()).done;){var u=s.value;i.push.apply(i,M(u.exit))}}catch(o){a.e(o)}finally{a.f()}for(var f=0,c=Object.values(n.children);f<c.length;f++){var d=c[f];i.push(En(d))}var v=Je(i,t,n,e),r=v.nextState;return r}function Wt(t,n){return n.machine.getTransitionData(n,t)}function Jr(t){var n=new Set,e=t.configuration.filter(Ye),i=w(e),a;try{for(i.s();!(a=i.n()).done;){var s=a.value,u=w([s].concat(kt(s,null))),f;try{e:for(u.s();!(f=u.n()).done;){var c=f.value;if(c.always){var d=w(c.always),v;try{for(d.s();!(v=d.n()).done;){var r=v.value;if(r.guard===void 0||At(r.guard,t.context,t.event,t)){n.add(r);break e}}}catch(o){d.e(o)}finally{d.f()}}}}catch(o){u.e(o)}finally{u.f()}}}catch(o){i.e(o)}finally{i.f()}return Dn(Array.from(n),new Set(t.configuration),t.historyValue)}function Xt(t,n){var e=Oe(Me(t,n));return jn(t,M(e))}function Fn(t,n){if(t===n)return!0;if(t===void 0||n===void 0)return!1;if(Y(t)||Y(n))return t===n;var e=Object.keys(t),i=Object.keys(n);return e.length===i.length&&e.every(function(a){return Fn(t[a],n[a])})}function Qr(t){var n=[],e=t.initial,i=new Set,a=new Set([t]);Hn([e],{},a,i);var s=w(M(i).sort(function(c,d){return c.order-d.order})),u;try{for(s.s();!(u=s.n()).done;){var f=u.value;n.push(f)}}catch(c){s.e(c)}finally{s.f()}return n}var Ur=["configuration","transitions","tags","machine"],Yr=["configuration","transitions","tags","machine","children"],se=function(){function t(n,e){var i,a,s,u;De(this,t),this.machine=e,g(this,"tags",void 0),g(this,"value",void 0),g(this,"done",void 0),g(this,"output",void 0),g(this,"context",void 0),g(this,"historyValue",{}),g(this,"actions",[]),g(this,"event",void 0),g(this,"_internalQueue",void 0),g(this,"_initial",!1),g(this,"changed",void 0),g(this,"configuration",void 0),g(this,"transitions",void 0),g(this,"children",void 0),this.context=n.context,this._internalQueue=(i=n._internalQueue)!==null&&i!==void 0?i:[],this.event=n.event,this.historyValue=n.historyValue||{},this.actions=(a=n.actions)!==null&&a!==void 0?a:[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=(s=n.configuration)!==null&&s!==void 0?s:Array.from(Oe(Me(e.root,n.value))),this.transitions=n.transitions,this.children=n.children,this.value=jn(e.root,this.configuration),this.tags=new Set(lt(this.configuration.map(function(f){return f.tags}))),this.done=(u=n.done)!==null&&u!==void 0?u:!1,this.output=n.output}return Ce(t,[{key:"toStrings",value:function(){var e=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.value,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:".";if(Y(i))return[i];var s=Object.keys(i);return s.concat.apply(s,M(s.map(function(u){return e.toStrings(i[u],a).map(function(f){return u+a+f})})))}},{key:"toJSON",value:function(){this.configuration,this.transitions;var e=this.tags;this.machine;var i=Ue(this,Ur);return S(S({},i),{},{tags:Array.from(e),meta:this.meta})}},{key:"matches",value:function(e){return Tn(e,this.value)}},{key:"hasTag",value:function(e){return this.tags.has(e)}},{key:"can",value:function(e){gr(!!this.machine);var i=this.machine.getTransitionData(this,e);return!!(i!=null&&i.length)&&i.some(function(a){return a.target!==void 0||a.actions.length})}},{key:"nextEvents",get:function(){var e=this;return oe(this,"nextEvents",function(){return M(new Set(lt(M(e.configuration.map(function(i){return i.ownEvents})))))})}},{key:"meta",get:function(){return this.configuration.reduce(function(e,i){return i.meta!==void 0&&(e[i.id]=i.meta),e},{})}}],[{key:"from",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;if(e instanceof t)return e.context!==i?new t({value:e.value,context:i,event:e.event,actions:[],meta:{},configuration:[],transitions:[],children:{}},a):e;var s=Be({}),u=Oe(Me(a.root,e));return new t({value:e,context:i,event:s,actions:[],meta:void 0,configuration:Array.from(u),transitions:[],children:{}},a)}}]),t}();function be(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new se(S(S({},t),n),t.machine)}function Zr(t){t.configuration,t.transitions,t.tags,t.machine;var n=t.children,e=Ue(t,Yr),i={};for(var a in n){var s,u;i[a]={state:(s=(u=n[a]).getPersistedState)===null||s===void 0?void 0:s.call(u),src:n[a].src}}return S(S({},e),{},{children:i})}function dt(t){return ce({type:Ee,params:t},function(n,e){var i=e.state,a=e.actorContext,s=Ee,u=t.id,f=t.src,c;if(kr(f))c={type:s,params:S(S({},t),{},{ref:f})};else{var d=qe(i.machine.options.actors[f]);if(!d)c={type:s,params:t};else{var v="input"in t?t.input:d.input,r=me(d.src,{id:u,src:f,parent:a==null?void 0:a.self,systemId:t.systemId,input:typeof v=="function"?v({context:i.context,event:n,self:a==null?void 0:a.self}):v});c={type:s,params:S(S({},t),{},{ref:r})}}}var o=c.params.ref,l=be(i,{children:S(S({},i.children),{},g({},u,o))});return c.execute=function(h){var _=h.self,m=c.params,p=m.id,y=m.ref;y&&h.defer(function(){if(o.status!==J.Stopped)try{var b;(b=o.start)===null||b===void 0||b.call(o)}catch(x){_.send(Et(p,x));return}})},[l,c]})}function Gn(t,n,e,i,a){return function(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Y(s)){var f=qe(n.options.actors[s]);if(f){var c,d=(c=u.id)!==null&&c!==void 0?c:"anon",v="input"in u?u.input:f.input,r=me(f.src,{id:d,parent:t,input:typeof v=="function"?v({context:e,event:i,self:t}):v});return a.push(dt({id:r.id,src:r,ref:r,meta:void 0,input:v})),r}throw new Error("Behavior '".concat(s,"' not implemented in machine '").concat(n.id,"'"))}else{var o=me(s,{id:u.id||"anonymous",parent:t,input:u.input});return a.push(dt({src:o,ref:o,id:o.id,meta:void 0,input:u.input})),o}}}function Kr(t){return ce({type:$t,params:{assignment:t}},function(n,e){var i,a=e.state,s=e.action,u=e.actorContext,f=[];if(!a.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");var c={context:a.context,event:n,action:s,spawn:Gn(u==null?void 0:u.self,a.machine,a.context,n,f),self:(i=u==null?void 0:u.self)!==null&&i!==void 0?i:{},system:u==null?void 0:u.system},d={};if(ie(t))d=t(c);else for(var v=0,r=Object.keys(t);v<r.length;v++){var o=r[v],l=t[o];d[o]=ie(l)?l(c):l}var h=Object.assign({},a.context,d);return[be(a,{context:h}),{type:$t,params:{context:h,actions:f}}]})}function Nr(t,n){return ce({type:ot,params:{delay:n?n.delay:void 0,event:t,id:n&&n.id!==void 0?n.id:typeof t=="function"?t.name:t.type}},function(e,i){var a,s=i.state,u=i.actorContext,f={delay:n?n.delay:void 0,event:t,id:n&&n.id!==void 0?n.id:typeof t=="function"?t.name:t.type},c={context:s.context,event:e,self:(a=u==null?void 0:u.self)!==null&&a!==void 0?a:{},system:u==null?void 0:u.system},d=s.machine.options.delays;if(typeof t=="string")throw new Error('Only event objects may be used with raise; use raise({ type: "'.concat(t,'" }) instead'));var v=typeof t=="function"?t(c):t,r;if(typeof f.delay=="string"){var o=d&&d[f.delay];r=typeof o=="function"?o(c):o}else r=typeof f.delay=="function"?f.delay(c):f.delay;var l={type:ot,params:S(S({},f),{},{event:v,delay:r}),execute:function(_){if(typeof l.params.delay=="number"){_.self.delaySend(l);return}}};return[s,l]})}var zr={type:gt};function ei(t,n){if(Tt(t))return t;var e=n[t.type];if(typeof e=="function"){var i;return ce({type:"xstate.function",params:(i=t.params)!==null&&i!==void 0?i:{}},function(a,s){var u=s.state,f={type:t.type,params:t.params,execute:function(d){return e({context:u.context,event:a,action:f,system:d.system,self:d.self})}};return[u,f]})}else return e||t}function ti(t){if(Tt(t))return t;if(typeof t=="string")return{type:t,params:{}};if(typeof t=="function"){var n="xstate.function";return ce({type:n,params:{}},function(e,i){var a=i.state,s={type:n,params:{function:t},execute:function(f){return t({context:a.context,event:e,action:s,self:f.self,system:f.system})}};return[a,s]})}return t}var Qe=function(n){if(!n)return[];var e=Ae(n)?n:[n];return e.map(ti)};function ni(t,n){var e=n?"#".concat(n):"";return"".concat(B.After,"(").concat(t,")").concat(e)}function vt(t,n){var e="".concat(B.DoneState,".").concat(t),i={type:e,output:n};return i.toString=function(){return e},i}function ri(t,n){var e="".concat(B.DoneInvoke,".").concat(t),i={type:e,output:n};return i.toString=function(){return e},i}function Et(t,n){var e="".concat(B.ErrorPlatform,".").concat(t),i={type:e,data:n};return i.toString=function(){return e},i}function Be(t){return{type:gt,input:t}}var ii=["onDone","onError"],ai={},oi=function(){function t(n,e){var i=this;if(De(this,t),this.config=n,g(this,"key",void 0),g(this,"id",void 0),g(this,"type",void 0),g(this,"path",void 0),g(this,"states",void 0),g(this,"history",void 0),g(this,"entry",void 0),g(this,"exit",void 0),g(this,"parent",void 0),g(this,"machine",void 0),g(this,"meta",void 0),g(this,"output",void 0),g(this,"order",-1),g(this,"description",void 0),g(this,"tags",[]),g(this,"transitions",void 0),g(this,"always",void 0),this.parent=e._parent,this.key=e._key,this.machine=e._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id].concat(M(this.path)).join(this.machine.delimiter),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?Ht(this.config.states,function(a,s){var u=new t(a,{_parent:i,_key:s,_machine:i.machine});return u}):ai,this.type==="compound"&&!this.config.initial)throw new Error('No initial state specified for compound state node "#'.concat(this.id,'". Try adding { initial: "').concat(Object.keys(this.states)[0],'" } to the state config.'));this.history=this.config.history===!0?"shallow":this.config.history||!1,this.entry=Qe(this.config.entry),this.exit=Qe(this.config.exit),this.meta=this.config.meta,this.output=this.type==="final"?this.config.output:void 0,this.tags=re(n.tags)}return Ce(t,[{key:"_initialize",value:function(){var e=this;this.transitions=$r(this),this.config.always&&(this.always=ae(Sn,this.config.always).map(function(i){return Ke(e,i)})),Object.keys(this.states).forEach(function(i){e.states[i]._initialize()})}},{key:"definition",get:function(){var e=this;return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions,eventType:null,reenter:!1,toJSON:function(){return{target:e.initial.target.map(function(a){return"#".concat(a.id)}),source:"#".concat(e.id),actions:e.initial.actions,eventType:null}}}:void 0,history:this.history,states:Ht(this.states,function(i){return i.definition}),on:this.on,transitions:this.transitions,entry:this.entry,exit:this.exit,meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}},{key:"toJSON",value:function(){return this.definition}},{key:"invoke",get:function(){var e=this;return oe(this,"invoke",function(){return re(e.config.invoke).map(function(i,a){var s=Tr(e.id,a),u=wr(i,s),f=u.id||s,c=u.src,d=u.systemId,v=Y(c)||"type"in c?c:f;return!e.machine.options.actors[f]&&typeof c!="string"&&!("type"in c)&&(e.machine.options.actors=S(S({},e.machine.options.actors),{},g({},f,c))),S(S({type:Ee},u),{},{src:v,id:f,systemId:d,toJSON:function(){u.onDone,u.onError;var o=Ue(u,ii);return S(S({},o),{},{type:Ee,src:v,id:f})}})})})}},{key:"on",get:function(){var e=this;return oe(this,"on",function(){var i=e.transitions;return i.reduce(function(a,s){return a[s.eventType]=a[s.eventType]||[],a[s.eventType].push(s),a},{})})}},{key:"after",get:function(){var e=this;return oe(this,"delayedTransitions",function(){return Lr(e)})}},{key:"initial",get:function(){var e=this;return oe(this,"initial",function(){return Dr(e,e.config.initial||[])})}},{key:"next",value:function(e,i){var a=this,s=i.type,u=[],f,c=oe(this,"candidates-".concat(s),function(){return jr(a,s)}),d=w(c),v;try{for(d.s();!(v=d.n()).done;){var r=v.value,o=r.guard,l=e.context,h=!1;try{h=!o||At(o,l,i,e)}catch(_){throw new Error("Unable to evaluate guard '".concat(o.type,"' in transition for event '").concat(s,"' in state node '").concat(this.id,`':
`).concat(_.message))}if(h){u.push.apply(u,M(r.actions)),f=r;break}}}catch(_){d.e(_)}finally{d.f()}return f?[f]:void 0}},{key:"target",get:function(){if(this.type==="history"){var e=this.config;return e.target}}},{key:"stateIds",get:function(){var e=this,i=lt(Object.keys(this.states).map(function(a){return e.states[a].stateIds}));return[this.id].concat(i)}},{key:"events",get:function(){var e=this;return oe(this,"events",function(){var i=e.states,a=new Set(e.ownEvents);if(i)for(var s=0,u=Object.keys(i);s<u.length;s++){var f=u[s],c=i[f];if(c.states){var d=w(c.events),v;try{for(d.s();!(v=d.n()).done;){var r=v.value;a.add("".concat(r))}}catch(o){d.e(o)}finally{d.f()}}}return Array.from(a)})}},{key:"ownEvents",get:function(){var e=new Set(this.transitions.filter(function(i){return!(!i.target&&!i.actions.length&&!i.reenter)}).map(function(i){return i.eventType}));return Array.from(e)}}]),t}(),si="#";function ui(){return{actions:{},actors:{},delays:{},guards:{},context:{}}}var li=function(){function t(n,e){var i;De(this,t),this.config=n,g(this,"version",void 0),g(this,"delimiter",void 0),g(this,"options",void 0),g(this,"types",void 0),g(this,"__xstatenode",!0),g(this,"idMap",new Map),g(this,"root",void 0),g(this,"id",void 0),g(this,"states",void 0),g(this,"events",void 0),g(this,"__TContext",void 0),g(this,"__TEvent",void 0),g(this,"__TAction",void 0),g(this,"__TActorMap",void 0),g(this,"__TResolvedTypesMeta",void 0),this.id=n.id||"(machine)",this.options=Object.assign(ui(),e),this.delimiter=this.config.delimiter||wn,this.version=this.config.version,this.types=(i=this.config.types)!==null&&i!==void 0?i:{},this.transition=this.transition.bind(this),this.root=new oi(n,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}return Ce(t,[{key:"getContext",value:function(e){return this.getContextAndActions(void 0,e)[0]}},{key:"getContextAndActions",value:function(e,i){var a=[],s=this.config.context,u=typeof s=="function"?s({spawn:Gn(e==null?void 0:e.self,this,void 0,Be(i),a),input:i}):s;return[u||{},a]}},{key:"provide",value:function(e){var i=this.options,a=i.actions,s=i.guards,u=i.actors,f=i.delays;return new t(this.config,{actions:S(S({},a),e.actions),guards:S(S({},s),e.guards),actors:S(S({},u),e.actors),delays:S(S({},f),e.delays)})}},{key:"resolveState",value:function(e){var i=Oe(Me(this.root,e.value)),a=Array.from(i);return this.createState(S(S({},e),{},{value:Xt(this.root,e.value),configuration:a,done:Ze(a)}))}},{key:"resolveStateValue",value:function(e){var i=Xt(this.root,e),a=this.getContext();return this.resolveState(se.from(i,a,this))}},{key:"transition",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.initialState,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,s=e instanceof se?e:this.resolveStateValue(e);if(br(i)&&!s.nextEvents.some(function(c){return c===i.type}))throw i.data;var u=rt(s,i,a),f=u.state;return f}},{key:"microstep",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.initialState,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return rt(e,i,a).microstates}},{key:"getTransitionData",value:function(e,i){return xt(this.root,e.value,e,i)||[]}},{key:"getPreInitialState",value:function(e,i){var a,s=this.getContextAndActions(e,i),u=St(s,2),f=u[0],c=u[1],d=Qr(this.root),v=this.resolveState(this.createState({value:{},context:f,event:Be({}),actions:[],meta:void 0,configuration:d,transitions:[],children:{}}));if(v._initial=!0,(a=v.actions).unshift.apply(a,M(c)),e){var r=Je(c,zr,v,e),o=r.nextState;v.children=o.children,v.actions=o.actions}return v}},{key:"initialState",get:function(){return this.getInitialState()}},{key:"getInitialState",value:function(e,i){var a,s=Be(i),u=this.getPreInitialState(e,i),f=Ve([],u,e,s);(a=f.actions).unshift.apply(a,M(u.actions));var c=rt(f,s,e),d=c.state;return d}},{key:"start",value:function(e,i){e.actions.forEach(function(a){var s;(s=a.execute)===null||s===void 0||s.call(a,i)}),Object.values(e.children).forEach(function(a){if(a.status===0)try{var s;(s=a.start)===null||s===void 0||s.call(a)}catch(u){i.self.send(Et(a.id,u))}})}},{key:"getStateNodeById",value:function(e){var i=e.split(this.delimiter),a=i.slice(1),s=ye(i[0])?i[0].slice(si.length):i[0],u=this.idMap.get(s);if(!u)throw new Error("Child state node '#".concat(s,"' does not exist on machine '").concat(this.id,"'"));return Xe(u,a)}},{key:"definition",get:function(){return S({context:this.getContext()},this.root.definition)}},{key:"toJSON",value:function(){return this.definition}},{key:"getPersistedState",value:function(e){return Zr(e)}},{key:"createState",value:function(e){var i=e instanceof se?e:new se(e,this),a=Je(i.actions,i.event,i,void 0),s=a.nextState;return s}},{key:"getStatus",value:function(e){return e.done?{status:"done",data:e.output}:{status:"active"}}},{key:"restoreState",value:function(e,i){var a=this,s={};Object.keys(e.children).forEach(function(f){var c,d,v=e.children[f],r=v.state,o=v.src,l=o?(c=qe(a.options.actors[o]))===null||c===void 0?void 0:c.src:void 0;if(l){var h=(d=l.restoreState)===null||d===void 0?void 0:d.call(l,r,i),_=me(l,{id:f,state:h});s[f]=_}});var u=this.createState(new se(S(S({},e),{},{children:s}),this));return u.configuration.forEach(function(f){f.invoke&&f.invoke.forEach(function(c){var d=c.id,v=c.src;if(!s[d]){var r=qe(a.options.actors[v]);if(r){var o=me(r.src,{id:d,parent:i==null?void 0:i.self,input:"input"in c?c.input:r.input});s[d]=o}}})}),u.actions=[],u}}]),t}();function ci(t,n){return new li(t,n)}function fi(t,...[n={}]){const{guards:e,actions:i,actors:a,delays:s,...u}=n,f={guards:e,actions:i,actors:a,delays:s},c=t.provide(f),d=me(c,u).start();return Qn(()=>d.stop()),{state:gn(d.getSnapshot(),r=>d.subscribe(o=>{o.changed&&r(o)}).unsubscribe),send:d.send,service:d}}const Vn={},di=t=>{Un(Vn,t)},Ne=()=>Yn(Vn),vi=ci({id:"gameClient",context:({input:t})=>({gameId:t.gameId,userId:t.userId,hostUserId:t.hostUserId,users:[],characters:[],actions:[]}),types:{context:{},events:{},actors:{}},initial:"Initial",states:{Initial:{always:[{target:"Lobby",guard:"gameNotStarted"},{target:"Finished",guard:"gameFinished"},{target:"Ingame"}]},Ingame:{entry:["consoleLogValueAgain"],states:{Initial:{}},initial:"Initial"},Lobby:{states:{"As admin":{on:{"assign side":{target:"As admin",actions:"forwardToServer"},"assign admin":{target:"As admin",actions:"forwardToServer"}}},"As player":{},Initial:{always:[{target:"As admin",guard:"isAdmin"},"As player"]}},initial:"Initial",on:{"admin starts game":{actions:"consoleLogValue",target:"Ingame"}}},Finished:{}},on:{"users update":{target:"#gameClient",actions:"updateUsers"},"user sends emoji":{target:"#gameClient",actions:"sendEmoji"},"show emoji":{target:"#gameClient",actions:"showEmoji"}}}),hi=({send:t,actions:n})=>vi.provide({actions:{consoleLogValue:({event:e})=>{console.log(e)},consoleLogValueAgain:({context:e})=>{console.log("context value 2: ",e)},updateUsers:Kr(({event:e})=>({users:e.users})),sendEmoji:({event:e})=>{t({type:"send emoji",emoji:e.emoji})},showEmoji:({event:e})=>{const i=e;n.showEmoji({userId:i.userId,emoji:i.emoji})},forwardToServer:({event:e})=>{t(e)}},actors:{},guards:{isHost:({context:e})=>e.hostUserId===e.userId,isAdmin:({context:e})=>!!e.users.find(i=>i.id===e.userId&&i.isAdmin),isPlayer:({context:e})=>e.hostUserId!==e.userId,gameNotStarted:()=>!0,gameFinished:()=>!1}}),pi=({gameId:t,userId:n,onMessage:e})=>{const i=er({status:"opening",log:[]}),a=(d,v)=>(console.debug("[websocket]",d,v),i.update(r=>({...r,log:[...r.log,`[websocket] ${d}`]}))),s=d=>i.update(v=>({...v,status:d}));let u;const f=()=>{a("connecting");const d=window.location.protocol==="https:"?"wss:":"ws:";u=new WebSocket(`${d}//${window.location.host}/websocket?gameId=${t}&userId=${n}`),u.addEventListener("open",()=>{s("opened"),a("connection open")}),u.addEventListener("close",()=>{s("closed"),a("connection closed")}),u.addEventListener("message",v=>{try{const r=JSON.parse(v.data);r.type!=="mouse position"&&a(`message received: ${v.data}`,v),e(r)}catch(r){a("error parsing message",r)}})},c=d=>{u==null||u.send(JSON.stringify(d))};return{subscribe:i.subscribe,open:f,close:()=>u==null?void 0:u.close(),send:c}},_i=(t,n)=>t===n,ve=(t,n,e=_i)=>{let i,a=n(t.getSnapshot());return gn(a,u=>(i=t.subscribe(f=>{const c=n(f);e(a,c)||(a=c,u(c))}),()=>{i.unsubscribe()}))};var k=class{static clamp(t,n,e){return Math.max(n,typeof e<"u"?Math.min(t,e):t)}static clampV(t,n,e){return t.map(i=>e?k.clamp(i,n,e):k.clamp(i,n))}static cross(t,n,e){return(n[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(n[1]-t[1])}static snap(t,n=1){return[Math.round(t[0]/n)*n,Math.round(t[1]/n)*n]}},T=k;T.neg=t=>[-t[0],-t[1]];T.add=(t,n)=>[t[0]+n[0],t[1]+n[1]];T.addScalar=(t,n)=>[t[0]+n,t[1]+n];T.sub=(t,n)=>[t[0]-n[0],t[1]-n[1]];T.subScalar=(t,n)=>[t[0]-n,t[1]-n];T.vec=(t,n)=>[n[0]-t[0],n[1]-t[1]];T.mul=(t,n)=>[t[0]*n,t[1]*n];T.mulV=(t,n)=>[t[0]*n[0],t[1]*n[1]];T.div=(t,n)=>[t[0]/n,t[1]/n];T.divV=(t,n)=>[t[0]/n[0],t[1]/n[1]];T.per=t=>[t[1],-t[0]];T.dpr=(t,n)=>t[0]*n[0]+t[1]*n[1];T.cpr=(t,n)=>t[0]*n[1]-n[0]*t[1];T.len2=t=>t[0]*t[0]+t[1]*t[1];T.len=t=>Math.hypot(t[0],t[1]);T.pry=(t,n)=>k.dpr(t,n)/k.len(n);T.uni=t=>k.div(t,k.len(t));T.normalize=t=>k.uni(t);T.tangent=(t,n)=>k.uni(k.sub(t,n));T.dist2=(t,n)=>k.len2(k.sub(t,n));T.dist=(t,n)=>Math.hypot(t[1]-n[1],t[0]-n[0]);T.fastDist=(t,n)=>{const e=[n[0]-t[0],n[1]-t[1]],i=[Math.abs(e[0]),Math.abs(e[1])];let a=1/Math.max(i[0],i[1]);return a=a*(1.29289-(i[0]+i[1])*a*.29289),[e[0]*a,e[1]*a]};T.ang=(t,n)=>Math.atan2(k.cpr(t,n),k.dpr(t,n));T.angle=(t,n)=>Math.atan2(n[1]-t[1],n[0]-t[0]);T.med=(t,n)=>k.mul(k.add(t,n),.5);T.rot=(t,n=0)=>[t[0]*Math.cos(n)-t[1]*Math.sin(n),t[0]*Math.sin(n)+t[1]*Math.cos(n)];T.rotWith=(t,n,e=0)=>{if(e===0)return t;const i=Math.sin(e),a=Math.cos(e),s=t[0]-n[0],u=t[1]-n[1],f=s*a-u*i,c=s*i+u*a;return[f+n[0],c+n[1]]};T.isEqual=(t,n)=>t[0]===n[0]&&t[1]===n[1];T.lrp=(t,n,e)=>k.add(t,k.mul(k.sub(n,t),e));T.int=(t,n,e,i,a=1)=>{const s=(k.clamp(e,i)-e)/(i-e);return k.add(k.mul(t,1-s),k.mul(n,a))};T.ang3=(t,n,e)=>{const i=k.vec(n,t),a=k.vec(n,e);return k.ang(i,a)};T.abs=t=>[Math.abs(t[0]),Math.abs(t[1])];T.rescale=(t,n)=>{const e=k.len(t);return[n*t[0]/e,n*t[1]/e]};T.isLeft=(t,n,e)=>(n[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(n[1]-t[1]);T.clockwise=(t,n,e)=>k.isLeft(t,n,e)>0;T.toFixed=(t,n=2)=>t.map(e=>+e.toFixed(n));T.nearestPointOnLineThroughPoint=(t,n,e)=>k.add(t,k.mul(n,k.pry(k.sub(e,t),n)));T.distanceToLineThroughPoint=(t,n,e)=>k.dist(e,k.nearestPointOnLineThroughPoint(t,n,e));T.nearestPointOnLineSegment=(t,n,e,i=!0)=>{const a=k.uni(k.sub(n,t)),s=k.add(t,k.mul(a,k.pry(k.sub(e,t),a)));if(i){if(s[0]<Math.min(t[0],n[0]))return t[0]<n[0]?t:n;if(s[0]>Math.max(t[0],n[0]))return t[0]>n[0]?t:n;if(s[1]<Math.min(t[1],n[1]))return t[1]<n[1]?t:n;if(s[1]>Math.max(t[1],n[1]))return t[1]>n[1]?t:n}return s};T.distanceToLineSegment=(t,n,e,i=!0)=>k.dist(e,k.nearestPointOnLineSegment(t,n,e,i));T.nudge=(t,n,e)=>k.isEqual(t,n)?t:k.add(t,k.mul(k.uni(k.sub(n,t)),e));T.nudgeAtAngle=(t,n,e)=>[Math.cos(n)*e+t[0],Math.sin(n)*e+t[1]];T.toPrecision=(t,n=4)=>[+t[0].toPrecision(n),+t[1].toPrecision(n)];T.pointsBetween=(t,n,e=6)=>Array.from(Array(e)).map((i,a)=>{const s=a/(e-1),u=Math.min(1,.5+Math.abs(.5-s));return[...k.lrp(t,n,s),u]});T.slope=(t,n)=>t[0]===n[0]?NaN:(t[1]-n[1])/(t[0]-n[0]);T.max=(...t)=>[Math.max(...t.map(n=>n[0])),Math.max(...t.map(n=>n[1]))];T.min=(...t)=>[Math.max(...t.map(n=>n[0])),Math.max(...t.map(n=>n[1]))];var mi=class{constructor(t=[]){this.points=[],this.lengths=[],this.totalLength=0,this.addPoint=n=>{if(this.prev){const e=T.dist(this.prev,n);this.lengths.push(e),this.totalLength+=e,this.points.push(n)}this.prev=n},this.clear=()=>{this.points=this.prev?[this.prev]:[],this.totalLength=0},this.getSplinePoint=n=>{const{points:e}=this,i=e.length-1,a=Math.trunc(n),s=Math.min(a+1,i),u=Math.min(s+1,i),f=Math.min(u+1,i),c=s-1,d=n-a,v=d*d,r=v*d,o=-r+2*v-d,l=3*r-5*v+2,h=-3*r+4*v+d,_=r-v;return[(e[c][0]*o+e[s][0]*l+e[u][0]*h+e[f][0]*_)/2,(e[c][1]*o+e[s][1]*l+e[u][1]*h+e[f][1]*_)/2]},this.points=t,this.lengths=t.map((n,e,i)=>e===0?0:T.dist(n,i[e-1])),this.totalLength=this.lengths.reduce((n,e)=>n+e,0)}},ht=class{constructor(t){this.state="idle",this.queue=[],this.timestamp=performance.now(),this.lastRequestId=0,this.timeoutId=0,this.spline=new mi,this.addPoint=n=>{clearTimeout(this.timeoutId);const e=performance.now(),i=Math.min(e-this.timestamp,ht.MAX_INTERVAL);if(!this.prevPoint){this.spline.clear(),this.prevPoint=n,this.spline.addPoint(n),this.cb(n),this.state="stopped";return}if(this.state==="stopped"){if(T.dist(this.prevPoint,n)<4){this.cb(n);return}this.spline.clear(),this.spline.addPoint(this.prevPoint),this.spline.addPoint(this.prevPoint),this.spline.addPoint(n),this.state="idle"}else this.spline.addPoint(n);if(i<16){this.prevPoint=n,this.timestamp=e,this.cb(n);return}const a={start:this.spline.points.length-3,from:this.prevPoint,to:n,duration:i};switch(this.prevPoint=n,this.timestamp=e,this.state){case"idle":{this.state="animating",this.animateNext(a);break}case"animating":{this.queue.push(a);break}}},this.animateNext=n=>{const e=performance.now(),i=()=>{const a=(performance.now()-e)/n.duration;if(a<=1&&this.spline.points.length>0){try{this.cb(this.spline.getSplinePoint(a+n.start))}catch(u){console.warn(u)}this.lastRequestId=requestAnimationFrame(i);return}const s=this.queue.shift();s?(this.state="animating",this.animateNext(s)):(this.state="idle",this.timeoutId=setTimeout(()=>{this.state="stopped"},ht.MAX_INTERVAL))};i()},this.dispose=()=>{clearTimeout(this.timeoutId)},this.cb=t}},Rn=ht;Rn.MAX_INTERVAL=300;function yi(t){let n,e,i,a,s,u=t[0].name+"",f;return{c(){n=C("div"),e=Mt("svg"),i=Mt("path"),a=Q(),s=C("span"),f=W(u),this.h()},l(c){n=H(c,"DIV",{class:!0});var d=D(n);e=Pt(d,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,"stroke-width":!0,stroke:!0,fill:!0,"stroke-linecap":!0,"stroke-linejoin":!0,class:!0});var v=D(e);i=Pt(v,"path",{d:!0}),D(i).forEach(A),v.forEach(A),a=U(d),s=H(d,"SPAN",{class:!0});var r=D(s);f=X(r,u),r.forEach(A),d.forEach(A),this.h()},h(){L(i,"d","M7.904 17.563a1.2 1.2 0 0 0 2.228 .308l2.09 -3.093l4.907 4.907a1.067 1.067 0 0 0 1.509 0l1.047 -1.047a1.067 1.067 0 0 0 0 -1.509l-4.907 -4.907l3.113 -2.09a1.2 1.2 0 0 0 -.309 -2.228l-13.582 -3.904l3.904 13.563z"),L(e,"xmlns","http://www.w3.org/2000/svg"),L(e,"width","44"),L(e,"height","44"),L(e,"viewBox","0 0 24 24"),L(e,"stroke-width","1.5"),L(e,"stroke","#2c3e50"),L(e,"fill","white"),L(e,"stroke-linecap","round"),L(e,"stroke-linejoin","round"),L(e,"class","svelte-qvny00"),L(s,"class","name svelte-qvny00"),L(n,"class","cursor svelte-qvny00")},m(c,d){V(c,n,d),I(n,e),I(e,i),I(n,a),I(n,s),I(s,f),t[3](n)},p(c,[d]){d&1&&u!==(u=c[0].name+"")&&he(f,u)},i:pe,o:pe,d(c){c&&A(n),t[3](null)}}}function gi(t,n,e){let{position:i}=n,a,s;hn(()=>(e(2,a=new Rn(([f,c])=>{s.style.setProperty("translate",`${f}px ${c}px`)})),()=>{a==null||a.dispose()}));function u(f){pt[f?"unshift":"push"](()=>{s=f,e(1,s)})}return t.$$set=f=>{"position"in f&&e(0,i=f.position)},t.$$.update=()=>{t.$$.dirty&5&&(a==null||a.addPoint(i.position))},[i,s,a,u]}class bi extends we{constructor(n){super(),Se(this,n,gi,yi,Te,{position:0})}}function Jt(t,n,e){const i=t.slice();return i[9]=n[e],i}function Qt(t,n){let e,i,a;return i=new bi({props:{position:n[9]}}),{key:t,first:null,c(){e=jt(),Pe(i.$$.fragment),this.h()},l(s){e=jt(),je(i.$$.fragment,s),this.h()},h(){this.first=e},m(s,u){V(s,e,u),Le(i,s,u),a=!0},p(s,u){n=s;const f={};u&4&&(f.position=n[9]),i.$set(f)},i(s){a||(K(i.$$.fragment,s),a=!0)},o(s){N(i.$$.fragment,s),a=!1},d(s){s&&A(e),$e(i,s)}}}function wi(t){let n,e=[],i=new Map,a,s,u=t[2];const f=c=>c[9].id;for(let c=0;c<u.length;c+=1){let d=Jt(t,u,c),v=f(d);i.set(v,e[c]=Qt(v,d))}return{c(){n=C("div");for(let c=0;c<e.length;c+=1)e[c].c();this.h()},l(c){n=H(c,"DIV",{class:!0});var d=D(n);for(let v=0;v<e.length;v+=1)e[v].l(d);d.forEach(A),this.h()},h(){L(n,"class","cursor-overlays svelte-1n4ax7h"),_t(()=>t[6].call(n))},m(c,d){V(c,n,d);for(let v=0;v<e.length;v+=1)e[v]&&e[v].m(n,null);a=pn(n,t[6].bind(n)),s=!0},p(c,[d]){d&4&&(u=c[2],mt(),e=_n(e,d,f,1,c,u,i,n,mn,Qt,null,Jt),yt())},i(c){if(!s){for(let d=0;d<u.length;d+=1)K(e[d]);s=!0}},o(c){for(let d=0;d<e.length;d+=1)N(e[d]);s=!1},d(c){c&&A(n);for(let d=0;d<e.length;d+=1)e[d].d();a()}}}function Si(t,n,e){let i,a,{mousePositions:s={}}=n;const u=Ne();let f=1,c=1;const d=ve(u.machine.service,o=>o.context.users);ne(t,d,o=>e(5,a=o));const v=(o,l)=>o.filter(h=>h.isConnected&&!!l[h.id]).map(h=>{const _=l[h.id];return{id:h.id,name:h.name,position:[_[0]*f,_[1]*c]}});function r(){f=this.clientWidth,c=this.clientHeight,e(0,f),e(1,c)}return t.$$set=o=>{"mousePositions"in o&&e(4,s=o.mousePositions)},t.$$.update=()=>{t.$$.dirty&48&&e(2,i=v(a,s))},[f,c,i,d,s,a,r]}class Ti extends we{constructor(n){super(),Se(this,n,Si,wi,Te,{mousePositions:4})}}function Ai(t){const n=t-1;return n*n*n+1}function ki(t,{delay:n=0,duration:e=400,easing:i=Zn}={}){const a=+getComputedStyle(t).opacity;return{delay:n,duration:e,easing:i,css:s=>`opacity: ${s*a}`}}function xi(t,{delay:n=0,duration:e=400,easing:i=Ai,start:a=0,opacity:s=0}={}){const u=getComputedStyle(t),f=+u.opacity,c=u.transform==="none"?"":u.transform,d=1-a,v=f*(1-s);return{delay:n,duration:e,easing:i,css:(r,o)=>`
			transform: ${c} scale(${1-d*o});
			opacity: ${f-v*o}
		`}}function Ut(t,n,e){const i=t.slice();return i[10]=n[e],i}function Yt(t,n,e){const i=t.slice();return i[1]=n[e][0],i[10]=n[e][1],i}function Zt(t,n){let e,i,a=n[10].emoji+"",s,u,f,c=n[10].userName+"",d,v,r,o,l,h;function _(){return n[6](n[1])}return{key:t,first:null,c(){e=C("div"),i=C("span"),s=W(a),u=Q(),f=C("span"),d=W(c),this.h()},l(m){e=H(m,"DIV",{class:!0});var p=D(e);i=H(p,"SPAN",{class:!0});var y=D(i);s=X(y,a),y.forEach(A),u=U(p),f=H(p,"SPAN",{class:!0});var b=D(f);d=X(b,c),b.forEach(A),p.forEach(A),this.h()},h(){L(i,"class","emjoi"),L(f,"class","name svelte-ar5859"),L(e,"class","displayed-emoji svelte-ar5859"),Fe(e,"--_x",n[10].position[0]),Fe(e,"--_y",n[10].position[1]),this.first=e},m(m,p){V(m,e,p),I(e,i),I(i,s),I(e,u),I(e,f),I(f,d),o=!0,l||(h=_e(e,"introend",_),l=!0)},p(m,p){n=m,(!o||p&1)&&a!==(a=n[10].emoji+"")&&he(s,a),(!o||p&1)&&c!==(c=n[10].userName+"")&&he(d,c),p&1&&Fe(e,"--_x",n[10].position[0]),p&1&&Fe(e,"--_y",n[10].position[1])},i(m){o||(_t(()=>{o&&(r&&r.end(1),v=Kn(e,xi,{duration:200,start:.4}),v.start())}),o=!0)},o(m){v&&v.invalidate(),r=Nn(e,ki,{}),o=!1},d(m){m&&A(e),m&&r&&r.end(),l=!1,h()}}}function Kt(t){let n,e=t[10]+"",i,a,s;function u(){return t[7](t[10])}return{c(){n=C("button"),i=W(e),this.h()},l(f){n=H(f,"BUTTON",{class:!0});var c=D(n);i=X(c,e),c.forEach(A),this.h()},h(){L(n,"class","emoji svelte-ar5859")},m(f,c){V(f,n,c),I(n,i),a||(s=_e(n,"click",u),a=!0)},p(f,c){t=f},d(f){f&&A(n),a=!1,s()}}}function Ii(t){let n,e=[],i=new Map,a,s,u=Object.entries(t[0]);const f=v=>v[1];for(let v=0;v<u.length;v+=1){let r=Yt(t,u,v),o=f(r);i.set(o,e[v]=Zt(o,r))}let c=t[3],d=[];for(let v=0;v<c.length;v+=1)d[v]=Kt(Ut(t,c,v));return{c(){n=C("div");for(let v=0;v<e.length;v+=1)e[v].c();a=Q();for(let v=0;v<d.length;v+=1)d[v].c();this.h()},l(v){n=H(v,"DIV",{class:!0});var r=D(n);for(let o=0;o<e.length;o+=1)e[o].l(r);a=U(r);for(let o=0;o<d.length;o+=1)d[o].l(r);r.forEach(A),this.h()},h(){L(n,"class","emojis svelte-ar5859")},m(v,r){V(v,n,r);for(let o=0;o<e.length;o+=1)e[o]&&e[o].m(n,null);I(n,a);for(let o=0;o<d.length;o+=1)d[o]&&d[o].m(n,null);s=!0},p(v,[r]){if(r&1&&(u=Object.entries(v[0]),mt(),e=_n(e,r,f,1,v,u,i,n,mn,Zt,a,Yt),yt()),r&24){c=v[3];let o;for(o=0;o<c.length;o+=1){const l=Ut(v,c,o);d[o]?d[o].p(l,r):(d[o]=Kt(l),d[o].c(),d[o].m(n,null))}for(;o<d.length;o+=1)d[o].d(1);d.length=c.length}},i(v){if(!s){for(let r=0;r<u.length;r+=1)K(e[r]);s=!0}},o(v){for(let r=0;r<e.length;r+=1)N(e[r]);s=!1},d(v){v&&A(n);for(let r=0;r<e.length;r+=1)e[r].d();yn(d,v)}}}function Ei(t,n,e){let i;const a=Ne(),s=ve(a.machine.service,l=>l.context.users);ne(t,s,l=>e(8,i=l));const u=["","","","","",""],f=l=>{a.machine.send({type:"user sends emoji",emoji:l})};let c={},d=0;return[c,d,s,u,f,({userId:l,emoji:h})=>{var m;const _=((m=i.find(p=>p.id===l))==null?void 0:m.name)??"Unknown";e(0,c[`${e(1,d++,d)}`]={emoji:h,userName:_,position:[Math.random(),Math.random()]},c),e(0,c),e(1,d++,d)},l=>{setTimeout(()=>{delete c[l],e(0,c)},2e3)},l=>f(l)]}class Oi extends we{constructor(n){super(),Se(this,n,Ei,Ii,Te,{showEmoji:5})}get showEmoji(){return this.$$.ctx[5]}}function Nt(t,n,e){const i=t.slice();return i[13]=n[e],i}function zt(t){let n,e;return{c(){n=C("span"),e=W("admin"),this.h()},l(i){n=H(i,"SPAN",{class:!0});var a=D(n);e=X(a,"admin"),a.forEach(A),this.h()},h(){L(n,"class","admin")},m(i,a){V(i,n,a),I(n,e)},d(i){i&&A(n)}}}function Mi(t){let n;return{c(){n=W("---")},l(e){n=X(e,"---")},m(e,i){V(e,n,i)},d(e){e&&A(n)}}}function Pi(t){let n;return{c(){n=W("Verteidigung")},l(e){n=X(e,"Verteidigung")},m(e,i){V(e,n,i)},d(e){e&&A(n)}}}function ji(t){let n;return{c(){n=W("Angriff")},l(e){n=X(e,"Angriff")},m(e,i){V(e,n,i)},d(e){e&&A(n)}}}function en(t){let n,e,i,a,s,u,f;function c(){return t[9](t[13])}function d(){return t[10](t[13])}return{c(){n=C("button"),e=W("Angriff"),i=Q(),a=C("button"),s=W("Verteidigung")},l(v){n=H(v,"BUTTON",{});var r=D(n);e=X(r,"Angriff"),r.forEach(A),i=U(v),a=H(v,"BUTTON",{});var o=D(a);s=X(o,"Verteidigung"),o.forEach(A)},m(v,r){V(v,n,r),I(n,e),V(v,i,r),V(v,a,r),I(a,s),u||(f=[_e(n,"click",c),_e(a,"click",d)],u=!0)},p(v,r){t=v},d(v){v&&A(n),v&&A(i),v&&A(a),u=!1,zn(f)}}}function tn(t){let n,e,i,a;function s(){return t[11](t[13])}return{c(){n=C("button"),e=W("Toggle Admin")},l(u){n=H(u,"BUTTON",{});var f=D(n);e=X(f,"Toggle Admin"),f.forEach(A)},m(u,f){V(u,n,f),I(n,e),i||(a=_e(n,"click",s),i=!0)},p(u,f){t=u},d(u){u&&A(n),i=!1,a()}}}function nn(t){let n,e=t[13].name+"",i,a,s,u,f,c,d,v=t[13].isAdmin&&zt();function r(m,p){return m[13].side==="attacker"?ji:m[13].side==="defender"?Pi:Mi}let o=r(t),l=o(t),h=t[1]&&en(t),_=t[2]&&t[13].id!==t[3]&&tn(t);return{c(){n=C("div"),i=W(e),a=Q(),v&&v.c(),s=Q(),u=C("span"),l.c(),f=Q(),h&&h.c(),c=Q(),_&&_.c(),d=Q(),this.h()},l(m){n=H(m,"DIV",{class:!0});var p=D(n);i=X(p,e),a=U(p),v&&v.l(p),s=U(p),u=H(p,"SPAN",{class:!0});var y=D(u);l.l(y),y.forEach(A),f=U(p),h&&h.l(p),c=U(p),_&&_.l(p),d=U(p),p.forEach(A),this.h()},h(){L(u,"class","side svelte-190hwhb"),L(n,"class","user")},m(m,p){V(m,n,p),I(n,i),I(n,a),v&&v.m(n,null),I(n,s),I(n,u),l.m(u,null),I(n,f),h&&h.m(n,null),I(n,c),_&&_.m(n,null),I(n,d)},p(m,p){p&1&&e!==(e=m[13].name+"")&&he(i,e),m[13].isAdmin?v||(v=zt(),v.c(),v.m(n,s)):v&&(v.d(1),v=null),o!==(o=r(m))&&(l.d(1),l=o(m),l&&(l.c(),l.m(u,null))),m[1]?h?h.p(m,p):(h=en(m),h.c(),h.m(n,c)):h&&(h.d(1),h=null),m[2]&&m[13].id!==m[3]?_?_.p(m,p):(_=tn(m),_.c(),_.m(n,d)):_&&(_.d(1),_=null)},d(m){m&&A(n),v&&v.d(),l.d(),h&&h.d(),_&&_.d()}}}function Li(t){let n,e,i,a,s=t[0],u=[];for(let f=0;f<s.length;f+=1)u[f]=nn(Nt(t,s,f));return{c(){n=C("h1"),e=W("Lobby"),i=Q(),a=C("div");for(let f=0;f<u.length;f+=1)u[f].c();this.h()},l(f){n=H(f,"H1",{});var c=D(n);e=X(c,"Lobby"),c.forEach(A),i=U(f),a=H(f,"DIV",{class:!0});var d=D(a);for(let v=0;v<u.length;v+=1)u[v].l(d);d.forEach(A),this.h()},h(){L(a,"class","users")},m(f,c){V(f,n,c),I(n,e),V(f,i,c),V(f,a,c);for(let d=0;d<u.length;d+=1)u[d]&&u[d].m(a,null)},p(f,[c]){if(c&399){s=f[0];let d;for(d=0;d<s.length;d+=1){const v=Nt(f,s,d);u[d]?u[d].p(v,c):(u[d]=nn(v),u[d].c(),u[d].m(a,null))}for(;d<u.length;d+=1)u[d].d(1);u.length=s.length}},i:pe,o:pe,d(f){f&&A(n),f&&A(i),f&&A(a),yn(u,f)}}}function $i(t,n,e){let i,a,s;const{userId:u,machine:f}=Ne(),c=ve(f.service,m=>m.can({type:"assign side",otherUserId:"",side:"attacker"}));ne(t,c,m=>e(1,a=m));const d=ve(f.service,m=>m.can({type:"assign admin",otherUserId:"",isAdmin:!0}));ne(t,d,m=>e(2,s=m));const v=ve(f.service,m=>m.context.users.filter(p=>p.id!==m.context.hostUserId));ne(t,v,m=>e(0,i=m));const r=(m,p)=>{f.send({type:"assign side",otherUserId:m,side:p})},o=(m,p)=>{f.send({type:"assign admin",otherUserId:m,isAdmin:p})};return[i,a,s,u,c,d,v,r,o,m=>r(m.id,"attacker"),m=>r(m.id,"defender"),m=>o(m.id,!m.isAdmin)]}class Di extends we{constructor(n){super(),Se(this,n,$i,Li,Te,{})}}const Ci=t=>({}),rn=t=>({}),Hi=t=>({}),an=t=>({}),Fi=t=>({}),on=t=>({});function Gi(t){let n;return{c(){n=W("...")},l(e){n=X(e,"...")},m(e,i){V(e,n,i)},i:pe,o:pe,d(e){e&&A(n)}}}function Vi(t){let n,e;return n=new Di({}),{c(){Pe(n.$$.fragment)},l(i){je(n.$$.fragment,i)},m(i,a){Le(n,i,a),e=!0},i(i){e||(K(n.$$.fragment,i),e=!0)},o(i){N(n.$$.fragment,i),e=!1},d(i){$e(n,i)}}}function Ri(t){let n,e,i,a,s,u,f,c,d,v,r,o,l,h,_,m,p,y,b;const x=t[8].items,P=ze(x,t,t[7],on),j=t[8].actions,$=ze(j,t,t[7],an),Z=[Vi,Gi],E=[];function ee(O,R){return O[3]==="Lobby"?0:1}l=ee(t),h=E[l]=Z[l](t);const te=t[8]["cursor-overlays"],q=ze(te,t,t[7],rn);return{c(){n=C("div"),e=C("div"),i=C("div"),a=W("The Hidden Threat"),s=Q(),u=C("div"),f=Q(),c=C("div"),P&&P.c(),d=Q(),v=C("div"),$&&$.c(),r=Q(),o=C("div"),h.c(),_=Q(),q&&q.c(),this.h()},l(O){n=H(O,"DIV",{class:!0});var R=D(n);e=H(R,"DIV",{class:!0});var F=D(e);i=H(F,"DIV",{class:!0});var ke=D(i);a=X(ke,"The Hidden Threat"),ke.forEach(A),s=U(F),u=H(F,"DIV",{class:!0}),D(u).forEach(A),f=U(F),c=H(F,"DIV",{class:!0});var He=D(c);P&&P.l(He),He.forEach(A),d=U(F),v=H(F,"DIV",{class:!0});var G=D(v);$&&$.l(G),G.forEach(A),r=U(F),o=H(F,"DIV",{class:!0});var xe=D(o);h.l(xe),xe.forEach(A),_=U(F),q&&q.l(F),F.forEach(A),R.forEach(A),this.h()},h(){L(i,"class","name svelte-yumm1n"),L(u,"class","characters svelte-yumm1n"),L(c,"class","items svelte-yumm1n"),L(v,"class","actions svelte-yumm1n"),L(o,"class","content svelte-yumm1n"),L(e,"class","game svelte-yumm1n"),_t(()=>t[10].call(e)),L(n,"class","game-wrapper svelte-yumm1n")},m(O,R){V(O,n,R),I(n,e),I(e,i),I(i,a),I(e,s),I(e,u),I(e,f),I(e,c),P&&P.m(c,null),I(e,d),I(e,v),$&&$.m(v,null),I(e,r),I(e,o),E[l].m(o,null),I(e,_),q&&q.m(e,null),t[9](e),m=pn(e,t[10].bind(e)),p=!0,y||(b=_e(e,"mousemove",t[4]),y=!0)},p(O,[R]){P&&P.p&&(!p||R&128)&&et(P,x,O,O[7],p?nt(x,O[7],R,Fi):tt(O[7]),on),$&&$.p&&(!p||R&128)&&et($,j,O,O[7],p?nt(j,O[7],R,Hi):tt(O[7]),an);let F=l;l=ee(O),l!==F&&(mt(),N(E[F],1,1,()=>{E[F]=null}),yt(),h=E[l],h||(h=E[l]=Z[l](O),h.c()),K(h,1),h.m(o,null)),q&&q.p&&(!p||R&128)&&et(q,te,O,O[7],p?nt(te,O[7],R,Ci):tt(O[7]),rn)},i(O){p||(K(P,O),K($,O),K(h),K(q,O),p=!0)},o(O){N(P,O),N($,O),N(h),N(q,O),p=!1},d(O){O&&A(n),P&&P.d(O),$&&$.d(O),E[l].d(),q&&q.d(O),t[9](null),m(),y=!1,b()}}}function Bi(t,n,e){let i,{$$slots:a={},$$scope:s}=n;const{machine:u}=Ne();let{reportMousePosition:f}=n,c,d=1,v=1;const r=_=>{f([(_.clientX-c.offsetLeft)/d,(_.clientY-c.offsetTop)/v])},o=ve(u.service,_=>{let m;return _.matches("Lobby")&&(m="Lobby"),m});ne(t,o,_=>e(3,i=_));function l(_){pt[_?"unshift":"push"](()=>{c=_,e(0,c)})}function h(){d=this.clientWidth,v=this.clientHeight,e(1,d),e(2,v)}return t.$$set=_=>{"reportMousePosition"in _&&e(6,f=_.reportMousePosition),"$$scope"in _&&e(7,s=_.$$scope)},[c,d,v,i,r,o,f,s,a,l,h]}class qi extends we{constructor(n){super(),Se(this,n,Bi,Ri,Te,{reportMousePosition:6})}}var z=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Bn={};/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(t){(function(){var n=function(){this.init()};n.prototype={init:function(){var r=this||e;return r._counter=1e3,r._html5AudioPool=[],r.html5PoolSize=10,r._codecs={},r._howls=[],r._muted=!1,r._volume=1,r._canPlayEvent="canplaythrough",r._navigator=typeof window<"u"&&window.navigator?window.navigator:null,r.masterGain=null,r.noAudio=!1,r.usingWebAudio=!0,r.autoSuspend=!0,r.ctx=null,r.autoUnlock=!0,r._setup(),r},volume:function(r){var o=this||e;if(r=parseFloat(r),o.ctx||v(),typeof r<"u"&&r>=0&&r<=1){if(o._volume=r,o._muted)return o;o.usingWebAudio&&o.masterGain.gain.setValueAtTime(r,e.ctx.currentTime);for(var l=0;l<o._howls.length;l++)if(!o._howls[l]._webAudio)for(var h=o._howls[l]._getSoundIds(),_=0;_<h.length;_++){var m=o._howls[l]._soundById(h[_]);m&&m._node&&(m._node.volume=m._volume*r)}return o}return o._volume},mute:function(r){var o=this||e;o.ctx||v(),o._muted=r,o.usingWebAudio&&o.masterGain.gain.setValueAtTime(r?0:o._volume,e.ctx.currentTime);for(var l=0;l<o._howls.length;l++)if(!o._howls[l]._webAudio)for(var h=o._howls[l]._getSoundIds(),_=0;_<h.length;_++){var m=o._howls[l]._soundById(h[_]);m&&m._node&&(m._node.muted=r?!0:m._muted)}return o},stop:function(){for(var r=this||e,o=0;o<r._howls.length;o++)r._howls[o].stop();return r},unload:function(){for(var r=this||e,o=r._howls.length-1;o>=0;o--)r._howls[o].unload();return r.usingWebAudio&&r.ctx&&typeof r.ctx.close<"u"&&(r.ctx.close(),r.ctx=null,v()),r},codecs:function(r){return(this||e)._codecs[r.replace(/^x-/,"")]},_setup:function(){var r=this||e;if(r.state=r.ctx&&r.ctx.state||"suspended",r._autoSuspend(),!r.usingWebAudio)if(typeof Audio<"u")try{var o=new Audio;typeof o.oncanplaythrough>"u"&&(r._canPlayEvent="canplay")}catch{r.noAudio=!0}else r.noAudio=!0;try{var o=new Audio;o.muted&&(r.noAudio=!0)}catch{}return r.noAudio||r._setupCodecs(),r},_setupCodecs:function(){var r=this||e,o=null;try{o=typeof Audio<"u"?new Audio:null}catch{return r}if(!o||typeof o.canPlayType!="function")return r;var l=o.canPlayType("audio/mpeg;").replace(/^no$/,""),h=r._navigator?r._navigator.userAgent:"",_=h.match(/OPR\/([0-6].)/g),m=_&&parseInt(_[0].split("/")[1],10)<33,p=h.indexOf("Safari")!==-1&&h.indexOf("Chrome")===-1,y=h.match(/Version\/(.*?) /),b=p&&y&&parseInt(y[1],10)<15;return r._codecs={mp3:!!(!m&&(l||o.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!l,opus:!!o.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(o.canPlayType('audio/wav; codecs="1"')||o.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!o.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!o.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(o.canPlayType("audio/x-m4a;")||o.canPlayType("audio/m4a;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(o.canPlayType("audio/x-m4b;")||o.canPlayType("audio/m4b;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(o.canPlayType("audio/x-mp4;")||o.canPlayType("audio/mp4;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!b&&o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!b&&o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!o.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(o.canPlayType("audio/x-flac;")||o.canPlayType("audio/flac;")).replace(/^no$/,"")},r},_unlockAudio:function(){var r=this||e;if(!(r._audioUnlocked||!r.ctx)){r._audioUnlocked=!1,r.autoUnlock=!1,!r._mobileUnloaded&&r.ctx.sampleRate!==44100&&(r._mobileUnloaded=!0,r.unload()),r._scratchBuffer=r.ctx.createBuffer(1,1,22050);var o=function(l){for(;r._html5AudioPool.length<r.html5PoolSize;)try{var h=new Audio;h._unlocked=!0,r._releaseHtml5Audio(h)}catch{r.noAudio=!0;break}for(var _=0;_<r._howls.length;_++)if(!r._howls[_]._webAudio)for(var m=r._howls[_]._getSoundIds(),p=0;p<m.length;p++){var y=r._howls[_]._soundById(m[p]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}r._autoResume();var b=r.ctx.createBufferSource();b.buffer=r._scratchBuffer,b.connect(r.ctx.destination),typeof b.start>"u"?b.noteOn(0):b.start(0),typeof r.ctx.resume=="function"&&r.ctx.resume(),b.onended=function(){b.disconnect(0),r._audioUnlocked=!0,document.removeEventListener("touchstart",o,!0),document.removeEventListener("touchend",o,!0),document.removeEventListener("click",o,!0),document.removeEventListener("keydown",o,!0);for(var x=0;x<r._howls.length;x++)r._howls[x]._emit("unlock")}};return document.addEventListener("touchstart",o,!0),document.addEventListener("touchend",o,!0),document.addEventListener("click",o,!0),document.addEventListener("keydown",o,!0),r}},_obtainHtml5Audio:function(){var r=this||e;if(r._html5AudioPool.length)return r._html5AudioPool.pop();var o=new Audio().play();return o&&typeof Promise<"u"&&(o instanceof Promise||typeof o.then=="function")&&o.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(r){var o=this||e;return r._unlocked&&o._html5AudioPool.push(r),o},_autoSuspend:function(){var r=this;if(!(!r.autoSuspend||!r.ctx||typeof r.ctx.suspend>"u"||!e.usingWebAudio)){for(var o=0;o<r._howls.length;o++)if(r._howls[o]._webAudio){for(var l=0;l<r._howls[o]._sounds.length;l++)if(!r._howls[o]._sounds[l]._paused)return r}return r._suspendTimer&&clearTimeout(r._suspendTimer),r._suspendTimer=setTimeout(function(){if(r.autoSuspend){r._suspendTimer=null,r.state="suspending";var h=function(){r.state="suspended",r._resumeAfterSuspend&&(delete r._resumeAfterSuspend,r._autoResume())};r.ctx.suspend().then(h,h)}},3e4),r}},_autoResume:function(){var r=this;if(!(!r.ctx||typeof r.ctx.resume>"u"||!e.usingWebAudio))return r.state==="running"&&r.ctx.state!=="interrupted"&&r._suspendTimer?(clearTimeout(r._suspendTimer),r._suspendTimer=null):r.state==="suspended"||r.state==="running"&&r.ctx.state==="interrupted"?(r.ctx.resume().then(function(){r.state="running";for(var o=0;o<r._howls.length;o++)r._howls[o]._emit("resume")}),r._suspendTimer&&(clearTimeout(r._suspendTimer),r._suspendTimer=null)):r.state==="suspending"&&(r._resumeAfterSuspend=!0),r}};var e=new n,i=function(r){var o=this;if(!r.src||r.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}o.init(r)};i.prototype={init:function(r){var o=this;return e.ctx||v(),o._autoplay=r.autoplay||!1,o._format=typeof r.format!="string"?r.format:[r.format],o._html5=r.html5||!1,o._muted=r.mute||!1,o._loop=r.loop||!1,o._pool=r.pool||5,o._preload=typeof r.preload=="boolean"||r.preload==="metadata"?r.preload:!0,o._rate=r.rate||1,o._sprite=r.sprite||{},o._src=typeof r.src!="string"?r.src:[r.src],o._volume=r.volume!==void 0?r.volume:1,o._xhr={method:r.xhr&&r.xhr.method?r.xhr.method:"GET",headers:r.xhr&&r.xhr.headers?r.xhr.headers:null,withCredentials:r.xhr&&r.xhr.withCredentials?r.xhr.withCredentials:!1},o._duration=0,o._state="unloaded",o._sounds=[],o._endTimers={},o._queue=[],o._playLock=!1,o._onend=r.onend?[{fn:r.onend}]:[],o._onfade=r.onfade?[{fn:r.onfade}]:[],o._onload=r.onload?[{fn:r.onload}]:[],o._onloaderror=r.onloaderror?[{fn:r.onloaderror}]:[],o._onplayerror=r.onplayerror?[{fn:r.onplayerror}]:[],o._onpause=r.onpause?[{fn:r.onpause}]:[],o._onplay=r.onplay?[{fn:r.onplay}]:[],o._onstop=r.onstop?[{fn:r.onstop}]:[],o._onmute=r.onmute?[{fn:r.onmute}]:[],o._onvolume=r.onvolume?[{fn:r.onvolume}]:[],o._onrate=r.onrate?[{fn:r.onrate}]:[],o._onseek=r.onseek?[{fn:r.onseek}]:[],o._onunlock=r.onunlock?[{fn:r.onunlock}]:[],o._onresume=[],o._webAudio=e.usingWebAudio&&!o._html5,typeof e.ctx<"u"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(o),o._autoplay&&o._queue.push({event:"play",action:function(){o.play()}}),o._preload&&o._preload!=="none"&&o.load(),o},load:function(){var r=this,o=null;if(e.noAudio){r._emit("loaderror",null,"No audio support.");return}typeof r._src=="string"&&(r._src=[r._src]);for(var l=0;l<r._src.length;l++){var h,_;if(r._format&&r._format[l])h=r._format[l];else{if(_=r._src[l],typeof _!="string"){r._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}h=/^data:audio\/([^;,]+);/i.exec(_),h||(h=/\.([^.]+)$/.exec(_.split("?",1)[0])),h&&(h=h[1].toLowerCase())}if(h||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),h&&e.codecs(h)){o=r._src[l];break}}if(!o){r._emit("loaderror",null,"No codec support for selected audio sources.");return}return r._src=o,r._state="loading",window.location.protocol==="https:"&&o.slice(0,5)==="http:"&&(r._html5=!0,r._webAudio=!1),new a(r),r._webAudio&&u(r),r},play:function(r,o){var l=this,h=null;if(typeof r=="number")h=r,r=null;else{if(typeof r=="string"&&l._state==="loaded"&&!l._sprite[r])return null;if(typeof r>"u"&&(r="__default",!l._playLock)){for(var _=0,m=0;m<l._sounds.length;m++)l._sounds[m]._paused&&!l._sounds[m]._ended&&(_++,h=l._sounds[m]._id);_===1?r=null:h=null}}var p=h?l._soundById(h):l._inactiveSound();if(!p)return null;if(h&&!r&&(r=p._sprite||"__default"),l._state!=="loaded"){p._sprite=r,p._ended=!1;var y=p._id;return l._queue.push({event:"play",action:function(){l.play(y)}}),y}if(h&&!p._paused)return o||l._loadQueue("play"),p._id;l._webAudio&&e._autoResume();var b=Math.max(0,p._seek>0?p._seek:l._sprite[r][0]/1e3),x=Math.max(0,(l._sprite[r][0]+l._sprite[r][1])/1e3-b),P=x*1e3/Math.abs(p._rate),j=l._sprite[r][0]/1e3,$=(l._sprite[r][0]+l._sprite[r][1])/1e3;p._sprite=r,p._ended=!1;var Z=function(){p._paused=!1,p._seek=b,p._start=j,p._stop=$,p._loop=!!(p._loop||l._sprite[r][2])};if(b>=$){l._ended(p);return}var E=p._node;if(l._webAudio){var ee=function(){l._playLock=!1,Z(),l._refreshBuffer(p);var R=p._muted||l._muted?0:p._volume;E.gain.setValueAtTime(R,e.ctx.currentTime),p._playStart=e.ctx.currentTime,typeof E.bufferSource.start>"u"?p._loop?E.bufferSource.noteGrainOn(0,b,86400):E.bufferSource.noteGrainOn(0,b,x):p._loop?E.bufferSource.start(0,b,86400):E.bufferSource.start(0,b,x),P!==1/0&&(l._endTimers[p._id]=setTimeout(l._ended.bind(l,p),P)),o||setTimeout(function(){l._emit("play",p._id),l._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?ee():(l._playLock=!0,l.once("resume",ee),l._clearTimer(p._id))}else{var te=function(){E.currentTime=b,E.muted=p._muted||l._muted||e._muted||E.muted,E.volume=p._volume*e.volume(),E.playbackRate=p._rate;try{var R=E.play();if(R&&typeof Promise<"u"&&(R instanceof Promise||typeof R.then=="function")?(l._playLock=!0,Z(),R.then(function(){l._playLock=!1,E._unlocked=!0,o?l._loadQueue():l._emit("play",p._id)}).catch(function(){l._playLock=!1,l._emit("playerror",p._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),p._ended=!0,p._paused=!0})):o||(l._playLock=!1,Z(),l._emit("play",p._id)),E.playbackRate=p._rate,E.paused){l._emit("playerror",p._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}r!=="__default"||p._loop?l._endTimers[p._id]=setTimeout(l._ended.bind(l,p),P):(l._endTimers[p._id]=function(){l._ended(p),E.removeEventListener("ended",l._endTimers[p._id],!1)},E.addEventListener("ended",l._endTimers[p._id],!1))}catch(F){l._emit("playerror",p._id,F)}};E.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(E.src=l._src,E.load());var q=window&&window.ejecta||!E.readyState&&e._navigator.isCocoonJS;if(E.readyState>=3||q)te();else{l._playLock=!0,l._state="loading";var O=function(){l._state="loaded",te(),E.removeEventListener(e._canPlayEvent,O,!1)};E.addEventListener(e._canPlayEvent,O,!1),l._clearTimer(p._id)}}return p._id},pause:function(r){var o=this;if(o._state!=="loaded"||o._playLock)return o._queue.push({event:"pause",action:function(){o.pause(r)}}),o;for(var l=o._getSoundIds(r),h=0;h<l.length;h++){o._clearTimer(l[h]);var _=o._soundById(l[h]);if(_&&!_._paused&&(_._seek=o.seek(l[h]),_._rateSeek=0,_._paused=!0,o._stopFade(l[h]),_._node))if(o._webAudio){if(!_._node.bufferSource)continue;typeof _._node.bufferSource.stop>"u"?_._node.bufferSource.noteOff(0):_._node.bufferSource.stop(0),o._cleanBuffer(_._node)}else(!isNaN(_._node.duration)||_._node.duration===1/0)&&_._node.pause();arguments[1]||o._emit("pause",_?_._id:null)}return o},stop:function(r,o){var l=this;if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"stop",action:function(){l.stop(r)}}),l;for(var h=l._getSoundIds(r),_=0;_<h.length;_++){l._clearTimer(h[_]);var m=l._soundById(h[_]);m&&(m._seek=m._start||0,m._rateSeek=0,m._paused=!0,m._ended=!0,l._stopFade(h[_]),m._node&&(l._webAudio?m._node.bufferSource&&(typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),l._cleanBuffer(m._node)):(!isNaN(m._node.duration)||m._node.duration===1/0)&&(m._node.currentTime=m._start||0,m._node.pause(),m._node.duration===1/0&&l._clearSound(m._node))),o||l._emit("stop",m._id))}return l},mute:function(r,o){var l=this;if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"mute",action:function(){l.mute(r,o)}}),l;if(typeof o>"u")if(typeof r=="boolean")l._muted=r;else return l._muted;for(var h=l._getSoundIds(o),_=0;_<h.length;_++){var m=l._soundById(h[_]);m&&(m._muted=r,m._interval&&l._stopFade(m._id),l._webAudio&&m._node?m._node.gain.setValueAtTime(r?0:m._volume,e.ctx.currentTime):m._node&&(m._node.muted=e._muted?!0:r),l._emit("mute",m._id))}return l},volume:function(){var r=this,o=arguments,l,h;if(o.length===0)return r._volume;if(o.length===1||o.length===2&&typeof o[1]>"u"){var _=r._getSoundIds(),m=_.indexOf(o[0]);m>=0?h=parseInt(o[0],10):l=parseFloat(o[0])}else o.length>=2&&(l=parseFloat(o[0]),h=parseInt(o[1],10));var p;if(typeof l<"u"&&l>=0&&l<=1){if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,o)}}),r;typeof h>"u"&&(r._volume=l),h=r._getSoundIds(h);for(var y=0;y<h.length;y++)p=r._soundById(h[y]),p&&(p._volume=l,o[2]||r._stopFade(h[y]),r._webAudio&&p._node&&!p._muted?p._node.gain.setValueAtTime(l,e.ctx.currentTime):p._node&&!p._muted&&(p._node.volume=l*e.volume()),r._emit("volume",p._id))}else return p=h?r._soundById(h):r._sounds[0],p?p._volume:0;return r},fade:function(r,o,l,h){var _=this;if(_._state!=="loaded"||_._playLock)return _._queue.push({event:"fade",action:function(){_.fade(r,o,l,h)}}),_;r=Math.min(Math.max(0,parseFloat(r)),1),o=Math.min(Math.max(0,parseFloat(o)),1),l=parseFloat(l),_.volume(r,h);for(var m=_._getSoundIds(h),p=0;p<m.length;p++){var y=_._soundById(m[p]);if(y){if(h||_._stopFade(m[p]),_._webAudio&&!y._muted){var b=e.ctx.currentTime,x=b+l/1e3;y._volume=r,y._node.gain.setValueAtTime(r,b),y._node.gain.linearRampToValueAtTime(o,x)}_._startFadeInterval(y,r,o,l,m[p],typeof h>"u")}}return _},_startFadeInterval:function(r,o,l,h,_,m){var p=this,y=o,b=l-o,x=Math.abs(b/.01),P=Math.max(4,x>0?h/x:h),j=Date.now();r._fadeTo=l,r._interval=setInterval(function(){var $=(Date.now()-j)/h;j=Date.now(),y+=b*$,y=Math.round(y*100)/100,b<0?y=Math.max(l,y):y=Math.min(l,y),p._webAudio?r._volume=y:p.volume(y,r._id,!0),m&&(p._volume=y),(l<o&&y<=l||l>o&&y>=l)&&(clearInterval(r._interval),r._interval=null,r._fadeTo=null,p.volume(l,r._id),p._emit("fade",r._id))},P)},_stopFade:function(r){var o=this,l=o._soundById(r);return l&&l._interval&&(o._webAudio&&l._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(l._interval),l._interval=null,o.volume(l._fadeTo,r),l._fadeTo=null,o._emit("fade",r)),o},loop:function(){var r=this,o=arguments,l,h,_;if(o.length===0)return r._loop;if(o.length===1)if(typeof o[0]=="boolean")l=o[0],r._loop=l;else return _=r._soundById(parseInt(o[0],10)),_?_._loop:!1;else o.length===2&&(l=o[0],h=parseInt(o[1],10));for(var m=r._getSoundIds(h),p=0;p<m.length;p++)_=r._soundById(m[p]),_&&(_._loop=l,r._webAudio&&_._node&&_._node.bufferSource&&(_._node.bufferSource.loop=l,l&&(_._node.bufferSource.loopStart=_._start||0,_._node.bufferSource.loopEnd=_._stop,r.playing(m[p])&&(r.pause(m[p],!0),r.play(m[p],!0)))));return r},rate:function(){var r=this,o=arguments,l,h;if(o.length===0)h=r._sounds[0]._id;else if(o.length===1){var _=r._getSoundIds(),m=_.indexOf(o[0]);m>=0?h=parseInt(o[0],10):l=parseFloat(o[0])}else o.length===2&&(l=parseFloat(o[0]),h=parseInt(o[1],10));var p;if(typeof l=="number"){if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,o)}}),r;typeof h>"u"&&(r._rate=l),h=r._getSoundIds(h);for(var y=0;y<h.length;y++)if(p=r._soundById(h[y]),p){r.playing(h[y])&&(p._rateSeek=r.seek(h[y]),p._playStart=r._webAudio?e.ctx.currentTime:p._playStart),p._rate=l,r._webAudio&&p._node&&p._node.bufferSource?p._node.bufferSource.playbackRate.setValueAtTime(l,e.ctx.currentTime):p._node&&(p._node.playbackRate=l);var b=r.seek(h[y]),x=(r._sprite[p._sprite][0]+r._sprite[p._sprite][1])/1e3-b,P=x*1e3/Math.abs(p._rate);(r._endTimers[h[y]]||!p._paused)&&(r._clearTimer(h[y]),r._endTimers[h[y]]=setTimeout(r._ended.bind(r,p),P)),r._emit("rate",p._id)}}else return p=r._soundById(h),p?p._rate:r._rate;return r},seek:function(){var r=this,o=arguments,l,h;if(o.length===0)r._sounds.length&&(h=r._sounds[0]._id);else if(o.length===1){var _=r._getSoundIds(),m=_.indexOf(o[0]);m>=0?h=parseInt(o[0],10):r._sounds.length&&(h=r._sounds[0]._id,l=parseFloat(o[0]))}else o.length===2&&(l=parseFloat(o[0]),h=parseInt(o[1],10));if(typeof h>"u")return 0;if(typeof l=="number"&&(r._state!=="loaded"||r._playLock))return r._queue.push({event:"seek",action:function(){r.seek.apply(r,o)}}),r;var p=r._soundById(h);if(p)if(typeof l=="number"&&l>=0){var y=r.playing(h);y&&r.pause(h,!0),p._seek=l,p._ended=!1,r._clearTimer(h),!r._webAudio&&p._node&&!isNaN(p._node.duration)&&(p._node.currentTime=l);var b=function(){y&&r.play(h,!0),r._emit("seek",h)};if(y&&!r._webAudio){var x=function(){r._playLock?setTimeout(x,0):b()};setTimeout(x,0)}else b()}else if(r._webAudio){var P=r.playing(h)?e.ctx.currentTime-p._playStart:0,j=p._rateSeek?p._rateSeek-p._seek:0;return p._seek+(j+P*Math.abs(p._rate))}else return p._node.currentTime;return r},playing:function(r){var o=this;if(typeof r=="number"){var l=o._soundById(r);return l?!l._paused:!1}for(var h=0;h<o._sounds.length;h++)if(!o._sounds[h]._paused)return!0;return!1},duration:function(r){var o=this,l=o._duration,h=o._soundById(r);return h&&(l=o._sprite[h._sprite][1]/1e3),l},state:function(){return this._state},unload:function(){for(var r=this,o=r._sounds,l=0;l<o.length;l++)o[l]._paused||r.stop(o[l]._id),r._webAudio||(r._clearSound(o[l]._node),o[l]._node.removeEventListener("error",o[l]._errorFn,!1),o[l]._node.removeEventListener(e._canPlayEvent,o[l]._loadFn,!1),o[l]._node.removeEventListener("ended",o[l]._endFn,!1),e._releaseHtml5Audio(o[l]._node)),delete o[l]._node,r._clearTimer(o[l]._id);var h=e._howls.indexOf(r);h>=0&&e._howls.splice(h,1);var _=!0;for(l=0;l<e._howls.length;l++)if(e._howls[l]._src===r._src||r._src.indexOf(e._howls[l]._src)>=0){_=!1;break}return s&&_&&delete s[r._src],e.noAudio=!1,r._state="unloaded",r._sounds=[],r=null,null},on:function(r,o,l,h){var _=this,m=_["_on"+r];return typeof o=="function"&&m.push(h?{id:l,fn:o,once:h}:{id:l,fn:o}),_},off:function(r,o,l){var h=this,_=h["_on"+r],m=0;if(typeof o=="number"&&(l=o,o=null),o||l)for(m=0;m<_.length;m++){var p=l===_[m].id;if(o===_[m].fn&&p||!o&&p){_.splice(m,1);break}}else if(r)h["_on"+r]=[];else{var y=Object.keys(h);for(m=0;m<y.length;m++)y[m].indexOf("_on")===0&&Array.isArray(h[y[m]])&&(h[y[m]]=[])}return h},once:function(r,o,l){var h=this;return h.on(r,o,l,1),h},_emit:function(r,o,l){for(var h=this,_=h["_on"+r],m=_.length-1;m>=0;m--)(!_[m].id||_[m].id===o||r==="load")&&(setTimeout(function(p){p.call(this,o,l)}.bind(h,_[m].fn),0),_[m].once&&h.off(r,_[m].fn,_[m].id));return h._loadQueue(r),h},_loadQueue:function(r){var o=this;if(o._queue.length>0){var l=o._queue[0];l.event===r&&(o._queue.shift(),o._loadQueue()),r||l.action()}return o},_ended:function(r){var o=this,l=r._sprite;if(!o._webAudio&&r._node&&!r._node.paused&&!r._node.ended&&r._node.currentTime<r._stop)return setTimeout(o._ended.bind(o,r),100),o;var h=!!(r._loop||o._sprite[l][2]);if(o._emit("end",r._id),!o._webAudio&&h&&o.stop(r._id,!0).play(r._id),o._webAudio&&h){o._emit("play",r._id),r._seek=r._start||0,r._rateSeek=0,r._playStart=e.ctx.currentTime;var _=(r._stop-r._start)*1e3/Math.abs(r._rate);o._endTimers[r._id]=setTimeout(o._ended.bind(o,r),_)}return o._webAudio&&!h&&(r._paused=!0,r._ended=!0,r._seek=r._start||0,r._rateSeek=0,o._clearTimer(r._id),o._cleanBuffer(r._node),e._autoSuspend()),!o._webAudio&&!h&&o.stop(r._id,!0),o},_clearTimer:function(r){var o=this;if(o._endTimers[r]){if(typeof o._endTimers[r]!="function")clearTimeout(o._endTimers[r]);else{var l=o._soundById(r);l&&l._node&&l._node.removeEventListener("ended",o._endTimers[r],!1)}delete o._endTimers[r]}return o},_soundById:function(r){for(var o=this,l=0;l<o._sounds.length;l++)if(r===o._sounds[l]._id)return o._sounds[l];return null},_inactiveSound:function(){var r=this;r._drain();for(var o=0;o<r._sounds.length;o++)if(r._sounds[o]._ended)return r._sounds[o].reset();return new a(r)},_drain:function(){var r=this,o=r._pool,l=0,h=0;if(!(r._sounds.length<o)){for(h=0;h<r._sounds.length;h++)r._sounds[h]._ended&&l++;for(h=r._sounds.length-1;h>=0;h--){if(l<=o)return;r._sounds[h]._ended&&(r._webAudio&&r._sounds[h]._node&&r._sounds[h]._node.disconnect(0),r._sounds.splice(h,1),l--)}}},_getSoundIds:function(r){var o=this;if(typeof r>"u"){for(var l=[],h=0;h<o._sounds.length;h++)l.push(o._sounds[h]._id);return l}else return[r]},_refreshBuffer:function(r){var o=this;return r._node.bufferSource=e.ctx.createBufferSource(),r._node.bufferSource.buffer=s[o._src],r._panner?r._node.bufferSource.connect(r._panner):r._node.bufferSource.connect(r._node),r._node.bufferSource.loop=r._loop,r._loop&&(r._node.bufferSource.loopStart=r._start||0,r._node.bufferSource.loopEnd=r._stop||0),r._node.bufferSource.playbackRate.setValueAtTime(r._rate,e.ctx.currentTime),o},_cleanBuffer:function(r){var o=this,l=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(e._scratchBuffer&&r.bufferSource&&(r.bufferSource.onended=null,r.bufferSource.disconnect(0),l))try{r.bufferSource.buffer=e._scratchBuffer}catch{}return r.bufferSource=null,o},_clearSound:function(r){var o=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);o||(r.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(r){this._parent=r,this.init()};a.prototype={init:function(){var r=this,o=r._parent;return r._muted=o._muted,r._loop=o._loop,r._volume=o._volume,r._rate=o._rate,r._seek=0,r._paused=!0,r._ended=!0,r._sprite="__default",r._id=++e._counter,o._sounds.push(r),r.create(),r},create:function(){var r=this,o=r._parent,l=e._muted||r._muted||r._parent._muted?0:r._volume;return o._webAudio?(r._node=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),r._node.gain.setValueAtTime(l,e.ctx.currentTime),r._node.paused=!0,r._node.connect(e.masterGain)):e.noAudio||(r._node=e._obtainHtml5Audio(),r._errorFn=r._errorListener.bind(r),r._node.addEventListener("error",r._errorFn,!1),r._loadFn=r._loadListener.bind(r),r._node.addEventListener(e._canPlayEvent,r._loadFn,!1),r._endFn=r._endListener.bind(r),r._node.addEventListener("ended",r._endFn,!1),r._node.src=o._src,r._node.preload=o._preload===!0?"auto":o._preload,r._node.volume=l*e.volume(),r._node.load()),r},reset:function(){var r=this,o=r._parent;return r._muted=o._muted,r._loop=o._loop,r._volume=o._volume,r._rate=o._rate,r._seek=0,r._rateSeek=0,r._paused=!0,r._ended=!0,r._sprite="__default",r._id=++e._counter,r},_errorListener:function(){var r=this;r._parent._emit("loaderror",r._id,r._node.error?r._node.error.code:0),r._node.removeEventListener("error",r._errorFn,!1)},_loadListener:function(){var r=this,o=r._parent;o._duration=Math.ceil(r._node.duration*10)/10,Object.keys(o._sprite).length===0&&(o._sprite={__default:[0,o._duration*1e3]}),o._state!=="loaded"&&(o._state="loaded",o._emit("load"),o._loadQueue()),r._node.removeEventListener(e._canPlayEvent,r._loadFn,!1)},_endListener:function(){var r=this,o=r._parent;o._duration===1/0&&(o._duration=Math.ceil(r._node.duration*10)/10,o._sprite.__default[1]===1/0&&(o._sprite.__default[1]=o._duration*1e3),o._ended(r)),r._node.removeEventListener("ended",r._endFn,!1)}};var s={},u=function(r){var o=r._src;if(s[o]){r._duration=s[o].duration,d(r);return}if(/^data:[^;]+;base64,/.test(o)){for(var l=atob(o.split(",")[1]),h=new Uint8Array(l.length),_=0;_<l.length;++_)h[_]=l.charCodeAt(_);c(h.buffer,r)}else{var m=new XMLHttpRequest;m.open(r._xhr.method,o,!0),m.withCredentials=r._xhr.withCredentials,m.responseType="arraybuffer",r._xhr.headers&&Object.keys(r._xhr.headers).forEach(function(p){m.setRequestHeader(p,r._xhr.headers[p])}),m.onload=function(){var p=(m.status+"")[0];if(p!=="0"&&p!=="2"&&p!=="3"){r._emit("loaderror",null,"Failed loading audio file with status: "+m.status+".");return}c(m.response,r)},m.onerror=function(){r._webAudio&&(r._html5=!0,r._webAudio=!1,r._sounds=[],delete s[o],r.load())},f(m)}},f=function(r){try{r.send()}catch{r.onerror()}},c=function(r,o){var l=function(){o._emit("loaderror",null,"Decoding audio data failed.")},h=function(_){_&&o._sounds.length>0?(s[o._src]=_,d(o,_)):l()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(r).then(h).catch(l):e.ctx.decodeAudioData(r,h,l)},d=function(r,o){o&&!r._duration&&(r._duration=o.duration),Object.keys(r._sprite).length===0&&(r._sprite={__default:[0,r._duration*1e3]}),r._state!=="loaded"&&(r._state="loaded",r._emit("load"),r._loadQueue())},v=function(){if(e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var r=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),o=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),l=o?parseInt(o[1],10):null;if(r&&l&&l<9){var h=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!h&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};t.Howler=e,t.Howl=i,typeof z<"u"?(z.HowlerGlobal=n,z.Howler=e,z.Howl=i,z.Sound=a):typeof window<"u"&&(window.HowlerGlobal=n,window.Howler=e,window.Howl=i,window.Sound=a)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var a=i._howls.length-1;a>=0;a--)i._howls[a].stereo(e);return i},HowlerGlobal.prototype.pos=function(e,i,a){var s=this;if(!s.ctx||!s.ctx.listener)return s;if(i=typeof i!="number"?s._pos[1]:i,a=typeof a!="number"?s._pos[2]:a,typeof e=="number")s._pos=[e,i,a],typeof s.ctx.listener.positionX<"u"?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]);else return s._pos;return s},HowlerGlobal.prototype.orientation=function(e,i,a,s,u,f){var c=this;if(!c.ctx||!c.ctx.listener)return c;var d=c._orientation;if(i=typeof i!="number"?d[1]:i,a=typeof a!="number"?d[2]:a,s=typeof s!="number"?d[3]:s,u=typeof u!="number"?d[4]:u,f=typeof f!="number"?d[5]:f,typeof e=="number")c._orientation=[e,i,a,s,u,f],typeof c.ctx.listener.forwardX<"u"?(c.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),c.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),c.ctx.listener.forwardZ.setTargetAtTime(a,Howler.ctx.currentTime,.1),c.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),c.ctx.listener.upY.setTargetAtTime(u,Howler.ctx.currentTime,.1),c.ctx.listener.upZ.setTargetAtTime(f,Howler.ctx.currentTime,.1)):c.ctx.listener.setOrientation(e,i,a,s,u,f);else return d;return c},Howl.prototype.init=function(e){return function(i){var a=this;return a._orientation=i.orientation||[1,0,0],a._stereo=i.stereo||null,a._pos=i.pos||null,a._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance<"u"?i.maxDistance:1e4,panningModel:typeof i.panningModel<"u"?i.panningModel:"HRTF",refDistance:typeof i.refDistance<"u"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:1},a._onstereo=i.onstereo?[{fn:i.onstereo}]:[],a._onpos=i.onpos?[{fn:i.onpos}]:[],a._onorientation=i.onorientation?[{fn:i.onorientation}]:[],e.call(this,i)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,i){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"stereo",action:function(){a.stereo(e,i)}}),a;var s=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof i>"u")if(typeof e=="number")a._stereo=e,a._pos=[e,0,0];else return a._stereo;for(var u=a._getSoundIds(i),f=0;f<u.length;f++){var c=a._soundById(u[f]);if(c)if(typeof e=="number")c._stereo=e,c._pos=[e,0,0],c._node&&(c._pannerAttr.panningModel="equalpower",(!c._panner||!c._panner.pan)&&n(c,s),s==="spatial"?typeof c._panner.positionX<"u"?(c._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):c._panner.setPosition(e,0,0):c._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),a._emit("stereo",c._id);else return c._stereo}return a},Howl.prototype.pos=function(e,i,a,s){var u=this;if(!u._webAudio)return u;if(u._state!=="loaded")return u._queue.push({event:"pos",action:function(){u.pos(e,i,a,s)}}),u;if(i=typeof i!="number"?0:i,a=typeof a!="number"?-.5:a,typeof s>"u")if(typeof e=="number")u._pos=[e,i,a];else return u._pos;for(var f=u._getSoundIds(s),c=0;c<f.length;c++){var d=u._soundById(f[c]);if(d)if(typeof e=="number")d._pos=[e,i,a],d._node&&((!d._panner||d._panner.pan)&&n(d,"spatial"),typeof d._panner.positionX<"u"?(d._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),d._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),d._panner.positionZ.setValueAtTime(a,Howler.ctx.currentTime)):d._panner.setPosition(e,i,a)),u._emit("pos",d._id);else return d._pos}return u},Howl.prototype.orientation=function(e,i,a,s){var u=this;if(!u._webAudio)return u;if(u._state!=="loaded")return u._queue.push({event:"orientation",action:function(){u.orientation(e,i,a,s)}}),u;if(i=typeof i!="number"?u._orientation[1]:i,a=typeof a!="number"?u._orientation[2]:a,typeof s>"u")if(typeof e=="number")u._orientation=[e,i,a];else return u._orientation;for(var f=u._getSoundIds(s),c=0;c<f.length;c++){var d=u._soundById(f[c]);if(d)if(typeof e=="number")d._orientation=[e,i,a],d._node&&(d._panner||(d._pos||(d._pos=u._pos||[0,0,-.5]),n(d,"spatial")),typeof d._panner.orientationX<"u"?(d._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),d._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),d._panner.orientationZ.setValueAtTime(a,Howler.ctx.currentTime)):d._panner.setOrientation(e,i,a)),u._emit("orientation",d._id);else return d._orientation}return u},Howl.prototype.pannerAttr=function(){var e=this,i=arguments,a,s,u;if(!e._webAudio)return e;if(i.length===0)return e._pannerAttr;if(i.length===1)if(typeof i[0]=="object")a=i[0],typeof s>"u"&&(a.pannerAttr||(a.pannerAttr={coneInnerAngle:a.coneInnerAngle,coneOuterAngle:a.coneOuterAngle,coneOuterGain:a.coneOuterGain,distanceModel:a.distanceModel,maxDistance:a.maxDistance,refDistance:a.refDistance,rolloffFactor:a.rolloffFactor,panningModel:a.panningModel}),e._pannerAttr={coneInnerAngle:typeof a.pannerAttr.coneInnerAngle<"u"?a.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof a.pannerAttr.coneOuterAngle<"u"?a.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof a.pannerAttr.coneOuterGain<"u"?a.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof a.pannerAttr.distanceModel<"u"?a.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof a.pannerAttr.maxDistance<"u"?a.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof a.pannerAttr.refDistance<"u"?a.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof a.pannerAttr.rolloffFactor<"u"?a.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof a.pannerAttr.panningModel<"u"?a.pannerAttr.panningModel:e._panningModel});else return u=e._soundById(parseInt(i[0],10)),u?u._pannerAttr:e._pannerAttr;else i.length===2&&(a=i[0],s=parseInt(i[1],10));for(var f=e._getSoundIds(s),c=0;c<f.length;c++)if(u=e._soundById(f[c]),u){var d=u._pannerAttr;d={coneInnerAngle:typeof a.coneInnerAngle<"u"?a.coneInnerAngle:d.coneInnerAngle,coneOuterAngle:typeof a.coneOuterAngle<"u"?a.coneOuterAngle:d.coneOuterAngle,coneOuterGain:typeof a.coneOuterGain<"u"?a.coneOuterGain:d.coneOuterGain,distanceModel:typeof a.distanceModel<"u"?a.distanceModel:d.distanceModel,maxDistance:typeof a.maxDistance<"u"?a.maxDistance:d.maxDistance,refDistance:typeof a.refDistance<"u"?a.refDistance:d.refDistance,rolloffFactor:typeof a.rolloffFactor<"u"?a.rolloffFactor:d.rolloffFactor,panningModel:typeof a.panningModel<"u"?a.panningModel:d.panningModel};var v=u._panner;v?(v.coneInnerAngle=d.coneInnerAngle,v.coneOuterAngle=d.coneOuterAngle,v.coneOuterGain=d.coneOuterGain,v.distanceModel=d.distanceModel,v.maxDistance=d.maxDistance,v.refDistance=d.refDistance,v.rolloffFactor=d.rolloffFactor,v.panningModel=d.panningModel):(u._pos||(u._pos=e._pos||[0,0,-.5]),n(u,"spatial"))}return e},Sound.prototype.init=function(e){return function(){var i=this,a=i._parent;i._orientation=a._orientation,i._stereo=a._stereo,i._pos=a._pos,i._pannerAttr=a._pannerAttr,e.call(this),i._stereo?a.stereo(i._stereo):i._pos&&a.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var i=this,a=i._parent;return i._orientation=a._orientation,i._stereo=a._stereo,i._pos=a._pos,i._pannerAttr=a._pannerAttr,i._stereo?a.stereo(i._stereo):i._pos?a.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,a._refreshBuffer(i)),e.call(this)}}(Sound.prototype.reset);var n=function(e,i){i=i||"spatial",i==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(Bn);let it;const sn={capture:[0,204],move:[704,316],select:[1519,153],silence:[2172,500]},Wi=()=>{if(!it){const t=Object.values(sn).map(n=>window.btoa(`${n[0]}:${n[1]}`)).join("-");it??(it=new Bn.Howl({src:[`/audio/sprite.mp3?v=${t}`],sprite:sn}))}return it},Xi=t=>{Wi().play(t)};function Ji(t){var n=typeof t;return t!=null&&(n=="object"||n=="function")}var Ot=Ji,Qi=typeof z=="object"&&z&&z.Object===Object&&z,Ui=Qi,Yi=Ui,Zi=typeof self=="object"&&self&&self.Object===Object&&self,Ki=Yi||Zi||Function("return this")(),qn=Ki,Ni=qn,zi=function(){return Ni.Date.now()},ea=zi,ta=/\s/;function na(t){for(var n=t.length;n--&&ta.test(t.charAt(n)););return n}var ra=na,ia=ra,aa=/^\s+/;function oa(t){return t&&t.slice(0,ia(t)+1).replace(aa,"")}var sa=oa,ua=qn,la=ua.Symbol,Wn=la,un=Wn,Xn=Object.prototype,ca=Xn.hasOwnProperty,fa=Xn.toString,Ie=un?un.toStringTag:void 0;function da(t){var n=ca.call(t,Ie),e=t[Ie];try{t[Ie]=void 0;var i=!0}catch{}var a=fa.call(t);return i&&(n?t[Ie]=e:delete t[Ie]),a}var va=da,ha=Object.prototype,pa=ha.toString;function _a(t){return pa.call(t)}var ma=_a,ln=Wn,ya=va,ga=ma,ba="[object Null]",wa="[object Undefined]",cn=ln?ln.toStringTag:void 0;function Sa(t){return t==null?t===void 0?wa:ba:cn&&cn in Object(t)?ya(t):ga(t)}var Ta=Sa;function Aa(t){return t!=null&&typeof t=="object"}var ka=Aa,xa=Ta,Ia=ka,Ea="[object Symbol]";function Oa(t){return typeof t=="symbol"||Ia(t)&&xa(t)==Ea}var Ma=Oa,Pa=sa,fn=Ot,ja=Ma,dn=0/0,La=/^[-+]0x[0-9a-f]+$/i,$a=/^0b[01]+$/i,Da=/^0o[0-7]+$/i,Ca=parseInt;function Ha(t){if(typeof t=="number")return t;if(ja(t))return dn;if(fn(t)){var n=typeof t.valueOf=="function"?t.valueOf():t;t=fn(n)?n+"":n}if(typeof t!="string")return t===0?t:+t;t=Pa(t);var e=$a.test(t);return e||Da.test(t)?Ca(t.slice(2),e?2:8):La.test(t)?dn:+t}var Fa=Ha,Ga=Ot,at=ea,vn=Fa,Va="Expected a function",Ra=Math.max,Ba=Math.min;function qa(t,n,e){var i,a,s,u,f,c,d=0,v=!1,r=!1,o=!0;if(typeof t!="function")throw new TypeError(Va);n=vn(n)||0,Ga(e)&&(v=!!e.leading,r="maxWait"in e,s=r?Ra(vn(e.maxWait)||0,n):s,o="trailing"in e?!!e.trailing:o);function l(j){var $=i,Z=a;return i=a=void 0,d=j,u=t.apply(Z,$),u}function h(j){return d=j,f=setTimeout(p,n),v?l(j):u}function _(j){var $=j-c,Z=j-d,E=n-$;return r?Ba(E,s-Z):E}function m(j){var $=j-c,Z=j-d;return c===void 0||$>=n||$<0||r&&Z>=s}function p(){var j=at();if(m(j))return y(j);f=setTimeout(p,_(j))}function y(j){return f=void 0,o&&i?l(j):(i=a=void 0,u)}function b(){f!==void 0&&clearTimeout(f),d=0,i=c=a=f=void 0}function x(){return f===void 0?u:y(at())}function P(){var j=at(),$=m(j);if(i=arguments,a=this,c=j,$){if(f===void 0)return h(c);if(r)return clearTimeout(f),f=setTimeout(p,n),l(c)}return f===void 0&&(f=setTimeout(p,n)),u}return P.cancel=b,P.flush=x,P}var Wa=qa,Xa=Wa,Ja=Ot,Qa="Expected a function";function Ua(t,n,e){var i=!0,a=!0;if(typeof t!="function")throw new TypeError(Qa);return Ja(e)&&(i="leading"in e?!!e.leading:i,a="trailing"in e?!!e.trailing:a),Xa(t,n,{leading:i,maxWait:n,trailing:a})}var Ya=Ua;function Za(t){let n,e,i={slot:"actions"};return n=new Oi({props:i}),t[8](n),{c(){Pe(n.$$.fragment)},l(a){je(n.$$.fragment,a)},m(a,s){Le(n,a,s),e=!0},p(a,s){const u={};n.$set(u)},i(a){e||(K(n.$$.fragment,a),e=!0)},o(a){N(n.$$.fragment,a),e=!1},d(a){t[8](null),$e(n,a)}}}function Ka(t){let n,e;return n=new Ti({props:{slot:"cursor-overlays",mousePositions:t[0]}}),{c(){Pe(n.$$.fragment)},l(i){je(n.$$.fragment,i)},m(i,a){Le(n,i,a),e=!0},p(i,a){const s={};a&1&&(s.mousePositions=i[0]),n.$set(s)},i(i){e||(K(n.$$.fragment,i),e=!0)},o(i){N(n.$$.fragment,i),e=!1},d(i){$e(n,i)}}}function Na(t){let n,e,i,a,s=t[2].log.join(`
`)+"",u,f,c=JSON.stringify(t[3],null,2)+"",d,v,r;return n=new qi({props:{reportMousePosition:t[6],$$slots:{"cursor-overlays":[Ka],actions:[Za]},$$scope:{ctx:t}}}),{c(){Pe(n.$$.fragment),e=Q(),i=C("pre"),a=W(""),u=W(s),f=W(`

`),d=W(c),v=W(`
`)},l(o){je(n.$$.fragment,o),e=U(o),i=H(o,"PRE",{});var l=D(i);a=X(l,""),u=X(l,s),f=X(l,`

`),d=X(l,c),v=X(l,`
`),l.forEach(A)},m(o,l){Le(n,o,l),V(o,e,l),V(o,i,l),I(i,a),I(i,u),I(i,f),I(i,d),I(i,v),r=!0},p(o,[l]){const h={};l&8195&&(h.$$scope={dirty:l,ctx:o}),n.$set(h),(!r||l&4)&&s!==(s=o[2].log.join(`
`)+"")&&he(u,s),(!r||l&8)&&c!==(c=JSON.stringify(o[3],null,2)+"")&&he(d,c)},i(o){r||(K(n.$$.fragment,o),r=!0)},o(o){N(n.$$.fragment,o),r=!1},d(o){$e(n,o),o&&A(e),o&&A(i)}}}function za(t,n,e){let i,a,{data:s}=n;const u=s.gameId,f=s.userId,c=s.hostUserId,d={},v=pi({gameId:u,userId:f,onMessage:m=>{m.type==="mouse position"?e(0,d[m.userId]=m.position,d):r.send(m)}});ne(t,v,m=>e(2,i=m));const r=fi(hi({send:v.send,actions:{playSound:Xi,showEmoji:({userId:m,emoji:p})=>l==null?void 0:l.showEmoji({userId:m,emoji:p})}}),{input:{gameId:u,userId:f,hostUserId:c}});di({gameId:u,userId:f,hostUserId:c,machine:r});const o=r.state;ne(t,o,m=>e(3,a=m)),hn(()=>(v.open(),()=>{v.close()}));let l;const h=Ya(m=>{v.send({type:"mouse position",position:m})},50,{leading:!0,trailing:!0});function _(m){pt[m?"unshift":"push"](()=>{l=m,e(1,l)})}return t.$$set=m=>{"data"in m&&e(7,s=m.data)},[d,l,i,a,v,o,h,s,_]}class no extends we{constructor(n){super(),Se(this,n,za,Na,Te,{data:7})}}export{no as default};
