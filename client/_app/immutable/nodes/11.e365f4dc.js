import{r as Qt,E as Sn,H as An,I as kn,s as he,n as ce,o as Ut,l as ze,m as et,c as z,p as In,d as Ve,u as Re,g as qe,e as Be}from"../chunks/scheduler.03dcb200.js";import{q as N,p as X,S as me,i as ve,e as $,F as _t,s as V,t as B,c as P,a as D,G as pt,d as A,f as R,b as W,n as O,g as L,h as I,j as ue,H as Jt,B as tt,z as nt,v as ht,l as Se,m as Ae,o as ke,r as Ie,I as Yt,A as xe,y as le,J as En,K as xn,k as fe}from"../chunks/index.1583bf7b.js";import{r as Zt,w as On}from"../chunks/index.c110b09d.js";function C(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function Kt(n,t){N(n,1,1,()=>{t.delete(n.key)})}function Ct(n,t,e,i,o,a,c,d,l,f,h,r){let s=n.length,u=a.length,_=s;const v={};for(;_--;)v[n[_].key]=_;const m=[],p=new Map,g=new Map,S=[];for(_=u;_--;){const w=r(o,a,_),j=e(w);let T=c.get(j);T?i&&S.push(()=>T.p(w,t)):(T=f(j,w),T.c()),p.set(j,m[_]=T),j in v&&g.set(j,Math.abs(_-v[j]))}const M=new Set,x=new Set;function E(w){X(w,1),w.m(d,h),c.set(w.key,w),h=w.first,u--}for(;s&&u;){const w=m[u-1],j=n[s-1],T=w.key,Q=j.key;w===j?(h=w.first,s--,u--):p.has(Q)?!c.has(T)||M.has(T)?E(w):x.has(Q)?s--:g.get(T)>g.get(Q)?(x.add(T),E(w)):(M.add(Q),s--):(l(j,c),s--)}for(;s--;){const w=n[s];p.has(w.key)||l(w,c)}for(;u;)E(m[u-1]);return Qt(S),m}const Mn=!1,ko=Object.freeze(Object.defineProperty({__proto__:null,ssr:Mn},Symbol.toStringTag,{value:"Module"}));function $n(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function Pn(){const n=$n();if(n.__xstate__)return n.__xstate__}const jn=n=>{if(typeof window>"u")return;const t=Pn();t&&t.register(n)};let Z=function(n){return n.After="xstate.after",n.DoneState="done.state",n.DoneInvoke="done.invoke",n.ErrorExecution="error.execution",n.ErrorCommunication="error.communication",n.ErrorPlatform="error.platform",n.ErrorCustom="xstate.error",n}({});Z.After;Z.DoneState;const Ln=Z.ErrorExecution,Dn=Z.ErrorPlatform;Z.ErrorCustom;const ge=".",Fn="",zt="",Hn="#",Gn="*",en="xstate.init",mt=new WeakMap;function ee(n,t,e){let i=mt.get(n);return i?t in i||(i[t]=e()):(i={[t]:e()},mt.set(n,i)),i[t]}function Vn(n,t,e,{sendId:i}){const o=typeof i=="function"?i(e):i;return[t,o]}function Rn(n,t){n.self.cancel(t)}function qn(n){function t(e){}return t.type="xstate.cancel",t.sendId=n,t.resolve=Vn,t.execute=Rn,t}class vt{constructor(t){this._process=t,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}prepend(t){if(!this._current){this.enqueue(t);return}this._current={value:t,next:this._current}}enqueue(t){const e={value:t,next:null};if(this._current){this._last.next=e,this._last=e;return}this._current=e,this._last=e,this._active&&this.flush()}flush(){for(;this._current;){const t=this._current;this._process(t.value),t===this._current&&(this._current=this._current.next)}this._last=null}}const Bn=(()=>typeof Symbol=="function"&&Symbol.observable||"@@observable")();function tn(n,t){const e=Qe(n),i=Qe(t);return typeof i=="string"?typeof e=="string"?i===e:!1:typeof e=="string"?e in i:Object.keys(e).every(o=>o in i?tn(e[o],i[o]):!1)}function nn(n){try{return Ee(n)?n:n.toString().split(ge)}catch{throw new Error(`'${n}' is not a valid state path.`)}}function Wn(n){return typeof n=="object"&&"value"in n&&"context"in n&&"event"in n}function Qe(n){if(Wn(n))return n.value;if(Ee(n))return gt(n);if(typeof n!="string")return n;const t=nn(n);return gt(t)}function gt(n){if(n.length===1)return n[0];const t={};let e=t;for(let i=0;i<n.length-1;i++)if(i===n.length-2)e[n[i]]=n[i+1];else{const o=e;e={},o[n[i]]=e}return t}function yt(n,t){const e={},i=Object.keys(n);for(let o=0;o<i.length;o++){const a=i[o];e[a]=t(n[a],a,n,o)}return e}function Ue(n){return[].concat(...n)}function rn(n){return Ee(n)?n:[n]}function Y(n){return n===void 0?[]:rn(n)}function on(n,t,e){if(typeof n=="function")return n({context:t,event:e});const i={},o={context:t,event:e};for(const a of Object.keys(n)){const c=n[a];typeof c=="function"?i[a]=c(o):i[a]=c}return i}function Ee(n){return Array.isArray(n)}function Nn(n){return typeof n.type=="string"&&(n.type===Ln||n.type.startsWith(Dn))}function oe(n){return rn(n).map(t=>typeof t>"u"||typeof t=="string"?{target:t}:t)}function sn(n){if(!(n===void 0||n===Fn))return Y(n)}function Xn(n,t){if(typeof n=="object"){if("src"in n)return n;if("transition"in n)return{id:t,src:n}}return{id:t,src:n}}function Qn(n,t,e){const i=()=>{},o=typeof n=="object",a=o?n:null;return{next:((o?n.next:n)||i).bind(a),error:((o?n.error:t)||i).bind(a),complete:((o?n.complete:e)||i).bind(a)}}function Un(n,t){return`${n}:invocation[${t}]`}function $e(n){return n?"transition"in n?{src:n,input:void 0}:n:void 0}const Je="xstate.stop";function Jn(){let n=0;const t=new Map,e=new Map,i=new WeakMap;return{_bookId:()=>`x:${n++}`,_register:(a,c)=>(t.set(a,c),a),_unregister:a=>{t.delete(a.sessionId);const c=i.get(a);c!==void 0&&(e.delete(c),i.delete(a))},get:a=>e.get(a),_set:(a,c)=>{const d=e.get(a);if(d&&d!==c)throw new Error(`Actor with system ID '${a}' already exists.`);e.set(a,c),i.set(c,a)}}}let G=function(n){return n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped",n}({});const Yn={deferEvents:!0,clock:{setTimeout:(n,t)=>setTimeout(n,t),clearTimeout:n=>clearTimeout(n)},logger:console.log.bind(console),devTools:!1};class Zn{constructor(t,e){this.logic=t,this._state=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new vt(this._process.bind(this)),this.delayedEventsMap={},this.observers=new Set,this.logger=void 0,this.status=G.NotStarted,this._parent=void 0,this.ref=void 0,this._actorContext=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const i={...Yn,...e},{clock:o,logger:a,parent:c,id:d,systemId:l}=i,f=this;this.system=(c==null?void 0:c.system)??Jn(),l&&(this._systemId=l,this.system._set(l,this)),this.sessionId=this.system._bookId(),this.id=d??this.sessionId,this.logger=a,this.clock=o,this._parent=c,this.options=i,this.src=i.src,this.ref=this,this._actorContext={self:f,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:h=>{this._deferred.push(h)},system:this.system,stopChild:h=>{if(h._parent!==this)throw new Error(`Cannot stop child actor ${h.id} of ${this.id} because it is not a child`);h._stop()}},this.send=this.send.bind(this),this._initState()}_initState(){var t;this._state=this.options.state?this.logic.restoreState?this.logic.restoreState(this.options.state,this._actorContext):this.options.state:this.logic.getInitialState(this._actorContext,(t=this.options)==null?void 0:t.input)}update(t){var a,c,d,l,f;this._state=t;const e=this.getSnapshot();let i;for(;i=this._deferred.shift();)i();for(const h of this.observers)(a=h.next)==null||a.call(h,e);const o=(d=(c=this.logic).getStatus)==null?void 0:d.call(c,t);switch(o==null?void 0:o.status){case"done":this._stopProcedure(),this._doneEvent=kr(this.id,o.data),(l=this._parent)==null||l.send(this._doneEvent),this._complete();break;case"error":this._stopProcedure(),(f=this._parent)==null||f.send(He(this.id,o.data)),this._error(o.data);break}}subscribe(t,e,i){var a;const o=Qn(t,e,i);return this.observers.add(o),this.status===G.Stopped&&((a=o.complete)==null||a.call(o),this.observers.delete(o)),{unsubscribe:()=>{this.observers.delete(o)}}}start(){return this.status===G.Running?this:(this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this.status=G.Running,this.logic.start&&this.logic.start(this._state,this._actorContext),this.update(this._state),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this)}_process(t){try{const e=this.logic.transition(this._state,t,this._actorContext);this.update(e),t.type===Je&&(this._stopProcedure(),this._complete())}catch(e){if(this.observers.size>0)this.observers.forEach(i=>{var o;(o=i.error)==null||o.call(i,e)}),this.stop();else throw e}}_stop(){return this.status===G.Stopped?this:(this.mailbox.clear(),this.status===G.NotStarted?(this.status=G.Stopped,this):(this.mailbox.enqueue({type:Je}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){var t;for(const e of this.observers)(t=e.complete)==null||t.call(e);this.observers.clear()}_error(t){var e;for(const i of this.observers)(e=i.error)==null||e.call(i,t);this.observers.clear()}_stopProcedure(){if(this.status!==G.Running)return this;for(const t of Object.keys(this.delayedEventsMap))this.clock.clearTimeout(this.delayedEventsMap[t]);return this.mailbox.clear(),this.mailbox=new vt(this._process.bind(this)),this.status=G.Stopped,this.system._unregister(this),this}send(t){if(typeof t=="string")throw new Error(`Only event objects may be sent to actors; use .send({ type: "${t}" }) instead`);if(this.status!==G.Stopped){if(this.status!==G.Running&&!this.options.deferEvents)throw new Error(`Event "${t.type}" was sent to uninitialized actor "${this.id}". Make sure .start() is called for this actor, or set { deferEvents: true } in the actor options.
Event: ${JSON.stringify(t)}`);this.mailbox.enqueue(t)}}delaySend({event:t,id:e,delay:i,to:o}){const a=this.clock.setTimeout(()=>{o?o.send(t):this.send(t)},i);e&&(this.delayedEventsMap[e]=a)}cancel(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]}attachDevTools(){const{devTools:t}=this.options;t&&(typeof t=="function"?t:jn)(this)}toJSON(){return{id:this.id}}getPersistedState(){var t,e;return(e=(t=this.logic).getPersistedState)==null?void 0:e.call(t,this._state)}[Bn](){return this}getSnapshot(){return this.logic.getSnapshot?this.logic.getSnapshot(this._state):this._state}}function de(n,t){return new Zn(n,t)}function Kn(n,t,e,{id:i,systemId:o,src:a,input:c}){const d=$e(t.machine.implementations.actors[a]);let l;if(d){const f=c||d.input;l=de(d.src,{id:i,src:a,parent:n==null?void 0:n.self,systemId:o,input:typeof f=="function"?f({context:t.context,event:e.event,self:n==null?void 0:n.self}):f})}return[re(t,{children:{...t.children,[i]:l}}),{id:i,actorRef:l}]}function Cn(n,{id:t,actorRef:e}){e&&n.defer(()=>{var i;if(e.status!==G.Stopped)try{(i=e.start)==null||i.call(e)}catch(o){n.self.send(He(t,o));return}})}function zn({id:n,systemId:t,src:e,input:i}){function o(a){}return o.type="xstate.invoke",o.id=n,o.systemId=t,o.src=e,o.input=i,o.resolve=Kn,o.execute=Cn,o}function rt(n,t,e,i){var c,d;const{machine:o}=i,a=((d=(c=o==null?void 0:o.implementations)==null?void 0:c.guards)==null?void 0:d[n.type])??n.predicate;if(!a)throw new Error(`Guard '${n.type}' is not implemented.'.`);return a({context:t,event:e,state:i,guard:n,evaluate:rt})}function Ye(n,t){var i,o;if(typeof n=="string"){const a=t==null?void 0:t(n);return typeof a=="function"?{type:n,predicate:a,params:{type:n}}:a||{type:n,params:{type:n}}}if(typeof n=="function")return{type:n.name,predicate:n,params:{type:n.name,name:n.name}};const e=t==null?void 0:t(n.type);return typeof e=="function"?{type:n.type,params:n.params||n,children:(i=n.children)==null?void 0:i.map(a=>Ye(a,t)),predicate:(t==null?void 0:t(n.type))||n.predicate}:e||{type:n.type,params:n.params||n,children:(o=n.children)==null?void 0:o.map(a=>Ye(a,t)),predicate:n.predicate}}function er(n,t,e){const i=n[0].machine,o=n.find(a=>a.type==="final"&&a.parent===i.root);return o&&o.output?on(o.output,t,e):void 0}const Le=n=>n.type==="atomic"||n.type==="final";function te(n){return Object.values(n.states).filter(t=>t.type!=="history")}function it(n,t){const e=[];let i=n.parent;for(;i&&i!==t;)e.push(i),i=i.parent;return e}function we(n){const t=new Set(n),e=new Set(n),i=cn(e);for(const o of t)if(o.type==="compound"&&(!i.get(o)||!i.get(o).length))bt(o).forEach(a=>e.add(a));else if(o.type==="parallel"){for(const a of te(o))if(a.type!=="history"&&!e.has(a))for(const c of bt(a))e.add(c)}for(const o of e){let a=o.parent;for(;a;)e.add(a),a=a.parent}return e}function an(n,t){const e=t.get(n);if(!e)return{};if(n.type==="compound"){const o=e[0];if(o){if(Le(o))return o.key}else return{}}const i={};for(const o of e)i[o.key]=an(o,t);return i}function cn(n){const t=new Map;for(const e of n)t.has(e)||t.set(e,[]),e.parent&&(t.has(e.parent)||t.set(e.parent,[]),t.get(e.parent).push(e));return t}function un(n,t){const e=we(t);return an(n,cn(e))}function De(n,t=n[0].machine.root){return t.type==="compound"?te(t).some(e=>e.type==="final"&&n.includes(e)):t.type==="parallel"?te(t).every(e=>De(n,e)):!1}const _e=n=>n[0]===Hn;function tr(n,t){return n.transitions.get(t)||[...n.transitions.keys()].filter(i=>{if(i===Gn)return!0;if(!i.endsWith(".*"))return!1;const o=i.split("."),a=t.split(".");for(let c=0;c<o.length;c++){const d=o[c],l=a[c];if(d==="*")return c===o.length-1;if(d!==l)return!1}return!0}).sort((i,o)=>o.length-i.length).flatMap(i=>n.transitions.get(i))}function nr(n){const t=n.config.after;if(!t)return[];const e=(o,a)=>{const c=typeof o=="function"?`${n.id}:delay[${a}]`:o,d=Ar(c,n.id);return n.entry.push(Sr({type:d},{id:d,delay:o})),n.exit.push(qn(d)),d};return(Ee(t)?t.map((o,a)=>{const c=e(o.delay,a);return{...o,event:c}}):Object.keys(t).flatMap((o,a)=>{const c=t[o],d=typeof c=="string"?{target:c}:c,l=isNaN(+o)?o:+o,f=e(l,a);return Y(d).map(h=>({...h,event:f,delay:l}))})).map(o=>{const{delay:a}=o;return{...K(n,o.event,o),delay:a}})}function K(n,t,e){const i=sn(e.target),o=e.reenter??!1,{guards:a}=n.machine.implementations,c=ln(n,i),d={...e,actions:Y(e.actions),guard:e.guard?Ye(e.guard,l=>a[l]):void 0,target:c,source:n,reenter:o,eventType:t,toJSON:()=>({...d,source:`#${n.id}`,target:c?c.map(l=>`#${l.id}`):void 0})};return d}function rr(n){const t=new Map;if(n.config.on)for(const e of Object.keys(n.config.on)){if(e===zt)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const i=n.config.on[e];t.set(e,oe(i).map(o=>K(n,e,o)))}if(n.config.onDone){const e=String(Ke(n.id));t.set(e,oe(n.config.onDone).map(i=>K(n,e,i)))}for(const e of n.invoke){if(e.onDone){const i=`done.invoke.${e.id}`;t.set(i,oe(e.onDone).map(o=>K(n,i,o)))}if(e.onError){const i=`error.platform.${e.id}`;t.set(i,oe(e.onError).map(o=>K(n,i,o)))}if(e.onSnapshot){const i=`xstate.snapshot.${e.id}`;t.set(i,oe(e.onSnapshot).map(o=>K(n,i,o)))}}for(const e of n.after){let i=t.get(e.eventType);i||(i=[],t.set(e.eventType,i)),i.push(e)}return t}function ir(n,t){if(typeof t=="string"||Ee(t)){const e=Y(t).map(a=>{const c=typeof a=="string"?_e(a)?n.machine.getStateNodeById(a):n.states[a]:a;if(!c)throw new Error(`Initial state node "${a}" not found on parent state node #${n.id}`);if(!ne(c,n))throw new Error(`Invalid initial target: state node #${c.id} is not a descendant of #${n.id}`);return c}),i=ln(n,e),o={source:n,actions:[],eventType:null,reenter:!1,target:i,toJSON:()=>({...o,source:`#${n.id}`,target:i?i.map(a=>`#${a.id}`):void 0})};return o}return K(n,"__INITIAL__",{target:Y(t.target).map(e=>typeof e=="string"?_e(e)?e:`${ge}${e}`:e),actions:t.actions})}function ln(n,t){if(t!==void 0)return t.map(e=>{if(typeof e!="string")return e;if(_e(e))return n.machine.getStateNodeById(e);const i=e[0]===ge;if(i&&!n.parent)return je(n,e.slice(1));const o=i?n.key+e:e;if(n.parent)try{return je(n.parent,o)}catch(a){throw new Error(`Invalid transition definition for state node '${n.id}':
${a.message}`)}else throw new Error(`Invalid target: "${e}" is not a valid target from the root node. Did you mean ".${e}"?`)})}function fn(n){const t=sn(n.target);return t?t.map(e=>typeof e=="string"?je(n.parent,e):e):n.parent.initial.target}function Pe(n){return n.type==="history"}function bt(n){const t=new Set;function e(i){if(!t.has(i)){if(t.add(i),i.type==="compound")for(const o of i.initial.target){for(const a of it(o,n))t.add(a);e(o)}else if(i.type==="parallel")for(const o of te(i))e(o)}}return e(n),[...t]}function pe(n,t){if(_e(t))return n.machine.getStateNodeById(t);if(!n.states)throw new Error(`Unable to retrieve child state '${t}' from '${n.id}'; no child states exist.`);const e=n.states[t];if(!e)throw new Error(`Child state '${t}' does not exist on '${n.id}'`);return e}function je(n,t){if(typeof t=="string"&&_e(t))try{return n.machine.getStateNodeById(t)}catch{}const e=nn(t).slice();let i=n;for(;e.length;){const o=e.shift();if(!o.length)break;i=pe(i,o)}return i}function Te(n,t){const e=t instanceof U?t.value:Qe(t);if(typeof e=="string")return[n,n.states[e]];const i=Object.keys(e),o=i.map(a=>pe(n,a)).filter(Boolean);return[n.machine.root,n].concat(o,i.reduce((a,c)=>{const d=pe(n,c);if(!d)return a;const l=Te(d,e[c]);return a.concat(l)},[]))}function or(n,t,e,i){const a=pe(n,t).next(e,i);return!a||!a.length?n.next(e,i):a}function sr(n,t,e,i){const o=Object.keys(t),a=pe(n,o[0]),c=ot(a,t[o[0]],e,i);return!c||!c.length?n.next(e,i):c}function ar(n,t,e,i){const o=[];for(const a of Object.keys(t)){const c=t[a];if(!c)continue;const d=pe(n,a),l=ot(d,c,e,i);l&&o.push(...l)}return o.length?o:n.next(e,i)}function ot(n,t,e,i){return typeof t=="string"?or(n,t,e,i):Object.keys(t).length===1?sr(n,t,e,i):ar(n,t,e,i)}function cr(n){return Object.keys(n.states).map(t=>n.states[t]).filter(t=>t.type==="history")}function ne(n,t){let e=n;for(;e.parent&&e.parent!==t;)e=e.parent;return e.parent===t}function wt(n){const t=[];let e=n.parent;for(;e;)t.unshift(e),e=e.parent;return t}function ur(n,t){const e=new Set(n),i=new Set(t);for(const o of e)if(i.has(o))return!0;for(const o of i)if(e.has(o))return!0;return!1}function dn(n,t,e){const i=new Set;for(const o of n){let a=!1;const c=new Set;for(const d of i)if(ur(Ze([o],t,e),Ze([d],t,e)))if(ne(o.source,d.source))c.add(d);else{a=!0;break}if(!a){for(const d of c)i.delete(d);i.add(o)}}return Array.from(i)}function lr(n){const[t]=n;let e=wt(t),i=[];for(const o of n){const a=wt(o);i=e.filter(c=>a.includes(c)),e=i,i=[]}return e[e.length-1]}function st(n,t){if(!n.target)return[];const e=new Set;for(const i of n.target)if(Pe(i))if(t[i.id])for(const o of t[i.id])e.add(o);else for(const o of st({target:fn(i)},t))e.add(o);else e.add(i);return[...e]}function _n(n,t){const e=st(n,t);return e?!n.reenter&&n.source.type!=="parallel"&&e.every(o=>ne(o,n.source))?n.source:lr(e.concat(n.source)):null}function Ze(n,t,e){var o;const i=new Set;for(const a of n)if((o=a.target)!=null&&o.length){const c=_n(a,e);for(const d of t)ne(d,c)&&i.add(d)}return[...i]}function Oe(n,t,e,i,o){const a=new Set(t.configuration);if(!n.length)return t;const c=fr(n,t,a,i,e,o);return re(c,{value:{}})}function fr(n,t,e,i,o,a){const c=[],d={...t.historyValue},l=dn(n,e,d),f=[...t._internalQueue];a||_r(l,e,d,c),c.push(...l.flatMap(s=>s.actions)),dr(i,l,e,c,f,t,d,a);const h=[...e],r=De(h);if(r){const s=h.sort((u,_)=>_.order-u.order).flatMap(u=>u.exit);c.push(...s)}try{const s=Fe(c,i,t,o),u=r?er(h,s.context,i):void 0;return f.push(...s._internalQueue),re(t,{configuration:h,historyValue:d,_internalQueue:f,context:s.context,done:r,output:u,children:s.children})}catch(s){throw s}}function dr(n,t,e,i,o,a,c,d){const l=new Set,f=new Set;pn(t,c,f,l),d&&f.add(a.machine.root);for(const h of[...l].sort((r,s)=>r.order-s.order)){e.add(h);for(const r of h.invoke)i.push(zn(r));if(i.push(...h.entry),f.has(h))for(const r of f){const s=r.initial.actions;i.push(...s)}if(h.type==="final"){const r=h.parent;if(!r.parent)continue;if(o.push(Ke(r.id,h.output?on(h.output,a.context,n):void 0)),r.parent){const s=r.parent;s.type==="parallel"&&te(s).every(u=>De([...e],u))&&o.push(Ke(s.id))}}}}function pn(n,t,e,i){for(const o of n){for(const d of o.target||[])se(d,t,e,i);const a=_n(o,t),c=st(o,t);for(const d of c)Me(d,a,i,t,e)}}function se(n,t,e,i){if(Pe(n))if(t[n.id]){const o=t[n.id];for(const a of o)se(a,t,e,i);for(const a of o){Me(a,n.parent,i,t,e);for(const c of e)e.add(c)}}else{const o=fn(n);for(const a of o)se(a,t,e,i);for(const a of o){Me(a,n,i,t,e);for(const c of e)e.add(c)}}else if(i.add(n),n.type==="compound"){e.add(n);const o=n.initial.target;for(const a of o)se(a,t,e,i);for(const a of o)Me(a,n,i,t,e)}else if(n.type==="parallel")for(const o of te(n).filter(a=>!Pe(a)))[...i].some(a=>ne(a,o))||se(o,t,e,i)}function Me(n,t,e,i,o){const a=it(n,t);for(const c of a)if(e.add(c),c.type==="parallel")for(const d of te(c).filter(l=>!Pe(l)))[...e].some(l=>ne(l,d))||se(d,i,o,e)}function _r(n,t,e,i){const o=Ze(n,t,e);o.sort((a,c)=>c.order-a.order);for(const a of o)for(const c of cr(a)){let d;c.history==="deep"?d=l=>Le(l)&&ne(l,a):d=l=>l.parent===a,e[c.id]=Array.from(t).filter(d)}for(const a of o)i.push(...a.exit,...a.invoke.map(c=>hn(c.id))),t.delete(a)}function Fe(n,t,e,i){const{machine:o}=e;let a=re(e,{_internalQueue:[]});for(const c of n){const d=typeof c=="function"?c:o.implementations.actions[typeof c=="string"?c:c.type];if(!d)continue;const l={context:a.context,event:t,self:i==null?void 0:i.self,system:i==null?void 0:i.system,action:typeof c=="string"?{type:c}:c};if(!("resolve"in d)){(i==null?void 0:i.self.status)===G.Running?d(l):i==null||i.defer(()=>d(l));continue}const f=d,[h,r,s]=f.resolve(i,a,l,d);a=h,"execute"in d&&((i==null?void 0:i.self.status)===G.Running?f.execute(i,r):i==null||i.defer(f.execute.bind(null,i,r))),s&&(a=Fe(s,t,a,i))}return a}function We(n,t,e){let i=n;const o=[];if(t.type===Je)return i=Tt(t,i,e),o.push(i),{state:i,microstates:o};let a=t;if(a.type!==en){const c=St(a,i);i=Oe(c,n,e,a,!1),o.push(i)}for(;!i.done;){let c=pr(i,a);if(c.length)i=Oe(c,i,e,a,!1),o.push(i);else if(i._internalQueue.length){a=i._internalQueue[0];const d=St(a,i);i=Oe(d,i,e,a,!1),i._internalQueue.shift(),o.push(i)}else break}return i.done&&Tt(a,i,e),{state:i,microstates:o}}function Tt(n,t,e){const i=[];for(const o of t.configuration.sort((a,c)=>c.order-a.order))i.push(...o.exit);for(const o of Object.values(t.children))i.push(hn(o));return Fe(i,n,t,e)}function St(n,t){return t.machine.getTransitionData(t,n)}function pr(n,t){const e=new Set,i=n.configuration.filter(Le);for(const o of i)e:for(const a of[o].concat(it(o,null)))if(a.always){for(const c of a.always)if(c.guard===void 0||rt(c.guard,n.context,t,n)){e.add(c);break e}}return dn(Array.from(e),new Set(n.configuration),n.historyValue)}function At(n,t){const e=we(Te(n,t));return un(n,[...e])}function hr(n){const t=[],e=n.initial,i=new Set;pn([e],{},new Set([n]),i);for(const a of[...i].sort((c,d)=>c.order-d.order))t.push(a);return t}class U{static from(t,e={},i){if(t instanceof U)return t.context!==e?new U({value:t.value,context:e,meta:{},configuration:[],children:{}},i):t;const o=we(Te(i.root,t));return new U({value:t,context:e,meta:void 0,configuration:Array.from(o),children:{}},i)}constructor(t,e){this.machine=e,this.tags=void 0,this.value=void 0,this.done=void 0,this.output=void 0,this.context=void 0,this.historyValue={},this._internalQueue=void 0,this.configuration=void 0,this.children=void 0,this.context=t.context,this._internalQueue=t._internalQueue??[],this.historyValue=t.historyValue||{},this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration??Array.from(we(Te(e.root,t.value))),this.children=t.children,this.value=un(e.root,this.configuration),this.tags=new Set(Ue(this.configuration.map(i=>i.tags))),this.done=t.done??!1,this.output=t.output}toStrings(t=this.value){if(typeof t=="string")return[t];const e=Object.keys(t);return e.concat(...e.map(i=>this.toStrings(t[i]).map(o=>i+ge+o)))}toJSON(){const{configuration:t,tags:e,machine:i,...o}=this;return{...o,tags:Array.from(e),meta:this.meta}}matches(t){return tn(t,this.value)}hasTag(t){return this.tags.has(t)}can(t){const e=this.machine.getTransitionData(this,t);return!!(e!=null&&e.length)&&e.some(i=>i.target!==void 0||i.actions.length)}get nextEvents(){return ee(this,"nextEvents",()=>[...new Set(Ue([...this.configuration.map(t=>t.ownEvents)]))])}get meta(){return this.configuration.reduce((t,e)=>(e.meta!==void 0&&(t[e.id]=e.meta),t),{})}}function re(n,t={}){return new U({...n,...t},n.machine)}function mr(n){var d,l;const{configuration:t,tags:e,machine:i,children:o,...a}=n,c={};for(const f in o)c[f]={state:(l=(d=o[f]).getPersistedState)==null?void 0:l.call(d),src:o[f].src};return{...a,children:c}}function vr(n,t,e,{actorRef:i}){const o=typeof i=="function"?i(e):i,a=typeof o=="string"?t.children[o]:o;let c=t.children;return a&&(c={...c},delete c[a.id]),[re(t,{children:c}),a]}function gr(n,t){if(t){if(t.status!==G.Running){n.stopChild(t);return}n.defer(()=>{n.stopChild(t)})}}function hn(n){function t(e){}return t.type="xstate.stop",t.actorRef=n,t.resolve=vr,t.execute=gr,t}function yr(n,{machine:t,context:e},i,o){const a=(c,d={})=>{const{systemId:l}=d;if(typeof c=="string"){const f=$e(t.implementations.actors[c]);if(!f)throw new Error(`Actor logic '${c}' not implemented in machine '${t.id}'`);const h="input"in d?d.input:f.input,r=de(f.src,{id:d.id,parent:n.self,input:typeof h=="function"?h({context:e,event:i,self:n.self}):h,systemId:l});return o[r.id]=r,r}else return de(c,{id:d.id,parent:n.self,input:d.input,systemId:l})};return(c,d)=>{const l=a(c,d);return o[l.id]=l,n.defer(()=>{var f;if(l.status!==G.Stopped)try{(f=l.start)==null||f.call(l)}catch(h){n.self.send(He(l.id,h));return}}),l}}function br(n,t,e,{assignment:i}){if(!t.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const o={},a={context:t.context,event:e.event,action:e.action,spawn:yr(n,t,e.event,o),self:n==null?void 0:n.self,system:n==null?void 0:n.system};let c={};if(typeof i=="function")c=i(a);else for(const l of Object.keys(i)){const f=i[l];c[l]=typeof f=="function"?f(a):f}const d=Object.assign({},t.context,c);return[re(t,{context:d,children:Object.keys(o).length?{...t.children,...o}:t.children})]}function mn(n){function t(e){}return t.type="xstate.assign",t.assignment=n,t.resolve=br,t}function wr(n,t,e,{event:i,id:o,delay:a}){const c=t.machine.implementations.delays;if(typeof i=="string")throw new Error(`Only event objects may be used with raise; use raise({ type: "${i}" }) instead`);const d=typeof i=="function"?i(e):i;let l;if(typeof a=="string"){const f=c&&c[a];l=typeof f=="function"?f(e):f}else l=typeof a=="function"?a(e):a;return[typeof l!="number"?re(t,{_internalQueue:t._internalQueue.concat(d)}):t,{event:d,id:o,delay:l}]}function Tr(n,t){if(typeof t.delay=="number"){n.self.delaySend(t);return}}function Sr(n,t){function e(i){}return e.type="xstate.raise",e.event=n,e.id=t==null?void 0:t.id,e.delay=t==null?void 0:t.delay,e.resolve=wr,e.execute=Tr,e}function Ar(n,t){const e=t?`#${t}`:"";return`${Z.After}(${n})${e}`}function Ke(n,t){const e=`${Z.DoneState}.${n}`,i={type:e,output:t};return i.toString=()=>e,i}function kr(n,t){const e=`${Z.DoneInvoke}.${n}`,i={type:e,output:t};return i.toString=()=>e,i}function He(n,t){const e=`${Z.ErrorPlatform}.${n}`,i={type:e,data:t};return i.toString=()=>e,i}function Ir(n){return{type:en,input:n}}const Er={},ye=n=>typeof n=="string"?{type:n}:typeof n=="function"?"resolve"in n?{type:n.type}:{type:n.name}:n;class at{constructor(t,e){if(this.config=t,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=e._parent,this.key=e._key,this.machine=e._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join(ge),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?yt(this.config.states,(i,o)=>new at(i,{_parent:this,_key:o,_machine:this.machine})):Er,this.type==="compound"&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=this.config.history===!0?"shallow":this.config.history||!1,this.entry=Y(this.config.entry),this.exit=Y(this.config.exit),this.meta=this.config.meta,this.output=this.type==="final"?this.config.output:void 0,this.tags=Y(t.tags)}_initialize(){this.transitions=rr(this),this.config.always&&(this.always=oe(this.config.always).map(t=>K(this,zt,t))),Object.keys(this.states).forEach(t=>{this.states[t]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(ye),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(t=>`#${t.id}`),source:`#${this.id}`,actions:this.initial.actions.map(ye),eventType:null})}:void 0,history:this.history,states:yt(this.states,t=>t.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(t=>({...t,actions:t.actions.map(ye)})),entry:this.entry.map(ye),exit:this.exit.map(ye),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return ee(this,"invoke",()=>Y(this.config.invoke).map((t,e)=>{const i=Un(this.id,e),o=Xn(t,i),a=o.id||i,c=o.src,{systemId:d}=o,l=typeof c=="string"||"type"in c?c:a;return!this.machine.implementations.actors[a]&&typeof c!="string"&&!("type"in c)&&(this.machine.implementations.actors={...this.machine.implementations.actors,[a]:c}),{type:"xstate.invoke",...o,src:l,id:a,systemId:d,toJSON(){const{onDone:f,onError:h,...r}=o;return{...r,type:"xstate.invoke",src:l,id:a}}}}))}get on(){return ee(this,"on",()=>[...this.transitions].flatMap(([e,i])=>i.map(o=>[e,o])).reduce((e,[i,o])=>(e[i]=e[i]||[],e[i].push(o),e),{}))}get after(){return ee(this,"delayedTransitions",()=>nr(this))}get initial(){return ee(this,"initial",()=>ir(this,this.config.initial||[]))}next(t,e){const i=e.type,o=[];let a;const c=ee(this,`candidates-${i}`,()=>tr(this,i));for(const d of c){const{guard:l}=d,f=t.context;let h=!1;try{h=!l||rt(l,f,e,t)}catch(r){throw new Error(`Unable to evaluate guard '${l.type}' in transition for event '${i}' in state node '${this.id}':
${r.message}`)}if(h){o.push(...d.actions),a=d;break}}return a?[a]:void 0}get target(){if(this.type==="history")return this.config.target}get stateIds(){const t=Ue(Object.keys(this.states).map(e=>this.states[e].stateIds));return[this.id].concat(t)}get events(){return ee(this,"events",()=>{const{states:t}=this,e=new Set(this.ownEvents);if(t)for(const i of Object.keys(t)){const o=t[i];if(o.states)for(const a of o.events)e.add(`${a}`)}return Array.from(e)})}get ownEvents(){const t=new Set([...this.transitions.keys()].filter(e=>this.transitions.get(e).some(i=>!(!i.target&&!i.actions.length&&!i.reenter))));return Array.from(t)}}const xr="#";class ct{constructor(t,e){this.config=t,this.version=void 0,this.implementations=void 0,this.types=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.__TContext=void 0,this.__TEvent=void 0,this.__TAction=void 0,this.__TActorMap=void 0,this.__TResolvedTypesMeta=void 0,this.id=t.id||"(machine)",this.implementations={actors:(e==null?void 0:e.actors)??{},actions:(e==null?void 0:e.actions)??{},delays:(e==null?void 0:e.delays)??{},guards:(e==null?void 0:e.guards)??{}},this.version=this.config.version,this.types=this.config.types??{},this.transition=this.transition.bind(this),this.root=new at(t,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(t){const{actions:e,guards:i,actors:o,delays:a}=this.implementations;return new ct(this.config,{actions:{...e,...t.actions},guards:{...i,...t.guards},actors:{...o,...t.actors},delays:{...a,...t.delays}})}resolveState(t){const e=we(Te(this.root,t.value)),i=Array.from(e);return this.createState({...t,value:At(this.root,t.value),configuration:i,done:De(i)})}resolveStateValue(t,...[e]){const i=At(this.root,t);return this.resolveState(U.from(i,e,this))}transition(t,e,i){if(Nn(e)&&!t.nextEvents.some(a=>a===e.type))throw e.data;const{state:o}=We(t,e,i);return o}microstep(t,e,i){return We(t,e,i).microstates}getTransitionData(t,e){return ot(this.root,t.value,t,e)||[]}getPreInitialState(t,e){const{context:i}=this.config,o=this.resolveState(this.createState({value:{},context:typeof i!="function"&&i?i:{},meta:void 0,configuration:hr(this.root),children:{}}));return typeof i=="function"?Fe([mn(({spawn:c,event:d})=>i({spawn:c,input:d.input}))],e,o,t):o}getInitialState(t,e){const i=Ir(e),o=this.getPreInitialState(t,i),a=Oe([{target:[...o.configuration].filter(Le),source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],o,t,i,!0),{state:c}=We(a,i,t);return c}start(t,e){Object.values(t.children).forEach(i=>{var o;if(i.status===0)try{(o=i.start)==null||o.call(i)}catch(a){e.self.send(He(i.id,a))}})}getStateNodeById(t){const e=t.split(ge),i=e.slice(1),o=_e(e[0])?e[0].slice(xr.length):e[0],a=this.idMap.get(o);if(!a)throw new Error(`Child state node '#${o}' does not exist on machine '${this.id}'`);return je(a,i)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedState(t){return mr(t)}createState(t){return t instanceof U?t:new U(t,this)}getStatus(t){return t.done?{status:"done",data:t.output}:{status:"active"}}restoreState(t,e){const i={};Object.keys(t.children).forEach(a=>{var s,u;const c=t.children[a],d=c.state,l=c.src,f=l?(s=$e(this.implementations.actors[l]))==null?void 0:s.src:void 0;if(!f)return;const h=(u=f.restoreState)==null?void 0:u.call(f,d,e),r=de(f,{id:a,state:h});i[a]=r});const o=this.createState(new U({...t,children:i},this));return o.configuration.forEach(a=>{a.invoke&&a.invoke.forEach(c=>{const{id:d,src:l}=c;if(i[d])return;const f=$e(this.implementations.actors[l]);if(f){const h=de(f.src,{id:d,parent:e==null?void 0:e.self,input:"input"in c?c.input:f.input});i[d]=h}})}),o}}function Or(n,t){return new ct(n,t)}function Mr(n,...[t={}]){const{guards:e,actions:i,actors:o,delays:a,...c}=t,d={guards:e,actions:i,actors:o,delays:a},l=n.provide(d),f=de(l,c).start();Sn(()=>f.stop());let h=f.getSnapshot();return{state:Zt(h,s=>f.subscribe(u=>{h!==u&&(h=u,s(h))}).unsubscribe),send:f.send,service:f}}const vn={},$r=n=>{An(vn,n)},Ge=()=>kn(vn),Pr=Or({id:"gameClient",context:({input:n})=>({gameId:n.gameId,userId:n.userId,hostUserId:n.hostUserId,users:n.users,actions:n.actions,defense:n.defense,attack:n.attack}),types:{context:{},events:{},actors:{}},initial:"Initial",states:{Initial:{always:[{target:"Lobby",guard:"gameNotStarted"},{target:"Finished",guard:"gameFinished"},{target:"Ingame"}]},Ingame:{entry:["consoleLogValueAgain"],states:{Initial:{}},initial:"Initial"},Lobby:{states:{"As admin":{on:{"assign side":{target:"As admin",actions:"forwardToServer"},"assign admin":{target:"As admin",actions:"forwardToServer"}}},"As player":{},Initial:{always:[{target:"As admin",guard:"isAdmin"},"As player"]}},initial:"Initial",on:{"admin starts game":{actions:"consoleLogValue",target:"Ingame"}}},Finished:{}},on:{"users update":{target:"#gameClient",actions:"updateUsers"},"user sends emoji":{target:"#gameClient",actions:"sendEmoji"},"show emoji":{target:"#gameClient",actions:"showEmoji"}}}),jr=({send:n,actions:t})=>Pr.provide({actions:{consoleLogValue:({event:e})=>{console.log(e)},consoleLogValueAgain:({context:e})=>{console.log("context value 2: ",e)},updateUsers:mn(({event:e})=>({users:e.users})),sendEmoji:({event:e})=>{n({type:"send emoji",emoji:e.emoji})},showEmoji:({event:e})=>{const i=e;t.showEmoji({userId:i.userId,emoji:i.emoji})},forwardToServer:({event:e})=>{n(e)}},actors:{},guards:{isHost:({context:e})=>e.hostUserId===e.userId,isAdmin:({context:e})=>!!e.users.find(i=>i.id===e.userId&&i.isAdmin),isPlayer:({context:e})=>e.hostUserId!==e.userId,gameNotStarted:()=>!0,gameFinished:()=>!1}}),Lr=({gameId:n,userId:t,onMessage:e})=>{const i=On({status:"opening",log:[]}),o=(f,h)=>(console.debug("[websocket]",f,h),i.update(r=>({...r,log:[...r.log,`[websocket] ${f}`]}))),a=f=>i.update(h=>({...h,status:f}));let c;const d=()=>{o("connecting");const f=window.location.protocol==="https:"?"wss:":"ws:";c=new WebSocket(`${f}//${window.location.host}/websocket?gameId=${n}&userId=${t}`),c.addEventListener("open",()=>{a("opened"),o("connection open")}),c.addEventListener("close",()=>{a("closed"),o("connection closed")}),c.addEventListener("message",h=>{try{const r=JSON.parse(h.data);r.type!=="mouse position"&&o(`message received: ${h.data}`,h),e(r)}catch(r){o("error parsing message",r)}})},l=f=>{c==null||c.send(JSON.stringify(f))};return{subscribe:i.subscribe,open:d,close:()=>c==null?void 0:c.close(),send:l}};function Dr(n,t){return n===t}const ae=(n,t,e=Dr)=>{let i,o=t(n.getSnapshot());return Zt(o,c=>(i=n.subscribe(d=>{const l=t(d);e(o,l)||(o=l,c(l))}),()=>{i.unsubscribe()}))};var b=class{static clamp(n,t,e){return Math.max(t,typeof e<"u"?Math.min(n,e):n)}static clampV(n,t,e){return n.map(i=>e?b.clamp(i,t,e):b.clamp(i,t))}static cross(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(e[0]-n[0])*(t[1]-n[1])}static snap(n,t=1){return[Math.round(n[0]/t)*t,Math.round(n[1]/t)*t]}},y=b;y.neg=n=>[-n[0],-n[1]];y.add=(n,t)=>[n[0]+t[0],n[1]+t[1]];y.addScalar=(n,t)=>[n[0]+t,n[1]+t];y.sub=(n,t)=>[n[0]-t[0],n[1]-t[1]];y.subScalar=(n,t)=>[n[0]-t,n[1]-t];y.vec=(n,t)=>[t[0]-n[0],t[1]-n[1]];y.mul=(n,t)=>[n[0]*t,n[1]*t];y.mulV=(n,t)=>[n[0]*t[0],n[1]*t[1]];y.div=(n,t)=>[n[0]/t,n[1]/t];y.divV=(n,t)=>[n[0]/t[0],n[1]/t[1]];y.per=n=>[n[1],-n[0]];y.dpr=(n,t)=>n[0]*t[0]+n[1]*t[1];y.cpr=(n,t)=>n[0]*t[1]-t[0]*n[1];y.len2=n=>n[0]*n[0]+n[1]*n[1];y.len=n=>Math.hypot(n[0],n[1]);y.pry=(n,t)=>b.dpr(n,t)/b.len(t);y.uni=n=>b.div(n,b.len(n));y.normalize=n=>b.uni(n);y.tangent=(n,t)=>b.uni(b.sub(n,t));y.dist2=(n,t)=>b.len2(b.sub(n,t));y.dist=(n,t)=>Math.hypot(n[1]-t[1],n[0]-t[0]);y.fastDist=(n,t)=>{const e=[t[0]-n[0],t[1]-n[1]],i=[Math.abs(e[0]),Math.abs(e[1])];let o=1/Math.max(i[0],i[1]);return o=o*(1.29289-(i[0]+i[1])*o*.29289),[e[0]*o,e[1]*o]};y.ang=(n,t)=>Math.atan2(b.cpr(n,t),b.dpr(n,t));y.angle=(n,t)=>Math.atan2(t[1]-n[1],t[0]-n[0]);y.med=(n,t)=>b.mul(b.add(n,t),.5);y.rot=(n,t=0)=>[n[0]*Math.cos(t)-n[1]*Math.sin(t),n[0]*Math.sin(t)+n[1]*Math.cos(t)];y.rotWith=(n,t,e=0)=>{if(e===0)return n;const i=Math.sin(e),o=Math.cos(e),a=n[0]-t[0],c=n[1]-t[1],d=a*o-c*i,l=a*i+c*o;return[d+t[0],l+t[1]]};y.isEqual=(n,t)=>n[0]===t[0]&&n[1]===t[1];y.lrp=(n,t,e)=>b.add(n,b.mul(b.sub(t,n),e));y.int=(n,t,e,i,o=1)=>{const a=(b.clamp(e,i)-e)/(i-e);return b.add(b.mul(n,1-a),b.mul(t,o))};y.ang3=(n,t,e)=>{const i=b.vec(t,n),o=b.vec(t,e);return b.ang(i,o)};y.abs=n=>[Math.abs(n[0]),Math.abs(n[1])];y.rescale=(n,t)=>{const e=b.len(n);return[t*n[0]/e,t*n[1]/e]};y.isLeft=(n,t,e)=>(t[0]-n[0])*(e[1]-n[1])-(e[0]-n[0])*(t[1]-n[1]);y.clockwise=(n,t,e)=>b.isLeft(n,t,e)>0;y.toFixed=(n,t=2)=>n.map(e=>+e.toFixed(t));y.nearestPointOnLineThroughPoint=(n,t,e)=>b.add(n,b.mul(t,b.pry(b.sub(e,n),t)));y.distanceToLineThroughPoint=(n,t,e)=>b.dist(e,b.nearestPointOnLineThroughPoint(n,t,e));y.nearestPointOnLineSegment=(n,t,e,i=!0)=>{const o=b.uni(b.sub(t,n)),a=b.add(n,b.mul(o,b.pry(b.sub(e,n),o)));if(i){if(a[0]<Math.min(n[0],t[0]))return n[0]<t[0]?n:t;if(a[0]>Math.max(n[0],t[0]))return n[0]>t[0]?n:t;if(a[1]<Math.min(n[1],t[1]))return n[1]<t[1]?n:t;if(a[1]>Math.max(n[1],t[1]))return n[1]>t[1]?n:t}return a};y.distanceToLineSegment=(n,t,e,i=!0)=>b.dist(e,b.nearestPointOnLineSegment(n,t,e,i));y.nudge=(n,t,e)=>b.isEqual(n,t)?n:b.add(n,b.mul(b.uni(b.sub(t,n)),e));y.nudgeAtAngle=(n,t,e)=>[Math.cos(t)*e+n[0],Math.sin(t)*e+n[1]];y.toPrecision=(n,t=4)=>[+n[0].toPrecision(t),+n[1].toPrecision(t)];y.pointsBetween=(n,t,e=6)=>Array.from(Array(e)).map((i,o)=>{const a=o/(e-1),c=Math.min(1,.5+Math.abs(.5-a));return[...b.lrp(n,t,a),c]});y.slope=(n,t)=>n[0]===t[0]?NaN:(n[1]-t[1])/(n[0]-t[0]);y.max=(...n)=>[Math.max(...n.map(t=>t[0])),Math.max(...n.map(t=>t[1]))];y.min=(...n)=>[Math.max(...n.map(t=>t[0])),Math.max(...n.map(t=>t[1]))];var Fr=class{constructor(n=[]){this.points=[],this.lengths=[],this.totalLength=0,this.addPoint=t=>{if(this.prev){const e=y.dist(this.prev,t);this.lengths.push(e),this.totalLength+=e,this.points.push(t)}this.prev=t},this.clear=()=>{this.points=this.prev?[this.prev]:[],this.totalLength=0},this.getSplinePoint=t=>{const{points:e}=this,i=e.length-1,o=Math.trunc(t),a=Math.min(o+1,i),c=Math.min(a+1,i),d=Math.min(c+1,i),l=a-1,f=t-o,h=f*f,r=h*f,s=-r+2*h-f,u=3*r-5*h+2,_=-3*r+4*h+f,v=r-h;return[(e[l][0]*s+e[a][0]*u+e[c][0]*_+e[d][0]*v)/2,(e[l][1]*s+e[a][1]*u+e[c][1]*_+e[d][1]*v)/2]},this.points=n,this.lengths=n.map((t,e,i)=>e===0?0:y.dist(t,i[e-1])),this.totalLength=this.lengths.reduce((t,e)=>t+e,0)}},Ce=class{constructor(n){this.state="idle",this.queue=[],this.timestamp=performance.now(),this.lastRequestId=0,this.timeoutId=0,this.spline=new Fr,this.addPoint=t=>{clearTimeout(this.timeoutId);const e=performance.now(),i=Math.min(e-this.timestamp,Ce.MAX_INTERVAL);if(!this.prevPoint){this.spline.clear(),this.prevPoint=t,this.spline.addPoint(t),this.cb(t),this.state="stopped";return}if(this.state==="stopped"){if(y.dist(this.prevPoint,t)<4){this.cb(t);return}this.spline.clear(),this.spline.addPoint(this.prevPoint),this.spline.addPoint(this.prevPoint),this.spline.addPoint(t),this.state="idle"}else this.spline.addPoint(t);if(i<16){this.prevPoint=t,this.timestamp=e,this.cb(t);return}const o={start:this.spline.points.length-3,from:this.prevPoint,to:t,duration:i};switch(this.prevPoint=t,this.timestamp=e,this.state){case"idle":{this.state="animating",this.animateNext(o);break}case"animating":{this.queue.push(o);break}}},this.animateNext=t=>{const e=performance.now(),i=()=>{const o=(performance.now()-e)/t.duration;if(o<=1&&this.spline.points.length>0){try{this.cb(this.spline.getSplinePoint(o+t.start))}catch(c){console.warn(c)}this.lastRequestId=requestAnimationFrame(i);return}const a=this.queue.shift();a?(this.state="animating",this.animateNext(a)):(this.state="idle",this.timeoutId=setTimeout(()=>{this.state="stopped"},Ce.MAX_INTERVAL))};i()},this.dispose=()=>{clearTimeout(this.timeoutId)},this.cb=n}},gn=Ce;gn.MAX_INTERVAL=300;function Hr(n){let t,e,i,o,a,c=n[0].name+"",d;return{c(){t=$("div"),e=_t("svg"),i=_t("path"),o=V(),a=$("span"),d=B(c),this.h()},l(l){t=P(l,"DIV",{class:!0});var f=D(t);e=pt(f,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,"stroke-width":!0,stroke:!0,fill:!0,"stroke-linecap":!0,"stroke-linejoin":!0,class:!0});var h=D(e);i=pt(h,"path",{d:!0}),D(i).forEach(A),h.forEach(A),o=R(f),a=P(f,"SPAN",{class:!0});var r=D(a);d=W(r,c),r.forEach(A),f.forEach(A),this.h()},h(){O(i,"d","M7.904 17.563a1.2 1.2 0 0 0 2.228 .308l2.09 -3.093l4.907 4.907a1.067 1.067 0 0 0 1.509 0l1.047 -1.047a1.067 1.067 0 0 0 0 -1.509l-4.907 -4.907l3.113 -2.09a1.2 1.2 0 0 0 -.309 -2.228l-13.582 -3.904l3.904 13.563z"),O(e,"xmlns","http://www.w3.org/2000/svg"),O(e,"width","44"),O(e,"height","44"),O(e,"viewBox","0 0 24 24"),O(e,"stroke-width","1.5"),O(e,"stroke","#2c3e50"),O(e,"fill","white"),O(e,"stroke-linecap","round"),O(e,"stroke-linejoin","round"),O(e,"class","svelte-qvny00"),O(a,"class","name svelte-qvny00"),O(t,"class","cursor svelte-qvny00")},m(l,f){L(l,t,f),I(t,e),I(e,i),I(t,o),I(t,a),I(a,d),n[3](t)},p(l,[f]){f&1&&c!==(c=l[0].name+"")&&ue(d,c)},i:ce,o:ce,d(l){l&&A(t),n[3](null)}}}function Gr(n,t,e){let{position:i}=t,o,a;Ut(()=>(e(2,o=new gn(([d,l])=>{a.style.setProperty("translate",`${d}px ${l}px`)})),()=>{o==null||o.dispose()}));function c(d){ze[d?"unshift":"push"](()=>{a=d,e(1,a)})}return n.$$set=d=>{"position"in d&&e(0,i=d.position)},n.$$.update=()=>{n.$$.dirty&5&&(o==null||o.addPoint(i.position))},[i,a,o,c]}class Vr extends me{constructor(t){super(),ve(this,t,Gr,Hr,he,{position:0})}}function kt(n,t,e){const i=n.slice();return i[9]=t[e],i}function It(n,t){let e,i,o;return i=new Vr({props:{position:t[9]}}),{key:n,first:null,c(){e=ht(),Se(i.$$.fragment),this.h()},l(a){e=ht(),Ae(i.$$.fragment,a),this.h()},h(){this.first=e},m(a,c){L(a,e,c),ke(i,a,c),o=!0},p(a,c){t=a;const d={};c&4&&(d.position=t[9]),i.$set(d)},i(a){o||(X(i.$$.fragment,a),o=!0)},o(a){N(i.$$.fragment,a),o=!1},d(a){a&&A(e),Ie(i,a)}}}function Rr(n){let t,e=[],i=new Map,o,a,c=C(n[2]);const d=l=>l[9].id;for(let l=0;l<c.length;l+=1){let f=kt(n,c,l),h=d(f);i.set(h,e[l]=It(h,f))}return{c(){t=$("div");for(let l=0;l<e.length;l+=1)e[l].c();this.h()},l(l){t=P(l,"DIV",{class:!0});var f=D(t);for(let h=0;h<e.length;h+=1)e[h].l(f);f.forEach(A),this.h()},h(){O(t,"class","cursor-overlays svelte-1n4ax7h"),et(()=>n[6].call(t))},m(l,f){L(l,t,f);for(let h=0;h<e.length;h+=1)e[h]&&e[h].m(t,null);o=Jt(t,n[6].bind(t)),a=!0},p(l,[f]){f&4&&(c=C(l[2]),tt(),e=Ct(e,f,d,1,l,c,i,t,Kt,It,null,kt),nt())},i(l){if(!a){for(let f=0;f<c.length;f+=1)X(e[f]);a=!0}},o(l){for(let f=0;f<e.length;f+=1)N(e[f]);a=!1},d(l){l&&A(t);for(let f=0;f<e.length;f+=1)e[f].d();o()}}}function qr(n,t,e){let i,o,{mousePositions:a={}}=t;const c=Ge();let d=1,l=1;const f=ae(c.machine.service,s=>s.context.users);z(n,f,s=>e(5,o=s));const h=(s,u)=>s.filter(_=>_.isConnected&&!!u[_.id]).map(_=>{const v=u[_.id];return{id:_.id,name:_.name,position:[v[0]*d,v[1]*l]}});function r(){d=this.clientWidth,l=this.clientHeight,e(0,d),e(1,l)}return n.$$set=s=>{"mousePositions"in s&&e(4,a=s.mousePositions)},n.$$.update=()=>{n.$$.dirty&48&&e(2,i=h(o,a))},[d,l,i,f,a,o,r]}class Br extends me{constructor(t){super(),ve(this,t,qr,Rr,he,{mousePositions:4})}}function Wr(n){const t=n-1;return t*t*t+1}function Nr(n,{delay:t=0,duration:e=400,easing:i=In}={}){const o=+getComputedStyle(n).opacity;return{delay:t,duration:e,easing:i,css:a=>`opacity: ${a*o}`}}function Xr(n,{delay:t=0,duration:e=400,easing:i=Wr,start:o=0,opacity:a=0}={}){const c=getComputedStyle(n),d=+c.opacity,l=c.transform==="none"?"":c.transform,f=1-o,h=d*(1-a);return{delay:t,duration:e,easing:i,css:(r,s)=>`
			transform: ${l} scale(${1-f*s});
			opacity: ${d-h*s}
		`}}function Et(n,t,e){const i=n.slice();return i[10]=t[e],i}function xt(n,t,e){const i=n.slice();return i[1]=t[e][0],i[10]=t[e][1],i}function Ot(n,t){let e,i,o=t[10].emoji+"",a,c,d,l=t[10].userName+"",f,h,r,s,u,_;function v(){return t[6](t[1])}return{key:n,first:null,c(){e=$("div"),i=$("span"),a=B(o),c=V(),d=$("span"),f=B(l),this.h()},l(m){e=P(m,"DIV",{class:!0});var p=D(e);i=P(p,"SPAN",{class:!0});var g=D(i);a=W(g,o),g.forEach(A),c=R(p),d=P(p,"SPAN",{class:!0});var S=D(d);f=W(S,l),S.forEach(A),p.forEach(A),this.h()},h(){O(i,"class","emjoi"),O(d,"class","name svelte-ar5859"),O(e,"class","displayed-emoji svelte-ar5859"),xe(e,"--_x",t[10].position[0]),xe(e,"--_y",t[10].position[1]),this.first=e},m(m,p){L(m,e,p),I(e,i),I(i,a),I(e,c),I(e,d),I(d,f),s=!0,u||(_=le(e,"introend",v),u=!0)},p(m,p){t=m,(!s||p&1)&&o!==(o=t[10].emoji+"")&&ue(a,o),(!s||p&1)&&l!==(l=t[10].userName+"")&&ue(f,l),p&1&&xe(e,"--_x",t[10].position[0]),p&1&&xe(e,"--_y",t[10].position[1])},i(m){s||(m&&et(()=>{s&&(r&&r.end(1),h=En(e,Xr,{duration:200,start:.4}),h.start())}),s=!0)},o(m){h&&h.invalidate(),m&&(r=xn(e,Nr,{})),s=!1},d(m){m&&A(e),m&&r&&r.end(),u=!1,_()}}}function Mt(n){let t,e=n[10]+"",i,o,a;function c(){return n[7](n[10])}return{c(){t=$("button"),i=B(e),this.h()},l(d){t=P(d,"BUTTON",{class:!0});var l=D(t);i=W(l,e),l.forEach(A),this.h()},h(){O(t,"class","emoji svelte-ar5859")},m(d,l){L(d,t,l),I(t,i),o||(a=le(t,"click",c),o=!0)},p(d,l){n=d},d(d){d&&A(t),o=!1,a()}}}function Qr(n){let t,e=[],i=new Map,o,a,c=C(Object.entries(n[0]));const d=h=>h[1];for(let h=0;h<c.length;h+=1){let r=xt(n,c,h),s=d(r);i.set(s,e[h]=Ot(s,r))}let l=C(n[3]),f=[];for(let h=0;h<l.length;h+=1)f[h]=Mt(Et(n,l,h));return{c(){t=$("div");for(let h=0;h<e.length;h+=1)e[h].c();o=V();for(let h=0;h<f.length;h+=1)f[h].c();this.h()},l(h){t=P(h,"DIV",{class:!0});var r=D(t);for(let s=0;s<e.length;s+=1)e[s].l(r);o=R(r);for(let s=0;s<f.length;s+=1)f[s].l(r);r.forEach(A),this.h()},h(){O(t,"class","emojis svelte-ar5859")},m(h,r){L(h,t,r);for(let s=0;s<e.length;s+=1)e[s]&&e[s].m(t,null);I(t,o);for(let s=0;s<f.length;s+=1)f[s]&&f[s].m(t,null);a=!0},p(h,[r]){if(r&1&&(c=C(Object.entries(h[0])),tt(),e=Ct(e,r,d,1,h,c,i,t,Kt,Ot,o,xt),nt()),r&24){l=C(h[3]);let s;for(s=0;s<l.length;s+=1){const u=Et(h,l,s);f[s]?f[s].p(u,r):(f[s]=Mt(u),f[s].c(),f[s].m(t,null))}for(;s<f.length;s+=1)f[s].d(1);f.length=l.length}},i(h){if(!a){for(let r=0;r<c.length;r+=1)X(e[r]);a=!0}},o(h){for(let r=0;r<e.length;r+=1)N(e[r]);a=!1},d(h){h&&A(t);for(let r=0;r<e.length;r+=1)e[r].d();Yt(f,h)}}}function Ur(n,t,e){let i;const o=Ge(),a=ae(o.machine.service,u=>u.context.users);z(n,a,u=>e(8,i=u));const c=["👋","👍","👏","😃","🧠","🤔"],d=u=>{o.machine.send({type:"user sends emoji",emoji:u})};let l={},f=0;return[l,f,a,c,d,({userId:u,emoji:_})=>{var m;const v=((m=i.find(p=>p.id===u))==null?void 0:m.name)??"Unknown";e(0,l[`${e(1,f++,f)}`]={emoji:_,userName:v,position:[Math.random(),Math.random()]},l),e(0,l),e(1,f++,f)},u=>{setTimeout(()=>{delete l[u],e(0,l)},2e3)},u=>d(u)]}class Jr extends me{constructor(t){super(),ve(this,t,Ur,Qr,he,{showEmoji:5})}get showEmoji(){return this.$$.ctx[5]}}function $t(n,t,e){const i=n.slice();return i[13]=t[e],i}function Pt(n){let t,e="admin";return{c(){t=$("span"),t.textContent=e,this.h()},l(i){t=P(i,"SPAN",{class:!0,"data-svelte-h":!0}),fe(t)!=="svelte-fku40z"&&(t.textContent=e),this.h()},h(){O(t,"class","admin")},m(i,o){L(i,t,o)},d(i){i&&A(t)}}}function Yr(n){let t;return{c(){t=B("---")},l(e){t=W(e,"---")},m(e,i){L(e,t,i)},d(e){e&&A(t)}}}function Zr(n){let t;return{c(){t=B("Verteidigung")},l(e){t=W(e,"Verteidigung")},m(e,i){L(e,t,i)},d(e){e&&A(t)}}}function Kr(n){let t;return{c(){t=B("Angriff")},l(e){t=W(e,"Angriff")},m(e,i){L(e,t,i)},d(e){e&&A(t)}}}function jt(n){let t,e="Angriff",i,o,a="Verteidigung",c,d;function l(){return n[9](n[13])}function f(){return n[10](n[13])}return{c(){t=$("button"),t.textContent=e,i=V(),o=$("button"),o.textContent=a},l(h){t=P(h,"BUTTON",{"data-svelte-h":!0}),fe(t)!=="svelte-1hqe603"&&(t.textContent=e),i=R(h),o=P(h,"BUTTON",{"data-svelte-h":!0}),fe(o)!=="svelte-1yuwb2t"&&(o.textContent=a)},m(h,r){L(h,t,r),L(h,i,r),L(h,o,r),c||(d=[le(t,"click",l),le(o,"click",f)],c=!0)},p(h,r){n=h},d(h){h&&(A(t),A(i),A(o)),c=!1,Qt(d)}}}function Lt(n){let t,e="Toggle Admin",i,o;function a(){return n[11](n[13])}return{c(){t=$("button"),t.textContent=e},l(c){t=P(c,"BUTTON",{"data-svelte-h":!0}),fe(t)!=="svelte-mqfmin"&&(t.textContent=e)},m(c,d){L(c,t,d),i||(o=le(t,"click",a),i=!0)},p(c,d){n=c},d(c){c&&A(t),i=!1,o()}}}function Dt(n){let t,e=n[13].name+"",i,o,a,c,d,l,f,h=n[13].isAdmin&&Pt();function r(m,p){return m[13].side==="attacker"?Kr:m[13].side==="defender"?Zr:Yr}let s=r(n),u=s(n),_=n[1]&&jt(n),v=n[2]&&n[13].id!==n[3]&&Lt(n);return{c(){t=$("div"),i=B(e),o=V(),h&&h.c(),a=V(),c=$("span"),u.c(),d=V(),_&&_.c(),l=V(),v&&v.c(),f=V(),this.h()},l(m){t=P(m,"DIV",{class:!0});var p=D(t);i=W(p,e),o=R(p),h&&h.l(p),a=R(p),c=P(p,"SPAN",{class:!0});var g=D(c);u.l(g),g.forEach(A),d=R(p),_&&_.l(p),l=R(p),v&&v.l(p),f=R(p),p.forEach(A),this.h()},h(){O(c,"class","side svelte-190hwhb"),O(t,"class","user")},m(m,p){L(m,t,p),I(t,i),I(t,o),h&&h.m(t,null),I(t,a),I(t,c),u.m(c,null),I(t,d),_&&_.m(t,null),I(t,l),v&&v.m(t,null),I(t,f)},p(m,p){p&1&&e!==(e=m[13].name+"")&&ue(i,e),m[13].isAdmin?h||(h=Pt(),h.c(),h.m(t,a)):h&&(h.d(1),h=null),s!==(s=r(m))&&(u.d(1),u=s(m),u&&(u.c(),u.m(c,null))),m[1]?_?_.p(m,p):(_=jt(m),_.c(),_.m(t,l)):_&&(_.d(1),_=null),m[2]&&m[13].id!==m[3]?v?v.p(m,p):(v=Lt(m),v.c(),v.m(t,f)):v&&(v.d(1),v=null)},d(m){m&&A(t),h&&h.d(),u.d(),_&&_.d(),v&&v.d()}}}function Cr(n){let t,e="Lobby",i,o,a=C(n[0]),c=[];for(let d=0;d<a.length;d+=1)c[d]=Dt($t(n,a,d));return{c(){t=$("h1"),t.textContent=e,i=V(),o=$("div");for(let d=0;d<c.length;d+=1)c[d].c();this.h()},l(d){t=P(d,"H1",{"data-svelte-h":!0}),fe(t)!=="svelte-1ueu1i2"&&(t.textContent=e),i=R(d),o=P(d,"DIV",{class:!0});var l=D(o);for(let f=0;f<c.length;f+=1)c[f].l(l);l.forEach(A),this.h()},h(){O(o,"class","users")},m(d,l){L(d,t,l),L(d,i,l),L(d,o,l);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(o,null)},p(d,[l]){if(l&399){a=C(d[0]);let f;for(f=0;f<a.length;f+=1){const h=$t(d,a,f);c[f]?c[f].p(h,l):(c[f]=Dt(h),c[f].c(),c[f].m(o,null))}for(;f<c.length;f+=1)c[f].d(1);c.length=a.length}},i:ce,o:ce,d(d){d&&(A(t),A(i),A(o)),Yt(c,d)}}}function zr(n,t,e){let i,o,a;const{userId:c,machine:d}=Ge(),l=ae(d.service,m=>m.can({type:"assign side",otherUserId:"",side:"attacker"}));z(n,l,m=>e(1,o=m));const f=ae(d.service,m=>m.can({type:"assign admin",otherUserId:"",isAdmin:!0}));z(n,f,m=>e(2,a=m));const h=ae(d.service,m=>m.context.users.filter(p=>p.id!==m.context.hostUserId));z(n,h,m=>e(0,i=m));const r=(m,p)=>{d.send({type:"assign side",otherUserId:m,side:p})},s=(m,p)=>{d.send({type:"assign admin",otherUserId:m,isAdmin:p})};return[i,o,a,c,l,f,h,r,s,m=>r(m.id,"attacker"),m=>r(m.id,"defender"),m=>s(m.id,!m.isAdmin)]}class ei extends me{constructor(t){super(),ve(this,t,zr,Cr,he,{})}}const ti=n=>({}),Ft=n=>({}),ni=n=>({}),Ht=n=>({}),ri=n=>({}),Gt=n=>({});function ii(n){let t;return{c(){t=B("...")},l(e){t=W(e,"...")},m(e,i){L(e,t,i)},i:ce,o:ce,d(e){e&&A(t)}}}function oi(n){let t,e;return t=new ei({}),{c(){Se(t.$$.fragment)},l(i){Ae(t.$$.fragment,i)},m(i,o){ke(t,i,o),e=!0},i(i){e||(X(t.$$.fragment,i),e=!0)},o(i){N(t.$$.fragment,i),e=!1},d(i){Ie(t,i)}}}function si(n){let t,e,i,o="The Hidden Threat",a,c,d,l,f,h,r,s,u,_,v,m,p,g,S;const M=n[8].items,x=Ve(M,n,n[7],Gt),E=n[8].actions,w=Ve(E,n,n[7],Ht),j=[oi,ii],T=[];function Q(k,F){return k[3]==="Lobby"?0:1}u=Q(n),_=T[u]=j[u](n);const ie=n[8]["cursor-overlays"],q=Ve(ie,n,n[7],Ft);return{c(){t=$("div"),e=$("div"),i=$("div"),i.textContent=o,a=V(),c=$("div"),d=V(),l=$("div"),x&&x.c(),f=V(),h=$("div"),w&&w.c(),r=V(),s=$("div"),_.c(),v=V(),q&&q.c(),this.h()},l(k){t=P(k,"DIV",{class:!0});var F=D(t);e=P(F,"DIV",{class:!0});var H=D(e);i=P(H,"DIV",{class:!0,"data-svelte-h":!0}),fe(i)!=="svelte-iqe0dn"&&(i.textContent=o),a=R(H),c=P(H,"DIV",{class:!0}),D(c).forEach(A),d=R(H),l=P(H,"DIV",{class:!0});var lt=D(l);x&&x.l(lt),lt.forEach(A),f=R(H),h=P(H,"DIV",{class:!0});var ft=D(h);w&&w.l(ft),ft.forEach(A),r=R(H),s=P(H,"DIV",{class:!0});var dt=D(s);_.l(dt),dt.forEach(A),v=R(H),q&&q.l(H),H.forEach(A),F.forEach(A),this.h()},h(){O(i,"class","name svelte-yumm1n"),O(c,"class","characters svelte-yumm1n"),O(l,"class","items svelte-yumm1n"),O(h,"class","actions svelte-yumm1n"),O(s,"class","content svelte-yumm1n"),O(e,"class","game svelte-yumm1n"),et(()=>n[10].call(e)),O(t,"class","game-wrapper svelte-yumm1n")},m(k,F){L(k,t,F),I(t,e),I(e,i),I(e,a),I(e,c),I(e,d),I(e,l),x&&x.m(l,null),I(e,f),I(e,h),w&&w.m(h,null),I(e,r),I(e,s),T[u].m(s,null),I(e,v),q&&q.m(e,null),n[9](e),m=Jt(e,n[10].bind(e)),p=!0,g||(S=le(e,"mousemove",n[4]),g=!0)},p(k,[F]){x&&x.p&&(!p||F&128)&&Re(x,M,k,k[7],p?Be(M,k[7],F,ri):qe(k[7]),Gt),w&&w.p&&(!p||F&128)&&Re(w,E,k,k[7],p?Be(E,k[7],F,ni):qe(k[7]),Ht);let H=u;u=Q(k),u!==H&&(tt(),N(T[H],1,1,()=>{T[H]=null}),nt(),_=T[u],_||(_=T[u]=j[u](k),_.c()),X(_,1),_.m(s,null)),q&&q.p&&(!p||F&128)&&Re(q,ie,k,k[7],p?Be(ie,k[7],F,ti):qe(k[7]),Ft)},i(k){p||(X(x,k),X(w,k),X(_),X(q,k),p=!0)},o(k){N(x,k),N(w,k),N(_),N(q,k),p=!1},d(k){k&&A(t),x&&x.d(k),w&&w.d(k),T[u].d(),q&&q.d(k),n[9](null),m(),g=!1,S()}}}function ai(n,t,e){let i,{$$slots:o={},$$scope:a}=t;const{machine:c}=Ge();let{reportMousePosition:d}=t,l,f=1,h=1;const r=v=>{d([(v.clientX-l.offsetLeft)/f,(v.clientY-l.offsetTop)/h])},s=ae(c.service,v=>{let m;return v.matches("Lobby")&&(m="Lobby"),m});z(n,s,v=>e(3,i=v));function u(v){ze[v?"unshift":"push"](()=>{l=v,e(0,l)})}function _(){f=this.clientWidth,h=this.clientHeight,e(1,f),e(2,h)}return n.$$set=v=>{"reportMousePosition"in v&&e(6,d=v.reportMousePosition),"$$scope"in v&&e(7,a=v.$$scope)},[l,f,h,i,r,s,d,a,o,u,_]}class ci extends me{constructor(t){super(),ve(this,t,ai,si,he,{reportMousePosition:6})}}var J=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ui(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var yn={};/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(n){(function(){var t=function(){this.init()};t.prototype={init:function(){var r=this||e;return r._counter=1e3,r._html5AudioPool=[],r.html5PoolSize=10,r._codecs={},r._howls=[],r._muted=!1,r._volume=1,r._canPlayEvent="canplaythrough",r._navigator=typeof window<"u"&&window.navigator?window.navigator:null,r.masterGain=null,r.noAudio=!1,r.usingWebAudio=!0,r.autoSuspend=!0,r.ctx=null,r.autoUnlock=!0,r._setup(),r},volume:function(r){var s=this||e;if(r=parseFloat(r),s.ctx||h(),typeof r<"u"&&r>=0&&r<=1){if(s._volume=r,s._muted)return s;s.usingWebAudio&&s.masterGain.gain.setValueAtTime(r,e.ctx.currentTime);for(var u=0;u<s._howls.length;u++)if(!s._howls[u]._webAudio)for(var _=s._howls[u]._getSoundIds(),v=0;v<_.length;v++){var m=s._howls[u]._soundById(_[v]);m&&m._node&&(m._node.volume=m._volume*r)}return s}return s._volume},mute:function(r){var s=this||e;s.ctx||h(),s._muted=r,s.usingWebAudio&&s.masterGain.gain.setValueAtTime(r?0:s._volume,e.ctx.currentTime);for(var u=0;u<s._howls.length;u++)if(!s._howls[u]._webAudio)for(var _=s._howls[u]._getSoundIds(),v=0;v<_.length;v++){var m=s._howls[u]._soundById(_[v]);m&&m._node&&(m._node.muted=r?!0:m._muted)}return s},stop:function(){for(var r=this||e,s=0;s<r._howls.length;s++)r._howls[s].stop();return r},unload:function(){for(var r=this||e,s=r._howls.length-1;s>=0;s--)r._howls[s].unload();return r.usingWebAudio&&r.ctx&&typeof r.ctx.close<"u"&&(r.ctx.close(),r.ctx=null,h()),r},codecs:function(r){return(this||e)._codecs[r.replace(/^x-/,"")]},_setup:function(){var r=this||e;if(r.state=r.ctx&&r.ctx.state||"suspended",r._autoSuspend(),!r.usingWebAudio)if(typeof Audio<"u")try{var s=new Audio;typeof s.oncanplaythrough>"u"&&(r._canPlayEvent="canplay")}catch{r.noAudio=!0}else r.noAudio=!0;try{var s=new Audio;s.muted&&(r.noAudio=!0)}catch{}return r.noAudio||r._setupCodecs(),r},_setupCodecs:function(){var r=this||e,s=null;try{s=typeof Audio<"u"?new Audio:null}catch{return r}if(!s||typeof s.canPlayType!="function")return r;var u=s.canPlayType("audio/mpeg;").replace(/^no$/,""),_=r._navigator?r._navigator.userAgent:"",v=_.match(/OPR\/([0-6].)/g),m=v&&parseInt(v[0].split("/")[1],10)<33,p=_.indexOf("Safari")!==-1&&_.indexOf("Chrome")===-1,g=_.match(/Version\/(.*?) /),S=p&&g&&parseInt(g[1],10)<15;return r._codecs={mp3:!!(!m&&(u||s.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!u,opus:!!s.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!s.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!s.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(s.canPlayType('audio/wav; codecs="1"')||s.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!s.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!s.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(s.canPlayType("audio/x-m4a;")||s.canPlayType("audio/m4a;")||s.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(s.canPlayType("audio/x-m4b;")||s.canPlayType("audio/m4b;")||s.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(s.canPlayType("audio/x-mp4;")||s.canPlayType("audio/mp4;")||s.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!S&&s.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!S&&s.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!s.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(s.canPlayType("audio/x-flac;")||s.canPlayType("audio/flac;")).replace(/^no$/,"")},r},_unlockAudio:function(){var r=this||e;if(!(r._audioUnlocked||!r.ctx)){r._audioUnlocked=!1,r.autoUnlock=!1,!r._mobileUnloaded&&r.ctx.sampleRate!==44100&&(r._mobileUnloaded=!0,r.unload()),r._scratchBuffer=r.ctx.createBuffer(1,1,22050);var s=function(u){for(;r._html5AudioPool.length<r.html5PoolSize;)try{var _=new Audio;_._unlocked=!0,r._releaseHtml5Audio(_)}catch{r.noAudio=!0;break}for(var v=0;v<r._howls.length;v++)if(!r._howls[v]._webAudio)for(var m=r._howls[v]._getSoundIds(),p=0;p<m.length;p++){var g=r._howls[v]._soundById(m[p]);g&&g._node&&!g._node._unlocked&&(g._node._unlocked=!0,g._node.load())}r._autoResume();var S=r.ctx.createBufferSource();S.buffer=r._scratchBuffer,S.connect(r.ctx.destination),typeof S.start>"u"?S.noteOn(0):S.start(0),typeof r.ctx.resume=="function"&&r.ctx.resume(),S.onended=function(){S.disconnect(0),r._audioUnlocked=!0,document.removeEventListener("touchstart",s,!0),document.removeEventListener("touchend",s,!0),document.removeEventListener("click",s,!0),document.removeEventListener("keydown",s,!0);for(var M=0;M<r._howls.length;M++)r._howls[M]._emit("unlock")}};return document.addEventListener("touchstart",s,!0),document.addEventListener("touchend",s,!0),document.addEventListener("click",s,!0),document.addEventListener("keydown",s,!0),r}},_obtainHtml5Audio:function(){var r=this||e;if(r._html5AudioPool.length)return r._html5AudioPool.pop();var s=new Audio().play();return s&&typeof Promise<"u"&&(s instanceof Promise||typeof s.then=="function")&&s.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(r){var s=this||e;return r._unlocked&&s._html5AudioPool.push(r),s},_autoSuspend:function(){var r=this;if(!(!r.autoSuspend||!r.ctx||typeof r.ctx.suspend>"u"||!e.usingWebAudio)){for(var s=0;s<r._howls.length;s++)if(r._howls[s]._webAudio){for(var u=0;u<r._howls[s]._sounds.length;u++)if(!r._howls[s]._sounds[u]._paused)return r}return r._suspendTimer&&clearTimeout(r._suspendTimer),r._suspendTimer=setTimeout(function(){if(r.autoSuspend){r._suspendTimer=null,r.state="suspending";var _=function(){r.state="suspended",r._resumeAfterSuspend&&(delete r._resumeAfterSuspend,r._autoResume())};r.ctx.suspend().then(_,_)}},3e4),r}},_autoResume:function(){var r=this;if(!(!r.ctx||typeof r.ctx.resume>"u"||!e.usingWebAudio))return r.state==="running"&&r.ctx.state!=="interrupted"&&r._suspendTimer?(clearTimeout(r._suspendTimer),r._suspendTimer=null):r.state==="suspended"||r.state==="running"&&r.ctx.state==="interrupted"?(r.ctx.resume().then(function(){r.state="running";for(var s=0;s<r._howls.length;s++)r._howls[s]._emit("resume")}),r._suspendTimer&&(clearTimeout(r._suspendTimer),r._suspendTimer=null)):r.state==="suspending"&&(r._resumeAfterSuspend=!0),r}};var e=new t,i=function(r){var s=this;if(!r.src||r.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}s.init(r)};i.prototype={init:function(r){var s=this;return e.ctx||h(),s._autoplay=r.autoplay||!1,s._format=typeof r.format!="string"?r.format:[r.format],s._html5=r.html5||!1,s._muted=r.mute||!1,s._loop=r.loop||!1,s._pool=r.pool||5,s._preload=typeof r.preload=="boolean"||r.preload==="metadata"?r.preload:!0,s._rate=r.rate||1,s._sprite=r.sprite||{},s._src=typeof r.src!="string"?r.src:[r.src],s._volume=r.volume!==void 0?r.volume:1,s._xhr={method:r.xhr&&r.xhr.method?r.xhr.method:"GET",headers:r.xhr&&r.xhr.headers?r.xhr.headers:null,withCredentials:r.xhr&&r.xhr.withCredentials?r.xhr.withCredentials:!1},s._duration=0,s._state="unloaded",s._sounds=[],s._endTimers={},s._queue=[],s._playLock=!1,s._onend=r.onend?[{fn:r.onend}]:[],s._onfade=r.onfade?[{fn:r.onfade}]:[],s._onload=r.onload?[{fn:r.onload}]:[],s._onloaderror=r.onloaderror?[{fn:r.onloaderror}]:[],s._onplayerror=r.onplayerror?[{fn:r.onplayerror}]:[],s._onpause=r.onpause?[{fn:r.onpause}]:[],s._onplay=r.onplay?[{fn:r.onplay}]:[],s._onstop=r.onstop?[{fn:r.onstop}]:[],s._onmute=r.onmute?[{fn:r.onmute}]:[],s._onvolume=r.onvolume?[{fn:r.onvolume}]:[],s._onrate=r.onrate?[{fn:r.onrate}]:[],s._onseek=r.onseek?[{fn:r.onseek}]:[],s._onunlock=r.onunlock?[{fn:r.onunlock}]:[],s._onresume=[],s._webAudio=e.usingWebAudio&&!s._html5,typeof e.ctx<"u"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(s),s._autoplay&&s._queue.push({event:"play",action:function(){s.play()}}),s._preload&&s._preload!=="none"&&s.load(),s},load:function(){var r=this,s=null;if(e.noAudio){r._emit("loaderror",null,"No audio support.");return}typeof r._src=="string"&&(r._src=[r._src]);for(var u=0;u<r._src.length;u++){var _,v;if(r._format&&r._format[u])_=r._format[u];else{if(v=r._src[u],typeof v!="string"){r._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}_=/^data:audio\/([^;,]+);/i.exec(v),_||(_=/\.([^.]+)$/.exec(v.split("?",1)[0])),_&&(_=_[1].toLowerCase())}if(_||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),_&&e.codecs(_)){s=r._src[u];break}}if(!s){r._emit("loaderror",null,"No codec support for selected audio sources.");return}return r._src=s,r._state="loading",window.location.protocol==="https:"&&s.slice(0,5)==="http:"&&(r._html5=!0,r._webAudio=!1),new o(r),r._webAudio&&c(r),r},play:function(r,s){var u=this,_=null;if(typeof r=="number")_=r,r=null;else{if(typeof r=="string"&&u._state==="loaded"&&!u._sprite[r])return null;if(typeof r>"u"&&(r="__default",!u._playLock)){for(var v=0,m=0;m<u._sounds.length;m++)u._sounds[m]._paused&&!u._sounds[m]._ended&&(v++,_=u._sounds[m]._id);v===1?r=null:_=null}}var p=_?u._soundById(_):u._inactiveSound();if(!p)return null;if(_&&!r&&(r=p._sprite||"__default"),u._state!=="loaded"){p._sprite=r,p._ended=!1;var g=p._id;return u._queue.push({event:"play",action:function(){u.play(g)}}),g}if(_&&!p._paused)return s||u._loadQueue("play"),p._id;u._webAudio&&e._autoResume();var S=Math.max(0,p._seek>0?p._seek:u._sprite[r][0]/1e3),M=Math.max(0,(u._sprite[r][0]+u._sprite[r][1])/1e3-S),x=M*1e3/Math.abs(p._rate),E=u._sprite[r][0]/1e3,w=(u._sprite[r][0]+u._sprite[r][1])/1e3;p._sprite=r,p._ended=!1;var j=function(){p._paused=!1,p._seek=S,p._start=E,p._stop=w,p._loop=!!(p._loop||u._sprite[r][2])};if(S>=w){u._ended(p);return}var T=p._node;if(u._webAudio){var Q=function(){u._playLock=!1,j(),u._refreshBuffer(p);var F=p._muted||u._muted?0:p._volume;T.gain.setValueAtTime(F,e.ctx.currentTime),p._playStart=e.ctx.currentTime,typeof T.bufferSource.start>"u"?p._loop?T.bufferSource.noteGrainOn(0,S,86400):T.bufferSource.noteGrainOn(0,S,M):p._loop?T.bufferSource.start(0,S,86400):T.bufferSource.start(0,S,M),x!==1/0&&(u._endTimers[p._id]=setTimeout(u._ended.bind(u,p),x)),s||setTimeout(function(){u._emit("play",p._id),u._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?Q():(u._playLock=!0,u.once("resume",Q),u._clearTimer(p._id))}else{var ie=function(){T.currentTime=S,T.muted=p._muted||u._muted||e._muted||T.muted,T.volume=p._volume*e.volume(),T.playbackRate=p._rate;try{var F=T.play();if(F&&typeof Promise<"u"&&(F instanceof Promise||typeof F.then=="function")?(u._playLock=!0,j(),F.then(function(){u._playLock=!1,T._unlocked=!0,s?u._loadQueue():u._emit("play",p._id)}).catch(function(){u._playLock=!1,u._emit("playerror",p._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),p._ended=!0,p._paused=!0})):s||(u._playLock=!1,j(),u._emit("play",p._id)),T.playbackRate=p._rate,T.paused){u._emit("playerror",p._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}r!=="__default"||p._loop?u._endTimers[p._id]=setTimeout(u._ended.bind(u,p),x):(u._endTimers[p._id]=function(){u._ended(p),T.removeEventListener("ended",u._endTimers[p._id],!1)},T.addEventListener("ended",u._endTimers[p._id],!1))}catch(H){u._emit("playerror",p._id,H)}};T.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(T.src=u._src,T.load());var q=window&&window.ejecta||!T.readyState&&e._navigator.isCocoonJS;if(T.readyState>=3||q)ie();else{u._playLock=!0,u._state="loading";var k=function(){u._state="loaded",ie(),T.removeEventListener(e._canPlayEvent,k,!1)};T.addEventListener(e._canPlayEvent,k,!1),u._clearTimer(p._id)}}return p._id},pause:function(r){var s=this;if(s._state!=="loaded"||s._playLock)return s._queue.push({event:"pause",action:function(){s.pause(r)}}),s;for(var u=s._getSoundIds(r),_=0;_<u.length;_++){s._clearTimer(u[_]);var v=s._soundById(u[_]);if(v&&!v._paused&&(v._seek=s.seek(u[_]),v._rateSeek=0,v._paused=!0,s._stopFade(u[_]),v._node))if(s._webAudio){if(!v._node.bufferSource)continue;typeof v._node.bufferSource.stop>"u"?v._node.bufferSource.noteOff(0):v._node.bufferSource.stop(0),s._cleanBuffer(v._node)}else(!isNaN(v._node.duration)||v._node.duration===1/0)&&v._node.pause();arguments[1]||s._emit("pause",v?v._id:null)}return s},stop:function(r,s){var u=this;if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"stop",action:function(){u.stop(r)}}),u;for(var _=u._getSoundIds(r),v=0;v<_.length;v++){u._clearTimer(_[v]);var m=u._soundById(_[v]);m&&(m._seek=m._start||0,m._rateSeek=0,m._paused=!0,m._ended=!0,u._stopFade(_[v]),m._node&&(u._webAudio?m._node.bufferSource&&(typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),u._cleanBuffer(m._node)):(!isNaN(m._node.duration)||m._node.duration===1/0)&&(m._node.currentTime=m._start||0,m._node.pause(),m._node.duration===1/0&&u._clearSound(m._node))),s||u._emit("stop",m._id))}return u},mute:function(r,s){var u=this;if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"mute",action:function(){u.mute(r,s)}}),u;if(typeof s>"u")if(typeof r=="boolean")u._muted=r;else return u._muted;for(var _=u._getSoundIds(s),v=0;v<_.length;v++){var m=u._soundById(_[v]);m&&(m._muted=r,m._interval&&u._stopFade(m._id),u._webAudio&&m._node?m._node.gain.setValueAtTime(r?0:m._volume,e.ctx.currentTime):m._node&&(m._node.muted=e._muted?!0:r),u._emit("mute",m._id))}return u},volume:function(){var r=this,s=arguments,u,_;if(s.length===0)return r._volume;if(s.length===1||s.length===2&&typeof s[1]>"u"){var v=r._getSoundIds(),m=v.indexOf(s[0]);m>=0?_=parseInt(s[0],10):u=parseFloat(s[0])}else s.length>=2&&(u=parseFloat(s[0]),_=parseInt(s[1],10));var p;if(typeof u<"u"&&u>=0&&u<=1){if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,s)}}),r;typeof _>"u"&&(r._volume=u),_=r._getSoundIds(_);for(var g=0;g<_.length;g++)p=r._soundById(_[g]),p&&(p._volume=u,s[2]||r._stopFade(_[g]),r._webAudio&&p._node&&!p._muted?p._node.gain.setValueAtTime(u,e.ctx.currentTime):p._node&&!p._muted&&(p._node.volume=u*e.volume()),r._emit("volume",p._id))}else return p=_?r._soundById(_):r._sounds[0],p?p._volume:0;return r},fade:function(r,s,u,_){var v=this;if(v._state!=="loaded"||v._playLock)return v._queue.push({event:"fade",action:function(){v.fade(r,s,u,_)}}),v;r=Math.min(Math.max(0,parseFloat(r)),1),s=Math.min(Math.max(0,parseFloat(s)),1),u=parseFloat(u),v.volume(r,_);for(var m=v._getSoundIds(_),p=0;p<m.length;p++){var g=v._soundById(m[p]);if(g){if(_||v._stopFade(m[p]),v._webAudio&&!g._muted){var S=e.ctx.currentTime,M=S+u/1e3;g._volume=r,g._node.gain.setValueAtTime(r,S),g._node.gain.linearRampToValueAtTime(s,M)}v._startFadeInterval(g,r,s,u,m[p],typeof _>"u")}}return v},_startFadeInterval:function(r,s,u,_,v,m){var p=this,g=s,S=u-s,M=Math.abs(S/.01),x=Math.max(4,M>0?_/M:_),E=Date.now();r._fadeTo=u,r._interval=setInterval(function(){var w=(Date.now()-E)/_;E=Date.now(),g+=S*w,g=Math.round(g*100)/100,S<0?g=Math.max(u,g):g=Math.min(u,g),p._webAudio?r._volume=g:p.volume(g,r._id,!0),m&&(p._volume=g),(u<s&&g<=u||u>s&&g>=u)&&(clearInterval(r._interval),r._interval=null,r._fadeTo=null,p.volume(u,r._id),p._emit("fade",r._id))},x)},_stopFade:function(r){var s=this,u=s._soundById(r);return u&&u._interval&&(s._webAudio&&u._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(u._interval),u._interval=null,s.volume(u._fadeTo,r),u._fadeTo=null,s._emit("fade",r)),s},loop:function(){var r=this,s=arguments,u,_,v;if(s.length===0)return r._loop;if(s.length===1)if(typeof s[0]=="boolean")u=s[0],r._loop=u;else return v=r._soundById(parseInt(s[0],10)),v?v._loop:!1;else s.length===2&&(u=s[0],_=parseInt(s[1],10));for(var m=r._getSoundIds(_),p=0;p<m.length;p++)v=r._soundById(m[p]),v&&(v._loop=u,r._webAudio&&v._node&&v._node.bufferSource&&(v._node.bufferSource.loop=u,u&&(v._node.bufferSource.loopStart=v._start||0,v._node.bufferSource.loopEnd=v._stop,r.playing(m[p])&&(r.pause(m[p],!0),r.play(m[p],!0)))));return r},rate:function(){var r=this,s=arguments,u,_;if(s.length===0)_=r._sounds[0]._id;else if(s.length===1){var v=r._getSoundIds(),m=v.indexOf(s[0]);m>=0?_=parseInt(s[0],10):u=parseFloat(s[0])}else s.length===2&&(u=parseFloat(s[0]),_=parseInt(s[1],10));var p;if(typeof u=="number"){if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,s)}}),r;typeof _>"u"&&(r._rate=u),_=r._getSoundIds(_);for(var g=0;g<_.length;g++)if(p=r._soundById(_[g]),p){r.playing(_[g])&&(p._rateSeek=r.seek(_[g]),p._playStart=r._webAudio?e.ctx.currentTime:p._playStart),p._rate=u,r._webAudio&&p._node&&p._node.bufferSource?p._node.bufferSource.playbackRate.setValueAtTime(u,e.ctx.currentTime):p._node&&(p._node.playbackRate=u);var S=r.seek(_[g]),M=(r._sprite[p._sprite][0]+r._sprite[p._sprite][1])/1e3-S,x=M*1e3/Math.abs(p._rate);(r._endTimers[_[g]]||!p._paused)&&(r._clearTimer(_[g]),r._endTimers[_[g]]=setTimeout(r._ended.bind(r,p),x)),r._emit("rate",p._id)}}else return p=r._soundById(_),p?p._rate:r._rate;return r},seek:function(){var r=this,s=arguments,u,_;if(s.length===0)r._sounds.length&&(_=r._sounds[0]._id);else if(s.length===1){var v=r._getSoundIds(),m=v.indexOf(s[0]);m>=0?_=parseInt(s[0],10):r._sounds.length&&(_=r._sounds[0]._id,u=parseFloat(s[0]))}else s.length===2&&(u=parseFloat(s[0]),_=parseInt(s[1],10));if(typeof _>"u")return 0;if(typeof u=="number"&&(r._state!=="loaded"||r._playLock))return r._queue.push({event:"seek",action:function(){r.seek.apply(r,s)}}),r;var p=r._soundById(_);if(p)if(typeof u=="number"&&u>=0){var g=r.playing(_);g&&r.pause(_,!0),p._seek=u,p._ended=!1,r._clearTimer(_),!r._webAudio&&p._node&&!isNaN(p._node.duration)&&(p._node.currentTime=u);var S=function(){g&&r.play(_,!0),r._emit("seek",_)};if(g&&!r._webAudio){var M=function(){r._playLock?setTimeout(M,0):S()};setTimeout(M,0)}else S()}else if(r._webAudio){var x=r.playing(_)?e.ctx.currentTime-p._playStart:0,E=p._rateSeek?p._rateSeek-p._seek:0;return p._seek+(E+x*Math.abs(p._rate))}else return p._node.currentTime;return r},playing:function(r){var s=this;if(typeof r=="number"){var u=s._soundById(r);return u?!u._paused:!1}for(var _=0;_<s._sounds.length;_++)if(!s._sounds[_]._paused)return!0;return!1},duration:function(r){var s=this,u=s._duration,_=s._soundById(r);return _&&(u=s._sprite[_._sprite][1]/1e3),u},state:function(){return this._state},unload:function(){for(var r=this,s=r._sounds,u=0;u<s.length;u++)s[u]._paused||r.stop(s[u]._id),r._webAudio||(r._clearSound(s[u]._node),s[u]._node.removeEventListener("error",s[u]._errorFn,!1),s[u]._node.removeEventListener(e._canPlayEvent,s[u]._loadFn,!1),s[u]._node.removeEventListener("ended",s[u]._endFn,!1),e._releaseHtml5Audio(s[u]._node)),delete s[u]._node,r._clearTimer(s[u]._id);var _=e._howls.indexOf(r);_>=0&&e._howls.splice(_,1);var v=!0;for(u=0;u<e._howls.length;u++)if(e._howls[u]._src===r._src||r._src.indexOf(e._howls[u]._src)>=0){v=!1;break}return a&&v&&delete a[r._src],e.noAudio=!1,r._state="unloaded",r._sounds=[],r=null,null},on:function(r,s,u,_){var v=this,m=v["_on"+r];return typeof s=="function"&&m.push(_?{id:u,fn:s,once:_}:{id:u,fn:s}),v},off:function(r,s,u){var _=this,v=_["_on"+r],m=0;if(typeof s=="number"&&(u=s,s=null),s||u)for(m=0;m<v.length;m++){var p=u===v[m].id;if(s===v[m].fn&&p||!s&&p){v.splice(m,1);break}}else if(r)_["_on"+r]=[];else{var g=Object.keys(_);for(m=0;m<g.length;m++)g[m].indexOf("_on")===0&&Array.isArray(_[g[m]])&&(_[g[m]]=[])}return _},once:function(r,s,u){var _=this;return _.on(r,s,u,1),_},_emit:function(r,s,u){for(var _=this,v=_["_on"+r],m=v.length-1;m>=0;m--)(!v[m].id||v[m].id===s||r==="load")&&(setTimeout((function(p){p.call(this,s,u)}).bind(_,v[m].fn),0),v[m].once&&_.off(r,v[m].fn,v[m].id));return _._loadQueue(r),_},_loadQueue:function(r){var s=this;if(s._queue.length>0){var u=s._queue[0];u.event===r&&(s._queue.shift(),s._loadQueue()),r||u.action()}return s},_ended:function(r){var s=this,u=r._sprite;if(!s._webAudio&&r._node&&!r._node.paused&&!r._node.ended&&r._node.currentTime<r._stop)return setTimeout(s._ended.bind(s,r),100),s;var _=!!(r._loop||s._sprite[u][2]);if(s._emit("end",r._id),!s._webAudio&&_&&s.stop(r._id,!0).play(r._id),s._webAudio&&_){s._emit("play",r._id),r._seek=r._start||0,r._rateSeek=0,r._playStart=e.ctx.currentTime;var v=(r._stop-r._start)*1e3/Math.abs(r._rate);s._endTimers[r._id]=setTimeout(s._ended.bind(s,r),v)}return s._webAudio&&!_&&(r._paused=!0,r._ended=!0,r._seek=r._start||0,r._rateSeek=0,s._clearTimer(r._id),s._cleanBuffer(r._node),e._autoSuspend()),!s._webAudio&&!_&&s.stop(r._id,!0),s},_clearTimer:function(r){var s=this;if(s._endTimers[r]){if(typeof s._endTimers[r]!="function")clearTimeout(s._endTimers[r]);else{var u=s._soundById(r);u&&u._node&&u._node.removeEventListener("ended",s._endTimers[r],!1)}delete s._endTimers[r]}return s},_soundById:function(r){for(var s=this,u=0;u<s._sounds.length;u++)if(r===s._sounds[u]._id)return s._sounds[u];return null},_inactiveSound:function(){var r=this;r._drain();for(var s=0;s<r._sounds.length;s++)if(r._sounds[s]._ended)return r._sounds[s].reset();return new o(r)},_drain:function(){var r=this,s=r._pool,u=0,_=0;if(!(r._sounds.length<s)){for(_=0;_<r._sounds.length;_++)r._sounds[_]._ended&&u++;for(_=r._sounds.length-1;_>=0;_--){if(u<=s)return;r._sounds[_]._ended&&(r._webAudio&&r._sounds[_]._node&&r._sounds[_]._node.disconnect(0),r._sounds.splice(_,1),u--)}}},_getSoundIds:function(r){var s=this;if(typeof r>"u"){for(var u=[],_=0;_<s._sounds.length;_++)u.push(s._sounds[_]._id);return u}else return[r]},_refreshBuffer:function(r){var s=this;return r._node.bufferSource=e.ctx.createBufferSource(),r._node.bufferSource.buffer=a[s._src],r._panner?r._node.bufferSource.connect(r._panner):r._node.bufferSource.connect(r._node),r._node.bufferSource.loop=r._loop,r._loop&&(r._node.bufferSource.loopStart=r._start||0,r._node.bufferSource.loopEnd=r._stop||0),r._node.bufferSource.playbackRate.setValueAtTime(r._rate,e.ctx.currentTime),s},_cleanBuffer:function(r){var s=this,u=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(e._scratchBuffer&&r.bufferSource&&(r.bufferSource.onended=null,r.bufferSource.disconnect(0),u))try{r.bufferSource.buffer=e._scratchBuffer}catch{}return r.bufferSource=null,s},_clearSound:function(r){var s=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);s||(r.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var o=function(r){this._parent=r,this.init()};o.prototype={init:function(){var r=this,s=r._parent;return r._muted=s._muted,r._loop=s._loop,r._volume=s._volume,r._rate=s._rate,r._seek=0,r._paused=!0,r._ended=!0,r._sprite="__default",r._id=++e._counter,s._sounds.push(r),r.create(),r},create:function(){var r=this,s=r._parent,u=e._muted||r._muted||r._parent._muted?0:r._volume;return s._webAudio?(r._node=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),r._node.gain.setValueAtTime(u,e.ctx.currentTime),r._node.paused=!0,r._node.connect(e.masterGain)):e.noAudio||(r._node=e._obtainHtml5Audio(),r._errorFn=r._errorListener.bind(r),r._node.addEventListener("error",r._errorFn,!1),r._loadFn=r._loadListener.bind(r),r._node.addEventListener(e._canPlayEvent,r._loadFn,!1),r._endFn=r._endListener.bind(r),r._node.addEventListener("ended",r._endFn,!1),r._node.src=s._src,r._node.preload=s._preload===!0?"auto":s._preload,r._node.volume=u*e.volume(),r._node.load()),r},reset:function(){var r=this,s=r._parent;return r._muted=s._muted,r._loop=s._loop,r._volume=s._volume,r._rate=s._rate,r._seek=0,r._rateSeek=0,r._paused=!0,r._ended=!0,r._sprite="__default",r._id=++e._counter,r},_errorListener:function(){var r=this;r._parent._emit("loaderror",r._id,r._node.error?r._node.error.code:0),r._node.removeEventListener("error",r._errorFn,!1)},_loadListener:function(){var r=this,s=r._parent;s._duration=Math.ceil(r._node.duration*10)/10,Object.keys(s._sprite).length===0&&(s._sprite={__default:[0,s._duration*1e3]}),s._state!=="loaded"&&(s._state="loaded",s._emit("load"),s._loadQueue()),r._node.removeEventListener(e._canPlayEvent,r._loadFn,!1)},_endListener:function(){var r=this,s=r._parent;s._duration===1/0&&(s._duration=Math.ceil(r._node.duration*10)/10,s._sprite.__default[1]===1/0&&(s._sprite.__default[1]=s._duration*1e3),s._ended(r)),r._node.removeEventListener("ended",r._endFn,!1)}};var a={},c=function(r){var s=r._src;if(a[s]){r._duration=a[s].duration,f(r);return}if(/^data:[^;]+;base64,/.test(s)){for(var u=atob(s.split(",")[1]),_=new Uint8Array(u.length),v=0;v<u.length;++v)_[v]=u.charCodeAt(v);l(_.buffer,r)}else{var m=new XMLHttpRequest;m.open(r._xhr.method,s,!0),m.withCredentials=r._xhr.withCredentials,m.responseType="arraybuffer",r._xhr.headers&&Object.keys(r._xhr.headers).forEach(function(p){m.setRequestHeader(p,r._xhr.headers[p])}),m.onload=function(){var p=(m.status+"")[0];if(p!=="0"&&p!=="2"&&p!=="3"){r._emit("loaderror",null,"Failed loading audio file with status: "+m.status+".");return}l(m.response,r)},m.onerror=function(){r._webAudio&&(r._html5=!0,r._webAudio=!1,r._sounds=[],delete a[s],r.load())},d(m)}},d=function(r){try{r.send()}catch{r.onerror()}},l=function(r,s){var u=function(){s._emit("loaderror",null,"Decoding audio data failed.")},_=function(v){v&&s._sounds.length>0?(a[s._src]=v,f(s,v)):u()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(r).then(_).catch(u):e.ctx.decodeAudioData(r,_,u)},f=function(r,s){s&&!r._duration&&(r._duration=s.duration),Object.keys(r._sprite).length===0&&(r._sprite={__default:[0,r._duration*1e3]}),r._state!=="loaded"&&(r._state="loaded",r._emit("load"),r._loadQueue())},h=function(){if(e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var r=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),s=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),u=s?parseInt(s[1],10):null;if(r&&u&&u<9){var _=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!_&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};n.Howler=e,n.Howl=i,typeof J<"u"?(J.HowlerGlobal=t,J.Howler=e,J.Howl=i,J.Sound=o):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=i,window.Sound=o)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var o=i._howls.length-1;o>=0;o--)i._howls[o].stereo(e);return i},HowlerGlobal.prototype.pos=function(e,i,o){var a=this;if(!a.ctx||!a.ctx.listener)return a;if(i=typeof i!="number"?a._pos[1]:i,o=typeof o!="number"?a._pos[2]:o,typeof e=="number")a._pos=[e,i,o],typeof a.ctx.listener.positionX<"u"?(a.ctx.listener.positionX.setTargetAtTime(a._pos[0],Howler.ctx.currentTime,.1),a.ctx.listener.positionY.setTargetAtTime(a._pos[1],Howler.ctx.currentTime,.1),a.ctx.listener.positionZ.setTargetAtTime(a._pos[2],Howler.ctx.currentTime,.1)):a.ctx.listener.setPosition(a._pos[0],a._pos[1],a._pos[2]);else return a._pos;return a},HowlerGlobal.prototype.orientation=function(e,i,o,a,c,d){var l=this;if(!l.ctx||!l.ctx.listener)return l;var f=l._orientation;if(i=typeof i!="number"?f[1]:i,o=typeof o!="number"?f[2]:o,a=typeof a!="number"?f[3]:a,c=typeof c!="number"?f[4]:c,d=typeof d!="number"?f[5]:d,typeof e=="number")l._orientation=[e,i,o,a,c,d],typeof l.ctx.listener.forwardX<"u"?(l.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),l.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),l.ctx.listener.forwardZ.setTargetAtTime(o,Howler.ctx.currentTime,.1),l.ctx.listener.upX.setTargetAtTime(a,Howler.ctx.currentTime,.1),l.ctx.listener.upY.setTargetAtTime(c,Howler.ctx.currentTime,.1),l.ctx.listener.upZ.setTargetAtTime(d,Howler.ctx.currentTime,.1)):l.ctx.listener.setOrientation(e,i,o,a,c,d);else return f;return l},Howl.prototype.init=function(e){return function(i){var o=this;return o._orientation=i.orientation||[1,0,0],o._stereo=i.stereo||null,o._pos=i.pos||null,o._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance<"u"?i.maxDistance:1e4,panningModel:typeof i.panningModel<"u"?i.panningModel:"HRTF",refDistance:typeof i.refDistance<"u"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:1},o._onstereo=i.onstereo?[{fn:i.onstereo}]:[],o._onpos=i.onpos?[{fn:i.onpos}]:[],o._onorientation=i.onorientation?[{fn:i.onorientation}]:[],e.call(this,i)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,i){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"stereo",action:function(){o.stereo(e,i)}}),o;var a=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof i>"u")if(typeof e=="number")o._stereo=e,o._pos=[e,0,0];else return o._stereo;for(var c=o._getSoundIds(i),d=0;d<c.length;d++){var l=o._soundById(c[d]);if(l)if(typeof e=="number")l._stereo=e,l._pos=[e,0,0],l._node&&(l._pannerAttr.panningModel="equalpower",(!l._panner||!l._panner.pan)&&t(l,a),a==="spatial"?typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):l._panner.setPosition(e,0,0):l._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),o._emit("stereo",l._id);else return l._stereo}return o},Howl.prototype.pos=function(e,i,o,a){var c=this;if(!c._webAudio)return c;if(c._state!=="loaded")return c._queue.push({event:"pos",action:function(){c.pos(e,i,o,a)}}),c;if(i=typeof i!="number"?0:i,o=typeof o!="number"?-.5:o,typeof a>"u")if(typeof e=="number")c._pos=[e,i,o];else return c._pos;for(var d=c._getSoundIds(a),l=0;l<d.length;l++){var f=c._soundById(d[l]);if(f)if(typeof e=="number")f._pos=[e,i,o],f._node&&((!f._panner||f._panner.pan)&&t(f,"spatial"),typeof f._panner.positionX<"u"?(f._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),f._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),f._panner.positionZ.setValueAtTime(o,Howler.ctx.currentTime)):f._panner.setPosition(e,i,o)),c._emit("pos",f._id);else return f._pos}return c},Howl.prototype.orientation=function(e,i,o,a){var c=this;if(!c._webAudio)return c;if(c._state!=="loaded")return c._queue.push({event:"orientation",action:function(){c.orientation(e,i,o,a)}}),c;if(i=typeof i!="number"?c._orientation[1]:i,o=typeof o!="number"?c._orientation[2]:o,typeof a>"u")if(typeof e=="number")c._orientation=[e,i,o];else return c._orientation;for(var d=c._getSoundIds(a),l=0;l<d.length;l++){var f=c._soundById(d[l]);if(f)if(typeof e=="number")f._orientation=[e,i,o],f._node&&(f._panner||(f._pos||(f._pos=c._pos||[0,0,-.5]),t(f,"spatial")),typeof f._panner.orientationX<"u"?(f._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),f._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),f._panner.orientationZ.setValueAtTime(o,Howler.ctx.currentTime)):f._panner.setOrientation(e,i,o)),c._emit("orientation",f._id);else return f._orientation}return c},Howl.prototype.pannerAttr=function(){var e=this,i=arguments,o,a,c;if(!e._webAudio)return e;if(i.length===0)return e._pannerAttr;if(i.length===1)if(typeof i[0]=="object")o=i[0],typeof a>"u"&&(o.pannerAttr||(o.pannerAttr={coneInnerAngle:o.coneInnerAngle,coneOuterAngle:o.coneOuterAngle,coneOuterGain:o.coneOuterGain,distanceModel:o.distanceModel,maxDistance:o.maxDistance,refDistance:o.refDistance,rolloffFactor:o.rolloffFactor,panningModel:o.panningModel}),e._pannerAttr={coneInnerAngle:typeof o.pannerAttr.coneInnerAngle<"u"?o.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof o.pannerAttr.coneOuterAngle<"u"?o.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof o.pannerAttr.coneOuterGain<"u"?o.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof o.pannerAttr.distanceModel<"u"?o.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof o.pannerAttr.maxDistance<"u"?o.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof o.pannerAttr.refDistance<"u"?o.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof o.pannerAttr.rolloffFactor<"u"?o.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof o.pannerAttr.panningModel<"u"?o.pannerAttr.panningModel:e._panningModel});else return c=e._soundById(parseInt(i[0],10)),c?c._pannerAttr:e._pannerAttr;else i.length===2&&(o=i[0],a=parseInt(i[1],10));for(var d=e._getSoundIds(a),l=0;l<d.length;l++)if(c=e._soundById(d[l]),c){var f=c._pannerAttr;f={coneInnerAngle:typeof o.coneInnerAngle<"u"?o.coneInnerAngle:f.coneInnerAngle,coneOuterAngle:typeof o.coneOuterAngle<"u"?o.coneOuterAngle:f.coneOuterAngle,coneOuterGain:typeof o.coneOuterGain<"u"?o.coneOuterGain:f.coneOuterGain,distanceModel:typeof o.distanceModel<"u"?o.distanceModel:f.distanceModel,maxDistance:typeof o.maxDistance<"u"?o.maxDistance:f.maxDistance,refDistance:typeof o.refDistance<"u"?o.refDistance:f.refDistance,rolloffFactor:typeof o.rolloffFactor<"u"?o.rolloffFactor:f.rolloffFactor,panningModel:typeof o.panningModel<"u"?o.panningModel:f.panningModel};var h=c._panner;h?(h.coneInnerAngle=f.coneInnerAngle,h.coneOuterAngle=f.coneOuterAngle,h.coneOuterGain=f.coneOuterGain,h.distanceModel=f.distanceModel,h.maxDistance=f.maxDistance,h.refDistance=f.refDistance,h.rolloffFactor=f.rolloffFactor,h.panningModel=f.panningModel):(c._pos||(c._pos=e._pos||[0,0,-.5]),t(c,"spatial"))}return e},Sound.prototype.init=function(e){return function(){var i=this,o=i._parent;i._orientation=o._orientation,i._stereo=o._stereo,i._pos=o._pos,i._pannerAttr=o._pannerAttr,e.call(this),i._stereo?o.stereo(i._stereo):i._pos&&o.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var i=this,o=i._parent;return i._orientation=o._orientation,i._stereo=o._stereo,i._pos=o._pos,i._pannerAttr=o._pannerAttr,i._stereo?o.stereo(i._stereo):i._pos?o.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,o._refreshBuffer(i)),e.call(this)}}(Sound.prototype.reset);var t=function(e,i){i=i||"spatial",i==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(yn);let Ne;const Vt={capture:[0,204],move:[704,316],select:[1519,153],silence:[2172,500]},li=()=>{if(!Ne){const n=Object.values(Vt).map(t=>window.btoa(`${t[0]}:${t[1]}`)).join("-");Ne??(Ne=new yn.Howl({src:[`/audio/sprite.mp3?v=${n}`],sprite:Vt}))}return Ne},fi=n=>{li().play(n)};function di(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}var ut=di,_i=typeof J=="object"&&J&&J.Object===Object&&J,pi=_i,hi=pi,mi=typeof self=="object"&&self&&self.Object===Object&&self,vi=hi||mi||Function("return this")(),bn=vi,gi=bn,yi=function(){return gi.Date.now()},bi=yi,wi=/\s/;function Ti(n){for(var t=n.length;t--&&wi.test(n.charAt(t)););return t}var Si=Ti,Ai=Si,ki=/^\s+/;function Ii(n){return n&&n.slice(0,Ai(n)+1).replace(ki,"")}var Ei=Ii,xi=bn,Oi=xi.Symbol,wn=Oi,Rt=wn,Tn=Object.prototype,Mi=Tn.hasOwnProperty,$i=Tn.toString,be=Rt?Rt.toStringTag:void 0;function Pi(n){var t=Mi.call(n,be),e=n[be];try{n[be]=void 0;var i=!0}catch{}var o=$i.call(n);return i&&(t?n[be]=e:delete n[be]),o}var ji=Pi,Li=Object.prototype,Di=Li.toString;function Fi(n){return Di.call(n)}var Hi=Fi,qt=wn,Gi=ji,Vi=Hi,Ri="[object Null]",qi="[object Undefined]",Bt=qt?qt.toStringTag:void 0;function Bi(n){return n==null?n===void 0?qi:Ri:Bt&&Bt in Object(n)?Gi(n):Vi(n)}var Wi=Bi;function Ni(n){return n!=null&&typeof n=="object"}var Xi=Ni,Qi=Wi,Ui=Xi,Ji="[object Symbol]";function Yi(n){return typeof n=="symbol"||Ui(n)&&Qi(n)==Ji}var Zi=Yi,Ki=Ei,Wt=ut,Ci=Zi,Nt=0/0,zi=/^[-+]0x[0-9a-f]+$/i,eo=/^0b[01]+$/i,to=/^0o[0-7]+$/i,no=parseInt;function ro(n){if(typeof n=="number")return n;if(Ci(n))return Nt;if(Wt(n)){var t=typeof n.valueOf=="function"?n.valueOf():n;n=Wt(t)?t+"":t}if(typeof n!="string")return n===0?n:+n;n=Ki(n);var e=eo.test(n);return e||to.test(n)?no(n.slice(2),e?2:8):zi.test(n)?Nt:+n}var io=ro,oo=ut,Xe=bi,Xt=io,so="Expected a function",ao=Math.max,co=Math.min;function uo(n,t,e){var i,o,a,c,d,l,f=0,h=!1,r=!1,s=!0;if(typeof n!="function")throw new TypeError(so);t=Xt(t)||0,oo(e)&&(h=!!e.leading,r="maxWait"in e,a=r?ao(Xt(e.maxWait)||0,t):a,s="trailing"in e?!!e.trailing:s);function u(E){var w=i,j=o;return i=o=void 0,f=E,c=n.apply(j,w),c}function _(E){return f=E,d=setTimeout(p,t),h?u(E):c}function v(E){var w=E-l,j=E-f,T=t-w;return r?co(T,a-j):T}function m(E){var w=E-l,j=E-f;return l===void 0||w>=t||w<0||r&&j>=a}function p(){var E=Xe();if(m(E))return g(E);d=setTimeout(p,v(E))}function g(E){return d=void 0,s&&i?u(E):(i=o=void 0,c)}function S(){d!==void 0&&clearTimeout(d),f=0,i=l=o=d=void 0}function M(){return d===void 0?c:g(Xe())}function x(){var E=Xe(),w=m(E);if(i=arguments,o=this,l=E,w){if(d===void 0)return _(l);if(r)return clearTimeout(d),d=setTimeout(p,t),u(l)}return d===void 0&&(d=setTimeout(p,t)),c}return x.cancel=S,x.flush=M,x}var lo=uo,fo=lo,_o=ut,po="Expected a function";function ho(n,t,e){var i=!0,o=!0;if(typeof n!="function")throw new TypeError(po);return _o(e)&&(i="leading"in e?!!e.leading:i,o="trailing"in e?!!e.trailing:o),fo(n,t,{leading:i,maxWait:t,trailing:o})}var mo=ho;const vo=ui(mo);function go(n){let t,e,i={slot:"actions"};return t=new Jr({props:i}),n[8](t),{c(){Se(t.$$.fragment)},l(o){Ae(t.$$.fragment,o)},m(o,a){ke(t,o,a),e=!0},p(o,a){const c={};t.$set(c)},i(o){e||(X(t.$$.fragment,o),e=!0)},o(o){N(t.$$.fragment,o),e=!1},d(o){n[8](null),Ie(t,o)}}}function yo(n){let t,e;return t=new Br({props:{slot:"cursor-overlays",mousePositions:n[0]}}),{c(){Se(t.$$.fragment)},l(i){Ae(t.$$.fragment,i)},m(i,o){ke(t,i,o),e=!0},p(i,o){const a={};o&1&&(a.mousePositions=i[0]),t.$set(a)},i(i){e||(X(t.$$.fragment,i),e=!0)},o(i){N(t.$$.fragment,i),e=!1},d(i){Ie(t,i)}}}function bo(n){let t,e,i,o,a=n[2].log.join(`
`)+"",c,d,l=JSON.stringify(n[3],null,2)+"",f,h,r;return t=new ci({props:{reportMousePosition:n[6],$$slots:{"cursor-overlays":[yo],actions:[go]},$$scope:{ctx:n}}}),{c(){Se(t.$$.fragment),e=V(),i=$("pre"),o=B(""),c=B(a),d=B(`

`),f=B(l),h=B(`
`)},l(s){Ae(t.$$.fragment,s),e=R(s),i=P(s,"PRE",{});var u=D(i);o=W(u,""),c=W(u,a),d=W(u,`

`),f=W(u,l),h=W(u,`
`),u.forEach(A)},m(s,u){ke(t,s,u),L(s,e,u),L(s,i,u),I(i,o),I(i,c),I(i,d),I(i,f),I(i,h),r=!0},p(s,[u]){const _={};u&16387&&(_.$$scope={dirty:u,ctx:s}),t.$set(_),(!r||u&4)&&a!==(a=s[2].log.join(`
`)+"")&&ue(c,a),(!r||u&8)&&l!==(l=JSON.stringify(s[3],null,2)+"")&&ue(f,l)},i(s){r||(X(t.$$.fragment,s),r=!0)},o(s){N(t.$$.fragment,s),r=!1},d(s){s&&(A(e),A(i)),Ie(t,s)}}}function wo(n,t,e){let i,o,{data:a}=t;const c=a.machineInput,d=c.gameId,l=c.userId,f=c.hostUserId,h={},r=Lr({gameId:d,userId:l,onMessage:p=>{p.type==="mouse position"?e(0,h[p.userId]=p.position,h):s.send(p)}});z(n,r,p=>e(2,i=p));const s=Mr(jr({send:r.send,actions:{playSound:fi,showEmoji:({userId:p,emoji:g})=>_==null?void 0:_.showEmoji({userId:p,emoji:g})}}),{input:c});$r({gameId:d,userId:l,hostUserId:f,machine:s});const u=s.state;z(n,u,p=>e(3,o=p)),Ut(()=>(r.open(),()=>{r.close()}));let _;const v=vo(p=>{r.send({type:"mouse position",position:p})},50,{leading:!0,trailing:!0});function m(p){ze[p?"unshift":"push"](()=>{_=p,e(1,_)})}return n.$$set=p=>{"data"in p&&e(7,a=p.data)},[h,_,i,o,r,u,v,a,m]}class Io extends me{constructor(t){super(),ve(this,t,wo,bo,he,{data:7})}}export{Io as component,ko as universal};
