import{r as gn,E as Un,H as Qn,I as Jn,s as te,n as ne,o as vn,l as ct,m as ut,c as J,p as Yn,J as Cn,d as Se,h as Zn,u as Te,g as ke,e as Ae}from"../chunks/scheduler.3df9b730.js";import{q as $,p as T,S as ie,i as se,e as R,F as wt,s as V,t as H,c as x,a as F,G as St,d as b,f as B,b as G,n as j,g as A,h as O,j as re,H as yn,B as K,z as ee,v as le,l as W,m as N,o as X,r as U,I as De,A as He,y as $e,J as zn,K as Kn,x as be,w as Tt,k as Qe,E as nt,L as kt}from"../chunks/index.06da1297.js";import{r as bn,w as er}from"../chunks/index.9b15924c.js";import{g as tr,B as Le}from"../chunks/Button.b63fec9a.js";function z(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function wn(n,t){$(n,1,1,()=>{t.delete(n.key)})}function Sn(n,t,e,r,s,a,l,f,u,d,m,i){let o=n.length,c=a.length,_=o;const h={};for(;_--;)h[n[_].key]=_;const v=[],p=new Map,g=new Map,y=[];for(_=c;_--;){const k=i(s,a,_),D=e(k);let E=l.get(D);E?r&&y.push(()=>E.p(k,t)):(E=d(D,k),E.c()),p.set(D,v[_]=E),D in h&&g.set(D,Math.abs(_-h[D]))}const w=new Set,S=new Set;function P(k){T(k,1),k.m(f,m),l.set(k.key,k),m=k.first,c--}for(;o&&c;){const k=v[c-1],D=n[o-1],E=k.key,oe=D.key;k===D?(m=k.first,o--,c--):p.has(oe)?!l.has(E)||w.has(E)?P(k):S.has(oe)?o--:g.get(E)>g.get(oe)?(S.add(E),P(k)):(w.add(oe),o--):(u(D,l),o--)}for(;o--;){const k=n[o];p.has(k.key)||u(k,l)}for(;c;)P(v[c-1]);return gn(y),v}const nr=!1,Po=Object.freeze(Object.defineProperty({__proto__:null,ssr:nr},Symbol.toStringTag,{value:"Module"}));function rr(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function ir(){const n=rr();if(n.__xstate__)return n.__xstate__}const sr=n=>{if(typeof window>"u")return;const t=ir();t&&t.register(n)};let fe=function(n){return n.After="xstate.after",n.DoneState="done.state",n.DoneInvoke="done.invoke",n.ErrorExecution="error.execution",n.ErrorCommunication="error.communication",n.ErrorPlatform="error.platform",n.ErrorCustom="xstate.error",n}({});fe.After;fe.DoneState;const or=fe.ErrorExecution,ar=fe.ErrorPlatform;fe.ErrorCustom;const Me=".",lr="",Tn="",cr="#",ur="*",kn="xstate.init",At=new WeakMap;function _e(n,t,e){let r=At.get(n);return r?t in r||(r[t]=e()):(r={[t]:e()},At.set(n,r)),r[t]}function fr(n,t,e,{sendId:r}){const s=typeof r=="function"?r(e):r;return[t,s]}function dr(n,t){n.self.cancel(t)}function _r(n){function t(e){}return t.type="xstate.cancel",t.sendId=n,t.resolve=fr,t.execute=dr,t}class $t{constructor(t){this._process=t,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}prepend(t){if(!this._current){this.enqueue(t);return}this._current={value:t,next:this._current}}enqueue(t){const e={value:t,next:null};if(this._current){this._last.next=e,this._last=e;return}this._current=e,this._last=e,this._active&&this.flush()}flush(){for(;this._current;){const t=this._current;this._process(t.value),t===this._current&&(this._current=this._current.next)}this._last=null}}const pr=(()=>typeof Symbol=="function"&&Symbol.observable||"@@observable")();function An(n,t){const e=rt(n),r=rt(t);return typeof r=="string"?typeof e=="string"?r===e:!1:typeof e=="string"?e in r:Object.keys(e).every(s=>s in r?An(e[s],r[s]):!1)}function $n(n){try{return Fe(n)?n:n.toString().split(Me)}catch{throw new Error(`'${n}' is not a valid state path.`)}}function hr(n){return typeof n=="object"&&"value"in n&&"context"in n&&"event"in n}function rt(n){if(hr(n))return n.value;if(Fe(n))return It(n);if(typeof n!="string")return n;const t=$n(n);return It(t)}function It(n){if(n.length===1)return n[0];const t={};let e=t;for(let r=0;r<n.length-1;r++)if(r===n.length-2)e[n[r]]=n[r+1];else{const s=e;e={},s[n[r]]=e}return t}function Et(n,t){const e={},r=Object.keys(n);for(let s=0;s<r.length;s++){const a=r[s];e[a]=t(n[a],a,n,s)}return e}function it(n){return[].concat(...n)}function In(n){return Fe(n)?n:[n]}function ue(n){return n===void 0?[]:In(n)}function En(n,t,e){if(typeof n=="function")return n({context:t,event:e});const r={},s={context:t,event:e};for(const a of Object.keys(n)){const l=n[a];typeof l=="function"?r[a]=l(s):r[a]=l}return r}function Fe(n){return Array.isArray(n)}function mr(n){return typeof n.type=="string"&&(n.type===or||n.type.startsWith(ar))}function ye(n){return In(n).map(t=>typeof t>"u"||typeof t=="string"?{target:t}:t)}function On(n){if(!(n===void 0||n===lr))return ue(n)}function gr(n,t){if(typeof n=="object"){if("src"in n)return n;if("transition"in n)return{id:t,src:n}}return{id:t,src:n}}function vr(n,t,e){const r=()=>{},s=typeof n=="object",a=s?n:null;return{next:((s?n.next:n)||r).bind(a),error:((s?n.error:t)||r).bind(a),complete:((s?n.complete:e)||r).bind(a)}}function yr(n,t){return`${n}:invocation[${t}]`}function qe(n){return n?"transition"in n?{src:n,input:void 0}:n:void 0}const st="xstate.stop";function br(){let n=0;const t=new Map,e=new Map,r=new WeakMap;return{_bookId:()=>`x:${n++}`,_register:(a,l)=>(t.set(a,l),a),_unregister:a=>{t.delete(a.sessionId);const l=r.get(a);l!==void 0&&(e.delete(l),r.delete(a))},get:a=>e.get(a),_set:(a,l)=>{const f=e.get(a);if(f&&f!==l)throw new Error(`Actor with system ID '${a}' already exists.`);e.set(a,l),r.set(l,a)}}}let Y=function(n){return n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped",n}({});const wr={deferEvents:!0,clock:{setTimeout:(n,t)=>setTimeout(n,t),clearTimeout:n=>clearTimeout(n)},logger:console.log.bind(console),devTools:!1};class Sr{constructor(t,e){this.logic=t,this._state=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new $t(this._process.bind(this)),this.delayedEventsMap={},this.observers=new Set,this.logger=void 0,this.status=Y.NotStarted,this._parent=void 0,this.ref=void 0,this._actorContext=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const r={...wr,...e},{clock:s,logger:a,parent:l,id:f,systemId:u}=r,d=this;this.system=(l==null?void 0:l.system)??br(),u&&(this._systemId=u,this.system._set(u,this)),this.sessionId=this.system._bookId(),this.id=f??this.sessionId,this.logger=a,this.clock=s,this._parent=l,this.options=r,this.src=r.src,this.ref=this,this._actorContext={self:d,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:m=>{this._deferred.push(m)},system:this.system,stopChild:m=>{if(m._parent!==this)throw new Error(`Cannot stop child actor ${m.id} of ${this.id} because it is not a child`);m._stop()}},this.send=this.send.bind(this),this._initState()}_initState(){var t;this._state=this.options.state?this.logic.restoreState?this.logic.restoreState(this.options.state,this._actorContext):this.options.state:this.logic.getInitialState(this._actorContext,(t=this.options)==null?void 0:t.input)}update(t){var a,l,f,u,d;this._state=t;const e=this.getSnapshot();let r;for(;r=this._deferred.shift();)r();for(const m of this.observers)(a=m.next)==null||a.call(m,e);const s=(f=(l=this.logic).getStatus)==null?void 0:f.call(l,t);switch(s==null?void 0:s.status){case"done":this._stopProcedure(),this._doneEvent=zr(this.id,s.data),(u=this._parent)==null||u.send(this._doneEvent),this._complete();break;case"error":this._stopProcedure(),(d=this._parent)==null||d.send(Ze(this.id,s.data)),this._error(s.data);break}}subscribe(t,e,r){var a;const s=vr(t,e,r);return this.observers.add(s),this.status===Y.Stopped&&((a=s.complete)==null||a.call(s),this.observers.delete(s)),{unsubscribe:()=>{this.observers.delete(s)}}}start(){return this.status===Y.Running?this:(this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this.status=Y.Running,this.logic.start&&this.logic.start(this._state,this._actorContext),this.update(this._state),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this)}_process(t){try{const e=this.logic.transition(this._state,t,this._actorContext);this.update(e),t.type===st&&(this._stopProcedure(),this._complete())}catch(e){if(this.observers.size>0)this.observers.forEach(r=>{var s;(s=r.error)==null||s.call(r,e)}),this.stop();else throw e}}_stop(){return this.status===Y.Stopped?this:(this.mailbox.clear(),this.status===Y.NotStarted?(this.status=Y.Stopped,this):(this.mailbox.enqueue({type:st}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){var t;for(const e of this.observers)(t=e.complete)==null||t.call(e);this.observers.clear()}_error(t){var e;for(const r of this.observers)(e=r.error)==null||e.call(r,t);this.observers.clear()}_stopProcedure(){if(this.status!==Y.Running)return this;for(const t of Object.keys(this.delayedEventsMap))this.clock.clearTimeout(this.delayedEventsMap[t]);return this.mailbox.clear(),this.mailbox=new $t(this._process.bind(this)),this.status=Y.Stopped,this.system._unregister(this),this}send(t){if(typeof t=="string")throw new Error(`Only event objects may be sent to actors; use .send({ type: "${t}" }) instead`);if(this.status!==Y.Stopped){if(this.status!==Y.Running&&!this.options.deferEvents)throw new Error(`Event "${t.type}" was sent to uninitialized actor "${this.id}". Make sure .start() is called for this actor, or set { deferEvents: true } in the actor options.
Event: ${JSON.stringify(t)}`);this.mailbox.enqueue(t)}}delaySend({event:t,id:e,delay:r,to:s}){const a=this.clock.setTimeout(()=>{s?s.send(t):this.send(t)},r);e&&(this.delayedEventsMap[e]=a)}cancel(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]}attachDevTools(){const{devTools:t}=this.options;t&&(typeof t=="function"?t:sr)(this)}toJSON(){return{id:this.id}}getPersistedState(){var t,e;return(e=(t=this.logic).getPersistedState)==null?void 0:e.call(t,this._state)}[pr](){return this}getSnapshot(){return this.logic.getSnapshot?this.logic.getSnapshot(this._state):this._state}}function Ie(n,t){return new Sr(n,t)}function Tr(n,t,e,{id:r,systemId:s,src:a,input:l}){const f=qe(t.machine.implementations.actors[a]);let u;if(f){const d=l||f.input;u=Ie(f.src,{id:r,src:a,parent:n==null?void 0:n.self,systemId:s,input:typeof d=="function"?d({context:t.context,event:e.event,self:n==null?void 0:n.self}):d})}return[me(t,{children:{...t.children,[r]:u}}),{id:r,actorRef:u}]}function kr(n,{id:t,actorRef:e}){e&&n.defer(()=>{var r;if(e.status!==Y.Stopped)try{(r=e.start)==null||r.call(e)}catch(s){n.self.send(Ze(t,s));return}})}function Ar({id:n,systemId:t,src:e,input:r}){function s(a){}return s.type="xstate.invoke",s.id=n,s.systemId=t,s.src=e,s.input=r,s.resolve=Tr,s.execute=kr,s}function $r(n){return{type:"xstate.boolean",params:{op:"not"},children:[We(n)],predicate:({evaluate:t,guard:e,context:r,event:s,state:a})=>!t(e.children[0],r,s,a)}}function ft(n,t,e,r){var l,f;const{machine:s}=r,a=((f=(l=s==null?void 0:s.implementations)==null?void 0:l.guards)==null?void 0:f[n.type])??n.predicate;if(!a)throw new Error(`Guard '${n.type}' is not implemented.'.`);return a({context:t,event:e,state:r,guard:n,evaluate:ft})}function We(n,t){var r,s;if(typeof n=="string"){const a=t==null?void 0:t(n);return typeof a=="function"?{type:n,predicate:a,params:{type:n}}:a||{type:n,params:{type:n}}}if(typeof n=="function")return{type:n.name,predicate:n,params:{type:n.name,name:n.name}};const e=t==null?void 0:t(n.type);return typeof e=="function"?{type:n.type,params:n.params||n,children:(r=n.children)==null?void 0:r.map(a=>We(a,t)),predicate:(t==null?void 0:t(n.type))||n.predicate}:e||{type:n.type,params:n.params||n,children:(s=n.children)==null?void 0:s.map(a=>We(a,t)),predicate:n.predicate}}function Ir(n,t,e){const r=n[0].machine,s=n.find(a=>a.type==="final"&&a.parent===r.root);return s&&s.output?En(s.output,t,e):void 0}const Je=n=>n.type==="atomic"||n.type==="final";function pe(n){return Object.values(n.states).filter(t=>t.type!=="history")}function dt(n,t){const e=[];let r=n.parent;for(;r&&r!==t;)e.push(r),r=r.parent;return e}function Re(n){const t=new Set(n),e=new Set(n),r=Pn(e);for(const s of t)if(s.type==="compound"&&(!r.get(s)||!r.get(s).length))Ot(s).forEach(a=>e.add(a));else if(s.type==="parallel"){for(const a of pe(s))if(a.type!=="history"&&!e.has(a))for(const l of Ot(a))e.add(l)}for(const s of e){let a=s.parent;for(;a;)e.add(a),a=a.parent}return e}function Mn(n,t){const e=t.get(n);if(!e)return{};if(n.type==="compound"){const s=e[0];if(s){if(Je(s))return s.key}else return{}}const r={};for(const s of e)r[s.key]=Mn(s,t);return r}function Pn(n){const t=new Map;for(const e of n)t.has(e)||t.set(e,[]),e.parent&&(t.has(e.parent)||t.set(e.parent,[]),t.get(e.parent).push(e));return t}function jn(n,t){const e=Re(t);return Mn(n,Pn(e))}function Ye(n,t=n[0].machine.root){return t.type==="compound"?pe(t).some(e=>e.type==="final"&&n.includes(e)):t.type==="parallel"?pe(t).every(e=>Ye(n,e)):!1}const Ee=n=>n[0]===cr;function Er(n,t){return n.transitions.get(t)||[...n.transitions.keys()].filter(r=>{if(r===ur)return!0;if(!r.endsWith(".*"))return!1;const s=r.split("."),a=t.split(".");for(let l=0;l<s.length;l++){const f=s[l],u=a[l];if(f==="*")return l===s.length-1;if(f!==u)return!1}return!0}).sort((r,s)=>s.length-r.length).flatMap(r=>n.transitions.get(r))}function Or(n){const t=n.config.after;if(!t)return[];const e=(s,a)=>{const l=typeof s=="function"?`${n.id}:delay[${a}]`:s,f=Zr(l,n.id);return n.entry.push(Cr({type:f},{id:f,delay:s})),n.exit.push(_r(f)),f};return(Fe(t)?t.map((s,a)=>{const l=e(s.delay,a);return{...s,event:l}}):Object.keys(t).flatMap((s,a)=>{const l=t[s],f=typeof l=="string"?{target:l}:l,u=isNaN(+s)?s:+s,d=e(u,a);return ue(f).map(m=>({...m,event:d,delay:u}))})).map(s=>{const{delay:a}=s;return{...de(n,s.event,s),delay:a}})}function de(n,t,e){const r=On(e.target),s=e.reenter??!1,{guards:a}=n.machine.implementations,l=Dn(n,r),f={...e,actions:ue(e.actions),guard:e.guard?We(e.guard,u=>a[u]):void 0,target:l,source:n,reenter:s,eventType:t,toJSON:()=>({...f,source:`#${n.id}`,target:l?l.map(u=>`#${u.id}`):void 0})};return f}function Mr(n){const t=new Map;if(n.config.on)for(const e of Object.keys(n.config.on)){if(e===Tn)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const r=n.config.on[e];t.set(e,ye(r).map(s=>de(n,e,s)))}if(n.config.onDone){const e=String(at(n.id));t.set(e,ye(n.config.onDone).map(r=>de(n,e,r)))}for(const e of n.invoke){if(e.onDone){const r=`done.invoke.${e.id}`;t.set(r,ye(e.onDone).map(s=>de(n,r,s)))}if(e.onError){const r=`error.platform.${e.id}`;t.set(r,ye(e.onError).map(s=>de(n,r,s)))}if(e.onSnapshot){const r=`xstate.snapshot.${e.id}`;t.set(r,ye(e.onSnapshot).map(s=>de(n,r,s)))}}for(const e of n.after){let r=t.get(e.eventType);r||(r=[],t.set(e.eventType,r)),r.push(e)}return t}function Pr(n,t){if(typeof t=="string"||Fe(t)){const e=ue(t).map(a=>{const l=typeof a=="string"?Ee(a)?n.machine.getStateNodeById(a):n.states[a]:a;if(!l)throw new Error(`Initial state node "${a}" not found on parent state node #${n.id}`);if(!he(l,n))throw new Error(`Invalid initial target: state node #${l.id} is not a descendant of #${n.id}`);return l}),r=Dn(n,e),s={source:n,actions:[],eventType:null,reenter:!1,target:r,toJSON:()=>({...s,source:`#${n.id}`,target:r?r.map(a=>`#${a.id}`):void 0})};return s}return de(n,"__INITIAL__",{target:ue(t.target).map(e=>typeof e=="string"?Ee(e)?e:`${Me}${e}`:e),actions:t.actions})}function Dn(n,t){if(t!==void 0)return t.map(e=>{if(typeof e!="string")return e;if(Ee(e))return n.machine.getStateNodeById(e);const r=e[0]===Me;if(r&&!n.parent)return Xe(n,e.slice(1));const s=r?n.key+e:e;if(n.parent)try{return Xe(n.parent,s)}catch(a){throw new Error(`Invalid transition definition for state node '${n.id}':
${a.message}`)}else throw new Error(`Invalid target: "${e}" is not a valid target from the root node. Did you mean ".${e}"?`)})}function Ln(n){const t=On(n.target);return t?t.map(e=>typeof e=="string"?Xe(n.parent,e):e):n.parent.initial.target}function Ne(n){return n.type==="history"}function Ot(n){const t=new Set;function e(r){if(!t.has(r)){if(t.add(r),r.type==="compound")for(const s of r.initial.target){for(const a of dt(s,n))t.add(a);e(s)}else if(r.type==="parallel")for(const s of pe(r))e(s)}}return e(n),[...t]}function Oe(n,t){if(Ee(t))return n.machine.getStateNodeById(t);if(!n.states)throw new Error(`Unable to retrieve child state '${t}' from '${n.id}'; no child states exist.`);const e=n.states[t];if(!e)throw new Error(`Child state '${t}' does not exist on '${n.id}'`);return e}function Xe(n,t){if(typeof t=="string"&&Ee(t))try{return n.machine.getStateNodeById(t)}catch{}const e=$n(t).slice();let r=n;for(;e.length;){const s=e.shift();if(!s.length)break;r=Oe(r,s)}return r}function xe(n,t){const e=t instanceof ae?t.value:rt(t);if(typeof e=="string")return[n,n.states[e]];const r=Object.keys(e),s=r.map(a=>Oe(n,a)).filter(Boolean);return[n.machine.root,n].concat(s,r.reduce((a,l)=>{const f=Oe(n,l);if(!f)return a;const u=xe(f,e[l]);return a.concat(u)},[]))}function jr(n,t,e,r){const a=Oe(n,t).next(e,r);return!a||!a.length?n.next(e,r):a}function Dr(n,t,e,r){const s=Object.keys(t),a=Oe(n,s[0]),l=_t(a,t[s[0]],e,r);return!l||!l.length?n.next(e,r):l}function Lr(n,t,e,r){const s=[];for(const a of Object.keys(t)){const l=t[a];if(!l)continue;const f=Oe(n,a),u=_t(f,l,e,r);u&&s.push(...u)}return s.length?s:n.next(e,r)}function _t(n,t,e,r){return typeof t=="string"?jr(n,t,e,r):Object.keys(t).length===1?Dr(n,t,e,r):Lr(n,t,e,r)}function Rr(n){return Object.keys(n.states).map(t=>n.states[t]).filter(t=>t.type==="history")}function he(n,t){let e=n;for(;e.parent&&e.parent!==t;)e=e.parent;return e.parent===t}function Mt(n){const t=[];let e=n.parent;for(;e;)t.unshift(e),e=e.parent;return t}function xr(n,t){const e=new Set(n),r=new Set(t);for(const s of e)if(r.has(s))return!0;for(const s of r)if(e.has(s))return!0;return!1}function Rn(n,t,e){const r=new Set;for(const s of n){let a=!1;const l=new Set;for(const f of r)if(xr(ot([s],t,e),ot([f],t,e)))if(he(s.source,f.source))l.add(f);else{a=!0;break}if(!a){for(const f of l)r.delete(f);r.add(s)}}return Array.from(r)}function Fr(n){const[t]=n;let e=Mt(t),r=[];for(const s of n){const a=Mt(s);r=e.filter(l=>a.includes(l)),e=r,r=[]}return e[e.length-1]}function pt(n,t){if(!n.target)return[];const e=new Set;for(const r of n.target)if(Ne(r))if(t[r.id])for(const s of t[r.id])e.add(s);else for(const s of pt({target:Ln(r)},t))e.add(s);else e.add(r);return[...e]}function xn(n,t){const e=pt(n,t);return e?!n.reenter&&n.source.type!=="parallel"&&e.every(s=>he(s,n.source))?n.source:Fr(e.concat(n.source)):null}function ot(n,t,e){var s;const r=new Set;for(const a of n)if((s=a.target)!=null&&s.length){const l=xn(a,e);for(const f of t)he(f,l)&&r.add(f)}return[...r]}function Ge(n,t,e,r,s){const a=new Set(t.configuration);if(!n.length)return t;const l=Hr(n,t,a,r,e,s);return me(l,{value:{}})}function Hr(n,t,e,r,s,a){const l=[],f={...t.historyValue},u=Rn(n,e,f),d=[...t._internalQueue];a||Vr(u,e,f,l),l.push(...u.flatMap(o=>o.actions)),Gr(r,u,e,l,d,t,f,a);const m=[...e],i=Ye(m);if(i){const o=m.sort((c,_)=>_.order-c.order).flatMap(c=>c.exit);l.push(...o)}try{const o=Ce(l,r,t,s),c=i?Ir(m,o.context,r):void 0;return d.push(...o._internalQueue),me(t,{configuration:m,historyValue:f,_internalQueue:d,context:o.context,done:i,output:c,children:o.children})}catch(o){throw o}}function Gr(n,t,e,r,s,a,l,f){const u=new Set,d=new Set;Fn(t,l,d,u),f&&d.add(a.machine.root);for(const m of[...u].sort((i,o)=>i.order-o.order)){e.add(m);for(const i of m.invoke)r.push(Ar(i));if(r.push(...m.entry),d.has(m))for(const i of d){const o=i.initial.actions;r.push(...o)}if(m.type==="final"){const i=m.parent;if(!i.parent)continue;if(s.push(at(i.id,m.output?En(m.output,a.context,n):void 0)),i.parent){const o=i.parent;o.type==="parallel"&&pe(o).every(c=>Ye([...e],c))&&s.push(at(o.id))}}}}function Fn(n,t,e,r){for(const s of n){for(const f of s.target||[])we(f,t,e,r);const a=xn(s,t),l=pt(s,t);for(const f of l)Ve(f,a,r,t,e)}}function we(n,t,e,r){if(Ne(n))if(t[n.id]){const s=t[n.id];for(const a of s)we(a,t,e,r);for(const a of s){Ve(a,n.parent,r,t,e);for(const l of e)e.add(l)}}else{const s=Ln(n);for(const a of s)we(a,t,e,r);for(const a of s){Ve(a,n,r,t,e);for(const l of e)e.add(l)}}else if(r.add(n),n.type==="compound"){e.add(n);const s=n.initial.target;for(const a of s)we(a,t,e,r);for(const a of s)Ve(a,n,r,t,e)}else if(n.type==="parallel")for(const s of pe(n).filter(a=>!Ne(a)))[...r].some(a=>he(a,s))||we(s,t,e,r)}function Ve(n,t,e,r,s){const a=dt(n,t);for(const l of a)if(e.add(l),l.type==="parallel")for(const f of pe(l).filter(u=>!Ne(u)))[...e].some(u=>he(u,f))||we(f,r,s,e)}function Vr(n,t,e,r){const s=ot(n,t,e);s.sort((a,l)=>l.order-a.order);for(const a of s)for(const l of Rr(a)){let f;l.history==="deep"?f=u=>Je(u)&&he(u,a):f=u=>u.parent===a,e[l.id]=Array.from(t).filter(f)}for(const a of s)r.push(...a.exit,...a.invoke.map(l=>Hn(l.id))),t.delete(a)}function Ce(n,t,e,r){const{machine:s}=e;let a=me(e,{_internalQueue:[]});for(const l of n){const f=typeof l=="function"?l:s.implementations.actions[typeof l=="string"?l:l.type];if(!f)continue;const u={context:a.context,event:t,self:r==null?void 0:r.self,system:r==null?void 0:r.system,action:typeof l=="string"?{type:l}:l};if(!("resolve"in f)){(r==null?void 0:r.self.status)===Y.Running?f(u):r==null||r.defer(()=>f(u));continue}const d=f,[m,i,o]=d.resolve(r,a,u,f);a=m,"execute"in f&&((r==null?void 0:r.self.status)===Y.Running?d.execute(r,i):r==null||r.defer(d.execute.bind(null,r,i))),o&&(a=Ce(o,t,a,r))}return a}function ze(n,t,e){let r=n;const s=[];if(t.type===st)return r=Pt(t,r,e),s.push(r),{state:r,microstates:s};let a=t;if(a.type!==kn){const l=jt(a,r);r=Ge(l,n,e,a,!1),s.push(r)}for(;!r.done;){let l=Br(r,a);if(l.length)r=Ge(l,r,e,a,!1),s.push(r);else if(r._internalQueue.length){a=r._internalQueue[0];const f=jt(a,r);r=Ge(f,r,e,a,!1),r._internalQueue.shift(),s.push(r)}else break}return r.done&&Pt(a,r,e),{state:r,microstates:s}}function Pt(n,t,e){const r=[];for(const s of t.configuration.sort((a,l)=>l.order-a.order))r.push(...s.exit);for(const s of Object.values(t.children))r.push(Hn(s));return Ce(r,n,t,e)}function jt(n,t){return t.machine.getTransitionData(t,n)}function Br(n,t){const e=new Set,r=n.configuration.filter(Je);for(const s of r)e:for(const a of[s].concat(dt(s,null)))if(a.always){for(const l of a.always)if(l.guard===void 0||ft(l.guard,n.context,t,n)){e.add(l);break e}}return Rn(Array.from(e),new Set(n.configuration),n.historyValue)}function Dt(n,t){const e=Re(xe(n,t));return jn(n,[...e])}function qr(n){const t=[],e=n.initial,r=new Set;Fn([e],{},new Set([n]),r);for(const a of[...r].sort((l,f)=>l.order-f.order))t.push(a);return t}class ae{static from(t,e={},r){if(t instanceof ae)return t.context!==e?new ae({value:t.value,context:e,meta:{},configuration:[],children:{}},r):t;const s=Re(xe(r.root,t));return new ae({value:t,context:e,meta:void 0,configuration:Array.from(s),children:{}},r)}constructor(t,e){this.machine=e,this.tags=void 0,this.value=void 0,this.done=void 0,this.output=void 0,this.context=void 0,this.historyValue={},this._internalQueue=void 0,this.configuration=void 0,this.children=void 0,this.context=t.context,this._internalQueue=t._internalQueue??[],this.historyValue=t.historyValue||{},this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration??Array.from(Re(xe(e.root,t.value))),this.children=t.children,this.value=jn(e.root,this.configuration),this.tags=new Set(it(this.configuration.map(r=>r.tags))),this.done=t.done??!1,this.output=t.output}toStrings(t=this.value){if(typeof t=="string")return[t];const e=Object.keys(t);return e.concat(...e.map(r=>this.toStrings(t[r]).map(s=>r+Me+s)))}toJSON(){const{configuration:t,tags:e,machine:r,...s}=this;return{...s,tags:Array.from(e),meta:this.meta}}matches(t){return An(t,this.value)}hasTag(t){return this.tags.has(t)}can(t){const e=this.machine.getTransitionData(this,t);return!!(e!=null&&e.length)&&e.some(r=>r.target!==void 0||r.actions.length)}get nextEvents(){return _e(this,"nextEvents",()=>[...new Set(it([...this.configuration.map(t=>t.ownEvents)]))])}get meta(){return this.configuration.reduce((t,e)=>(e.meta!==void 0&&(t[e.id]=e.meta),t),{})}}function me(n,t={}){return new ae({...n,...t},n.machine)}function Wr(n){var f,u;const{configuration:t,tags:e,machine:r,children:s,...a}=n,l={};for(const d in s)l[d]={state:(u=(f=s[d]).getPersistedState)==null?void 0:u.call(f),src:s[d].src};return{...a,children:l}}function Nr(n,t,e,{actorRef:r}){const s=typeof r=="function"?r(e):r,a=typeof s=="string"?t.children[s]:s;let l=t.children;return a&&(l={...l},delete l[a.id]),[me(t,{children:l}),a]}function Xr(n,t){if(t){if(t.status!==Y.Running){n.stopChild(t);return}n.defer(()=>{n.stopChild(t)})}}function Hn(n){function t(e){}return t.type="xstate.stop",t.actorRef=n,t.resolve=Nr,t.execute=Xr,t}function Ur(n,{machine:t,context:e},r,s){const a=(l,f={})=>{const{systemId:u}=f;if(typeof l=="string"){const d=qe(t.implementations.actors[l]);if(!d)throw new Error(`Actor logic '${l}' not implemented in machine '${t.id}'`);const m="input"in f?f.input:d.input,i=Ie(d.src,{id:f.id,parent:n.self,input:typeof m=="function"?m({context:e,event:r,self:n.self}):m,systemId:u});return s[i.id]=i,i}else return Ie(l,{id:f.id,parent:n.self,input:f.input,systemId:u})};return(l,f)=>{const u=a(l,f);return s[u.id]=u,n.defer(()=>{var d;if(u.status!==Y.Stopped)try{(d=u.start)==null||d.call(u)}catch(m){n.self.send(Ze(u.id,m));return}}),u}}function Qr(n,t,e,{assignment:r}){if(!t.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const s={},a={context:t.context,event:e.event,action:e.action,spawn:Ur(n,t,e.event,s),self:n==null?void 0:n.self,system:n==null?void 0:n.system};let l={};if(typeof r=="function")l=r(a);else for(const u of Object.keys(r)){const d=r[u];l[u]=typeof d=="function"?d(a):d}const f=Object.assign({},t.context,l);return[me(t,{context:f,children:Object.keys(s).length?{...t.children,...s}:t.children})]}function Gn(n){function t(e){}return t.type="xstate.assign",t.assignment=n,t.resolve=Qr,t}function Jr(n,t,e,{event:r,id:s,delay:a}){const l=t.machine.implementations.delays;if(typeof r=="string")throw new Error(`Only event objects may be used with raise; use raise({ type: "${r}" }) instead`);const f=typeof r=="function"?r(e):r;let u;if(typeof a=="string"){const d=l&&l[a];u=typeof d=="function"?d(e):d}else u=typeof a=="function"?a(e):a;return[typeof u!="number"?me(t,{_internalQueue:t._internalQueue.concat(f)}):t,{event:f,id:s,delay:u}]}function Yr(n,t){if(typeof t.delay=="number"){n.self.delaySend(t);return}}function Cr(n,t){function e(r){}return e.type="xstate.raise",e.event=n,e.id=t==null?void 0:t.id,e.delay=t==null?void 0:t.delay,e.resolve=Jr,e.execute=Yr,e}function Zr(n,t){const e=t?`#${t}`:"";return`${fe.After}(${n})${e}`}function at(n,t){const e=`${fe.DoneState}.${n}`,r={type:e,output:t};return r.toString=()=>e,r}function zr(n,t){const e=`${fe.DoneInvoke}.${n}`,r={type:e,output:t};return r.toString=()=>e,r}function Ze(n,t){const e=`${fe.ErrorPlatform}.${n}`,r={type:e,data:t};return r.toString=()=>e,r}function Kr(n){return{type:kn,input:n}}const ei={},Pe=n=>typeof n=="string"?{type:n}:typeof n=="function"?"resolve"in n?{type:n.type}:{type:n.name}:n;class ht{constructor(t,e){if(this.config=t,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=e._parent,this.key=e._key,this.machine=e._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join(Me),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?Et(this.config.states,(r,s)=>new ht(r,{_parent:this,_key:s,_machine:this.machine})):ei,this.type==="compound"&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=this.config.history===!0?"shallow":this.config.history||!1,this.entry=ue(this.config.entry),this.exit=ue(this.config.exit),this.meta=this.config.meta,this.output=this.type==="final"?this.config.output:void 0,this.tags=ue(t.tags)}_initialize(){this.transitions=Mr(this),this.config.always&&(this.always=ye(this.config.always).map(t=>de(this,Tn,t))),Object.keys(this.states).forEach(t=>{this.states[t]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(Pe),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(t=>`#${t.id}`),source:`#${this.id}`,actions:this.initial.actions.map(Pe),eventType:null})}:void 0,history:this.history,states:Et(this.states,t=>t.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(t=>({...t,actions:t.actions.map(Pe)})),entry:this.entry.map(Pe),exit:this.exit.map(Pe),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return _e(this,"invoke",()=>ue(this.config.invoke).map((t,e)=>{const r=yr(this.id,e),s=gr(t,r),a=s.id||r,l=s.src,{systemId:f}=s,u=typeof l=="string"||"type"in l?l:a;return!this.machine.implementations.actors[a]&&typeof l!="string"&&!("type"in l)&&(this.machine.implementations.actors={...this.machine.implementations.actors,[a]:l}),{type:"xstate.invoke",...s,src:u,id:a,systemId:f,toJSON(){const{onDone:d,onError:m,...i}=s;return{...i,type:"xstate.invoke",src:u,id:a}}}}))}get on(){return _e(this,"on",()=>[...this.transitions].flatMap(([e,r])=>r.map(s=>[e,s])).reduce((e,[r,s])=>(e[r]=e[r]||[],e[r].push(s),e),{}))}get after(){return _e(this,"delayedTransitions",()=>Or(this))}get initial(){return _e(this,"initial",()=>Pr(this,this.config.initial||[]))}next(t,e){const r=e.type,s=[];let a;const l=_e(this,`candidates-${r}`,()=>Er(this,r));for(const f of l){const{guard:u}=f,d=t.context;let m=!1;try{m=!u||ft(u,d,e,t)}catch(i){throw new Error(`Unable to evaluate guard '${u.type}' in transition for event '${r}' in state node '${this.id}':
${i.message}`)}if(m){s.push(...f.actions),a=f;break}}return a?[a]:void 0}get target(){if(this.type==="history")return this.config.target}get stateIds(){const t=it(Object.keys(this.states).map(e=>this.states[e].stateIds));return[this.id].concat(t)}get events(){return _e(this,"events",()=>{const{states:t}=this,e=new Set(this.ownEvents);if(t)for(const r of Object.keys(t)){const s=t[r];if(s.states)for(const a of s.events)e.add(`${a}`)}return Array.from(e)})}get ownEvents(){const t=new Set([...this.transitions.keys()].filter(e=>this.transitions.get(e).some(r=>!(!r.target&&!r.actions.length&&!r.reenter))));return Array.from(t)}}const ti="#";class mt{constructor(t,e){this.config=t,this.version=void 0,this.implementations=void 0,this.types=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.__TContext=void 0,this.__TEvent=void 0,this.__TAction=void 0,this.__TActorMap=void 0,this.__TResolvedTypesMeta=void 0,this.id=t.id||"(machine)",this.implementations={actors:(e==null?void 0:e.actors)??{},actions:(e==null?void 0:e.actions)??{},delays:(e==null?void 0:e.delays)??{},guards:(e==null?void 0:e.guards)??{}},this.version=this.config.version,this.types=this.config.types??{},this.transition=this.transition.bind(this),this.root=new ht(t,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(t){const{actions:e,guards:r,actors:s,delays:a}=this.implementations;return new mt(this.config,{actions:{...e,...t.actions},guards:{...r,...t.guards},actors:{...s,...t.actors},delays:{...a,...t.delays}})}resolveState(t){const e=Re(xe(this.root,t.value)),r=Array.from(e);return this.createState({...t,value:Dt(this.root,t.value),configuration:r,done:Ye(r)})}resolveStateValue(t,...[e]){const r=Dt(this.root,t);return this.resolveState(ae.from(r,e,this))}transition(t,e,r){if(mr(e)&&!t.nextEvents.some(a=>a===e.type))throw e.data;const{state:s}=ze(t,e,r);return s}microstep(t,e,r){return ze(t,e,r).microstates}getTransitionData(t,e){return _t(this.root,t.value,t,e)||[]}getPreInitialState(t,e){const{context:r}=this.config,s=this.resolveState(this.createState({value:{},context:typeof r!="function"&&r?r:{},meta:void 0,configuration:qr(this.root),children:{}}));return typeof r=="function"?Ce([Gn(({spawn:l,event:f})=>r({spawn:l,input:f.input}))],e,s,t):s}getInitialState(t,e){const r=Kr(e),s=this.getPreInitialState(t,r),a=Ge([{target:[...s.configuration].filter(Je),source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],s,t,r,!0),{state:l}=ze(a,r,t);return l}start(t,e){Object.values(t.children).forEach(r=>{var s;if(r.status===0)try{(s=r.start)==null||s.call(r)}catch(a){e.self.send(Ze(r.id,a))}})}getStateNodeById(t){const e=t.split(Me),r=e.slice(1),s=Ee(e[0])?e[0].slice(ti.length):e[0],a=this.idMap.get(s);if(!a)throw new Error(`Child state node '#${s}' does not exist on machine '${this.id}'`);return Xe(a,r)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedState(t){return Wr(t)}createState(t){return t instanceof ae?t:new ae(t,this)}getStatus(t){return t.done?{status:"done",data:t.output}:{status:"active"}}restoreState(t,e){const r={};Object.keys(t.children).forEach(a=>{var o,c;const l=t.children[a],f=l.state,u=l.src,d=u?(o=qe(this.implementations.actors[u]))==null?void 0:o.src:void 0;if(!d)return;const m=(c=d.restoreState)==null?void 0:c.call(d,f,e),i=Ie(d,{id:a,state:m});r[a]=i});const s=this.createState(new ae({...t,children:r},this));return s.configuration.forEach(a=>{a.invoke&&a.invoke.forEach(l=>{const{id:f,src:u}=l;if(r[f])return;const d=qe(this.implementations.actors[u]);if(d){const m=Ie(d.src,{id:f,parent:e==null?void 0:e.self,input:"input"in l?l.input:d.input});r[f]=m}})}),s}}function ni(n,t){return new mt(n,t)}function ri(n,...[t={}]){const{guards:e,actions:r,actors:s,delays:a,...l}=t,f={guards:e,actions:r,actors:s,delays:a},u=n.provide(f),d=Ie(u,l).start();Un(()=>d.stop());let m=d.getSnapshot();return{state:bn(m,o=>d.subscribe(c=>{m!==c&&(m=c,o(m))}).unsubscribe),send:d.send,service:d}}const Vn={},ii=n=>{Qn(Vn,n)},ge=()=>Jn(Vn),si=ni({id:"gameClient",context:({input:n})=>n,types:{context:{},events:{},actors:{}},initial:"Lobby",states:{Lobby:{initial:"Assigning sides",states:{"Assigning sides":{description:`This is the first step of the game setup, where users can join and are assigned to be either attacker or defender.

Users can also be made administrators.`,initial:"Incomplete",states:{Incomplete:{always:{target:"Ready",guard:"allSidesAssigned",description:"All users have been assigned a side and there is an admin on both sides",reenter:!1}},Ready:{on:{"next step":{target:"Ready",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1}}}},always:{target:"Assigning roles",guard:"finishedAssigningSides",reenter:!1},on:{"assign side":{target:"Assigning sides",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1},"assign admin":{target:"Assigning sides",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1}}},"Assigning roles":{description:"All users have been assigned a side, and now the roles will be configured.",initial:"Incomplete",states:{Incomplete:{always:[{target:"Ready",guard:"allRolesAssignedOfSide",description:"All users have been assigned a role.",reenter:!1},{target:"Editing player",guard:"isEditingPlayerOfSide",reenter:!1}]},Ready:{always:{target:"Editing player",guard:"isEditingPlayerOfSide",reenter:!1},on:{"next step":{target:"Ready",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1}}},"Editing player":{description:"Shows a modal where the admin can select the user, role and face image",always:{target:"Incomplete",guard:"isNotEditingPlayerOfSide",reenter:!1},on:{"assign role":{target:"Editing player",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1}}}},always:{target:"Waiting for other side",guard:"finishedAssigningRolesOfSide",reenter:!1},on:{"start editing player":{target:"Assigning roles",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1},"stop editing player":{target:"Assigning roles",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1}}},"Waiting for other side":{}},always:{target:"Ingame",guard:"finishedAssigningRoles",reenter:!1}},Ingame:{states:{Gameloop:{initial:"Waiting",states:{Waiting:{always:{target:"Playing",guard:"userOnActiveSide",reenter:!1}},Playing:{initial:"Ready to move",states:{"Ready to move":{always:{target:"Ready for action",guard:"playerMoved",reenter:!1},on:{move:{target:"Ready to move",guard:"userControlsPlayer",actions:{params:{},type:"forwardToServer"},reenter:!1}}},"Ready for action":{always:{target:"Ready to move",guard:"playerPerformedAction",reenter:!1},on:{"perform action":{target:"Ready for action",guard:"userControlsPlayer",actions:{params:{},type:"forwardToServer"},reenter:!1}}}},always:{target:"Waiting",guard:"userNotOnActiveSide",reenter:!1}}}},"Global Attack":{initial:"Showing current global attack",states:{"Showing current global attack":{on:{"dismiss global attack":{target:"Dismissed",reenter:!1}}},Dismissed:{on:{"new global attack":{target:"Showing current global attack",reenter:!1},"show global attack":{target:"Showing current global attack",reenter:!1}}}}},Sides:{initial:"Initial",states:{Initial:{always:[{target:"Defense",guard:"userIsDefender",reenter:!1},{target:"Attack",reenter:!1}]},Defense:{states:{"Attacker visibility":{initial:"Invisible",states:{Invisible:{always:{target:"Visible",guard:"attackerShouldBeVisible",reenter:!1}},Visible:{always:{target:"Invisible",guard:"attackerShouldBeInvisible",reenter:!1}}}}},type:"parallel"},Attack:{}},on:{"switch sides":{target:"Sides",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1}}}},always:{target:"Finished",guard:"gameFinished",reenter:!1},type:"parallel"},Finished:{description:"The game finished, but the users can still communicate by sending emojis."},"Server stopped":{type:"final"}},always:{target:".Server stopped",guard:"isServerStopped",reenter:!1},on:{"shared game context update":{target:"#gameClient",actions:{params:{},type:"updateSharedGameContext"},reenter:!1},"send emoji":{target:"#gameClient",actions:{params:{},type:"forwardToServer"},reenter:!1},"show emoji":{actions:{params:{},type:"showEmoji"},reenter:!0}}}),oi={gameFinished:()=>!1,allSidesAssigned:({context:n})=>n.users.every(t=>t.isSideAssigned)&&!!n.users.find(t=>t.side==="defender"&&t.isAdmin)&&!!n.users.find(t=>t.side==="attacker"&&t.isAdmin),finishedAssigningSides:({context:n})=>n.finishedAssigningSides,allRolesAssigned:({context:n})=>n.attack.attacker.isConfigured&&n.defense.defenders.every(t=>t.isConfigured),finishedAssigningRoles:({context:n})=>n.attack.finishedAssigning&&n.defense.finishedAssigning,attackerShouldBeVisible:()=>!1,attackerShouldBeInvisible:()=>!1},Be=n=>{const t=n.users.find(e=>e.id===n.userId);if(!t)throw new Error("The current user was not found in the users list.");return t},ai=({send:n,actions:t})=>si.provide({actions:{updateSharedGameContext:Gn(({event:e})=>({...e.sharedGameContext})),showEmoji:({event:e})=>{const r=e;t.showEmoji({userId:r.userId,emoji:r.emoji})},forwardToServer:({event:e})=>{const r=e;n({...r,type:`user: ${r.type}`})}},actors:{},guards:{isHost:({context:e})=>e.hostUserId===e.userId,isAdmin:({context:e})=>!!e.users.find(r=>r.id===e.userId&&r.isAdmin),isPlayer:({context:e})=>e.hostUserId!==e.userId,allRolesAssignedOfSide:({context:e})=>{const{side:r}=Be(e);return r?r==="attacker"?!!e.attack.attacker:e.defense.defenders.length===4:!1},finishedAssigningRolesOfSide:({context:e})=>{const{side:r}=Be(e);return r?(r==="attacker"?e.attack:e.defense).finishedAssigning:!1},isEditingPlayerOfSide:({context:e})=>{const{side:r}=Be(e);return r?(r==="attacker"?e.attack:e.defense).editingPlayer!==void 0:!1},isNotEditingPlayerOfSide:$r("isEditingPlayerOfSide"),userControlsPlayer:()=>!1,userOnActiveSide:()=>!1,userNotOnActiveSide:()=>!1,playerMoved:()=>!1,userIsDefender:()=>!1,isServerStopped:()=>!1,playerPerformedAction:()=>!1,...oi}}),li=({gameId:n,userId:t,onMessage:e})=>{const r=er({status:"opening",log:[]}),s=(d,m)=>(console.debug("[websocket]",d,m),r.update(i=>({...i,log:[...i.log,`[websocket] ${d}`]}))),a=d=>r.update(m=>({...m,status:d}));let l;const f=()=>{s("connecting");const d=window.location.protocol==="https:"?"wss:":"ws:";l=new WebSocket(`${d}//${window.location.host}/websocket?gameId=${n}&userId=${t}`),l.addEventListener("open",()=>{a("opened"),s("connection open")}),l.addEventListener("close",()=>{a("closed"),s("connection closed")}),l.addEventListener("message",m=>{try{const i=JSON.parse(m.data);i.type!=="mouse position"&&s(`message received: ${m.data}`,m),e(i)}catch(i){s("error parsing message",i)}})},u=d=>{l==null||l.send(JSON.stringify(d))};return{subscribe:r.subscribe,open:f,close:()=>l==null?void 0:l.close(),send:u}};function ci(n,t){return n===t}const C=(n,t,e=ci)=>{let r,s=t(n.getSnapshot());return bn(s,l=>(r=n.subscribe(f=>{const u=t(f);e(s,u)||(s=u,l(u))}),()=>{r.unsubscribe()}))};var M=class{static clamp(n,t,e){return Math.max(t,typeof e<"u"?Math.min(n,e):n)}static clampV(n,t,e){return n.map(r=>e?M.clamp(r,t,e):M.clamp(r,t))}static cross(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(e[0]-n[0])*(t[1]-n[1])}static snap(n,t=1){return[Math.round(n[0]/t)*t,Math.round(n[1]/t)*t]}},I=M;I.neg=n=>[-n[0],-n[1]];I.add=(n,t)=>[n[0]+t[0],n[1]+t[1]];I.addScalar=(n,t)=>[n[0]+t,n[1]+t];I.sub=(n,t)=>[n[0]-t[0],n[1]-t[1]];I.subScalar=(n,t)=>[n[0]-t,n[1]-t];I.vec=(n,t)=>[t[0]-n[0],t[1]-n[1]];I.mul=(n,t)=>[n[0]*t,n[1]*t];I.mulV=(n,t)=>[n[0]*t[0],n[1]*t[1]];I.div=(n,t)=>[n[0]/t,n[1]/t];I.divV=(n,t)=>[n[0]/t[0],n[1]/t[1]];I.per=n=>[n[1],-n[0]];I.dpr=(n,t)=>n[0]*t[0]+n[1]*t[1];I.cpr=(n,t)=>n[0]*t[1]-t[0]*n[1];I.len2=n=>n[0]*n[0]+n[1]*n[1];I.len=n=>Math.hypot(n[0],n[1]);I.pry=(n,t)=>M.dpr(n,t)/M.len(t);I.uni=n=>M.div(n,M.len(n));I.normalize=n=>M.uni(n);I.tangent=(n,t)=>M.uni(M.sub(n,t));I.dist2=(n,t)=>M.len2(M.sub(n,t));I.dist=(n,t)=>Math.hypot(n[1]-t[1],n[0]-t[0]);I.fastDist=(n,t)=>{const e=[t[0]-n[0],t[1]-n[1]],r=[Math.abs(e[0]),Math.abs(e[1])];let s=1/Math.max(r[0],r[1]);return s=s*(1.29289-(r[0]+r[1])*s*.29289),[e[0]*s,e[1]*s]};I.ang=(n,t)=>Math.atan2(M.cpr(n,t),M.dpr(n,t));I.angle=(n,t)=>Math.atan2(t[1]-n[1],t[0]-n[0]);I.med=(n,t)=>M.mul(M.add(n,t),.5);I.rot=(n,t=0)=>[n[0]*Math.cos(t)-n[1]*Math.sin(t),n[0]*Math.sin(t)+n[1]*Math.cos(t)];I.rotWith=(n,t,e=0)=>{if(e===0)return n;const r=Math.sin(e),s=Math.cos(e),a=n[0]-t[0],l=n[1]-t[1],f=a*s-l*r,u=a*r+l*s;return[f+t[0],u+t[1]]};I.isEqual=(n,t)=>n[0]===t[0]&&n[1]===t[1];I.lrp=(n,t,e)=>M.add(n,M.mul(M.sub(t,n),e));I.int=(n,t,e,r,s=1)=>{const a=(M.clamp(e,r)-e)/(r-e);return M.add(M.mul(n,1-a),M.mul(t,s))};I.ang3=(n,t,e)=>{const r=M.vec(t,n),s=M.vec(t,e);return M.ang(r,s)};I.abs=n=>[Math.abs(n[0]),Math.abs(n[1])];I.rescale=(n,t)=>{const e=M.len(n);return[t*n[0]/e,t*n[1]/e]};I.isLeft=(n,t,e)=>(t[0]-n[0])*(e[1]-n[1])-(e[0]-n[0])*(t[1]-n[1]);I.clockwise=(n,t,e)=>M.isLeft(n,t,e)>0;I.toFixed=(n,t=2)=>n.map(e=>+e.toFixed(t));I.nearestPointOnLineThroughPoint=(n,t,e)=>M.add(n,M.mul(t,M.pry(M.sub(e,n),t)));I.distanceToLineThroughPoint=(n,t,e)=>M.dist(e,M.nearestPointOnLineThroughPoint(n,t,e));I.nearestPointOnLineSegment=(n,t,e,r=!0)=>{const s=M.uni(M.sub(t,n)),a=M.add(n,M.mul(s,M.pry(M.sub(e,n),s)));if(r){if(a[0]<Math.min(n[0],t[0]))return n[0]<t[0]?n:t;if(a[0]>Math.max(n[0],t[0]))return n[0]>t[0]?n:t;if(a[1]<Math.min(n[1],t[1]))return n[1]<t[1]?n:t;if(a[1]>Math.max(n[1],t[1]))return n[1]>t[1]?n:t}return a};I.distanceToLineSegment=(n,t,e,r=!0)=>M.dist(e,M.nearestPointOnLineSegment(n,t,e,r));I.nudge=(n,t,e)=>M.isEqual(n,t)?n:M.add(n,M.mul(M.uni(M.sub(t,n)),e));I.nudgeAtAngle=(n,t,e)=>[Math.cos(t)*e+n[0],Math.sin(t)*e+n[1]];I.toPrecision=(n,t=4)=>[+n[0].toPrecision(t),+n[1].toPrecision(t)];I.pointsBetween=(n,t,e=6)=>Array.from(Array(e)).map((r,s)=>{const a=s/(e-1),l=Math.min(1,.5+Math.abs(.5-a));return[...M.lrp(n,t,a),l]});I.slope=(n,t)=>n[0]===t[0]?NaN:(n[1]-t[1])/(n[0]-t[0]);I.max=(...n)=>[Math.max(...n.map(t=>t[0])),Math.max(...n.map(t=>t[1]))];I.min=(...n)=>[Math.max(...n.map(t=>t[0])),Math.max(...n.map(t=>t[1]))];var ui=class{constructor(n=[]){this.points=[],this.lengths=[],this.totalLength=0,this.addPoint=t=>{if(this.prev){const e=I.dist(this.prev,t);this.lengths.push(e),this.totalLength+=e,this.points.push(t)}this.prev=t},this.clear=()=>{this.points=this.prev?[this.prev]:[],this.totalLength=0},this.getSplinePoint=t=>{const{points:e}=this,r=e.length-1,s=Math.trunc(t),a=Math.min(s+1,r),l=Math.min(a+1,r),f=Math.min(l+1,r),u=a-1,d=t-s,m=d*d,i=m*d,o=-i+2*m-d,c=3*i-5*m+2,_=-3*i+4*m+d,h=i-m;return[(e[u][0]*o+e[a][0]*c+e[l][0]*_+e[f][0]*h)/2,(e[u][1]*o+e[a][1]*c+e[l][1]*_+e[f][1]*h)/2]},this.points=n,this.lengths=n.map((t,e,r)=>e===0?0:I.dist(t,r[e-1])),this.totalLength=this.lengths.reduce((t,e)=>t+e,0)}},lt=class{constructor(n){this.state="idle",this.queue=[],this.timestamp=performance.now(),this.lastRequestId=0,this.timeoutId=0,this.spline=new ui,this.addPoint=t=>{clearTimeout(this.timeoutId);const e=performance.now(),r=Math.min(e-this.timestamp,lt.MAX_INTERVAL);if(!this.prevPoint){this.spline.clear(),this.prevPoint=t,this.spline.addPoint(t),this.cb(t),this.state="stopped";return}if(this.state==="stopped"){if(I.dist(this.prevPoint,t)<4){this.cb(t);return}this.spline.clear(),this.spline.addPoint(this.prevPoint),this.spline.addPoint(this.prevPoint),this.spline.addPoint(t),this.state="idle"}else this.spline.addPoint(t);if(r<16){this.prevPoint=t,this.timestamp=e,this.cb(t);return}const s={start:this.spline.points.length-3,from:this.prevPoint,to:t,duration:r};switch(this.prevPoint=t,this.timestamp=e,this.state){case"idle":{this.state="animating",this.animateNext(s);break}case"animating":{this.queue.push(s);break}}},this.animateNext=t=>{const e=performance.now(),r=()=>{const s=(performance.now()-e)/t.duration;if(s<=1&&this.spline.points.length>0){try{this.cb(this.spline.getSplinePoint(s+t.start))}catch(l){console.warn(l)}this.lastRequestId=requestAnimationFrame(r);return}const a=this.queue.shift();a?(this.state="animating",this.animateNext(a)):(this.state="idle",this.timeoutId=setTimeout(()=>{this.state="stopped"},lt.MAX_INTERVAL))};r()},this.dispose=()=>{clearTimeout(this.timeoutId)},this.cb=n}},Bn=lt;Bn.MAX_INTERVAL=300;function fi(n){let t,e,r,s,a,l=n[0].name+"",f;return{c(){t=R("div"),e=wt("svg"),r=wt("path"),s=V(),a=R("span"),f=H(l),this.h()},l(u){t=x(u,"DIV",{class:!0});var d=F(t);e=St(d,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,"stroke-width":!0,stroke:!0,fill:!0,"stroke-linecap":!0,"stroke-linejoin":!0,class:!0});var m=F(e);r=St(m,"path",{d:!0}),F(r).forEach(b),m.forEach(b),s=B(d),a=x(d,"SPAN",{class:!0});var i=F(a);f=G(i,l),i.forEach(b),d.forEach(b),this.h()},h(){j(r,"d","M7.904 17.563a1.2 1.2 0 0 0 2.228 .308l2.09 -3.093l4.907 4.907a1.067 1.067 0 0 0 1.509 0l1.047 -1.047a1.067 1.067 0 0 0 0 -1.509l-4.907 -4.907l3.113 -2.09a1.2 1.2 0 0 0 -.309 -2.228l-13.582 -3.904l3.904 13.563z"),j(e,"xmlns","http://www.w3.org/2000/svg"),j(e,"width","44"),j(e,"height","44"),j(e,"viewBox","0 0 24 24"),j(e,"stroke-width","1.5"),j(e,"stroke","#2c3e50"),j(e,"fill","white"),j(e,"stroke-linecap","round"),j(e,"stroke-linejoin","round"),j(e,"class","svelte-jg3id1"),j(a,"class","name svelte-jg3id1"),j(t,"class","cursor svelte-jg3id1")},m(u,d){A(u,t,d),O(t,e),O(e,r),O(t,s),O(t,a),O(a,f),n[3](t)},p(u,[d]){d&1&&l!==(l=u[0].name+"")&&re(f,l)},i:ne,o:ne,d(u){u&&b(t),n[3](null)}}}function di(n,t,e){let{position:r}=t,s,a;vn(()=>(e(2,s=new Bn(([f,u])=>{a.style.setProperty("translate",`${f}px ${u}px`)})),()=>{s==null||s.dispose()}));function l(f){ct[f?"unshift":"push"](()=>{a=f,e(1,a)})}return n.$$set=f=>{"position"in f&&e(0,r=f.position)},n.$$.update=()=>{n.$$.dirty&5&&(s==null||s.addPoint(r.position))},[r,a,s,l]}class _i extends ie{constructor(t){super(),se(this,t,di,fi,te,{position:0})}}function Lt(n,t,e){const r=n.slice();return r[9]=t[e],r}function Rt(n,t){let e,r,s;return r=new _i({props:{position:t[9]}}),{key:n,first:null,c(){e=le(),W(r.$$.fragment),this.h()},l(a){e=le(),N(r.$$.fragment,a),this.h()},h(){this.first=e},m(a,l){A(a,e,l),X(r,a,l),s=!0},p(a,l){t=a;const f={};l&4&&(f.position=t[9]),r.$set(f)},i(a){s||(T(r.$$.fragment,a),s=!0)},o(a){$(r.$$.fragment,a),s=!1},d(a){a&&b(e),U(r,a)}}}function pi(n){let t,e=[],r=new Map,s,a,l=z(n[2]);const f=u=>u[9].id;for(let u=0;u<l.length;u+=1){let d=Lt(n,l,u),m=f(d);r.set(m,e[u]=Rt(m,d))}return{c(){t=R("div");for(let u=0;u<e.length;u+=1)e[u].c();this.h()},l(u){t=x(u,"DIV",{class:!0});var d=F(t);for(let m=0;m<e.length;m+=1)e[m].l(d);d.forEach(b),this.h()},h(){j(t,"class","cursor-overlays svelte-1n4ax7h"),ut(()=>n[6].call(t))},m(u,d){A(u,t,d);for(let m=0;m<e.length;m+=1)e[m]&&e[m].m(t,null);s=yn(t,n[6].bind(t)),a=!0},p(u,[d]){d&4&&(l=z(u[2]),K(),e=Sn(e,d,f,1,u,l,r,t,wn,Rt,null,Lt),ee())},i(u){if(!a){for(let d=0;d<l.length;d+=1)T(e[d]);a=!0}},o(u){for(let d=0;d<e.length;d+=1)$(e[d]);a=!1},d(u){u&&b(t);for(let d=0;d<e.length;d+=1)e[d].d();s()}}}function hi(n,t,e){let r,s,{mousePositions:a={}}=t;const l=ge();let f=1,u=1;const d=C(l.machine.service,o=>o.context.users);J(n,d,o=>e(5,s=o));const m=(o,c)=>o.filter(_=>_.isConnected&&!!c[_.id]).map(_=>{const h=c[_.id];return{id:_.id,name:_.name,position:[h[0]*f,h[1]*u]}});function i(){f=this.clientWidth,u=this.clientHeight,e(0,f),e(1,u)}return n.$$set=o=>{"mousePositions"in o&&e(4,a=o.mousePositions)},n.$$.update=()=>{n.$$.dirty&48&&e(2,r=m(s,a))},[f,u,r,d,a,s,i]}class mi extends ie{constructor(t){super(),se(this,t,hi,pi,te,{mousePositions:4})}}function gi(n){const t=n-1;return t*t*t+1}function vi(n,{delay:t=0,duration:e=400,easing:r=Yn}={}){const s=+getComputedStyle(n).opacity;return{delay:t,duration:e,easing:r,css:a=>`opacity: ${a*s}`}}function yi(n,{delay:t=0,duration:e=400,easing:r=gi,start:s=0,opacity:a=0}={}){const l=getComputedStyle(n),f=+l.opacity,u=l.transform==="none"?"":l.transform,d=1-s,m=f*(1-a);return{delay:t,duration:e,easing:r,css:(i,o)=>`
			transform: ${u} scale(${1-d*o});
			opacity: ${f-m*o}
		`}}function xt(n,t,e){const r=n.slice();return r[10]=t[e],r}function Ft(n,t,e){const r=n.slice();return r[1]=t[e][0],r[10]=t[e][1],r}function Ht(n,t){let e,r,s=t[10].emoji+"",a,l,f,u=t[10].userName+"",d,m,i,o,c,_;function h(){return t[6](t[1])}return{key:n,first:null,c(){e=R("div"),r=R("span"),a=H(s),l=V(),f=R("span"),d=H(u),this.h()},l(v){e=x(v,"DIV",{class:!0});var p=F(e);r=x(p,"SPAN",{class:!0});var g=F(r);a=G(g,s),g.forEach(b),l=B(p),f=x(p,"SPAN",{class:!0});var y=F(f);d=G(y,u),y.forEach(b),p.forEach(b),this.h()},h(){j(r,"class","emjoi"),j(f,"class","name svelte-15c2n3p"),j(e,"class","displayed-emoji svelte-15c2n3p"),He(e,"--_x",t[10].position[0]),He(e,"--_y",t[10].position[1]),this.first=e},m(v,p){A(v,e,p),O(e,r),O(r,a),O(e,l),O(e,f),O(f,d),o=!0,c||(_=$e(e,"introend",h),c=!0)},p(v,p){t=v,(!o||p&1)&&s!==(s=t[10].emoji+"")&&re(a,s),(!o||p&1)&&u!==(u=t[10].userName+"")&&re(d,u),p&1&&He(e,"--_x",t[10].position[0]),p&1&&He(e,"--_y",t[10].position[1])},i(v){o||(v&&ut(()=>{o&&(i&&i.end(1),m=zn(e,yi,{duration:200,start:.4}),m.start())}),o=!0)},o(v){m&&m.invalidate(),v&&(i=Kn(e,vi,{})),o=!1},d(v){v&&b(e),v&&i&&i.end(),c=!1,_()}}}function Gt(n){let t,e=n[10]+"",r,s,a;function l(){return n[7](n[10])}return{c(){t=R("button"),r=H(e),this.h()},l(f){t=x(f,"BUTTON",{class:!0});var u=F(t);r=G(u,e),u.forEach(b),this.h()},h(){j(t,"class","emoji svelte-15c2n3p")},m(f,u){A(f,t,u),O(t,r),s||(a=$e(t,"click",l),s=!0)},p(f,u){n=f},d(f){f&&b(t),s=!1,a()}}}function bi(n){let t,e=[],r=new Map,s,a,l=z(Object.entries(n[0]));const f=m=>m[1];for(let m=0;m<l.length;m+=1){let i=Ft(n,l,m),o=f(i);r.set(o,e[m]=Ht(o,i))}let u=z(n[3]),d=[];for(let m=0;m<u.length;m+=1)d[m]=Gt(xt(n,u,m));return{c(){t=R("div");for(let m=0;m<e.length;m+=1)e[m].c();s=V();for(let m=0;m<d.length;m+=1)d[m].c();this.h()},l(m){t=x(m,"DIV",{class:!0});var i=F(t);for(let o=0;o<e.length;o+=1)e[o].l(i);s=B(i);for(let o=0;o<d.length;o+=1)d[o].l(i);i.forEach(b),this.h()},h(){j(t,"class","emojis svelte-15c2n3p")},m(m,i){A(m,t,i);for(let o=0;o<e.length;o+=1)e[o]&&e[o].m(t,null);O(t,s);for(let o=0;o<d.length;o+=1)d[o]&&d[o].m(t,null);a=!0},p(m,[i]){if(i&1&&(l=z(Object.entries(m[0])),K(),e=Sn(e,i,f,1,m,l,r,t,wn,Ht,s,Ft),ee()),i&24){u=z(m[3]);let o;for(o=0;o<u.length;o+=1){const c=xt(m,u,o);d[o]?d[o].p(c,i):(d[o]=Gt(c),d[o].c(),d[o].m(t,null))}for(;o<d.length;o+=1)d[o].d(1);d.length=u.length}},i(m){if(!a){for(let i=0;i<l.length;i+=1)T(e[i]);a=!0}},o(m){for(let i=0;i<e.length;i+=1)$(e[i]);a=!1},d(m){m&&b(t);for(let i=0;i<e.length;i+=1)e[i].d();De(d,m)}}}function wi(n,t,e){let r;const s=ge(),a=C(s.machine.service,c=>c.context.users);J(n,a,c=>e(8,r=c));const l=["","","","","",""],f=c=>{s.machine.send({type:"send emoji",emoji:c}),m({userId:s.userId,emoji:c})};let u={},d=0;const m=({userId:c,emoji:_})=>{var v;const h=((v=r.find(p=>p.id===c))==null?void 0:v.name)??"Unknown";e(0,u[`${e(1,d++,d)}`]={emoji:_,userName:h,position:[Math.random(),Math.random()]},u),e(0,u),e(1,d++,d)};return[u,d,a,l,f,m,c=>{setTimeout(()=>{delete u[c],e(0,u)},2e3)},c=>f(c)]}class Si extends ie{constructor(t){super(),se(this,t,wi,bi,te,{showEmoji:5})}get showEmoji(){return this.$$.ctx[5]}}const Ti=n=>({}),Vt=n=>({});function Ke(n){let t,e;const r=n[7].default,s=Se(r,n,n[6],null);let a=[{id:n[2]},{class:"h svelte-eb948l"}],l={};for(let f=0;f<a.length;f+=1)l=Zn(l,a[f]);return{c(){t=R(n[0]),s&&s.c(),this.h()},l(f){t=x(f,(n[0]||"null").toUpperCase(),{id:!0,class:!0});var u=F(t);s&&s.l(u),u.forEach(b),this.h()},h(){Tt(n[0])(t,l)},m(f,u){A(f,t,u),s&&s.m(t,null),e=!0},p(f,u){s&&s.p&&(!e||u&64)&&Te(s,r,f,f[6],e?Ae(r,f[6],u,null):ke(f[6]),null),Tt(f[0])(t,l=tr(a,[(!e||u&4)&&{id:f[2]},{class:"h svelte-eb948l"}]))},i(f){e||(T(s,f),e=!0)},o(f){$(s,f),e=!1},d(f){f&&b(t),s&&s.d(f)}}}function Bt(n){let t,e;const r=n[7].info,s=Se(r,n,n[6],Vt);return{c(){t=R("div"),s&&s.c(),this.h()},l(a){t=x(a,"DIV",{class:!0});var l=F(t);s&&s.l(l),l.forEach(b),this.h()},h(){j(t,"class","info svelte-eb948l")},m(a,l){A(a,t,l),s&&s.m(t,null),e=!0},p(a,l){s&&s.p&&(!e||l&64)&&Te(s,r,a,a[6],e?Ae(r,a[6],l,Ti):ke(a[6]),Vt)},i(a){e||(T(s,a),e=!0)},o(a){$(s,a),e=!1},d(a){a&&b(t),s&&s.d(a)}}}function ki(n){let t,e=n[0],r,s,a,l=n[0]&&Ke(n),f=n[5].info&&Bt(n);return{c(){t=R("div"),l&&l.c(),r=V(),f&&f.c(),this.h()},l(u){t=x(u,"DIV",{class:!0});var d=F(t);l&&l.l(d),r=B(d),f&&f.l(d),d.forEach(b),this.h()},h(){j(t,"class",s="heading size-"+n[1]+" svelte-eb948l"),be(t,"separator",n[3]),be(t,"centered",n[4])},m(u,d){A(u,t,d),l&&l.m(t,null),O(t,r),f&&f.m(t,null),a=!0},p(u,[d]){u[0]?e?te(e,u[0])?(l.d(1),l=Ke(u),e=u[0],l.c(),l.m(t,r)):l.p(u,d):(l=Ke(u),e=u[0],l.c(),l.m(t,r)):e&&(l.d(1),l=null,e=u[0]),u[5].info?f?(f.p(u,d),d&32&&T(f,1)):(f=Bt(u),f.c(),T(f,1),f.m(t,null)):f&&(K(),$(f,1,1,()=>{f=null}),ee()),(!a||d&2&&s!==(s="heading size-"+u[1]+" svelte-eb948l"))&&j(t,"class",s),(!a||d&10)&&be(t,"separator",u[3]),(!a||d&18)&&be(t,"centered",u[4])},i(u){a||(T(l,u),T(f),a=!0)},o(u){$(l,u),$(f),a=!1},d(u){u&&b(t),l&&l.d(u),f&&f.d()}}}function Ai(n,t,e){let{$$slots:r={},$$scope:s}=t;const a=Cn(r);let{size:l="md"}=t,{id:f=void 0}=t,{separator:u=!1}=t,{centered:d=!1}=t,{tag:m=void 0}=t;return m||(m={xl:"h1",lg:"h2",md:"h3",sm:"h4"}[l]),n.$$set=o=>{"size"in o&&e(1,l=o.size),"id"in o&&e(2,f=o.id),"separator"in o&&e(3,u=o.separator),"centered"in o&&e(4,d=o.centered),"tag"in o&&e(0,m=o.tag),"$$scope"in o&&e(6,s=o.$$scope)},[m,l,f,u,d,a,s,r]}class Ue extends ie{constructor(t){super(),se(this,t,Ai,ki,te,{size:1,id:2,separator:3,centered:4,tag:0})}}function qt(n,t,e){const r=n.slice();return r[16]=t[e],r}function $i(n){let t;return{c(){t=H("Einteilung in Teams")},l(e){t=G(e,"Einteilung in Teams")},m(e,r){A(e,t,r)},d(e){e&&b(t)}}}function Ii(n){let t;return{c(){t=H("Schritt 2 von 3")},l(e){t=G(e,"Schritt 2 von 3")},m(e,r){A(e,t,r)},d(e){e&&b(t)}}}function Wt(n){let t,e="(admin)";return{c(){t=R("span"),t.textContent=e,this.h()},l(r){t=x(r,"SPAN",{class:!0,"data-svelte-h":!0}),Qe(t)!=="svelte-16777ag"&&(t.textContent=e),this.h()},h(){j(t,"class","admin")},m(r,s){A(r,t,s)},d(r){r&&b(t)}}}function Nt(n){let t;function e(a,l){return a[16].side==="attacker"?Oi:Ei}let r=e(n),s=r(n);return{c(){t=R("span"),s.c(),this.h()},l(a){t=x(a,"SPAN",{class:!0});var l=F(t);s.l(l),l.forEach(b),this.h()},h(){j(t,"class","side svelte-1w8krv2")},m(a,l){A(a,t,l),s.m(t,null)},p(a,l){r!==(r=e(a))&&(s.d(1),s=r(a),s&&(s.c(),s.m(t,null)))},d(a){a&&b(t),s.d()}}}function Ei(n){let t;return{c(){t=H("Verteidigung")},l(e){t=G(e,"Verteidigung")},m(e,r){A(e,t,r)},d(e){e&&b(t)}}}function Oi(n){let t;return{c(){t=H("Angriff")},l(e){t=G(e,"Angriff")},m(e,r){A(e,t,r)},d(e){e&&b(t)}}}function Xt(n){let t,e,r,s;function a(){return n[12](n[16])}t=new Le({props:{$$slots:{default:[Mi]},$$scope:{ctx:n}}}),t.$on("click",a);function l(){return n[13](n[16])}return r=new Le({props:{$$slots:{default:[Pi]},$$scope:{ctx:n}}}),r.$on("click",l),{c(){W(t.$$.fragment),e=V(),W(r.$$.fragment)},l(f){N(t.$$.fragment,f),e=B(f),N(r.$$.fragment,f)},m(f,u){X(t,f,u),A(f,e,u),X(r,f,u),s=!0},p(f,u){n=f;const d={};u&524288&&(d.$$scope={dirty:u,ctx:n}),t.$set(d);const m={};u&524288&&(m.$$scope={dirty:u,ctx:n}),r.$set(m)},i(f){s||(T(t.$$.fragment,f),T(r.$$.fragment,f),s=!0)},o(f){$(t.$$.fragment,f),$(r.$$.fragment,f),s=!1},d(f){f&&b(e),U(t,f),U(r,f)}}}function Mi(n){let t;return{c(){t=H("Angriff")},l(e){t=G(e,"Angriff")},m(e,r){A(e,t,r)},d(e){e&&b(t)}}}function Pi(n){let t;return{c(){t=H("Verteidigung")},l(e){t=G(e,"Verteidigung")},m(e,r){A(e,t,r)},d(e){e&&b(t)}}}function Ut(n){let t,e;function r(){return n[14](n[16])}return t=new Le({props:{$$slots:{default:[ji]},$$scope:{ctx:n}}}),t.$on("click",r),{c(){W(t.$$.fragment)},l(s){N(t.$$.fragment,s)},m(s,a){X(t,s,a),e=!0},p(s,a){n=s;const l={};a&524288&&(l.$$scope={dirty:a,ctx:n}),t.$set(l)},i(s){e||(T(t.$$.fragment,s),e=!0)},o(s){$(t.$$.fragment,s),e=!1},d(s){U(t,s)}}}function ji(n){let t;return{c(){t=H("Toggle Admin")},l(e){t=G(e,"Toggle Admin")},m(e,r){A(e,t,r)},d(e){e&&b(t)}}}function Qt(n){let t,e=n[16].name+"",r,s,a,l,f,u,d,m=n[16].isAdmin&&Wt(),i=n[16].isSideAssigned&&Nt(n),o=n[1]&&Xt(n),c=n[2]&&n[16].id!==n[4]&&Ut(n);return{c(){t=R("div"),r=H(e),s=V(),m&&m.c(),a=V(),i&&i.c(),l=V(),o&&o.c(),f=V(),c&&c.c(),u=V(),this.h()},l(_){t=x(_,"DIV",{class:!0});var h=F(t);r=G(h,e),s=B(h),m&&m.l(h),a=B(h),i&&i.l(h),l=B(h),o&&o.l(h),f=B(h),c&&c.l(h),u=B(h),h.forEach(b),this.h()},h(){j(t,"class","user")},m(_,h){A(_,t,h),O(t,r),O(t,s),m&&m.m(t,null),O(t,a),i&&i.m(t,null),O(t,l),o&&o.m(t,null),O(t,f),c&&c.m(t,null),O(t,u),d=!0},p(_,h){(!d||h&1)&&e!==(e=_[16].name+"")&&re(r,e),_[16].isAdmin?m||(m=Wt(),m.c(),m.m(t,a)):m&&(m.d(1),m=null),_[16].isSideAssigned?i?i.p(_,h):(i=Nt(_),i.c(),i.m(t,l)):i&&(i.d(1),i=null),_[1]?o?(o.p(_,h),h&2&&T(o,1)):(o=Xt(_),o.c(),T(o,1),o.m(t,f)):o&&(K(),$(o,1,1,()=>{o=null}),ee()),_[2]&&_[16].id!==_[4]?c?(c.p(_,h),h&5&&T(c,1)):(c=Ut(_),c.c(),T(c,1),c.m(t,u)):c&&(K(),$(c,1,1,()=>{c=null}),ee())},i(_){d||(T(o),T(c),d=!0)},o(_){$(o),$(c),d=!1},d(_){_&&b(t),m&&m.d(),i&&i.d(),o&&o.d(),c&&c.d()}}}function Jt(n){let t,e;return t=new Le({props:{$$slots:{default:[Di]},$$scope:{ctx:n}}}),t.$on("click",n[15]),{c(){W(t.$$.fragment)},l(r){N(t.$$.fragment,r)},m(r,s){X(t,r,s),e=!0},p(r,s){const a={};s&524288&&(a.$$scope={dirty:s,ctx:r}),t.$set(a)},i(r){e||(T(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){U(t,r)}}}function Di(n){let t;return{c(){t=H("Next")},l(e){t=G(e,"Next")},m(e,r){A(e,t,r)},d(e){e&&b(t)}}}function Li(n){let t,e,r,s=`Gleich gehts los. Sobald alle Teilnehmende sich eingeloggt haben, kann die Spielleitung alle in
  Teams einteilen.`,a,l,f,u,d;t=new Ue({props:{separator:!0,$$slots:{info:[Ii],default:[$i]},$$scope:{ctx:n}}});let m=z(n[0]),i=[];for(let _=0;_<m.length;_+=1)i[_]=Qt(qt(n,m,_));const o=_=>$(i[_],1,1,()=>{i[_]=null});let c=n[3]&&Jt(n);return{c(){W(t.$$.fragment),e=V(),r=R("p"),r.textContent=s,a=V(),l=R("div");for(let _=0;_<i.length;_+=1)i[_].c();f=V(),c&&c.c(),u=le(),this.h()},l(_){N(t.$$.fragment,_),e=B(_),r=x(_,"P",{"data-svelte-h":!0}),Qe(r)!=="svelte-ugtca6"&&(r.textContent=s),a=B(_),l=x(_,"DIV",{class:!0});var h=F(l);for(let v=0;v<i.length;v+=1)i[v].l(h);h.forEach(b),f=B(_),c&&c.l(_),u=le(),this.h()},h(){j(l,"class","users svelte-1w8krv2")},m(_,h){X(t,_,h),A(_,e,h),A(_,r,h),A(_,a,h),A(_,l,h);for(let v=0;v<i.length;v+=1)i[v]&&i[v].m(l,null);A(_,f,h),c&&c.m(_,h),A(_,u,h),d=!0},p(_,[h]){const v={};if(h&524288&&(v.$$scope={dirty:h,ctx:_}),t.$set(v),h&3095){m=z(_[0]);let p;for(p=0;p<m.length;p+=1){const g=qt(_,m,p);i[p]?(i[p].p(g,h),T(i[p],1)):(i[p]=Qt(g),i[p].c(),T(i[p],1),i[p].m(l,null))}for(K(),p=m.length;p<i.length;p+=1)o(p);ee()}_[3]?c?(c.p(_,h),h&8&&T(c,1)):(c=Jt(_),c.c(),T(c,1),c.m(u.parentNode,u)):c&&(K(),$(c,1,1,()=>{c=null}),ee())},i(_){if(!d){T(t.$$.fragment,_);for(let h=0;h<m.length;h+=1)T(i[h]);T(c),d=!0}},o(_){$(t.$$.fragment,_),i=i.filter(Boolean);for(let h=0;h<i.length;h+=1)$(i[h]);$(c),d=!1},d(_){_&&(b(e),b(r),b(a),b(l),b(f),b(u)),U(t,_),De(i,_),c&&c.d(_)}}}function Ri(n,t,e){let r,s,a,l;const{userId:f,machine:u}=ge(),d=C(u.service,y=>y.can({type:"assign side",otherUserId:"",side:"attacker"}));J(n,d,y=>e(1,s=y));const m=C(u.service,y=>y.can({type:"assign admin",otherUserId:"",isAdmin:!0}));J(n,m,y=>e(2,a=y));const i=C(u.service,y=>y.can({type:"next step"}));J(n,i,y=>e(3,l=y));const o=C(u.service,y=>y.context.users);J(n,o,y=>e(0,r=y));const c=(y,w)=>{u.send({type:"assign side",otherUserId:y,side:w})},_=(y,w)=>{u.send({type:"assign admin",otherUserId:y,isAdmin:w})};return[r,s,a,l,f,u,d,m,i,o,c,_,y=>c(y.id,"attacker"),y=>c(y.id,"defender"),y=>_(y.id,!y.isAdmin),()=>u.send({type:"next step"})]}class xi extends ie{constructor(t){super(),se(this,t,Ri,Li,te,{})}}function Fi(n){let t,e,r;const s=n[2].default,a=Se(s,n,n[1],null);return{c(){t=R("p"),a&&a.c(),this.h()},l(l){t=x(l,"P",{class:!0});var f=F(t);a&&a.l(f),f.forEach(b),this.h()},h(){j(t,"class",e="size-"+n[0]+" svelte-de2sr5")},m(l,f){A(l,t,f),a&&a.m(t,null),r=!0},p(l,[f]){a&&a.p&&(!r||f&2)&&Te(a,s,l,l[1],r?Ae(s,l[1],f,null):ke(l[1]),null),(!r||f&1&&e!==(e="size-"+l[0]+" svelte-de2sr5"))&&j(t,"class",e)},i(l){r||(T(a,l),r=!0)},o(l){$(a,l),r=!1},d(l){l&&b(t),a&&a.d(l)}}}function Hi(n,t,e){let{$$slots:r={},$$scope:s}=t,{size:a="md"}=t;return n.$$set=l=>{"size"in l&&e(0,a=l.size),"$$scope"in l&&e(1,s=l.$$scope)},[a,s,r]}class Yt extends ie{constructor(t){super(),se(this,t,Hi,Fi,te,{size:0})}}const Ct={man:"man",woman:"woman",other:"other"},Gi=n=>n!=="attacker";function Zt(n,t,e){const r=n.slice();return r[18]=t[e][0],r[19]=t[e][1],r}function zt(n,t,e){const r=n.slice();return r[22]=t[e],r}function Kt(n){let t,e=n[22].name+"",r,s;return{c(){t=R("option"),r=H(e),this.h()},l(a){t=x(a,"OPTION",{});var l=F(t);r=G(l,e),l.forEach(b),this.h()},h(){t.__value=s=n[22].id,nt(t,t.__value)},m(a,l){A(a,t,l),O(t,r)},p(a,l){l&8&&e!==(e=a[22].name+"")&&re(r,e),l&8&&s!==(s=a[22].id)&&(t.__value=s,nt(t,t.__value))},d(a){a&&b(t)}}}function en(n){let t,e=n[19]+"",r,s,a,l;function f(){return n[14](n[18])}return{c(){t=R("button"),r=H(e),this.h()},l(u){t=x(u,"BUTTON",{class:!0});var d=F(t);r=G(d,e),d.forEach(b),this.h()},h(){t.disabled=s=!n[2],j(t,"class","face svelte-u0xhbm"),be(t,"active",n[18]===n[1])},m(u,d){A(u,t,d),O(t,r),a||(l=$e(t,"click",f),a=!0)},p(u,d){n=u,d&4&&s!==(s=!n[2])&&(t.disabled=s),d&2&&be(t,"active",n[18]===n[1])},d(u){u&&b(t),a=!1,l()}}}function Vi(n){let t,e,r,s="--PLEASE SELECT--",a,l,f,u,d,m,i,o,c,_=z(n[3]),h=[];for(let g=0;g<_.length;g+=1)h[g]=Kt(zt(n,_,g));let v=z(Object.entries(Ct)),p=[];for(let g=0;g<v.length;g+=1)p[g]=en(Zt(n,v,g));return{c(){t=R("div"),e=R("select"),r=R("option"),r.textContent=s;for(let g=0;g<h.length;g+=1)h[g].c();l=V(),f=R("div");for(let g=0;g<p.length;g+=1)p[g].c();u=V(),d=R("button"),m=H("Close"),this.h()},l(g){t=x(g,"DIV",{class:!0});var y=F(t);e=x(y,"SELECT",{});var w=F(e);r=x(w,"OPTION",{"data-svelte-h":!0}),Qe(r)!=="svelte-108q7wa"&&(r.textContent=s);for(let k=0;k<h.length;k+=1)h[k].l(w);w.forEach(b),l=B(y),f=x(y,"DIV",{class:!0});var S=F(f);for(let k=0;k<p.length;k+=1)p[k].l(S);S.forEach(b),u=B(y),d=x(y,"BUTTON",{});var P=F(d);m=G(P,"Close"),P.forEach(b),y.forEach(b),this.h()},h(){r.__value="",nt(r,r.__value),e.disabled=a=!n[2],j(f,"class","faces svelte-u0xhbm"),d.disabled=i=!n[2],j(t,"class","configurator svelte-u0xhbm")},m(g,y){A(g,t,y),O(t,e),O(e,r);for(let w=0;w<h.length;w+=1)h[w]&&h[w].m(e,null);kt(e,n[0]),O(t,l),O(t,f);for(let w=0;w<p.length;w+=1)p[w]&&p[w].m(f,null);O(t,u),O(t,d),O(d,m),o||(c=[$e(e,"input",n[13]),$e(d,"click",n[15])],o=!0)},p(g,[y]){if(y&8){_=z(g[3]);let w;for(w=0;w<_.length;w+=1){const S=zt(g,_,w);h[w]?h[w].p(S,y):(h[w]=Kt(S),h[w].c(),h[w].m(e,null))}for(;w<h.length;w+=1)h[w].d(1);h.length=_.length}if(y&4&&a!==(a=!g[2])&&(e.disabled=a),y&9&&kt(e,g[0]),y&518){v=z(Object.entries(Ct));let w;for(w=0;w<v.length;w+=1){const S=Zt(g,v,w);p[w]?p[w].p(S,y):(p[w]=en(S),p[w].c(),p[w].m(f,null))}for(;w<p.length;w+=1)p[w].d(1);p.length=v.length}y&4&&i!==(i=!g[2])&&(d.disabled=i)},i:ne,o:ne,d(g){g&&b(t),De(h,g),De(p,g),o=!1,gn(c)}}}function Bi(n,t,e){let r,s,a,l,f,u,{playerId:d}=t;const m=Gi(d)?"defender":"attacker",{machine:i}=ge(),o=C(i.service,({context:S})=>m==="attacker"?S.attack.attacker:S.defense.defenders[d]);J(n,o,S=>e(12,l=S));const c=C(i.service,({context:S})=>S.users.filter(P=>P.side===m));J(n,c,S=>e(3,u=S));const _=C(i.service,S=>S.can({type:"assign role",role:a,playerId:d,playingUserId:r,face:s}));J(n,_,S=>e(2,f=S));const h=()=>{i.send({type:"assign role",role:a,playerId:d,playingUserId:r,face:s})},v=S=>{e(1,s=S),h()},p=S=>{S&&(e(0,r=S),h())},g=S=>p(S.currentTarget.value),y=S=>v(S),w=()=>i.send({type:"stop editing player",side:m});return n.$$set=S=>{"playerId"in S&&e(11,d=S.playerId)},n.$$.update=()=>{n.$$.dirty&4096&&e(0,r=l.userId),n.$$.dirty&4096&&e(1,s=l.face),n.$$.dirty&4096&&(a=l.role)},[r,s,f,u,m,i,o,c,_,v,p,d,l,g,y,w]}class qi extends ie{constructor(t){super(),se(this,t,Bi,Vi,te,{playerId:11})}}function tn(n,t,e){const r=n.slice();return r[14]=t[e],r[16]=e,r}function Wi(n){let t;return{c(){t=H("Rollenverteilung")},l(e){t=G(e,"Rollenverteilung")},m(e,r){A(e,t,r)},d(e){e&&b(t)}}}function Ni(n){let t;return{c(){t=H("Schritt 3 von 3")},l(e){t=G(e,"Schritt 3 von 3")},m(e,r){A(e,t,r)},d(e){e&&b(t)}}}function Xi(n){let t;return{c(){t=H("Die Rollenverteilung wird von der Spielleitung bernommen.")},l(e){t=G(e,"Die Rollenverteilung wird von der Spielleitung bernommen.")},m(e,r){A(e,t,r)},d(e){e&&b(t)}}}function Ui(n){let t=n[0]==="attacker"?"Angriff":"Verteidigung",e;return{c(){e=H(t)},l(r){e=G(r,t)},m(r,s){A(r,e,s)},p(r,s){s&1&&t!==(t=r[0]==="attacker"?"Angriff":"Verteidigung")&&re(e,t)},d(r){r&&b(e)}}}function Qi(n){let t;return{c(){t=H(`Es mssen fr jede Rolle ein:e Spieler:in bestimmt und besttigt werden. Die restlichen
    Teilnehmenden knnen das Spielgeschehen beobachten und das Team beraten.`)},l(e){t=G(e,`Es mssen fr jede Rolle ein:e Spieler:in bestimmt und besttigt werden. Die restlichen
    Teilnehmenden knnen das Spielgeschehen beobachten und das Team beraten.`)},m(e,r){A(e,t,r)},d(e){e&&b(t)}}}function nn(n){var f;let t,e,r=((f=n[2].find(l))==null?void 0:f.name)+"",s,a;t=new Ue({props:{centered:!0,size:"sm",$$slots:{default:[Ji]},$$scope:{ctx:n}}});function l(...u){return n[12](n[14],...u)}return{c(){W(t.$$.fragment),e=V(),s=H(r)},l(u){N(t.$$.fragment,u),e=B(u),s=G(u,r)},m(u,d){X(t,u,d),A(u,e,d),A(u,s,d),a=!0},p(u,d){var i;n=u;const m={};d&131074&&(m.$$scope={dirty:d,ctx:n}),t.$set(m),(!a||d&6)&&r!==(r=((i=n[2].find(l))==null?void 0:i.name)+"")&&re(s,r)},i(u){a||(T(t.$$.fragment,u),a=!0)},o(u){$(t.$$.fragment,u),a=!1},d(u){u&&(b(e),b(s)),U(t,u)}}}function Ji(n){let t=n[14].role+"",e;return{c(){e=H(t)},l(r){e=G(r,t)},m(r,s){A(r,e,s)},p(r,s){s&2&&t!==(t=r[14].role+"")&&re(e,t)},d(r){r&&b(e)}}}function Yi(n){let t,e=n[14].isConfigured?"wechseln":`${n[16]+1} bestimmen`,r;return{c(){t=H("Rolle "),r=H(e)},l(s){t=G(s,"Rolle "),r=G(s,e)},m(s,a){A(s,t,a),A(s,r,a)},p(s,a){a&2&&e!==(e=s[14].isConfigured?"wechseln":`${s[16]+1} bestimmen`)&&re(r,e)},d(s){s&&(b(t),b(r))}}}function rn(n){let t,e,r,s,a,l=n[14].isConfigured&&nn(n);function f(){return n[13](n[16])}return r=new Le({props:{size:"small",disabled:!n[3],$$slots:{default:[Yi]},$$scope:{ctx:n}}}),r.$on("click",f),{c(){t=R("div"),l&&l.c(),e=V(),W(r.$$.fragment),s=V(),this.h()},l(u){t=x(u,"DIV",{class:!0});var d=F(t);l&&l.l(d),e=B(d),N(r.$$.fragment,d),s=B(d),d.forEach(b),this.h()},h(){j(t,"class","player svelte-11fuvol")},m(u,d){A(u,t,d),l&&l.m(t,null),O(t,e),X(r,t,null),O(t,s),a=!0},p(u,d){n=u,n[14].isConfigured?l?(l.p(n,d),d&2&&T(l,1)):(l=nn(n),l.c(),T(l,1),l.m(t,e)):l&&(K(),$(l,1,1,()=>{l=null}),ee());const m={};d&8&&(m.disabled=!n[3]),d&131074&&(m.$$scope={dirty:d,ctx:n}),r.$set(m)},i(u){a||(T(l),T(r.$$.fragment,u),a=!0)},o(u){$(l),$(r.$$.fragment,u),a=!1},d(u){u&&b(t),l&&l.d(),U(r)}}}function sn(n){let t=n[4],e,r,s=on(n);return{c(){s.c(),e=le()},l(a){s.l(a),e=le()},m(a,l){s.m(a,l),A(a,e,l),r=!0},p(a,l){l&16&&te(t,t=a[4])?(K(),$(s,1,1,ne),ee(),s=on(a),s.c(),T(s,1),s.m(e.parentNode,e)):s.p(a,l)},i(a){r||(T(s),r=!0)},o(a){$(s),r=!1},d(a){a&&b(e),s.d(a)}}}function on(n){let t,e;return t=new qi({props:{playerId:n[4]}}),{c(){W(t.$$.fragment)},l(r){N(t.$$.fragment,r)},m(r,s){X(t,r,s),e=!0},p(r,s){const a={};s&16&&(a.playerId=r[4]),t.$set(a)},i(r){e||(T(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){U(t,r)}}}function Ci(n){let t,e,r,s,a,l,f,u,d,m,i,o,c;t=new Ue({props:{separator:!0,$$slots:{info:[Ni],default:[Wi]},$$scope:{ctx:n}}}),r=new Yt({props:{$$slots:{default:[Xi]},$$scope:{ctx:n}}}),l=new Ue({props:{centered:!0,$$slots:{default:[Ui]},$$scope:{ctx:n}}}),u=new Yt({props:{$$slots:{default:[Qi]},$$scope:{ctx:n}}});let _=z(n[1]),h=[];for(let g=0;g<_.length;g+=1)h[g]=rn(tn(n,_,g));const v=g=>$(h[g],1,1,()=>{h[g]=null});let p=n[4]!==void 0&&sn(n);return{c(){W(t.$$.fragment),e=V(),W(r.$$.fragment),s=V(),a=R("section"),W(l.$$.fragment),f=V(),W(u.$$.fragment),d=V(),m=R("div");for(let g=0;g<h.length;g+=1)h[g].c();i=V(),p&&p.c(),o=le(),this.h()},l(g){N(t.$$.fragment,g),e=B(g),N(r.$$.fragment,g),s=B(g),a=x(g,"SECTION",{class:!0});var y=F(a);N(l.$$.fragment,y),f=B(y),N(u.$$.fragment,y),d=B(y),m=x(y,"DIV",{class:!0});var w=F(m);for(let S=0;S<h.length;S+=1)h[S].l(w);w.forEach(b),y.forEach(b),i=B(g),p&&p.l(g),o=le(),this.h()},h(){j(m,"class","players svelte-11fuvol"),j(a,"class","svelte-11fuvol")},m(g,y){X(t,g,y),A(g,e,y),X(r,g,y),A(g,s,y),A(g,a,y),X(l,a,null),O(a,f),X(u,a,null),O(a,d),O(a,m);for(let w=0;w<h.length;w+=1)h[w]&&h[w].m(m,null);A(g,i,y),p&&p.m(g,y),A(g,o,y),c=!0},p(g,[y]){const w={};y&131072&&(w.$$scope={dirty:y,ctx:g}),t.$set(w);const S={};y&131072&&(S.$$scope={dirty:y,ctx:g}),r.$set(S);const P={};y&131073&&(P.$$scope={dirty:y,ctx:g}),l.$set(P);const k={};if(y&131072&&(k.$$scope={dirty:y,ctx:g}),u.$set(k),y&1071){_=z(g[1]);let D;for(D=0;D<_.length;D+=1){const E=tn(g,_,D);h[D]?(h[D].p(E,y),T(h[D],1)):(h[D]=rn(E),h[D].c(),T(h[D],1),h[D].m(m,null))}for(K(),D=_.length;D<h.length;D+=1)v(D);ee()}g[4]!==void 0?p?(p.p(g,y),y&16&&T(p,1)):(p=sn(g),p.c(),T(p,1),p.m(o.parentNode,o)):p&&(K(),$(p,1,1,()=>{p=null}),ee())},i(g){if(!c){T(t.$$.fragment,g),T(r.$$.fragment,g),T(l.$$.fragment,g),T(u.$$.fragment,g);for(let y=0;y<_.length;y+=1)T(h[y]);T(p),c=!0}},o(g){$(t.$$.fragment,g),$(r.$$.fragment,g),$(l.$$.fragment,g),$(u.$$.fragment,g),h=h.filter(Boolean);for(let y=0;y<h.length;y+=1)$(h[y]);$(p),c=!1},d(g){g&&(b(e),b(s),b(a),b(i),b(o)),U(t,g),U(r,g),U(l),U(u),De(h,g),p&&p.d(g)}}}function Zi(n,t,e){let r,s,a,l,f;const{machine:u}=ge(),d=C(u.service,({context:p})=>{const{side:g}=Be(p);return g});J(n,d,p=>e(0,r=p));const m=C(u.service,({context:p})=>(r==="attacker"?p.attack:p.defense).editingPlayer);J(n,m,p=>e(4,f=p));const i=C(u.service,({context:p})=>r==="attacker"?[p.attack.attacker]:p.defense.defenders);J(n,i,p=>e(1,s=p));const o=C(u.service,p=>p.can({type:"start editing player",playerId:1}));J(n,o,p=>e(3,l=p));const c=p=>p,_=C(u.service,({context:p})=>p.users);return J(n,_,p=>e(2,a=p)),[r,s,a,l,f,u,d,m,i,o,c,_,(p,g)=>g.id===p.userId,p=>u.send({type:"start editing player",playerId:r==="attacker"?"attacker":c(p)})]}class zi extends ie{constructor(t){super(),se(this,t,Zi,Ci,te,{})}}function Ki(n){let t;return{c(){t=H("Unknown state")},l(e){t=G(e,"Unknown state")},m(e,r){A(e,t,r)},i:ne,o:ne,d(e){e&&b(t)}}}function es(n){let t;return{c(){t=H("Waiting for other side")},l(e){t=G(e,"Waiting for other side")},m(e,r){A(e,t,r)},i:ne,o:ne,d(e){e&&b(t)}}}function ts(n){let t,e;return t=new zi({}),{c(){W(t.$$.fragment)},l(r){N(t.$$.fragment,r)},m(r,s){X(t,r,s),e=!0},i(r){e||(T(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){U(t,r)}}}function ns(n){let t,e;return t=new xi({}),{c(){W(t.$$.fragment)},l(r){N(t.$$.fragment,r)},m(r,s){X(t,r,s),e=!0},i(r){e||(T(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){U(t,r)}}}function rs(n){let t,e,r,s;const a=[ns,ts,es,Ki],l=[];function f(u,d){return u[0]==="Assigning sides"?0:u[0]==="Assigning roles"?1:u[0]==="Waiting for other side"?2:3}return t=f(n),e=l[t]=a[t](n),{c(){e.c(),r=le()},l(u){e.l(u),r=le()},m(u,d){l[t].m(u,d),A(u,r,d),s=!0},p(u,[d]){let m=t;t=f(u),t!==m&&(K(),$(l[m],1,1,()=>{l[m]=null}),ee(),e=l[t],e||(e=l[t]=a[t](u),e.c()),T(e,1),e.m(r.parentNode,r))},i(u){s||(T(e),s=!0)},o(u){$(e),s=!1},d(u){u&&b(r),l[t].d(u)}}}function is(n,t,e){let r;const{machine:s}=ge(),a=C(s.service,l=>{let f;return l.matches("Lobby.Assigning sides")?f="Assigning sides":l.matches("Lobby.Assigning roles")?f="Assigning roles":l.matches("Lobby.Waiting for other side")&&(f="Waiting for other side"),f});return J(n,a,l=>e(0,r=l)),[r,a]}class ss extends ie{constructor(t){super(),se(this,t,is,rs,te,{})}}const os=n=>({}),an=n=>({}),as=n=>({}),ln=n=>({}),ls=n=>({}),cn=n=>({});function cs(n){let t;return{c(){t=H("...")},l(e){t=G(e,"...")},m(e,r){A(e,t,r)},i:ne,o:ne,d(e){e&&b(t)}}}function us(n){let t,e;return t=new ss({}),{c(){W(t.$$.fragment)},l(r){N(t.$$.fragment,r)},m(r,s){X(t,r,s),e=!0},i(r){e||(T(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){U(t,r)}}}function fs(n){let t,e,r,s="The Hidden Threat",a,l,f,u,d,m,i,o,c,_,h,v,p,g,y;const w=n[8].items,S=Se(w,n,n[7],cn),P=n[8].actions,k=Se(P,n,n[7],ln),D=[us,cs],E=[];function oe(L,q){return L[3]==="Lobby"?0:1}c=oe(n),_=E[c]=D[c](n);const ve=n[8]["cursor-overlays"],Z=Se(ve,n,n[7],an);return{c(){t=R("div"),e=R("div"),r=R("div"),r.textContent=s,a=V(),l=R("div"),f=V(),u=R("div"),S&&S.c(),d=V(),m=R("div"),k&&k.c(),i=V(),o=R("div"),_.c(),h=V(),Z&&Z.c(),this.h()},l(L){t=x(L,"DIV",{class:!0});var q=F(t);e=x(q,"DIV",{class:!0});var Q=F(e);r=x(Q,"DIV",{class:!0,"data-svelte-h":!0}),Qe(r)!=="svelte-iqe0dn"&&(r.textContent=s),a=B(Q),l=x(Q,"DIV",{class:!0}),F(l).forEach(b),f=B(Q),u=x(Q,"DIV",{class:!0});var vt=F(u);S&&S.l(vt),vt.forEach(b),d=B(Q),m=x(Q,"DIV",{class:!0});var yt=F(m);k&&k.l(yt),yt.forEach(b),i=B(Q),o=x(Q,"DIV",{class:!0});var bt=F(o);_.l(bt),bt.forEach(b),h=B(Q),Z&&Z.l(Q),Q.forEach(b),q.forEach(b),this.h()},h(){j(r,"class","name svelte-k0wvqu"),j(l,"class","characters svelte-k0wvqu"),j(u,"class","items svelte-k0wvqu"),j(m,"class","actions svelte-k0wvqu"),j(o,"class","content svelte-k0wvqu"),j(e,"class","game svelte-k0wvqu"),ut(()=>n[10].call(e)),j(t,"class","game-wrapper svelte-k0wvqu")},m(L,q){A(L,t,q),O(t,e),O(e,r),O(e,a),O(e,l),O(e,f),O(e,u),S&&S.m(u,null),O(e,d),O(e,m),k&&k.m(m,null),O(e,i),O(e,o),E[c].m(o,null),O(e,h),Z&&Z.m(e,null),n[9](e),v=yn(e,n[10].bind(e)),p=!0,g||(y=$e(e,"mousemove",n[4]),g=!0)},p(L,[q]){S&&S.p&&(!p||q&128)&&Te(S,w,L,L[7],p?Ae(w,L[7],q,ls):ke(L[7]),cn),k&&k.p&&(!p||q&128)&&Te(k,P,L,L[7],p?Ae(P,L[7],q,as):ke(L[7]),ln);let Q=c;c=oe(L),c!==Q&&(K(),$(E[Q],1,1,()=>{E[Q]=null}),ee(),_=E[c],_||(_=E[c]=D[c](L),_.c()),T(_,1),_.m(o,null)),Z&&Z.p&&(!p||q&128)&&Te(Z,ve,L,L[7],p?Ae(ve,L[7],q,os):ke(L[7]),an)},i(L){p||(T(S,L),T(k,L),T(_),T(Z,L),p=!0)},o(L){$(S,L),$(k,L),$(_),$(Z,L),p=!1},d(L){L&&b(t),S&&S.d(L),k&&k.d(L),E[c].d(),Z&&Z.d(L),n[9](null),v(),g=!1,y()}}}function ds(n,t,e){let r,{$$slots:s={},$$scope:a}=t;const{machine:l}=ge();let{reportMousePosition:f}=t,u,d=1,m=1;const i=h=>{const v=window.matchMedia("(width < 1200px) or (height < 675px)").matches?.6:window.matchMedia("(width < 1200px) or (height < 675px)").matches?.8:1,p=(h.clientX-u.offsetLeft)/d,g=(h.clientY-u.offsetTop)/m;f([(p-(1-v)/2)/v,(g-(1-v)/2)/v])},o=C(l.service,h=>{let v;return h.matches("Lobby")&&(v="Lobby"),v});J(n,o,h=>e(3,r=h));function c(h){ct[h?"unshift":"push"](()=>{u=h,e(0,u)})}function _(){d=this.clientWidth,m=this.clientHeight,e(1,d),e(2,m)}return n.$$set=h=>{"reportMousePosition"in h&&e(6,f=h.reportMousePosition),"$$scope"in h&&e(7,a=h.$$scope)},[u,d,m,r,i,o,f,a,s,c,_]}class _s extends ie{constructor(t){super(),se(this,t,ds,fs,te,{reportMousePosition:6})}}var ce=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ps(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var qn={};/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(n){(function(){var t=function(){this.init()};t.prototype={init:function(){var i=this||e;return i._counter=1e3,i._html5AudioPool=[],i.html5PoolSize=10,i._codecs={},i._howls=[],i._muted=!1,i._volume=1,i._canPlayEvent="canplaythrough",i._navigator=typeof window<"u"&&window.navigator?window.navigator:null,i.masterGain=null,i.noAudio=!1,i.usingWebAudio=!0,i.autoSuspend=!0,i.ctx=null,i.autoUnlock=!0,i._setup(),i},volume:function(i){var o=this||e;if(i=parseFloat(i),o.ctx||m(),typeof i<"u"&&i>=0&&i<=1){if(o._volume=i,o._muted)return o;o.usingWebAudio&&o.masterGain.gain.setValueAtTime(i,e.ctx.currentTime);for(var c=0;c<o._howls.length;c++)if(!o._howls[c]._webAudio)for(var _=o._howls[c]._getSoundIds(),h=0;h<_.length;h++){var v=o._howls[c]._soundById(_[h]);v&&v._node&&(v._node.volume=v._volume*i)}return o}return o._volume},mute:function(i){var o=this||e;o.ctx||m(),o._muted=i,o.usingWebAudio&&o.masterGain.gain.setValueAtTime(i?0:o._volume,e.ctx.currentTime);for(var c=0;c<o._howls.length;c++)if(!o._howls[c]._webAudio)for(var _=o._howls[c]._getSoundIds(),h=0;h<_.length;h++){var v=o._howls[c]._soundById(_[h]);v&&v._node&&(v._node.muted=i?!0:v._muted)}return o},stop:function(){for(var i=this||e,o=0;o<i._howls.length;o++)i._howls[o].stop();return i},unload:function(){for(var i=this||e,o=i._howls.length-1;o>=0;o--)i._howls[o].unload();return i.usingWebAudio&&i.ctx&&typeof i.ctx.close<"u"&&(i.ctx.close(),i.ctx=null,m()),i},codecs:function(i){return(this||e)._codecs[i.replace(/^x-/,"")]},_setup:function(){var i=this||e;if(i.state=i.ctx&&i.ctx.state||"suspended",i._autoSuspend(),!i.usingWebAudio)if(typeof Audio<"u")try{var o=new Audio;typeof o.oncanplaythrough>"u"&&(i._canPlayEvent="canplay")}catch{i.noAudio=!0}else i.noAudio=!0;try{var o=new Audio;o.muted&&(i.noAudio=!0)}catch{}return i.noAudio||i._setupCodecs(),i},_setupCodecs:function(){var i=this||e,o=null;try{o=typeof Audio<"u"?new Audio:null}catch{return i}if(!o||typeof o.canPlayType!="function")return i;var c=o.canPlayType("audio/mpeg;").replace(/^no$/,""),_=i._navigator?i._navigator.userAgent:"",h=_.match(/OPR\/([0-6].)/g),v=h&&parseInt(h[0].split("/")[1],10)<33,p=_.indexOf("Safari")!==-1&&_.indexOf("Chrome")===-1,g=_.match(/Version\/(.*?) /),y=p&&g&&parseInt(g[1],10)<15;return i._codecs={mp3:!!(!v&&(c||o.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!c,opus:!!o.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(o.canPlayType('audio/wav; codecs="1"')||o.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!o.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!o.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(o.canPlayType("audio/x-m4a;")||o.canPlayType("audio/m4a;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(o.canPlayType("audio/x-m4b;")||o.canPlayType("audio/m4b;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(o.canPlayType("audio/x-mp4;")||o.canPlayType("audio/mp4;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!y&&o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!y&&o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!o.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(o.canPlayType("audio/x-flac;")||o.canPlayType("audio/flac;")).replace(/^no$/,"")},i},_unlockAudio:function(){var i=this||e;if(!(i._audioUnlocked||!i.ctx)){i._audioUnlocked=!1,i.autoUnlock=!1,!i._mobileUnloaded&&i.ctx.sampleRate!==44100&&(i._mobileUnloaded=!0,i.unload()),i._scratchBuffer=i.ctx.createBuffer(1,1,22050);var o=function(c){for(;i._html5AudioPool.length<i.html5PoolSize;)try{var _=new Audio;_._unlocked=!0,i._releaseHtml5Audio(_)}catch{i.noAudio=!0;break}for(var h=0;h<i._howls.length;h++)if(!i._howls[h]._webAudio)for(var v=i._howls[h]._getSoundIds(),p=0;p<v.length;p++){var g=i._howls[h]._soundById(v[p]);g&&g._node&&!g._node._unlocked&&(g._node._unlocked=!0,g._node.load())}i._autoResume();var y=i.ctx.createBufferSource();y.buffer=i._scratchBuffer,y.connect(i.ctx.destination),typeof y.start>"u"?y.noteOn(0):y.start(0),typeof i.ctx.resume=="function"&&i.ctx.resume(),y.onended=function(){y.disconnect(0),i._audioUnlocked=!0,document.removeEventListener("touchstart",o,!0),document.removeEventListener("touchend",o,!0),document.removeEventListener("click",o,!0),document.removeEventListener("keydown",o,!0);for(var w=0;w<i._howls.length;w++)i._howls[w]._emit("unlock")}};return document.addEventListener("touchstart",o,!0),document.addEventListener("touchend",o,!0),document.addEventListener("click",o,!0),document.addEventListener("keydown",o,!0),i}},_obtainHtml5Audio:function(){var i=this||e;if(i._html5AudioPool.length)return i._html5AudioPool.pop();var o=new Audio().play();return o&&typeof Promise<"u"&&(o instanceof Promise||typeof o.then=="function")&&o.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(i){var o=this||e;return i._unlocked&&o._html5AudioPool.push(i),o},_autoSuspend:function(){var i=this;if(!(!i.autoSuspend||!i.ctx||typeof i.ctx.suspend>"u"||!e.usingWebAudio)){for(var o=0;o<i._howls.length;o++)if(i._howls[o]._webAudio){for(var c=0;c<i._howls[o]._sounds.length;c++)if(!i._howls[o]._sounds[c]._paused)return i}return i._suspendTimer&&clearTimeout(i._suspendTimer),i._suspendTimer=setTimeout(function(){if(i.autoSuspend){i._suspendTimer=null,i.state="suspending";var _=function(){i.state="suspended",i._resumeAfterSuspend&&(delete i._resumeAfterSuspend,i._autoResume())};i.ctx.suspend().then(_,_)}},3e4),i}},_autoResume:function(){var i=this;if(!(!i.ctx||typeof i.ctx.resume>"u"||!e.usingWebAudio))return i.state==="running"&&i.ctx.state!=="interrupted"&&i._suspendTimer?(clearTimeout(i._suspendTimer),i._suspendTimer=null):i.state==="suspended"||i.state==="running"&&i.ctx.state==="interrupted"?(i.ctx.resume().then(function(){i.state="running";for(var o=0;o<i._howls.length;o++)i._howls[o]._emit("resume")}),i._suspendTimer&&(clearTimeout(i._suspendTimer),i._suspendTimer=null)):i.state==="suspending"&&(i._resumeAfterSuspend=!0),i}};var e=new t,r=function(i){var o=this;if(!i.src||i.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}o.init(i)};r.prototype={init:function(i){var o=this;return e.ctx||m(),o._autoplay=i.autoplay||!1,o._format=typeof i.format!="string"?i.format:[i.format],o._html5=i.html5||!1,o._muted=i.mute||!1,o._loop=i.loop||!1,o._pool=i.pool||5,o._preload=typeof i.preload=="boolean"||i.preload==="metadata"?i.preload:!0,o._rate=i.rate||1,o._sprite=i.sprite||{},o._src=typeof i.src!="string"?i.src:[i.src],o._volume=i.volume!==void 0?i.volume:1,o._xhr={method:i.xhr&&i.xhr.method?i.xhr.method:"GET",headers:i.xhr&&i.xhr.headers?i.xhr.headers:null,withCredentials:i.xhr&&i.xhr.withCredentials?i.xhr.withCredentials:!1},o._duration=0,o._state="unloaded",o._sounds=[],o._endTimers={},o._queue=[],o._playLock=!1,o._onend=i.onend?[{fn:i.onend}]:[],o._onfade=i.onfade?[{fn:i.onfade}]:[],o._onload=i.onload?[{fn:i.onload}]:[],o._onloaderror=i.onloaderror?[{fn:i.onloaderror}]:[],o._onplayerror=i.onplayerror?[{fn:i.onplayerror}]:[],o._onpause=i.onpause?[{fn:i.onpause}]:[],o._onplay=i.onplay?[{fn:i.onplay}]:[],o._onstop=i.onstop?[{fn:i.onstop}]:[],o._onmute=i.onmute?[{fn:i.onmute}]:[],o._onvolume=i.onvolume?[{fn:i.onvolume}]:[],o._onrate=i.onrate?[{fn:i.onrate}]:[],o._onseek=i.onseek?[{fn:i.onseek}]:[],o._onunlock=i.onunlock?[{fn:i.onunlock}]:[],o._onresume=[],o._webAudio=e.usingWebAudio&&!o._html5,typeof e.ctx<"u"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(o),o._autoplay&&o._queue.push({event:"play",action:function(){o.play()}}),o._preload&&o._preload!=="none"&&o.load(),o},load:function(){var i=this,o=null;if(e.noAudio){i._emit("loaderror",null,"No audio support.");return}typeof i._src=="string"&&(i._src=[i._src]);for(var c=0;c<i._src.length;c++){var _,h;if(i._format&&i._format[c])_=i._format[c];else{if(h=i._src[c],typeof h!="string"){i._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}_=/^data:audio\/([^;,]+);/i.exec(h),_||(_=/\.([^.]+)$/.exec(h.split("?",1)[0])),_&&(_=_[1].toLowerCase())}if(_||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),_&&e.codecs(_)){o=i._src[c];break}}if(!o){i._emit("loaderror",null,"No codec support for selected audio sources.");return}return i._src=o,i._state="loading",window.location.protocol==="https:"&&o.slice(0,5)==="http:"&&(i._html5=!0,i._webAudio=!1),new s(i),i._webAudio&&l(i),i},play:function(i,o){var c=this,_=null;if(typeof i=="number")_=i,i=null;else{if(typeof i=="string"&&c._state==="loaded"&&!c._sprite[i])return null;if(typeof i>"u"&&(i="__default",!c._playLock)){for(var h=0,v=0;v<c._sounds.length;v++)c._sounds[v]._paused&&!c._sounds[v]._ended&&(h++,_=c._sounds[v]._id);h===1?i=null:_=null}}var p=_?c._soundById(_):c._inactiveSound();if(!p)return null;if(_&&!i&&(i=p._sprite||"__default"),c._state!=="loaded"){p._sprite=i,p._ended=!1;var g=p._id;return c._queue.push({event:"play",action:function(){c.play(g)}}),g}if(_&&!p._paused)return o||c._loadQueue("play"),p._id;c._webAudio&&e._autoResume();var y=Math.max(0,p._seek>0?p._seek:c._sprite[i][0]/1e3),w=Math.max(0,(c._sprite[i][0]+c._sprite[i][1])/1e3-y),S=w*1e3/Math.abs(p._rate),P=c._sprite[i][0]/1e3,k=(c._sprite[i][0]+c._sprite[i][1])/1e3;p._sprite=i,p._ended=!1;var D=function(){p._paused=!1,p._seek=y,p._start=P,p._stop=k,p._loop=!!(p._loop||c._sprite[i][2])};if(y>=k){c._ended(p);return}var E=p._node;if(c._webAudio){var oe=function(){c._playLock=!1,D(),c._refreshBuffer(p);var q=p._muted||c._muted?0:p._volume;E.gain.setValueAtTime(q,e.ctx.currentTime),p._playStart=e.ctx.currentTime,typeof E.bufferSource.start>"u"?p._loop?E.bufferSource.noteGrainOn(0,y,86400):E.bufferSource.noteGrainOn(0,y,w):p._loop?E.bufferSource.start(0,y,86400):E.bufferSource.start(0,y,w),S!==1/0&&(c._endTimers[p._id]=setTimeout(c._ended.bind(c,p),S)),o||setTimeout(function(){c._emit("play",p._id),c._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?oe():(c._playLock=!0,c.once("resume",oe),c._clearTimer(p._id))}else{var ve=function(){E.currentTime=y,E.muted=p._muted||c._muted||e._muted||E.muted,E.volume=p._volume*e.volume(),E.playbackRate=p._rate;try{var q=E.play();if(q&&typeof Promise<"u"&&(q instanceof Promise||typeof q.then=="function")?(c._playLock=!0,D(),q.then(function(){c._playLock=!1,E._unlocked=!0,o?c._loadQueue():c._emit("play",p._id)}).catch(function(){c._playLock=!1,c._emit("playerror",p._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),p._ended=!0,p._paused=!0})):o||(c._playLock=!1,D(),c._emit("play",p._id)),E.playbackRate=p._rate,E.paused){c._emit("playerror",p._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}i!=="__default"||p._loop?c._endTimers[p._id]=setTimeout(c._ended.bind(c,p),S):(c._endTimers[p._id]=function(){c._ended(p),E.removeEventListener("ended",c._endTimers[p._id],!1)},E.addEventListener("ended",c._endTimers[p._id],!1))}catch(Q){c._emit("playerror",p._id,Q)}};E.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(E.src=c._src,E.load());var Z=window&&window.ejecta||!E.readyState&&e._navigator.isCocoonJS;if(E.readyState>=3||Z)ve();else{c._playLock=!0,c._state="loading";var L=function(){c._state="loaded",ve(),E.removeEventListener(e._canPlayEvent,L,!1)};E.addEventListener(e._canPlayEvent,L,!1),c._clearTimer(p._id)}}return p._id},pause:function(i){var o=this;if(o._state!=="loaded"||o._playLock)return o._queue.push({event:"pause",action:function(){o.pause(i)}}),o;for(var c=o._getSoundIds(i),_=0;_<c.length;_++){o._clearTimer(c[_]);var h=o._soundById(c[_]);if(h&&!h._paused&&(h._seek=o.seek(c[_]),h._rateSeek=0,h._paused=!0,o._stopFade(c[_]),h._node))if(o._webAudio){if(!h._node.bufferSource)continue;typeof h._node.bufferSource.stop>"u"?h._node.bufferSource.noteOff(0):h._node.bufferSource.stop(0),o._cleanBuffer(h._node)}else(!isNaN(h._node.duration)||h._node.duration===1/0)&&h._node.pause();arguments[1]||o._emit("pause",h?h._id:null)}return o},stop:function(i,o){var c=this;if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"stop",action:function(){c.stop(i)}}),c;for(var _=c._getSoundIds(i),h=0;h<_.length;h++){c._clearTimer(_[h]);var v=c._soundById(_[h]);v&&(v._seek=v._start||0,v._rateSeek=0,v._paused=!0,v._ended=!0,c._stopFade(_[h]),v._node&&(c._webAudio?v._node.bufferSource&&(typeof v._node.bufferSource.stop>"u"?v._node.bufferSource.noteOff(0):v._node.bufferSource.stop(0),c._cleanBuffer(v._node)):(!isNaN(v._node.duration)||v._node.duration===1/0)&&(v._node.currentTime=v._start||0,v._node.pause(),v._node.duration===1/0&&c._clearSound(v._node))),o||c._emit("stop",v._id))}return c},mute:function(i,o){var c=this;if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"mute",action:function(){c.mute(i,o)}}),c;if(typeof o>"u")if(typeof i=="boolean")c._muted=i;else return c._muted;for(var _=c._getSoundIds(o),h=0;h<_.length;h++){var v=c._soundById(_[h]);v&&(v._muted=i,v._interval&&c._stopFade(v._id),c._webAudio&&v._node?v._node.gain.setValueAtTime(i?0:v._volume,e.ctx.currentTime):v._node&&(v._node.muted=e._muted?!0:i),c._emit("mute",v._id))}return c},volume:function(){var i=this,o=arguments,c,_;if(o.length===0)return i._volume;if(o.length===1||o.length===2&&typeof o[1]>"u"){var h=i._getSoundIds(),v=h.indexOf(o[0]);v>=0?_=parseInt(o[0],10):c=parseFloat(o[0])}else o.length>=2&&(c=parseFloat(o[0]),_=parseInt(o[1],10));var p;if(typeof c<"u"&&c>=0&&c<=1){if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"volume",action:function(){i.volume.apply(i,o)}}),i;typeof _>"u"&&(i._volume=c),_=i._getSoundIds(_);for(var g=0;g<_.length;g++)p=i._soundById(_[g]),p&&(p._volume=c,o[2]||i._stopFade(_[g]),i._webAudio&&p._node&&!p._muted?p._node.gain.setValueAtTime(c,e.ctx.currentTime):p._node&&!p._muted&&(p._node.volume=c*e.volume()),i._emit("volume",p._id))}else return p=_?i._soundById(_):i._sounds[0],p?p._volume:0;return i},fade:function(i,o,c,_){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"fade",action:function(){h.fade(i,o,c,_)}}),h;i=Math.min(Math.max(0,parseFloat(i)),1),o=Math.min(Math.max(0,parseFloat(o)),1),c=parseFloat(c),h.volume(i,_);for(var v=h._getSoundIds(_),p=0;p<v.length;p++){var g=h._soundById(v[p]);if(g){if(_||h._stopFade(v[p]),h._webAudio&&!g._muted){var y=e.ctx.currentTime,w=y+c/1e3;g._volume=i,g._node.gain.setValueAtTime(i,y),g._node.gain.linearRampToValueAtTime(o,w)}h._startFadeInterval(g,i,o,c,v[p],typeof _>"u")}}return h},_startFadeInterval:function(i,o,c,_,h,v){var p=this,g=o,y=c-o,w=Math.abs(y/.01),S=Math.max(4,w>0?_/w:_),P=Date.now();i._fadeTo=c,i._interval=setInterval(function(){var k=(Date.now()-P)/_;P=Date.now(),g+=y*k,g=Math.round(g*100)/100,y<0?g=Math.max(c,g):g=Math.min(c,g),p._webAudio?i._volume=g:p.volume(g,i._id,!0),v&&(p._volume=g),(c<o&&g<=c||c>o&&g>=c)&&(clearInterval(i._interval),i._interval=null,i._fadeTo=null,p.volume(c,i._id),p._emit("fade",i._id))},S)},_stopFade:function(i){var o=this,c=o._soundById(i);return c&&c._interval&&(o._webAudio&&c._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(c._interval),c._interval=null,o.volume(c._fadeTo,i),c._fadeTo=null,o._emit("fade",i)),o},loop:function(){var i=this,o=arguments,c,_,h;if(o.length===0)return i._loop;if(o.length===1)if(typeof o[0]=="boolean")c=o[0],i._loop=c;else return h=i._soundById(parseInt(o[0],10)),h?h._loop:!1;else o.length===2&&(c=o[0],_=parseInt(o[1],10));for(var v=i._getSoundIds(_),p=0;p<v.length;p++)h=i._soundById(v[p]),h&&(h._loop=c,i._webAudio&&h._node&&h._node.bufferSource&&(h._node.bufferSource.loop=c,c&&(h._node.bufferSource.loopStart=h._start||0,h._node.bufferSource.loopEnd=h._stop,i.playing(v[p])&&(i.pause(v[p],!0),i.play(v[p],!0)))));return i},rate:function(){var i=this,o=arguments,c,_;if(o.length===0)_=i._sounds[0]._id;else if(o.length===1){var h=i._getSoundIds(),v=h.indexOf(o[0]);v>=0?_=parseInt(o[0],10):c=parseFloat(o[0])}else o.length===2&&(c=parseFloat(o[0]),_=parseInt(o[1],10));var p;if(typeof c=="number"){if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"rate",action:function(){i.rate.apply(i,o)}}),i;typeof _>"u"&&(i._rate=c),_=i._getSoundIds(_);for(var g=0;g<_.length;g++)if(p=i._soundById(_[g]),p){i.playing(_[g])&&(p._rateSeek=i.seek(_[g]),p._playStart=i._webAudio?e.ctx.currentTime:p._playStart),p._rate=c,i._webAudio&&p._node&&p._node.bufferSource?p._node.bufferSource.playbackRate.setValueAtTime(c,e.ctx.currentTime):p._node&&(p._node.playbackRate=c);var y=i.seek(_[g]),w=(i._sprite[p._sprite][0]+i._sprite[p._sprite][1])/1e3-y,S=w*1e3/Math.abs(p._rate);(i._endTimers[_[g]]||!p._paused)&&(i._clearTimer(_[g]),i._endTimers[_[g]]=setTimeout(i._ended.bind(i,p),S)),i._emit("rate",p._id)}}else return p=i._soundById(_),p?p._rate:i._rate;return i},seek:function(){var i=this,o=arguments,c,_;if(o.length===0)i._sounds.length&&(_=i._sounds[0]._id);else if(o.length===1){var h=i._getSoundIds(),v=h.indexOf(o[0]);v>=0?_=parseInt(o[0],10):i._sounds.length&&(_=i._sounds[0]._id,c=parseFloat(o[0]))}else o.length===2&&(c=parseFloat(o[0]),_=parseInt(o[1],10));if(typeof _>"u")return 0;if(typeof c=="number"&&(i._state!=="loaded"||i._playLock))return i._queue.push({event:"seek",action:function(){i.seek.apply(i,o)}}),i;var p=i._soundById(_);if(p)if(typeof c=="number"&&c>=0){var g=i.playing(_);g&&i.pause(_,!0),p._seek=c,p._ended=!1,i._clearTimer(_),!i._webAudio&&p._node&&!isNaN(p._node.duration)&&(p._node.currentTime=c);var y=function(){g&&i.play(_,!0),i._emit("seek",_)};if(g&&!i._webAudio){var w=function(){i._playLock?setTimeout(w,0):y()};setTimeout(w,0)}else y()}else if(i._webAudio){var S=i.playing(_)?e.ctx.currentTime-p._playStart:0,P=p._rateSeek?p._rateSeek-p._seek:0;return p._seek+(P+S*Math.abs(p._rate))}else return p._node.currentTime;return i},playing:function(i){var o=this;if(typeof i=="number"){var c=o._soundById(i);return c?!c._paused:!1}for(var _=0;_<o._sounds.length;_++)if(!o._sounds[_]._paused)return!0;return!1},duration:function(i){var o=this,c=o._duration,_=o._soundById(i);return _&&(c=o._sprite[_._sprite][1]/1e3),c},state:function(){return this._state},unload:function(){for(var i=this,o=i._sounds,c=0;c<o.length;c++)o[c]._paused||i.stop(o[c]._id),i._webAudio||(i._clearSound(o[c]._node),o[c]._node.removeEventListener("error",o[c]._errorFn,!1),o[c]._node.removeEventListener(e._canPlayEvent,o[c]._loadFn,!1),o[c]._node.removeEventListener("ended",o[c]._endFn,!1),e._releaseHtml5Audio(o[c]._node)),delete o[c]._node,i._clearTimer(o[c]._id);var _=e._howls.indexOf(i);_>=0&&e._howls.splice(_,1);var h=!0;for(c=0;c<e._howls.length;c++)if(e._howls[c]._src===i._src||i._src.indexOf(e._howls[c]._src)>=0){h=!1;break}return a&&h&&delete a[i._src],e.noAudio=!1,i._state="unloaded",i._sounds=[],i=null,null},on:function(i,o,c,_){var h=this,v=h["_on"+i];return typeof o=="function"&&v.push(_?{id:c,fn:o,once:_}:{id:c,fn:o}),h},off:function(i,o,c){var _=this,h=_["_on"+i],v=0;if(typeof o=="number"&&(c=o,o=null),o||c)for(v=0;v<h.length;v++){var p=c===h[v].id;if(o===h[v].fn&&p||!o&&p){h.splice(v,1);break}}else if(i)_["_on"+i]=[];else{var g=Object.keys(_);for(v=0;v<g.length;v++)g[v].indexOf("_on")===0&&Array.isArray(_[g[v]])&&(_[g[v]]=[])}return _},once:function(i,o,c){var _=this;return _.on(i,o,c,1),_},_emit:function(i,o,c){for(var _=this,h=_["_on"+i],v=h.length-1;v>=0;v--)(!h[v].id||h[v].id===o||i==="load")&&(setTimeout((function(p){p.call(this,o,c)}).bind(_,h[v].fn),0),h[v].once&&_.off(i,h[v].fn,h[v].id));return _._loadQueue(i),_},_loadQueue:function(i){var o=this;if(o._queue.length>0){var c=o._queue[0];c.event===i&&(o._queue.shift(),o._loadQueue()),i||c.action()}return o},_ended:function(i){var o=this,c=i._sprite;if(!o._webAudio&&i._node&&!i._node.paused&&!i._node.ended&&i._node.currentTime<i._stop)return setTimeout(o._ended.bind(o,i),100),o;var _=!!(i._loop||o._sprite[c][2]);if(o._emit("end",i._id),!o._webAudio&&_&&o.stop(i._id,!0).play(i._id),o._webAudio&&_){o._emit("play",i._id),i._seek=i._start||0,i._rateSeek=0,i._playStart=e.ctx.currentTime;var h=(i._stop-i._start)*1e3/Math.abs(i._rate);o._endTimers[i._id]=setTimeout(o._ended.bind(o,i),h)}return o._webAudio&&!_&&(i._paused=!0,i._ended=!0,i._seek=i._start||0,i._rateSeek=0,o._clearTimer(i._id),o._cleanBuffer(i._node),e._autoSuspend()),!o._webAudio&&!_&&o.stop(i._id,!0),o},_clearTimer:function(i){var o=this;if(o._endTimers[i]){if(typeof o._endTimers[i]!="function")clearTimeout(o._endTimers[i]);else{var c=o._soundById(i);c&&c._node&&c._node.removeEventListener("ended",o._endTimers[i],!1)}delete o._endTimers[i]}return o},_soundById:function(i){for(var o=this,c=0;c<o._sounds.length;c++)if(i===o._sounds[c]._id)return o._sounds[c];return null},_inactiveSound:function(){var i=this;i._drain();for(var o=0;o<i._sounds.length;o++)if(i._sounds[o]._ended)return i._sounds[o].reset();return new s(i)},_drain:function(){var i=this,o=i._pool,c=0,_=0;if(!(i._sounds.length<o)){for(_=0;_<i._sounds.length;_++)i._sounds[_]._ended&&c++;for(_=i._sounds.length-1;_>=0;_--){if(c<=o)return;i._sounds[_]._ended&&(i._webAudio&&i._sounds[_]._node&&i._sounds[_]._node.disconnect(0),i._sounds.splice(_,1),c--)}}},_getSoundIds:function(i){var o=this;if(typeof i>"u"){for(var c=[],_=0;_<o._sounds.length;_++)c.push(o._sounds[_]._id);return c}else return[i]},_refreshBuffer:function(i){var o=this;return i._node.bufferSource=e.ctx.createBufferSource(),i._node.bufferSource.buffer=a[o._src],i._panner?i._node.bufferSource.connect(i._panner):i._node.bufferSource.connect(i._node),i._node.bufferSource.loop=i._loop,i._loop&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop||0),i._node.bufferSource.playbackRate.setValueAtTime(i._rate,e.ctx.currentTime),o},_cleanBuffer:function(i){var o=this,c=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(e._scratchBuffer&&i.bufferSource&&(i.bufferSource.onended=null,i.bufferSource.disconnect(0),c))try{i.bufferSource.buffer=e._scratchBuffer}catch{}return i.bufferSource=null,o},_clearSound:function(i){var o=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);o||(i.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var s=function(i){this._parent=i,this.init()};s.prototype={init:function(){var i=this,o=i._parent;return i._muted=o._muted,i._loop=o._loop,i._volume=o._volume,i._rate=o._rate,i._seek=0,i._paused=!0,i._ended=!0,i._sprite="__default",i._id=++e._counter,o._sounds.push(i),i.create(),i},create:function(){var i=this,o=i._parent,c=e._muted||i._muted||i._parent._muted?0:i._volume;return o._webAudio?(i._node=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),i._node.gain.setValueAtTime(c,e.ctx.currentTime),i._node.paused=!0,i._node.connect(e.masterGain)):e.noAudio||(i._node=e._obtainHtml5Audio(),i._errorFn=i._errorListener.bind(i),i._node.addEventListener("error",i._errorFn,!1),i._loadFn=i._loadListener.bind(i),i._node.addEventListener(e._canPlayEvent,i._loadFn,!1),i._endFn=i._endListener.bind(i),i._node.addEventListener("ended",i._endFn,!1),i._node.src=o._src,i._node.preload=o._preload===!0?"auto":o._preload,i._node.volume=c*e.volume(),i._node.load()),i},reset:function(){var i=this,o=i._parent;return i._muted=o._muted,i._loop=o._loop,i._volume=o._volume,i._rate=o._rate,i._seek=0,i._rateSeek=0,i._paused=!0,i._ended=!0,i._sprite="__default",i._id=++e._counter,i},_errorListener:function(){var i=this;i._parent._emit("loaderror",i._id,i._node.error?i._node.error.code:0),i._node.removeEventListener("error",i._errorFn,!1)},_loadListener:function(){var i=this,o=i._parent;o._duration=Math.ceil(i._node.duration*10)/10,Object.keys(o._sprite).length===0&&(o._sprite={__default:[0,o._duration*1e3]}),o._state!=="loaded"&&(o._state="loaded",o._emit("load"),o._loadQueue()),i._node.removeEventListener(e._canPlayEvent,i._loadFn,!1)},_endListener:function(){var i=this,o=i._parent;o._duration===1/0&&(o._duration=Math.ceil(i._node.duration*10)/10,o._sprite.__default[1]===1/0&&(o._sprite.__default[1]=o._duration*1e3),o._ended(i)),i._node.removeEventListener("ended",i._endFn,!1)}};var a={},l=function(i){var o=i._src;if(a[o]){i._duration=a[o].duration,d(i);return}if(/^data:[^;]+;base64,/.test(o)){for(var c=atob(o.split(",")[1]),_=new Uint8Array(c.length),h=0;h<c.length;++h)_[h]=c.charCodeAt(h);u(_.buffer,i)}else{var v=new XMLHttpRequest;v.open(i._xhr.method,o,!0),v.withCredentials=i._xhr.withCredentials,v.responseType="arraybuffer",i._xhr.headers&&Object.keys(i._xhr.headers).forEach(function(p){v.setRequestHeader(p,i._xhr.headers[p])}),v.onload=function(){var p=(v.status+"")[0];if(p!=="0"&&p!=="2"&&p!=="3"){i._emit("loaderror",null,"Failed loading audio file with status: "+v.status+".");return}u(v.response,i)},v.onerror=function(){i._webAudio&&(i._html5=!0,i._webAudio=!1,i._sounds=[],delete a[o],i.load())},f(v)}},f=function(i){try{i.send()}catch{i.onerror()}},u=function(i,o){var c=function(){o._emit("loaderror",null,"Decoding audio data failed.")},_=function(h){h&&o._sounds.length>0?(a[o._src]=h,d(o,h)):c()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(i).then(_).catch(c):e.ctx.decodeAudioData(i,_,c)},d=function(i,o){o&&!i._duration&&(i._duration=o.duration),Object.keys(i._sprite).length===0&&(i._sprite={__default:[0,i._duration*1e3]}),i._state!=="loaded"&&(i._state="loaded",i._emit("load"),i._loadQueue())},m=function(){if(e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var i=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),o=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),c=o?parseInt(o[1],10):null;if(i&&c&&c<9){var _=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!_&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};n.Howler=e,n.Howl=r,typeof ce<"u"?(ce.HowlerGlobal=t,ce.Howler=e,ce.Howl=r,ce.Sound=s):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=r,window.Sound=s)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var r=this;if(!r.ctx||!r.ctx.listener)return r;for(var s=r._howls.length-1;s>=0;s--)r._howls[s].stereo(e);return r},HowlerGlobal.prototype.pos=function(e,r,s){var a=this;if(!a.ctx||!a.ctx.listener)return a;if(r=typeof r!="number"?a._pos[1]:r,s=typeof s!="number"?a._pos[2]:s,typeof e=="number")a._pos=[e,r,s],typeof a.ctx.listener.positionX<"u"?(a.ctx.listener.positionX.setTargetAtTime(a._pos[0],Howler.ctx.currentTime,.1),a.ctx.listener.positionY.setTargetAtTime(a._pos[1],Howler.ctx.currentTime,.1),a.ctx.listener.positionZ.setTargetAtTime(a._pos[2],Howler.ctx.currentTime,.1)):a.ctx.listener.setPosition(a._pos[0],a._pos[1],a._pos[2]);else return a._pos;return a},HowlerGlobal.prototype.orientation=function(e,r,s,a,l,f){var u=this;if(!u.ctx||!u.ctx.listener)return u;var d=u._orientation;if(r=typeof r!="number"?d[1]:r,s=typeof s!="number"?d[2]:s,a=typeof a!="number"?d[3]:a,l=typeof l!="number"?d[4]:l,f=typeof f!="number"?d[5]:f,typeof e=="number")u._orientation=[e,r,s,a,l,f],typeof u.ctx.listener.forwardX<"u"?(u.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),u.ctx.listener.forwardY.setTargetAtTime(r,Howler.ctx.currentTime,.1),u.ctx.listener.forwardZ.setTargetAtTime(s,Howler.ctx.currentTime,.1),u.ctx.listener.upX.setTargetAtTime(a,Howler.ctx.currentTime,.1),u.ctx.listener.upY.setTargetAtTime(l,Howler.ctx.currentTime,.1),u.ctx.listener.upZ.setTargetAtTime(f,Howler.ctx.currentTime,.1)):u.ctx.listener.setOrientation(e,r,s,a,l,f);else return d;return u},Howl.prototype.init=function(e){return function(r){var s=this;return s._orientation=r.orientation||[1,0,0],s._stereo=r.stereo||null,s._pos=r.pos||null,s._pannerAttr={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:360,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:360,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:0,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:"inverse",maxDistance:typeof r.maxDistance<"u"?r.maxDistance:1e4,panningModel:typeof r.panningModel<"u"?r.panningModel:"HRTF",refDistance:typeof r.refDistance<"u"?r.refDistance:1,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:1},s._onstereo=r.onstereo?[{fn:r.onstereo}]:[],s._onpos=r.onpos?[{fn:r.onpos}]:[],s._onorientation=r.onorientation?[{fn:r.onorientation}]:[],e.call(this,r)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,r){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"stereo",action:function(){s.stereo(e,r)}}),s;var a=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof r>"u")if(typeof e=="number")s._stereo=e,s._pos=[e,0,0];else return s._stereo;for(var l=s._getSoundIds(r),f=0;f<l.length;f++){var u=s._soundById(l[f]);if(u)if(typeof e=="number")u._stereo=e,u._pos=[e,0,0],u._node&&(u._pannerAttr.panningModel="equalpower",(!u._panner||!u._panner.pan)&&t(u,a),a==="spatial"?typeof u._panner.positionX<"u"?(u._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):u._panner.setPosition(e,0,0):u._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),s._emit("stereo",u._id);else return u._stereo}return s},Howl.prototype.pos=function(e,r,s,a){var l=this;if(!l._webAudio)return l;if(l._state!=="loaded")return l._queue.push({event:"pos",action:function(){l.pos(e,r,s,a)}}),l;if(r=typeof r!="number"?0:r,s=typeof s!="number"?-.5:s,typeof a>"u")if(typeof e=="number")l._pos=[e,r,s];else return l._pos;for(var f=l._getSoundIds(a),u=0;u<f.length;u++){var d=l._soundById(f[u]);if(d)if(typeof e=="number")d._pos=[e,r,s],d._node&&((!d._panner||d._panner.pan)&&t(d,"spatial"),typeof d._panner.positionX<"u"?(d._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),d._panner.positionY.setValueAtTime(r,Howler.ctx.currentTime),d._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):d._panner.setPosition(e,r,s)),l._emit("pos",d._id);else return d._pos}return l},Howl.prototype.orientation=function(e,r,s,a){var l=this;if(!l._webAudio)return l;if(l._state!=="loaded")return l._queue.push({event:"orientation",action:function(){l.orientation(e,r,s,a)}}),l;if(r=typeof r!="number"?l._orientation[1]:r,s=typeof s!="number"?l._orientation[2]:s,typeof a>"u")if(typeof e=="number")l._orientation=[e,r,s];else return l._orientation;for(var f=l._getSoundIds(a),u=0;u<f.length;u++){var d=l._soundById(f[u]);if(d)if(typeof e=="number")d._orientation=[e,r,s],d._node&&(d._panner||(d._pos||(d._pos=l._pos||[0,0,-.5]),t(d,"spatial")),typeof d._panner.orientationX<"u"?(d._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),d._panner.orientationY.setValueAtTime(r,Howler.ctx.currentTime),d._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):d._panner.setOrientation(e,r,s)),l._emit("orientation",d._id);else return d._orientation}return l},Howl.prototype.pannerAttr=function(){var e=this,r=arguments,s,a,l;if(!e._webAudio)return e;if(r.length===0)return e._pannerAttr;if(r.length===1)if(typeof r[0]=="object")s=r[0],typeof a>"u"&&(s.pannerAttr||(s.pannerAttr={coneInnerAngle:s.coneInnerAngle,coneOuterAngle:s.coneOuterAngle,coneOuterGain:s.coneOuterGain,distanceModel:s.distanceModel,maxDistance:s.maxDistance,refDistance:s.refDistance,rolloffFactor:s.rolloffFactor,panningModel:s.panningModel}),e._pannerAttr={coneInnerAngle:typeof s.pannerAttr.coneInnerAngle<"u"?s.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof s.pannerAttr.coneOuterAngle<"u"?s.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof s.pannerAttr.coneOuterGain<"u"?s.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof s.pannerAttr.distanceModel<"u"?s.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof s.pannerAttr.maxDistance<"u"?s.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof s.pannerAttr.refDistance<"u"?s.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof s.pannerAttr.rolloffFactor<"u"?s.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof s.pannerAttr.panningModel<"u"?s.pannerAttr.panningModel:e._panningModel});else return l=e._soundById(parseInt(r[0],10)),l?l._pannerAttr:e._pannerAttr;else r.length===2&&(s=r[0],a=parseInt(r[1],10));for(var f=e._getSoundIds(a),u=0;u<f.length;u++)if(l=e._soundById(f[u]),l){var d=l._pannerAttr;d={coneInnerAngle:typeof s.coneInnerAngle<"u"?s.coneInnerAngle:d.coneInnerAngle,coneOuterAngle:typeof s.coneOuterAngle<"u"?s.coneOuterAngle:d.coneOuterAngle,coneOuterGain:typeof s.coneOuterGain<"u"?s.coneOuterGain:d.coneOuterGain,distanceModel:typeof s.distanceModel<"u"?s.distanceModel:d.distanceModel,maxDistance:typeof s.maxDistance<"u"?s.maxDistance:d.maxDistance,refDistance:typeof s.refDistance<"u"?s.refDistance:d.refDistance,rolloffFactor:typeof s.rolloffFactor<"u"?s.rolloffFactor:d.rolloffFactor,panningModel:typeof s.panningModel<"u"?s.panningModel:d.panningModel};var m=l._panner;m?(m.coneInnerAngle=d.coneInnerAngle,m.coneOuterAngle=d.coneOuterAngle,m.coneOuterGain=d.coneOuterGain,m.distanceModel=d.distanceModel,m.maxDistance=d.maxDistance,m.refDistance=d.refDistance,m.rolloffFactor=d.rolloffFactor,m.panningModel=d.panningModel):(l._pos||(l._pos=e._pos||[0,0,-.5]),t(l,"spatial"))}return e},Sound.prototype.init=function(e){return function(){var r=this,s=r._parent;r._orientation=s._orientation,r._stereo=s._stereo,r._pos=s._pos,r._pannerAttr=s._pannerAttr,e.call(this),r._stereo?s.stereo(r._stereo):r._pos&&s.pos(r._pos[0],r._pos[1],r._pos[2],r._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var r=this,s=r._parent;return r._orientation=s._orientation,r._stereo=s._stereo,r._pos=s._pos,r._pannerAttr=s._pannerAttr,r._stereo?s.stereo(r._stereo):r._pos?s.pos(r._pos[0],r._pos[1],r._pos[2],r._id):r._panner&&(r._panner.disconnect(0),r._panner=void 0,s._refreshBuffer(r)),e.call(this)}}(Sound.prototype.reset);var t=function(e,r){r=r||"spatial",r==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(qn);let et;const un={capture:[0,204],move:[704,316],select:[1519,153],silence:[2172,500]},hs=()=>{if(!et){const n=Object.values(un).map(t=>window.btoa(`${t[0]}:${t[1]}`)).join("-");et??(et=new qn.Howl({src:[`/audio/sprite.mp3?v=${n}`],sprite:un}))}return et},ms=n=>{hs().play(n)};function gs(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}var gt=gs,vs=typeof ce=="object"&&ce&&ce.Object===Object&&ce,ys=vs,bs=ys,ws=typeof self=="object"&&self&&self.Object===Object&&self,Ss=bs||ws||Function("return this")(),Wn=Ss,Ts=Wn,ks=function(){return Ts.Date.now()},As=ks,$s=/\s/;function Is(n){for(var t=n.length;t--&&$s.test(n.charAt(t)););return t}var Es=Is,Os=Es,Ms=/^\s+/;function Ps(n){return n&&n.slice(0,Os(n)+1).replace(Ms,"")}var js=Ps,Ds=Wn,Ls=Ds.Symbol,Nn=Ls,fn=Nn,Xn=Object.prototype,Rs=Xn.hasOwnProperty,xs=Xn.toString,je=fn?fn.toStringTag:void 0;function Fs(n){var t=Rs.call(n,je),e=n[je];try{n[je]=void 0;var r=!0}catch{}var s=xs.call(n);return r&&(t?n[je]=e:delete n[je]),s}var Hs=Fs,Gs=Object.prototype,Vs=Gs.toString;function Bs(n){return Vs.call(n)}var qs=Bs,dn=Nn,Ws=Hs,Ns=qs,Xs="[object Null]",Us="[object Undefined]",_n=dn?dn.toStringTag:void 0;function Qs(n){return n==null?n===void 0?Us:Xs:_n&&_n in Object(n)?Ws(n):Ns(n)}var Js=Qs;function Ys(n){return n!=null&&typeof n=="object"}var Cs=Ys,Zs=Js,zs=Cs,Ks="[object Symbol]";function eo(n){return typeof n=="symbol"||zs(n)&&Zs(n)==Ks}var to=eo,no=js,pn=gt,ro=to,hn=0/0,io=/^[-+]0x[0-9a-f]+$/i,so=/^0b[01]+$/i,oo=/^0o[0-7]+$/i,ao=parseInt;function lo(n){if(typeof n=="number")return n;if(ro(n))return hn;if(pn(n)){var t=typeof n.valueOf=="function"?n.valueOf():n;n=pn(t)?t+"":t}if(typeof n!="string")return n===0?n:+n;n=no(n);var e=so.test(n);return e||oo.test(n)?ao(n.slice(2),e?2:8):io.test(n)?hn:+n}var co=lo,uo=gt,tt=As,mn=co,fo="Expected a function",_o=Math.max,po=Math.min;function ho(n,t,e){var r,s,a,l,f,u,d=0,m=!1,i=!1,o=!0;if(typeof n!="function")throw new TypeError(fo);t=mn(t)||0,uo(e)&&(m=!!e.leading,i="maxWait"in e,a=i?_o(mn(e.maxWait)||0,t):a,o="trailing"in e?!!e.trailing:o);function c(P){var k=r,D=s;return r=s=void 0,d=P,l=n.apply(D,k),l}function _(P){return d=P,f=setTimeout(p,t),m?c(P):l}function h(P){var k=P-u,D=P-d,E=t-k;return i?po(E,a-D):E}function v(P){var k=P-u,D=P-d;return u===void 0||k>=t||k<0||i&&D>=a}function p(){var P=tt();if(v(P))return g(P);f=setTimeout(p,h(P))}function g(P){return f=void 0,o&&r?c(P):(r=s=void 0,l)}function y(){f!==void 0&&clearTimeout(f),d=0,r=u=s=f=void 0}function w(){return f===void 0?l:g(tt())}function S(){var P=tt(),k=v(P);if(r=arguments,s=this,u=P,k){if(f===void 0)return _(u);if(i)return clearTimeout(f),f=setTimeout(p,t),c(u)}return f===void 0&&(f=setTimeout(p,t)),l}return S.cancel=y,S.flush=w,S}var mo=ho,go=mo,vo=gt,yo="Expected a function";function bo(n,t,e){var r=!0,s=!0;if(typeof n!="function")throw new TypeError(yo);return vo(e)&&(r="leading"in e?!!e.leading:r,s="trailing"in e?!!e.trailing:s),go(n,t,{leading:r,maxWait:t,trailing:s})}var wo=bo;const So=ps(wo);function To(n){let t,e,r={slot:"actions"};return t=new Si({props:r}),n[8](t),{c(){W(t.$$.fragment)},l(s){N(t.$$.fragment,s)},m(s,a){X(t,s,a),e=!0},p(s,a){const l={};t.$set(l)},i(s){e||(T(t.$$.fragment,s),e=!0)},o(s){$(t.$$.fragment,s),e=!1},d(s){n[8](null),U(t,s)}}}function ko(n){let t,e;return t=new mi({props:{slot:"cursor-overlays",mousePositions:n[0]}}),{c(){W(t.$$.fragment)},l(r){N(t.$$.fragment,r)},m(r,s){X(t,r,s),e=!0},p(r,s){const a={};s&1&&(a.mousePositions=r[0]),t.$set(a)},i(r){e||(T(t.$$.fragment,r),e=!0)},o(r){$(t.$$.fragment,r),e=!1},d(r){U(t,r)}}}function Ao(n){let t,e,r,s,a=n[2].log.join(`
`)+"",l,f,u=JSON.stringify(n[3],null,2)+"",d,m,i;return t=new _s({props:{reportMousePosition:n[6],$$slots:{"cursor-overlays":[ko],actions:[To]},$$scope:{ctx:n}}}),{c(){W(t.$$.fragment),e=V(),r=R("pre"),s=H(""),l=H(a),f=H(`

`),d=H(u),m=H(`
`)},l(o){N(t.$$.fragment,o),e=B(o),r=x(o,"PRE",{});var c=F(r);s=G(c,""),l=G(c,a),f=G(c,`

`),d=G(c,u),m=G(c,`
`),c.forEach(b)},m(o,c){X(t,o,c),A(o,e,c),A(o,r,c),O(r,s),O(r,l),O(r,f),O(r,d),O(r,m),i=!0},p(o,[c]){const _={};c&16387&&(_.$$scope={dirty:c,ctx:o}),t.$set(_),(!i||c&4)&&a!==(a=o[2].log.join(`
`)+"")&&re(l,a),(!i||c&8)&&u!==(u=JSON.stringify(o[3],null,2)+"")&&re(d,u)},i(o){i||(T(t.$$.fragment,o),i=!0)},o(o){$(t.$$.fragment,o),i=!1},d(o){o&&(b(e),b(r)),U(t,o)}}}function $o(n,t,e){let r,s,{data:a}=t;const l=a.machineInput,f=l.gameId,u=l.userId,d=l.hostUserId,m={},i=li({gameId:f,userId:u,onMessage:p=>{p.type==="mouse position"?e(0,m[p.userId]=p.position,m):o.send(p)}});J(n,i,p=>e(2,r=p));const o=ri(ai({send:i.send,actions:{playSound:ms,showEmoji:({userId:p,emoji:g})=>_==null?void 0:_.showEmoji({userId:p,emoji:g})}}),{input:l});ii({gameId:f,userId:u,hostUserId:d,machine:o});const c=o.state;J(n,c,p=>e(3,s=p)),vn(()=>(i.open(),()=>{i.close()}));let _;const h=So(p=>{i.send({type:"mouse position",position:p})},50,{leading:!0,trailing:!0});function v(p){ct[p?"unshift":"push"](()=>{_=p,e(1,_)})}return n.$$set=p=>{"data"in p&&e(7,a=p.data)},[m,_,r,s,i,c,h,a,v]}class jo extends ie{constructor(t){super(),se(this,t,$o,Ao,te,{data:7})}}export{jo as component,Po as universal};
