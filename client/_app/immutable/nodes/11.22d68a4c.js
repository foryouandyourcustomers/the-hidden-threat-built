import{r as st,E as Rn,H as Gn,I as Vn,s as ee,n as C,o as un,l as ot,m as at,c as W,p as Bn,d as Ue,u as Xe,g as Qe,e as Ce}from"../chunks/scheduler.03dcb200.js";import{q as H,p as F,S as re,i as ie,e as x,F as vt,s as R,t as V,c as j,a as D,G as yt,d as w,f as G,b as B,n as P,g as $,h as I,j as ae,H as fn,B as ke,z as Ae,v as z,l as ce,m as ue,o as fe,r as de,I as $e,A as je,y as Y,J as Nn,K as qn,k as le,E as Ke,L as bt,x as wt}from"../chunks/index.91584b48.js";import{r as dn,w as Wn}from"../chunks/index.c110b09d.js";function J(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function _n(n,t){H(n,1,1,()=>{t.delete(n.key)})}function pn(n,t,e,r,s,a,l,d,u,f,_,i){let o=n.length,c=a.length,p=o;const m={};for(;p--;)m[n[p].key]=p;const g=[],h=new Map,v=new Map,y=[];for(p=c;p--;){const T=i(s,a,p),L=e(T);let E=l.get(L);E?r&&y.push(()=>E.p(T,t)):(E=f(L,T),E.c()),h.set(L,g[p]=E),L in m&&v.set(L,Math.abs(p-m[L]))}const b=new Set,S=new Set;function O(T){F(T,1),T.m(d,_),l.set(T.key,T),_=T.first,c--}for(;o&&c;){const T=g[c-1],L=n[o-1],E=T.key,Z=L.key;T===L?(_=T.first,o--,c--):h.has(Z)?!l.has(E)||b.has(E)?O(T):S.has(Z)?o--:v.get(E)>v.get(Z)?(S.add(E),O(T)):(b.add(Z),o--):(u(L,l),o--)}for(;o--;){const T=n[o];h.has(T.key)||u(T,l)}for(;c;)O(g[c-1]);return st(y),g}const Un=!1,no=Object.freeze(Object.defineProperty({__proto__:null,ssr:Un},Symbol.toStringTag,{value:"Module"}));function Xn(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function Qn(){const n=Xn();if(n.__xstate__)return n.__xstate__}const Cn=n=>{if(typeof window>"u")return;const t=Qn();t&&t.register(n)};let se=function(n){return n.After="xstate.after",n.DoneState="done.state",n.DoneInvoke="done.invoke",n.ErrorExecution="error.execution",n.ErrorCommunication="error.communication",n.ErrorPlatform="error.platform",n.ErrorCustom="xstate.error",n}({});se.After;se.DoneState;const Jn=se.ErrorExecution,Yn=se.ErrorPlatform;se.ErrorCustom;const Ie=".",Zn="",hn="",Kn="#",zn="*",mn="xstate.init",St=new WeakMap;function _e(n,t,e){let r=St.get(n);return r?t in r||(r[t]=e()):(r={[t]:e()},St.set(n,r)),r[t]}function er(n,t,e,{sendId:r}){const s=typeof r=="function"?r(e):r;return[t,s]}function tr(n,t){n.self.cancel(t)}function nr(n){function t(e){}return t.type="xstate.cancel",t.sendId=n,t.resolve=er,t.execute=tr,t}class Tt{constructor(t){this._process=t,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}prepend(t){if(!this._current){this.enqueue(t);return}this._current={value:t,next:this._current}}enqueue(t){const e={value:t,next:null};if(this._current){this._last.next=e,this._last=e;return}this._current=e,this._last=e,this._active&&this.flush()}flush(){for(;this._current;){const t=this._current;this._process(t.value),t===this._current&&(this._current=this._current.next)}this._last=null}}const rr=(()=>typeof Symbol=="function"&&Symbol.observable||"@@observable")();function gn(n,t){const e=ze(n),r=ze(t);return typeof r=="string"?typeof e=="string"?r===e:!1:typeof e=="string"?e in r:Object.keys(e).every(s=>s in r?gn(e[s],r[s]):!1)}function vn(n){try{return xe(n)?n:n.toString().split(Ie)}catch{throw new Error(`'${n}' is not a valid state path.`)}}function ir(n){return typeof n=="object"&&"value"in n&&"context"in n&&"event"in n}function ze(n){if(ir(n))return n.value;if(xe(n))return kt(n);if(typeof n!="string")return n;const t=vn(n);return kt(t)}function kt(n){if(n.length===1)return n[0];const t={};let e=t;for(let r=0;r<n.length-1;r++)if(r===n.length-2)e[n[r]]=n[r+1];else{const s=e;e={},s[n[r]]=e}return t}function At(n,t){const e={},r=Object.keys(n);for(let s=0;s<r.length;s++){const a=r[s];e[a]=t(n[a],a,n,s)}return e}function et(n){return[].concat(...n)}function yn(n){return xe(n)?n:[n]}function ne(n){return n===void 0?[]:yn(n)}function bn(n,t,e){if(typeof n=="function")return n({context:t,event:e});const r={},s={context:t,event:e};for(const a of Object.keys(n)){const l=n[a];typeof l=="function"?r[a]=l(s):r[a]=l}return r}function xe(n){return Array.isArray(n)}function sr(n){return typeof n.type=="string"&&(n.type===Jn||n.type.startsWith(Yn))}function ye(n){return yn(n).map(t=>typeof t>"u"||typeof t=="string"?{target:t}:t)}function wn(n){if(!(n===void 0||n===Zn))return ne(n)}function or(n,t){if(typeof n=="object"){if("src"in n)return n;if("transition"in n)return{id:t,src:n}}return{id:t,src:n}}function ar(n,t,e){const r=()=>{},s=typeof n=="object",a=s?n:null;return{next:((s?n.next:n)||r).bind(a),error:((s?n.error:t)||r).bind(a),complete:((s?n.complete:e)||r).bind(a)}}function lr(n,t){return`${n}:invocation[${t}]`}function He(n){return n?"transition"in n?{src:n,input:void 0}:n:void 0}const tt="xstate.stop";function cr(){let n=0;const t=new Map,e=new Map,r=new WeakMap;return{_bookId:()=>`x:${n++}`,_register:(a,l)=>(t.set(a,l),a),_unregister:a=>{t.delete(a.sessionId);const l=r.get(a);l!==void 0&&(e.delete(l),r.delete(a))},get:a=>e.get(a),_set:(a,l)=>{const d=e.get(a);if(d&&d!==l)throw new Error(`Actor with system ID '${a}' already exists.`);e.set(a,l),r.set(l,a)}}}let U=function(n){return n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped",n}({});const ur={deferEvents:!0,clock:{setTimeout:(n,t)=>setTimeout(n,t),clearTimeout:n=>clearTimeout(n)},logger:console.log.bind(console),devTools:!1};class fr{constructor(t,e){this.logic=t,this._state=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new Tt(this._process.bind(this)),this.delayedEventsMap={},this.observers=new Set,this.logger=void 0,this.status=U.NotStarted,this._parent=void 0,this.ref=void 0,this._actorContext=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const r={...ur,...e},{clock:s,logger:a,parent:l,id:d,systemId:u}=r,f=this;this.system=(l==null?void 0:l.system)??cr(),u&&(this._systemId=u,this.system._set(u,this)),this.sessionId=this.system._bookId(),this.id=d??this.sessionId,this.logger=a,this.clock=s,this._parent=l,this.options=r,this.src=r.src,this.ref=this,this._actorContext={self:f,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:_=>{this._deferred.push(_)},system:this.system,stopChild:_=>{if(_._parent!==this)throw new Error(`Cannot stop child actor ${_.id} of ${this.id} because it is not a child`);_._stop()}},this.send=this.send.bind(this),this._initState()}_initState(){var t;this._state=this.options.state?this.logic.restoreState?this.logic.restoreState(this.options.state,this._actorContext):this.options.state:this.logic.getInitialState(this._actorContext,(t=this.options)==null?void 0:t.input)}update(t){var a,l,d,u,f;this._state=t;const e=this.getSnapshot();let r;for(;r=this._deferred.shift();)r();for(const _ of this.observers)(a=_.next)==null||a.call(_,e);const s=(d=(l=this.logic).getStatus)==null?void 0:d.call(l,t);switch(s==null?void 0:s.status){case"done":this._stopProcedure(),this._doneEvent=Br(this.id,s.data),(u=this._parent)==null||u.send(this._doneEvent),this._complete();break;case"error":this._stopProcedure(),(f=this._parent)==null||f.send(We(this.id,s.data)),this._error(s.data);break}}subscribe(t,e,r){var a;const s=ar(t,e,r);return this.observers.add(s),this.status===U.Stopped&&((a=s.complete)==null||a.call(s),this.observers.delete(s)),{unsubscribe:()=>{this.observers.delete(s)}}}start(){return this.status===U.Running?this:(this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this.status=U.Running,this.logic.start&&this.logic.start(this._state,this._actorContext),this.update(this._state),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this)}_process(t){try{const e=this.logic.transition(this._state,t,this._actorContext);this.update(e),t.type===tt&&(this._stopProcedure(),this._complete())}catch(e){if(this.observers.size>0)this.observers.forEach(r=>{var s;(s=r.error)==null||s.call(r,e)}),this.stop();else throw e}}_stop(){return this.status===U.Stopped?this:(this.mailbox.clear(),this.status===U.NotStarted?(this.status=U.Stopped,this):(this.mailbox.enqueue({type:tt}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){var t;for(const e of this.observers)(t=e.complete)==null||t.call(e);this.observers.clear()}_error(t){var e;for(const r of this.observers)(e=r.error)==null||e.call(r,t);this.observers.clear()}_stopProcedure(){if(this.status!==U.Running)return this;for(const t of Object.keys(this.delayedEventsMap))this.clock.clearTimeout(this.delayedEventsMap[t]);return this.mailbox.clear(),this.mailbox=new Tt(this._process.bind(this)),this.status=U.Stopped,this.system._unregister(this),this}send(t){if(typeof t=="string")throw new Error(`Only event objects may be sent to actors; use .send({ type: "${t}" }) instead`);if(this.status!==U.Stopped){if(this.status!==U.Running&&!this.options.deferEvents)throw new Error(`Event "${t.type}" was sent to uninitialized actor "${this.id}". Make sure .start() is called for this actor, or set { deferEvents: true } in the actor options.
Event: ${JSON.stringify(t)}`);this.mailbox.enqueue(t)}}delaySend({event:t,id:e,delay:r,to:s}){const a=this.clock.setTimeout(()=>{s?s.send(t):this.send(t)},r);e&&(this.delayedEventsMap[e]=a)}cancel(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]}attachDevTools(){const{devTools:t}=this.options;t&&(typeof t=="function"?t:Cn)(this)}toJSON(){return{id:this.id}}getPersistedState(){var t,e;return(e=(t=this.logic).getPersistedState)==null?void 0:e.call(t,this._state)}[rr](){return this}getSnapshot(){return this.logic.getSnapshot?this.logic.getSnapshot(this._state):this._state}}function we(n,t){return new fr(n,t)}function dr(n,t,e,{id:r,systemId:s,src:a,input:l}){const d=He(t.machine.implementations.actors[a]);let u;if(d){const f=l||d.input;u=we(d.src,{id:r,src:a,parent:n==null?void 0:n.self,systemId:s,input:typeof f=="function"?f({context:t.context,event:e.event,self:n==null?void 0:n.self}):f})}return[me(t,{children:{...t.children,[r]:u}}),{id:r,actorRef:u}]}function _r(n,{id:t,actorRef:e}){e&&n.defer(()=>{var r;if(e.status!==U.Stopped)try{(r=e.start)==null||r.call(e)}catch(s){n.self.send(We(t,s));return}})}function pr({id:n,systemId:t,src:e,input:r}){function s(a){}return s.type="xstate.invoke",s.id=n,s.systemId=t,s.src=e,s.input=r,s.resolve=dr,s.execute=_r,s}function hr(n){return{type:"xstate.boolean",params:{op:"not"},children:[Re(n)],predicate:({evaluate:t,guard:e,context:r,event:s,state:a})=>!t(e.children[0],r,s,a)}}function lt(n,t,e,r){var l,d;const{machine:s}=r,a=((d=(l=s==null?void 0:s.implementations)==null?void 0:l.guards)==null?void 0:d[n.type])??n.predicate;if(!a)throw new Error(`Guard '${n.type}' is not implemented.'.`);return a({context:t,event:e,state:r,guard:n,evaluate:lt})}function Re(n,t){var r,s;if(typeof n=="string"){const a=t==null?void 0:t(n);return typeof a=="function"?{type:n,predicate:a,params:{type:n}}:a||{type:n,params:{type:n}}}if(typeof n=="function")return{type:n.name,predicate:n,params:{type:n.name,name:n.name}};const e=t==null?void 0:t(n.type);return typeof e=="function"?{type:n.type,params:n.params||n,children:(r=n.children)==null?void 0:r.map(a=>Re(a,t)),predicate:(t==null?void 0:t(n.type))||n.predicate}:e||{type:n.type,params:n.params||n,children:(s=n.children)==null?void 0:s.map(a=>Re(a,t)),predicate:n.predicate}}function mr(n,t,e){const r=n[0].machine,s=n.find(a=>a.type==="final"&&a.parent===r.root);return s&&s.output?bn(s.output,t,e):void 0}const Be=n=>n.type==="atomic"||n.type==="final";function pe(n){return Object.values(n.states).filter(t=>t.type!=="history")}function ct(n,t){const e=[];let r=n.parent;for(;r&&r!==t;)e.push(r),r=r.parent;return e}function Me(n){const t=new Set(n),e=new Set(n),r=Tn(e);for(const s of t)if(s.type==="compound"&&(!r.get(s)||!r.get(s).length))It(s).forEach(a=>e.add(a));else if(s.type==="parallel"){for(const a of pe(s))if(a.type!=="history"&&!e.has(a))for(const l of It(a))e.add(l)}for(const s of e){let a=s.parent;for(;a;)e.add(a),a=a.parent}return e}function Sn(n,t){const e=t.get(n);if(!e)return{};if(n.type==="compound"){const s=e[0];if(s){if(Be(s))return s.key}else return{}}const r={};for(const s of e)r[s.key]=Sn(s,t);return r}function Tn(n){const t=new Map;for(const e of n)t.has(e)||t.set(e,[]),e.parent&&(t.has(e.parent)||t.set(e.parent,[]),t.get(e.parent).push(e));return t}function kn(n,t){const e=Me(t);return Sn(n,Tn(e))}function Ne(n,t=n[0].machine.root){return t.type==="compound"?pe(t).some(e=>e.type==="final"&&n.includes(e)):t.type==="parallel"?pe(t).every(e=>Ne(n,e)):!1}const Se=n=>n[0]===Kn;function gr(n,t){return n.transitions.get(t)||[...n.transitions.keys()].filter(r=>{if(r===zn)return!0;if(!r.endsWith(".*"))return!1;const s=r.split("."),a=t.split(".");for(let l=0;l<s.length;l++){const d=s[l],u=a[l];if(d==="*")return l===s.length-1;if(d!==u)return!1}return!0}).sort((r,s)=>s.length-r.length).flatMap(r=>n.transitions.get(r))}function vr(n){const t=n.config.after;if(!t)return[];const e=(s,a)=>{const l=typeof s=="function"?`${n.id}:delay[${a}]`:s,d=Vr(l,n.id);return n.entry.push(Gr({type:d},{id:d,delay:s})),n.exit.push(nr(d)),d};return(xe(t)?t.map((s,a)=>{const l=e(s.delay,a);return{...s,event:l}}):Object.keys(t).flatMap((s,a)=>{const l=t[s],d=typeof l=="string"?{target:l}:l,u=isNaN(+s)?s:+s,f=e(u,a);return ne(d).map(_=>({..._,event:f,delay:u}))})).map(s=>{const{delay:a}=s;return{...oe(n,s.event,s),delay:a}})}function oe(n,t,e){const r=wn(e.target),s=e.reenter??!1,{guards:a}=n.machine.implementations,l=An(n,r),d={...e,actions:ne(e.actions),guard:e.guard?Re(e.guard,u=>a[u]):void 0,target:l,source:n,reenter:s,eventType:t,toJSON:()=>({...d,source:`#${n.id}`,target:l?l.map(u=>`#${u.id}`):void 0})};return d}function yr(n){const t=new Map;if(n.config.on)for(const e of Object.keys(n.config.on)){if(e===hn)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const r=n.config.on[e];t.set(e,ye(r).map(s=>oe(n,e,s)))}if(n.config.onDone){const e=String(rt(n.id));t.set(e,ye(n.config.onDone).map(r=>oe(n,e,r)))}for(const e of n.invoke){if(e.onDone){const r=`done.invoke.${e.id}`;t.set(r,ye(e.onDone).map(s=>oe(n,r,s)))}if(e.onError){const r=`error.platform.${e.id}`;t.set(r,ye(e.onError).map(s=>oe(n,r,s)))}if(e.onSnapshot){const r=`xstate.snapshot.${e.id}`;t.set(r,ye(e.onSnapshot).map(s=>oe(n,r,s)))}}for(const e of n.after){let r=t.get(e.eventType);r||(r=[],t.set(e.eventType,r)),r.push(e)}return t}function br(n,t){if(typeof t=="string"||xe(t)){const e=ne(t).map(a=>{const l=typeof a=="string"?Se(a)?n.machine.getStateNodeById(a):n.states[a]:a;if(!l)throw new Error(`Initial state node "${a}" not found on parent state node #${n.id}`);if(!he(l,n))throw new Error(`Invalid initial target: state node #${l.id} is not a descendant of #${n.id}`);return l}),r=An(n,e),s={source:n,actions:[],eventType:null,reenter:!1,target:r,toJSON:()=>({...s,source:`#${n.id}`,target:r?r.map(a=>`#${a.id}`):void 0})};return s}return oe(n,"__INITIAL__",{target:ne(t.target).map(e=>typeof e=="string"?Se(e)?e:`${Ie}${e}`:e),actions:t.actions})}function An(n,t){if(t!==void 0)return t.map(e=>{if(typeof e!="string")return e;if(Se(e))return n.machine.getStateNodeById(e);const r=e[0]===Ie;if(r&&!n.parent)return Ve(n,e.slice(1));const s=r?n.key+e:e;if(n.parent)try{return Ve(n.parent,s)}catch(a){throw new Error(`Invalid transition definition for state node '${n.id}':
${a.message}`)}else throw new Error(`Invalid target: "${e}" is not a valid target from the root node. Did you mean ".${e}"?`)})}function In(n){const t=wn(n.target);return t?t.map(e=>typeof e=="string"?Ve(n.parent,e):e):n.parent.initial.target}function Ge(n){return n.type==="history"}function It(n){const t=new Set;function e(r){if(!t.has(r)){if(t.add(r),r.type==="compound")for(const s of r.initial.target){for(const a of ct(s,n))t.add(a);e(s)}else if(r.type==="parallel")for(const s of pe(r))e(s)}}return e(n),[...t]}function Te(n,t){if(Se(t))return n.machine.getStateNodeById(t);if(!n.states)throw new Error(`Unable to retrieve child state '${t}' from '${n.id}'; no child states exist.`);const e=n.states[t];if(!e)throw new Error(`Child state '${t}' does not exist on '${n.id}'`);return e}function Ve(n,t){if(typeof t=="string"&&Se(t))try{return n.machine.getStateNodeById(t)}catch{}const e=vn(t).slice();let r=n;for(;e.length;){const s=e.shift();if(!s.length)break;r=Te(r,s)}return r}function Pe(n,t){const e=t instanceof K?t.value:ze(t);if(typeof e=="string")return[n,n.states[e]];const r=Object.keys(e),s=r.map(a=>Te(n,a)).filter(Boolean);return[n.machine.root,n].concat(s,r.reduce((a,l)=>{const d=Te(n,l);if(!d)return a;const u=Pe(d,e[l]);return a.concat(u)},[]))}function wr(n,t,e,r){const a=Te(n,t).next(e,r);return!a||!a.length?n.next(e,r):a}function Sr(n,t,e,r){const s=Object.keys(t),a=Te(n,s[0]),l=ut(a,t[s[0]],e,r);return!l||!l.length?n.next(e,r):l}function Tr(n,t,e,r){const s=[];for(const a of Object.keys(t)){const l=t[a];if(!l)continue;const d=Te(n,a),u=ut(d,l,e,r);u&&s.push(...u)}return s.length?s:n.next(e,r)}function ut(n,t,e,r){return typeof t=="string"?wr(n,t,e,r):Object.keys(t).length===1?Sr(n,t,e,r):Tr(n,t,e,r)}function kr(n){return Object.keys(n.states).map(t=>n.states[t]).filter(t=>t.type==="history")}function he(n,t){let e=n;for(;e.parent&&e.parent!==t;)e=e.parent;return e.parent===t}function Et(n){const t=[];let e=n.parent;for(;e;)t.unshift(e),e=e.parent;return t}function Ar(n,t){const e=new Set(n),r=new Set(t);for(const s of e)if(r.has(s))return!0;for(const s of r)if(e.has(s))return!0;return!1}function En(n,t,e){const r=new Set;for(const s of n){let a=!1;const l=new Set;for(const d of r)if(Ar(nt([s],t,e),nt([d],t,e)))if(he(s.source,d.source))l.add(d);else{a=!0;break}if(!a){for(const d of l)r.delete(d);r.add(s)}}return Array.from(r)}function Ir(n){const[t]=n;let e=Et(t),r=[];for(const s of n){const a=Et(s);r=e.filter(l=>a.includes(l)),e=r,r=[]}return e[e.length-1]}function ft(n,t){if(!n.target)return[];const e=new Set;for(const r of n.target)if(Ge(r))if(t[r.id])for(const s of t[r.id])e.add(s);else for(const s of ft({target:In(r)},t))e.add(s);else e.add(r);return[...e]}function On(n,t){const e=ft(n,t);return e?!n.reenter&&n.source.type!=="parallel"&&e.every(s=>he(s,n.source))?n.source:Ir(e.concat(n.source)):null}function nt(n,t,e){var s;const r=new Set;for(const a of n)if((s=a.target)!=null&&s.length){const l=On(a,e);for(const d of t)he(d,l)&&r.add(d)}return[...r]}function De(n,t,e,r,s){const a=new Set(t.configuration);if(!n.length)return t;const l=Er(n,t,a,r,e,s);return me(l,{value:{}})}function Er(n,t,e,r,s,a){const l=[],d={...t.historyValue},u=En(n,e,d),f=[...t._internalQueue];a||$r(u,e,d,l),l.push(...u.flatMap(o=>o.actions)),Or(r,u,e,l,f,t,d,a);const _=[...e],i=Ne(_);if(i){const o=_.sort((c,p)=>p.order-c.order).flatMap(c=>c.exit);l.push(...o)}try{const o=qe(l,r,t,s),c=i?mr(_,o.context,r):void 0;return f.push(...o._internalQueue),me(t,{configuration:_,historyValue:d,_internalQueue:f,context:o.context,done:i,output:c,children:o.children})}catch(o){throw o}}function Or(n,t,e,r,s,a,l,d){const u=new Set,f=new Set;$n(t,l,f,u),d&&f.add(a.machine.root);for(const _ of[...u].sort((i,o)=>i.order-o.order)){e.add(_);for(const i of _.invoke)r.push(pr(i));if(r.push(..._.entry),f.has(_))for(const i of f){const o=i.initial.actions;r.push(...o)}if(_.type==="final"){const i=_.parent;if(!i.parent)continue;if(s.push(rt(i.id,_.output?bn(_.output,a.context,n):void 0)),i.parent){const o=i.parent;o.type==="parallel"&&pe(o).every(c=>Ne([...e],c))&&s.push(rt(o.id))}}}}function $n(n,t,e,r){for(const s of n){for(const d of s.target||[])be(d,t,e,r);const a=On(s,t),l=ft(s,t);for(const d of l)Le(d,a,r,t,e)}}function be(n,t,e,r){if(Ge(n))if(t[n.id]){const s=t[n.id];for(const a of s)be(a,t,e,r);for(const a of s){Le(a,n.parent,r,t,e);for(const l of e)e.add(l)}}else{const s=In(n);for(const a of s)be(a,t,e,r);for(const a of s){Le(a,n,r,t,e);for(const l of e)e.add(l)}}else if(r.add(n),n.type==="compound"){e.add(n);const s=n.initial.target;for(const a of s)be(a,t,e,r);for(const a of s)Le(a,n,r,t,e)}else if(n.type==="parallel")for(const s of pe(n).filter(a=>!Ge(a)))[...r].some(a=>he(a,s))||be(s,t,e,r)}function Le(n,t,e,r,s){const a=ct(n,t);for(const l of a)if(e.add(l),l.type==="parallel")for(const d of pe(l).filter(u=>!Ge(u)))[...e].some(u=>he(u,d))||be(d,r,s,e)}function $r(n,t,e,r){const s=nt(n,t,e);s.sort((a,l)=>l.order-a.order);for(const a of s)for(const l of kr(a)){let d;l.history==="deep"?d=u=>Be(u)&&he(u,a):d=u=>u.parent===a,e[l.id]=Array.from(t).filter(d)}for(const a of s)r.push(...a.exit,...a.invoke.map(l=>Mn(l.id))),t.delete(a)}function qe(n,t,e,r){const{machine:s}=e;let a=me(e,{_internalQueue:[]});for(const l of n){const d=typeof l=="function"?l:s.implementations.actions[typeof l=="string"?l:l.type];if(!d)continue;const u={context:a.context,event:t,self:r==null?void 0:r.self,system:r==null?void 0:r.system,action:typeof l=="string"?{type:l}:l};if(!("resolve"in d)){(r==null?void 0:r.self.status)===U.Running?d(u):r==null||r.defer(()=>d(u));continue}const f=d,[_,i,o]=f.resolve(r,a,u,d);a=_,"execute"in d&&((r==null?void 0:r.self.status)===U.Running?f.execute(r,i):r==null||r.defer(f.execute.bind(null,r,i))),o&&(a=qe(o,t,a,r))}return a}function Je(n,t,e){let r=n;const s=[];if(t.type===tt)return r=Ot(t,r,e),s.push(r),{state:r,microstates:s};let a=t;if(a.type!==mn){const l=$t(a,r);r=De(l,n,e,a,!1),s.push(r)}for(;!r.done;){let l=Mr(r,a);if(l.length)r=De(l,r,e,a,!1),s.push(r);else if(r._internalQueue.length){a=r._internalQueue[0];const d=$t(a,r);r=De(d,r,e,a,!1),r._internalQueue.shift(),s.push(r)}else break}return r.done&&Ot(a,r,e),{state:r,microstates:s}}function Ot(n,t,e){const r=[];for(const s of t.configuration.sort((a,l)=>l.order-a.order))r.push(...s.exit);for(const s of Object.values(t.children))r.push(Mn(s));return qe(r,n,t,e)}function $t(n,t){return t.machine.getTransitionData(t,n)}function Mr(n,t){const e=new Set,r=n.configuration.filter(Be);for(const s of r)e:for(const a of[s].concat(ct(s,null)))if(a.always){for(const l of a.always)if(l.guard===void 0||lt(l.guard,n.context,t,n)){e.add(l);break e}}return En(Array.from(e),new Set(n.configuration),n.historyValue)}function Mt(n,t){const e=Me(Pe(n,t));return kn(n,[...e])}function Pr(n){const t=[],e=n.initial,r=new Set;$n([e],{},new Set([n]),r);for(const a of[...r].sort((l,d)=>l.order-d.order))t.push(a);return t}class K{static from(t,e={},r){if(t instanceof K)return t.context!==e?new K({value:t.value,context:e,meta:{},configuration:[],children:{}},r):t;const s=Me(Pe(r.root,t));return new K({value:t,context:e,meta:void 0,configuration:Array.from(s),children:{}},r)}constructor(t,e){this.machine=e,this.tags=void 0,this.value=void 0,this.done=void 0,this.output=void 0,this.context=void 0,this.historyValue={},this._internalQueue=void 0,this.configuration=void 0,this.children=void 0,this.context=t.context,this._internalQueue=t._internalQueue??[],this.historyValue=t.historyValue||{},this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration??Array.from(Me(Pe(e.root,t.value))),this.children=t.children,this.value=kn(e.root,this.configuration),this.tags=new Set(et(this.configuration.map(r=>r.tags))),this.done=t.done??!1,this.output=t.output}toStrings(t=this.value){if(typeof t=="string")return[t];const e=Object.keys(t);return e.concat(...e.map(r=>this.toStrings(t[r]).map(s=>r+Ie+s)))}toJSON(){const{configuration:t,tags:e,machine:r,...s}=this;return{...s,tags:Array.from(e),meta:this.meta}}matches(t){return gn(t,this.value)}hasTag(t){return this.tags.has(t)}can(t){const e=this.machine.getTransitionData(this,t);return!!(e!=null&&e.length)&&e.some(r=>r.target!==void 0||r.actions.length)}get nextEvents(){return _e(this,"nextEvents",()=>[...new Set(et([...this.configuration.map(t=>t.ownEvents)]))])}get meta(){return this.configuration.reduce((t,e)=>(e.meta!==void 0&&(t[e.id]=e.meta),t),{})}}function me(n,t={}){return new K({...n,...t},n.machine)}function xr(n){var d,u;const{configuration:t,tags:e,machine:r,children:s,...a}=n,l={};for(const f in s)l[f]={state:(u=(d=s[f]).getPersistedState)==null?void 0:u.call(d),src:s[f].src};return{...a,children:l}}function jr(n,t,e,{actorRef:r}){const s=typeof r=="function"?r(e):r,a=typeof s=="string"?t.children[s]:s;let l=t.children;return a&&(l={...l},delete l[a.id]),[me(t,{children:l}),a]}function Dr(n,t){if(t){if(t.status!==U.Running){n.stopChild(t);return}n.defer(()=>{n.stopChild(t)})}}function Mn(n){function t(e){}return t.type="xstate.stop",t.actorRef=n,t.resolve=jr,t.execute=Dr,t}function Lr(n,{machine:t,context:e},r,s){const a=(l,d={})=>{const{systemId:u}=d;if(typeof l=="string"){const f=He(t.implementations.actors[l]);if(!f)throw new Error(`Actor logic '${l}' not implemented in machine '${t.id}'`);const _="input"in d?d.input:f.input,i=we(f.src,{id:d.id,parent:n.self,input:typeof _=="function"?_({context:e,event:r,self:n.self}):_,systemId:u});return s[i.id]=i,i}else return we(l,{id:d.id,parent:n.self,input:d.input,systemId:u})};return(l,d)=>{const u=a(l,d);return s[u.id]=u,n.defer(()=>{var f;if(u.status!==U.Stopped)try{(f=u.start)==null||f.call(u)}catch(_){n.self.send(We(u.id,_));return}}),u}}function Fr(n,t,e,{assignment:r}){if(!t.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const s={},a={context:t.context,event:e.event,action:e.action,spawn:Lr(n,t,e.event,s),self:n==null?void 0:n.self,system:n==null?void 0:n.system};let l={};if(typeof r=="function")l=r(a);else for(const u of Object.keys(r)){const f=r[u];l[u]=typeof f=="function"?f(a):f}const d=Object.assign({},t.context,l);return[me(t,{context:d,children:Object.keys(s).length?{...t.children,...s}:t.children})]}function Pn(n){function t(e){}return t.type="xstate.assign",t.assignment=n,t.resolve=Fr,t}function Hr(n,t,e,{event:r,id:s,delay:a}){const l=t.machine.implementations.delays;if(typeof r=="string")throw new Error(`Only event objects may be used with raise; use raise({ type: "${r}" }) instead`);const d=typeof r=="function"?r(e):r;let u;if(typeof a=="string"){const f=l&&l[a];u=typeof f=="function"?f(e):f}else u=typeof a=="function"?a(e):a;return[typeof u!="number"?me(t,{_internalQueue:t._internalQueue.concat(d)}):t,{event:d,id:s,delay:u}]}function Rr(n,t){if(typeof t.delay=="number"){n.self.delaySend(t);return}}function Gr(n,t){function e(r){}return e.type="xstate.raise",e.event=n,e.id=t==null?void 0:t.id,e.delay=t==null?void 0:t.delay,e.resolve=Hr,e.execute=Rr,e}function Vr(n,t){const e=t?`#${t}`:"";return`${se.After}(${n})${e}`}function rt(n,t){const e=`${se.DoneState}.${n}`,r={type:e,output:t};return r.toString=()=>e,r}function Br(n,t){const e=`${se.DoneInvoke}.${n}`,r={type:e,output:t};return r.toString=()=>e,r}function We(n,t){const e=`${se.ErrorPlatform}.${n}`,r={type:e,data:t};return r.toString=()=>e,r}function Nr(n){return{type:mn,input:n}}const qr={},Ee=n=>typeof n=="string"?{type:n}:typeof n=="function"?"resolve"in n?{type:n.type}:{type:n.name}:n;class dt{constructor(t,e){if(this.config=t,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=e._parent,this.key=e._key,this.machine=e._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join(Ie),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?At(this.config.states,(r,s)=>new dt(r,{_parent:this,_key:s,_machine:this.machine})):qr,this.type==="compound"&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=this.config.history===!0?"shallow":this.config.history||!1,this.entry=ne(this.config.entry),this.exit=ne(this.config.exit),this.meta=this.config.meta,this.output=this.type==="final"?this.config.output:void 0,this.tags=ne(t.tags)}_initialize(){this.transitions=yr(this),this.config.always&&(this.always=ye(this.config.always).map(t=>oe(this,hn,t))),Object.keys(this.states).forEach(t=>{this.states[t]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(Ee),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(t=>`#${t.id}`),source:`#${this.id}`,actions:this.initial.actions.map(Ee),eventType:null})}:void 0,history:this.history,states:At(this.states,t=>t.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(t=>({...t,actions:t.actions.map(Ee)})),entry:this.entry.map(Ee),exit:this.exit.map(Ee),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return _e(this,"invoke",()=>ne(this.config.invoke).map((t,e)=>{const r=lr(this.id,e),s=or(t,r),a=s.id||r,l=s.src,{systemId:d}=s,u=typeof l=="string"||"type"in l?l:a;return!this.machine.implementations.actors[a]&&typeof l!="string"&&!("type"in l)&&(this.machine.implementations.actors={...this.machine.implementations.actors,[a]:l}),{type:"xstate.invoke",...s,src:u,id:a,systemId:d,toJSON(){const{onDone:f,onError:_,...i}=s;return{...i,type:"xstate.invoke",src:u,id:a}}}}))}get on(){return _e(this,"on",()=>[...this.transitions].flatMap(([e,r])=>r.map(s=>[e,s])).reduce((e,[r,s])=>(e[r]=e[r]||[],e[r].push(s),e),{}))}get after(){return _e(this,"delayedTransitions",()=>vr(this))}get initial(){return _e(this,"initial",()=>br(this,this.config.initial||[]))}next(t,e){const r=e.type,s=[];let a;const l=_e(this,`candidates-${r}`,()=>gr(this,r));for(const d of l){const{guard:u}=d,f=t.context;let _=!1;try{_=!u||lt(u,f,e,t)}catch(i){throw new Error(`Unable to evaluate guard '${u.type}' in transition for event '${r}' in state node '${this.id}':
${i.message}`)}if(_){s.push(...d.actions),a=d;break}}return a?[a]:void 0}get target(){if(this.type==="history")return this.config.target}get stateIds(){const t=et(Object.keys(this.states).map(e=>this.states[e].stateIds));return[this.id].concat(t)}get events(){return _e(this,"events",()=>{const{states:t}=this,e=new Set(this.ownEvents);if(t)for(const r of Object.keys(t)){const s=t[r];if(s.states)for(const a of s.events)e.add(`${a}`)}return Array.from(e)})}get ownEvents(){const t=new Set([...this.transitions.keys()].filter(e=>this.transitions.get(e).some(r=>!(!r.target&&!r.actions.length&&!r.reenter))));return Array.from(t)}}const Wr="#";class _t{constructor(t,e){this.config=t,this.version=void 0,this.implementations=void 0,this.types=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.__TContext=void 0,this.__TEvent=void 0,this.__TAction=void 0,this.__TActorMap=void 0,this.__TResolvedTypesMeta=void 0,this.id=t.id||"(machine)",this.implementations={actors:(e==null?void 0:e.actors)??{},actions:(e==null?void 0:e.actions)??{},delays:(e==null?void 0:e.delays)??{},guards:(e==null?void 0:e.guards)??{}},this.version=this.config.version,this.types=this.config.types??{},this.transition=this.transition.bind(this),this.root=new dt(t,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(t){const{actions:e,guards:r,actors:s,delays:a}=this.implementations;return new _t(this.config,{actions:{...e,...t.actions},guards:{...r,...t.guards},actors:{...s,...t.actors},delays:{...a,...t.delays}})}resolveState(t){const e=Me(Pe(this.root,t.value)),r=Array.from(e);return this.createState({...t,value:Mt(this.root,t.value),configuration:r,done:Ne(r)})}resolveStateValue(t,...[e]){const r=Mt(this.root,t);return this.resolveState(K.from(r,e,this))}transition(t,e,r){if(sr(e)&&!t.nextEvents.some(a=>a===e.type))throw e.data;const{state:s}=Je(t,e,r);return s}microstep(t,e,r){return Je(t,e,r).microstates}getTransitionData(t,e){return ut(this.root,t.value,t,e)||[]}getPreInitialState(t,e){const{context:r}=this.config,s=this.resolveState(this.createState({value:{},context:typeof r!="function"&&r?r:{},meta:void 0,configuration:Pr(this.root),children:{}}));return typeof r=="function"?qe([Pn(({spawn:l,event:d})=>r({spawn:l,input:d.input}))],e,s,t):s}getInitialState(t,e){const r=Nr(e),s=this.getPreInitialState(t,r),a=De([{target:[...s.configuration].filter(Be),source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],s,t,r,!0),{state:l}=Je(a,r,t);return l}start(t,e){Object.values(t.children).forEach(r=>{var s;if(r.status===0)try{(s=r.start)==null||s.call(r)}catch(a){e.self.send(We(r.id,a))}})}getStateNodeById(t){const e=t.split(Ie),r=e.slice(1),s=Se(e[0])?e[0].slice(Wr.length):e[0],a=this.idMap.get(s);if(!a)throw new Error(`Child state node '#${s}' does not exist on machine '${this.id}'`);return Ve(a,r)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedState(t){return xr(t)}createState(t){return t instanceof K?t:new K(t,this)}getStatus(t){return t.done?{status:"done",data:t.output}:{status:"active"}}restoreState(t,e){const r={};Object.keys(t.children).forEach(a=>{var o,c;const l=t.children[a],d=l.state,u=l.src,f=u?(o=He(this.implementations.actors[u]))==null?void 0:o.src:void 0;if(!f)return;const _=(c=f.restoreState)==null?void 0:c.call(f,d,e),i=we(f,{id:a,state:_});r[a]=i});const s=this.createState(new K({...t,children:r},this));return s.configuration.forEach(a=>{a.invoke&&a.invoke.forEach(l=>{const{id:d,src:u}=l;if(r[d])return;const f=He(this.implementations.actors[u]);if(f){const _=we(f.src,{id:d,parent:e==null?void 0:e.self,input:"input"in l?l.input:f.input});r[d]=_}})}),s}}function Ur(n,t){return new _t(n,t)}function Xr(n,...[t={}]){const{guards:e,actions:r,actors:s,delays:a,...l}=t,d={guards:e,actions:r,actors:s,delays:a},u=n.provide(d),f=we(u,l).start();Rn(()=>f.stop());let _=f.getSnapshot();return{state:dn(_,o=>f.subscribe(c=>{_!==c&&(_=c,o(_))}).unsubscribe),send:f.send,service:f}}const xn={},Qr=n=>{Gn(xn,n)},ge=()=>Vn(xn),Cr=Ur({id:"gameClient",context:({input:n})=>n,types:{context:{},events:{},actors:{}},initial:"Lobby",states:{Lobby:{initial:"Assigning sides",states:{"Assigning sides":{description:`This is the first step of the game setup, where users can join and are assigned to be either attacker or defender.

Users can also be made administrators.`,initial:"Incomplete",states:{Incomplete:{always:{target:"Ready",guard:"allSidesAssigned",description:"All users have been assigned a side and there is an admin on both sides",reenter:!1}},Ready:{on:{"next step":{target:"Ready",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1}}}},always:{target:"Assigning roles",guard:"finishedAssigningSides",reenter:!1},on:{"assign side":{target:"Assigning sides",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1},"assign admin":{target:"Assigning sides",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1}}},"Assigning roles":{description:"All users have been assigned a side, and now the roles will be configured.",initial:"Incomplete",states:{Incomplete:{always:[{target:"Ready",guard:"allRolesAssignedOfSide",description:"All users have been assigned a role.",reenter:!1},{target:"Editing player",guard:"isEditingPlayerOfSide",reenter:!1}]},Ready:{always:{target:"Editing player",guard:"isEditingPlayerOfSide",reenter:!1},on:{"next step":{target:"Ready",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1}}},"Editing player":{description:"Shows a modal where the admin can select the user, role and face image",always:{target:"Incomplete",guard:"isNotEditingPlayerOfSide",reenter:!1},on:{"assign role":{target:"Editing player",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1}}}},always:{target:"Waiting for other side",guard:"finishedAssigningRolesOfSide",reenter:!1},on:{"start editing player":{target:"Assigning roles",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1},"stop editing player":{target:"Assigning roles",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1}}},"Waiting for other side":{}},always:{target:"Ingame",guard:"finishedAssigningRoles",reenter:!1}},Ingame:{states:{Gameloop:{initial:"Waiting",states:{Waiting:{always:{target:"Playing",guard:"userOnActiveSide",reenter:!1}},Playing:{initial:"Ready to move",states:{"Ready to move":{always:{target:"Ready for action",guard:"playerMoved",reenter:!1},on:{move:{target:"Ready to move",guard:"userControlsPlayer",actions:{params:{},type:"forwardToServer"},reenter:!1}}},"Ready for action":{always:{target:"Ready to move",guard:"playerPerformedAction",reenter:!1},on:{"perform action":{target:"Ready for action",guard:"userControlsPlayer",actions:{params:{},type:"forwardToServer"},reenter:!1}}}},always:{target:"Waiting",guard:"userNotOnActiveSide",reenter:!1}}}},"Global Attack":{initial:"Showing current global attack",states:{"Showing current global attack":{on:{"dismiss global attack":{target:"Dismissed",reenter:!1}}},Dismissed:{on:{"new global attack":{target:"Showing current global attack",reenter:!1},"show global attack":{target:"Showing current global attack",reenter:!1}}}}},Sides:{initial:"Initial",states:{Initial:{always:[{target:"Defense",guard:"userIsDefender",reenter:!1},{target:"Attack",reenter:!1}]},Defense:{states:{"Attacker visibility":{initial:"Invisible",states:{Invisible:{always:{target:"Visible",guard:"attackerShouldBeVisible",reenter:!1}},Visible:{always:{target:"Invisible",guard:"attackerShouldBeInvisible",reenter:!1}}}}},type:"parallel"},Attack:{}},on:{"switch sides":{target:"Sides",guard:"isAdmin",actions:{params:{},type:"forwardToServer"},reenter:!1}}}},always:{target:"Finished",guard:"gameFinished",reenter:!1},type:"parallel"},Finished:{description:"The game finished, but the users can still communicate by sending emojis."},"Server stopped":{type:"final"}},always:{target:".Server stopped",guard:"isServerStopped",reenter:!1},on:{"shared game context update":{target:"#gameClient",actions:{params:{},type:"updateSharedGameContext"},reenter:!1},"send emoji":{target:"#gameClient",actions:{params:{},type:"forwardToServer"},reenter:!1},"show emoji":{actions:{params:{},type:"showEmoji"},reenter:!0}}}),Jr={gameFinished:()=>!1,allSidesAssigned:({context:n})=>n.users.every(t=>t.isSideAssigned)&&!!n.users.find(t=>t.side==="defender"&&t.isAdmin)&&!!n.users.find(t=>t.side==="attacker"&&t.isAdmin),finishedAssigningSides:({context:n})=>n.finishedAssigningSides,allRolesAssigned:({context:n})=>n.attack.attacker.isConfigured&&n.defense.defenders.every(t=>t.isConfigured),finishedAssigningRoles:({context:n})=>n.attack.finishedAssigning&&n.defense.finishedAssigning,attackerShouldBeVisible:()=>!1,attackerShouldBeInvisible:()=>!1},Fe=n=>{const t=n.users.find(e=>e.id===n.userId);if(!t)throw new Error("The current user was not found in the users list.");return t},Yr=({send:n,actions:t})=>Cr.provide({actions:{updateSharedGameContext:Pn(({event:e})=>({...e.sharedGameContext})),showEmoji:({event:e})=>{const r=e;t.showEmoji({userId:r.userId,emoji:r.emoji})},forwardToServer:({event:e})=>{const r=e;n({...r,type:`user: ${r.type}`})}},actors:{},guards:{isHost:({context:e})=>e.hostUserId===e.userId,isAdmin:({context:e})=>!!e.users.find(r=>r.id===e.userId&&r.isAdmin),isPlayer:({context:e})=>e.hostUserId!==e.userId,allRolesAssignedOfSide:({context:e})=>{const{side:r}=Fe(e);return r?r==="attacker"?!!e.attack.attacker:e.defense.defenders.length===4:!1},finishedAssigningRolesOfSide:({context:e})=>{const{side:r}=Fe(e);return r?(r==="attacker"?e.attack:e.defense).finishedAssigning:!1},isEditingPlayerOfSide:({context:e})=>{const{side:r}=Fe(e);return r?(r==="attacker"?e.attack:e.defense).editingPlayer!==void 0:!1},isNotEditingPlayerOfSide:hr("isEditingPlayerOfSide"),userControlsPlayer:()=>!1,userOnActiveSide:()=>!1,userNotOnActiveSide:()=>!1,playerMoved:()=>!1,userIsDefender:()=>!1,isServerStopped:()=>!1,playerPerformedAction:()=>!1,...Jr}}),Zr=({gameId:n,userId:t,onMessage:e})=>{const r=Wn({status:"opening",log:[]}),s=(f,_)=>(console.debug("[websocket]",f,_),r.update(i=>({...i,log:[...i.log,`[websocket] ${f}`]}))),a=f=>r.update(_=>({..._,status:f}));let l;const d=()=>{s("connecting");const f=window.location.protocol==="https:"?"wss:":"ws:";l=new WebSocket(`${f}//${window.location.host}/websocket?gameId=${n}&userId=${t}`),l.addEventListener("open",()=>{a("opened"),s("connection open")}),l.addEventListener("close",()=>{a("closed"),s("connection closed")}),l.addEventListener("message",_=>{try{const i=JSON.parse(_.data);i.type!=="mouse position"&&s(`message received: ${_.data}`,_),e(i)}catch(i){s("error parsing message",i)}})},u=f=>{l==null||l.send(JSON.stringify(f))};return{subscribe:r.subscribe,open:d,close:()=>l==null?void 0:l.close(),send:u}};function Kr(n,t){return n===t}const X=(n,t,e=Kr)=>{let r,s=t(n.getSnapshot());return dn(s,l=>(r=n.subscribe(d=>{const u=t(d);e(s,u)||(s=u,l(u))}),()=>{r.unsubscribe()}))};var A=class{static clamp(n,t,e){return Math.max(t,typeof e<"u"?Math.min(n,e):n)}static clampV(n,t,e){return n.map(r=>e?A.clamp(r,t,e):A.clamp(r,t))}static cross(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(e[0]-n[0])*(t[1]-n[1])}static snap(n,t=1){return[Math.round(n[0]/t)*t,Math.round(n[1]/t)*t]}},k=A;k.neg=n=>[-n[0],-n[1]];k.add=(n,t)=>[n[0]+t[0],n[1]+t[1]];k.addScalar=(n,t)=>[n[0]+t,n[1]+t];k.sub=(n,t)=>[n[0]-t[0],n[1]-t[1]];k.subScalar=(n,t)=>[n[0]-t,n[1]-t];k.vec=(n,t)=>[t[0]-n[0],t[1]-n[1]];k.mul=(n,t)=>[n[0]*t,n[1]*t];k.mulV=(n,t)=>[n[0]*t[0],n[1]*t[1]];k.div=(n,t)=>[n[0]/t,n[1]/t];k.divV=(n,t)=>[n[0]/t[0],n[1]/t[1]];k.per=n=>[n[1],-n[0]];k.dpr=(n,t)=>n[0]*t[0]+n[1]*t[1];k.cpr=(n,t)=>n[0]*t[1]-t[0]*n[1];k.len2=n=>n[0]*n[0]+n[1]*n[1];k.len=n=>Math.hypot(n[0],n[1]);k.pry=(n,t)=>A.dpr(n,t)/A.len(t);k.uni=n=>A.div(n,A.len(n));k.normalize=n=>A.uni(n);k.tangent=(n,t)=>A.uni(A.sub(n,t));k.dist2=(n,t)=>A.len2(A.sub(n,t));k.dist=(n,t)=>Math.hypot(n[1]-t[1],n[0]-t[0]);k.fastDist=(n,t)=>{const e=[t[0]-n[0],t[1]-n[1]],r=[Math.abs(e[0]),Math.abs(e[1])];let s=1/Math.max(r[0],r[1]);return s=s*(1.29289-(r[0]+r[1])*s*.29289),[e[0]*s,e[1]*s]};k.ang=(n,t)=>Math.atan2(A.cpr(n,t),A.dpr(n,t));k.angle=(n,t)=>Math.atan2(t[1]-n[1],t[0]-n[0]);k.med=(n,t)=>A.mul(A.add(n,t),.5);k.rot=(n,t=0)=>[n[0]*Math.cos(t)-n[1]*Math.sin(t),n[0]*Math.sin(t)+n[1]*Math.cos(t)];k.rotWith=(n,t,e=0)=>{if(e===0)return n;const r=Math.sin(e),s=Math.cos(e),a=n[0]-t[0],l=n[1]-t[1],d=a*s-l*r,u=a*r+l*s;return[d+t[0],u+t[1]]};k.isEqual=(n,t)=>n[0]===t[0]&&n[1]===t[1];k.lrp=(n,t,e)=>A.add(n,A.mul(A.sub(t,n),e));k.int=(n,t,e,r,s=1)=>{const a=(A.clamp(e,r)-e)/(r-e);return A.add(A.mul(n,1-a),A.mul(t,s))};k.ang3=(n,t,e)=>{const r=A.vec(t,n),s=A.vec(t,e);return A.ang(r,s)};k.abs=n=>[Math.abs(n[0]),Math.abs(n[1])];k.rescale=(n,t)=>{const e=A.len(n);return[t*n[0]/e,t*n[1]/e]};k.isLeft=(n,t,e)=>(t[0]-n[0])*(e[1]-n[1])-(e[0]-n[0])*(t[1]-n[1]);k.clockwise=(n,t,e)=>A.isLeft(n,t,e)>0;k.toFixed=(n,t=2)=>n.map(e=>+e.toFixed(t));k.nearestPointOnLineThroughPoint=(n,t,e)=>A.add(n,A.mul(t,A.pry(A.sub(e,n),t)));k.distanceToLineThroughPoint=(n,t,e)=>A.dist(e,A.nearestPointOnLineThroughPoint(n,t,e));k.nearestPointOnLineSegment=(n,t,e,r=!0)=>{const s=A.uni(A.sub(t,n)),a=A.add(n,A.mul(s,A.pry(A.sub(e,n),s)));if(r){if(a[0]<Math.min(n[0],t[0]))return n[0]<t[0]?n:t;if(a[0]>Math.max(n[0],t[0]))return n[0]>t[0]?n:t;if(a[1]<Math.min(n[1],t[1]))return n[1]<t[1]?n:t;if(a[1]>Math.max(n[1],t[1]))return n[1]>t[1]?n:t}return a};k.distanceToLineSegment=(n,t,e,r=!0)=>A.dist(e,A.nearestPointOnLineSegment(n,t,e,r));k.nudge=(n,t,e)=>A.isEqual(n,t)?n:A.add(n,A.mul(A.uni(A.sub(t,n)),e));k.nudgeAtAngle=(n,t,e)=>[Math.cos(t)*e+n[0],Math.sin(t)*e+n[1]];k.toPrecision=(n,t=4)=>[+n[0].toPrecision(t),+n[1].toPrecision(t)];k.pointsBetween=(n,t,e=6)=>Array.from(Array(e)).map((r,s)=>{const a=s/(e-1),l=Math.min(1,.5+Math.abs(.5-a));return[...A.lrp(n,t,a),l]});k.slope=(n,t)=>n[0]===t[0]?NaN:(n[1]-t[1])/(n[0]-t[0]);k.max=(...n)=>[Math.max(...n.map(t=>t[0])),Math.max(...n.map(t=>t[1]))];k.min=(...n)=>[Math.max(...n.map(t=>t[0])),Math.max(...n.map(t=>t[1]))];var zr=class{constructor(n=[]){this.points=[],this.lengths=[],this.totalLength=0,this.addPoint=t=>{if(this.prev){const e=k.dist(this.prev,t);this.lengths.push(e),this.totalLength+=e,this.points.push(t)}this.prev=t},this.clear=()=>{this.points=this.prev?[this.prev]:[],this.totalLength=0},this.getSplinePoint=t=>{const{points:e}=this,r=e.length-1,s=Math.trunc(t),a=Math.min(s+1,r),l=Math.min(a+1,r),d=Math.min(l+1,r),u=a-1,f=t-s,_=f*f,i=_*f,o=-i+2*_-f,c=3*i-5*_+2,p=-3*i+4*_+f,m=i-_;return[(e[u][0]*o+e[a][0]*c+e[l][0]*p+e[d][0]*m)/2,(e[u][1]*o+e[a][1]*c+e[l][1]*p+e[d][1]*m)/2]},this.points=n,this.lengths=n.map((t,e,r)=>e===0?0:k.dist(t,r[e-1])),this.totalLength=this.lengths.reduce((t,e)=>t+e,0)}},it=class{constructor(n){this.state="idle",this.queue=[],this.timestamp=performance.now(),this.lastRequestId=0,this.timeoutId=0,this.spline=new zr,this.addPoint=t=>{clearTimeout(this.timeoutId);const e=performance.now(),r=Math.min(e-this.timestamp,it.MAX_INTERVAL);if(!this.prevPoint){this.spline.clear(),this.prevPoint=t,this.spline.addPoint(t),this.cb(t),this.state="stopped";return}if(this.state==="stopped"){if(k.dist(this.prevPoint,t)<4){this.cb(t);return}this.spline.clear(),this.spline.addPoint(this.prevPoint),this.spline.addPoint(this.prevPoint),this.spline.addPoint(t),this.state="idle"}else this.spline.addPoint(t);if(r<16){this.prevPoint=t,this.timestamp=e,this.cb(t);return}const s={start:this.spline.points.length-3,from:this.prevPoint,to:t,duration:r};switch(this.prevPoint=t,this.timestamp=e,this.state){case"idle":{this.state="animating",this.animateNext(s);break}case"animating":{this.queue.push(s);break}}},this.animateNext=t=>{const e=performance.now(),r=()=>{const s=(performance.now()-e)/t.duration;if(s<=1&&this.spline.points.length>0){try{this.cb(this.spline.getSplinePoint(s+t.start))}catch(l){console.warn(l)}this.lastRequestId=requestAnimationFrame(r);return}const a=this.queue.shift();a?(this.state="animating",this.animateNext(a)):(this.state="idle",this.timeoutId=setTimeout(()=>{this.state="stopped"},it.MAX_INTERVAL))};r()},this.dispose=()=>{clearTimeout(this.timeoutId)},this.cb=n}},jn=it;jn.MAX_INTERVAL=300;function ei(n){let t,e,r,s,a,l=n[0].name+"",d;return{c(){t=x("div"),e=vt("svg"),r=vt("path"),s=R(),a=x("span"),d=V(l),this.h()},l(u){t=j(u,"DIV",{class:!0});var f=D(t);e=yt(f,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,"stroke-width":!0,stroke:!0,fill:!0,"stroke-linecap":!0,"stroke-linejoin":!0,class:!0});var _=D(e);r=yt(_,"path",{d:!0}),D(r).forEach(w),_.forEach(w),s=G(f),a=j(f,"SPAN",{class:!0});var i=D(a);d=B(i,l),i.forEach(w),f.forEach(w),this.h()},h(){P(r,"d","M7.904 17.563a1.2 1.2 0 0 0 2.228 .308l2.09 -3.093l4.907 4.907a1.067 1.067 0 0 0 1.509 0l1.047 -1.047a1.067 1.067 0 0 0 0 -1.509l-4.907 -4.907l3.113 -2.09a1.2 1.2 0 0 0 -.309 -2.228l-13.582 -3.904l3.904 13.563z"),P(e,"xmlns","http://www.w3.org/2000/svg"),P(e,"width","44"),P(e,"height","44"),P(e,"viewBox","0 0 24 24"),P(e,"stroke-width","1.5"),P(e,"stroke","#2c3e50"),P(e,"fill","white"),P(e,"stroke-linecap","round"),P(e,"stroke-linejoin","round"),P(e,"class","svelte-1y3w9l8"),P(a,"class","name svelte-1y3w9l8"),P(t,"class","cursor svelte-1y3w9l8")},m(u,f){$(u,t,f),I(t,e),I(e,r),I(t,s),I(t,a),I(a,d),n[3](t)},p(u,[f]){f&1&&l!==(l=u[0].name+"")&&ae(d,l)},i:C,o:C,d(u){u&&w(t),n[3](null)}}}function ti(n,t,e){let{position:r}=t,s,a;un(()=>(e(2,s=new jn(([d,u])=>{a.style.setProperty("translate",`${d}px ${u}px`)})),()=>{s==null||s.dispose()}));function l(d){ot[d?"unshift":"push"](()=>{a=d,e(1,a)})}return n.$$set=d=>{"position"in d&&e(0,r=d.position)},n.$$.update=()=>{n.$$.dirty&5&&(s==null||s.addPoint(r.position))},[r,a,s,l]}class ni extends re{constructor(t){super(),ie(this,t,ti,ei,ee,{position:0})}}function Pt(n,t,e){const r=n.slice();return r[9]=t[e],r}function xt(n,t){let e,r,s;return r=new ni({props:{position:t[9]}}),{key:n,first:null,c(){e=z(),ce(r.$$.fragment),this.h()},l(a){e=z(),ue(r.$$.fragment,a),this.h()},h(){this.first=e},m(a,l){$(a,e,l),fe(r,a,l),s=!0},p(a,l){t=a;const d={};l&4&&(d.position=t[9]),r.$set(d)},i(a){s||(F(r.$$.fragment,a),s=!0)},o(a){H(r.$$.fragment,a),s=!1},d(a){a&&w(e),de(r,a)}}}function ri(n){let t,e=[],r=new Map,s,a,l=J(n[2]);const d=u=>u[9].id;for(let u=0;u<l.length;u+=1){let f=Pt(n,l,u),_=d(f);r.set(_,e[u]=xt(_,f))}return{c(){t=x("div");for(let u=0;u<e.length;u+=1)e[u].c();this.h()},l(u){t=j(u,"DIV",{class:!0});var f=D(t);for(let _=0;_<e.length;_+=1)e[_].l(f);f.forEach(w),this.h()},h(){P(t,"class","cursor-overlays svelte-1n4ax7h"),at(()=>n[6].call(t))},m(u,f){$(u,t,f);for(let _=0;_<e.length;_+=1)e[_]&&e[_].m(t,null);s=fn(t,n[6].bind(t)),a=!0},p(u,[f]){f&4&&(l=J(u[2]),ke(),e=pn(e,f,d,1,u,l,r,t,_n,xt,null,Pt),Ae())},i(u){if(!a){for(let f=0;f<l.length;f+=1)F(e[f]);a=!0}},o(u){for(let f=0;f<e.length;f+=1)H(e[f]);a=!1},d(u){u&&w(t);for(let f=0;f<e.length;f+=1)e[f].d();s()}}}function ii(n,t,e){let r,s,{mousePositions:a={}}=t;const l=ge();let d=1,u=1;const f=X(l.machine.service,o=>o.context.users);W(n,f,o=>e(5,s=o));const _=(o,c)=>o.filter(p=>p.isConnected&&!!c[p.id]).map(p=>{const m=c[p.id];return{id:p.id,name:p.name,position:[m[0]*d,m[1]*u]}});function i(){d=this.clientWidth,u=this.clientHeight,e(0,d),e(1,u)}return n.$$set=o=>{"mousePositions"in o&&e(4,a=o.mousePositions)},n.$$.update=()=>{n.$$.dirty&48&&e(2,r=_(s,a))},[d,u,r,f,a,s,i]}class si extends re{constructor(t){super(),ie(this,t,ii,ri,ee,{mousePositions:4})}}function oi(n){const t=n-1;return t*t*t+1}function ai(n,{delay:t=0,duration:e=400,easing:r=Bn}={}){const s=+getComputedStyle(n).opacity;return{delay:t,duration:e,easing:r,css:a=>`opacity: ${a*s}`}}function li(n,{delay:t=0,duration:e=400,easing:r=oi,start:s=0,opacity:a=0}={}){const l=getComputedStyle(n),d=+l.opacity,u=l.transform==="none"?"":l.transform,f=1-s,_=d*(1-a);return{delay:t,duration:e,easing:r,css:(i,o)=>`
			transform: ${u} scale(${1-f*o});
			opacity: ${d-_*o}
		`}}function jt(n,t,e){const r=n.slice();return r[10]=t[e],r}function Dt(n,t,e){const r=n.slice();return r[1]=t[e][0],r[10]=t[e][1],r}function Lt(n,t){let e,r,s=t[10].emoji+"",a,l,d,u=t[10].userName+"",f,_,i,o,c,p;function m(){return t[6](t[1])}return{key:n,first:null,c(){e=x("div"),r=x("span"),a=V(s),l=R(),d=x("span"),f=V(u),this.h()},l(g){e=j(g,"DIV",{class:!0});var h=D(e);r=j(h,"SPAN",{class:!0});var v=D(r);a=B(v,s),v.forEach(w),l=G(h),d=j(h,"SPAN",{class:!0});var y=D(d);f=B(y,u),y.forEach(w),h.forEach(w),this.h()},h(){P(r,"class","emjoi"),P(d,"class","name svelte-csuuvb"),P(e,"class","displayed-emoji svelte-csuuvb"),je(e,"--_x",t[10].position[0]),je(e,"--_y",t[10].position[1]),this.first=e},m(g,h){$(g,e,h),I(e,r),I(r,a),I(e,l),I(e,d),I(d,f),o=!0,c||(p=Y(e,"introend",m),c=!0)},p(g,h){t=g,(!o||h&1)&&s!==(s=t[10].emoji+"")&&ae(a,s),(!o||h&1)&&u!==(u=t[10].userName+"")&&ae(f,u),h&1&&je(e,"--_x",t[10].position[0]),h&1&&je(e,"--_y",t[10].position[1])},i(g){o||(g&&at(()=>{o&&(i&&i.end(1),_=Nn(e,li,{duration:200,start:.4}),_.start())}),o=!0)},o(g){_&&_.invalidate(),g&&(i=qn(e,ai,{})),o=!1},d(g){g&&w(e),g&&i&&i.end(),c=!1,p()}}}function Ft(n){let t,e=n[10]+"",r,s,a;function l(){return n[7](n[10])}return{c(){t=x("button"),r=V(e),this.h()},l(d){t=j(d,"BUTTON",{class:!0});var u=D(t);r=B(u,e),u.forEach(w),this.h()},h(){P(t,"class","emoji svelte-csuuvb")},m(d,u){$(d,t,u),I(t,r),s||(a=Y(t,"click",l),s=!0)},p(d,u){n=d},d(d){d&&w(t),s=!1,a()}}}function ci(n){let t,e=[],r=new Map,s,a,l=J(Object.entries(n[0]));const d=_=>_[1];for(let _=0;_<l.length;_+=1){let i=Dt(n,l,_),o=d(i);r.set(o,e[_]=Lt(o,i))}let u=J(n[3]),f=[];for(let _=0;_<u.length;_+=1)f[_]=Ft(jt(n,u,_));return{c(){t=x("div");for(let _=0;_<e.length;_+=1)e[_].c();s=R();for(let _=0;_<f.length;_+=1)f[_].c();this.h()},l(_){t=j(_,"DIV",{class:!0});var i=D(t);for(let o=0;o<e.length;o+=1)e[o].l(i);s=G(i);for(let o=0;o<f.length;o+=1)f[o].l(i);i.forEach(w),this.h()},h(){P(t,"class","emojis svelte-csuuvb")},m(_,i){$(_,t,i);for(let o=0;o<e.length;o+=1)e[o]&&e[o].m(t,null);I(t,s);for(let o=0;o<f.length;o+=1)f[o]&&f[o].m(t,null);a=!0},p(_,[i]){if(i&1&&(l=J(Object.entries(_[0])),ke(),e=pn(e,i,d,1,_,l,r,t,_n,Lt,s,Dt),Ae()),i&24){u=J(_[3]);let o;for(o=0;o<u.length;o+=1){const c=jt(_,u,o);f[o]?f[o].p(c,i):(f[o]=Ft(c),f[o].c(),f[o].m(t,null))}for(;o<f.length;o+=1)f[o].d(1);f.length=u.length}},i(_){if(!a){for(let i=0;i<l.length;i+=1)F(e[i]);a=!0}},o(_){for(let i=0;i<e.length;i+=1)H(e[i]);a=!1},d(_){_&&w(t);for(let i=0;i<e.length;i+=1)e[i].d();$e(f,_)}}}function ui(n,t,e){let r;const s=ge(),a=X(s.machine.service,c=>c.context.users);W(n,a,c=>e(8,r=c));const l=["👋","👍","👏","😃","🧠","🤔"],d=c=>{s.machine.send({type:"send emoji",emoji:c}),_({userId:s.userId,emoji:c})};let u={},f=0;const _=({userId:c,emoji:p})=>{var g;const m=((g=r.find(h=>h.id===c))==null?void 0:g.name)??"Unknown";e(0,u[`${e(1,f++,f)}`]={emoji:p,userName:m,position:[Math.random(),Math.random()]},u),e(0,u),e(1,f++,f)};return[u,f,a,l,d,_,c=>{setTimeout(()=>{delete u[c],e(0,u)},2e3)},c=>d(c)]}class fi extends re{constructor(t){super(),ie(this,t,ui,ci,ee,{showEmoji:5})}get showEmoji(){return this.$$.ctx[5]}}function Ht(n,t,e){const r=n.slice();return r[16]=t[e],r}function Rt(n){let t,e="admin";return{c(){t=x("span"),t.textContent=e,this.h()},l(r){t=j(r,"SPAN",{class:!0,"data-svelte-h":!0}),le(t)!=="svelte-fku40z"&&(t.textContent=e),this.h()},h(){P(t,"class","admin")},m(r,s){$(r,t,s)},d(r){r&&w(t)}}}function Gt(n){let t;function e(a,l){return a[16].side==="attacker"?_i:di}let r=e(n),s=r(n);return{c(){t=x("span"),s.c(),this.h()},l(a){t=j(a,"SPAN",{class:!0});var l=D(t);s.l(l),l.forEach(w),this.h()},h(){P(t,"class","side svelte-190hwhb")},m(a,l){$(a,t,l),s.m(t,null)},p(a,l){r!==(r=e(a))&&(s.d(1),s=r(a),s&&(s.c(),s.m(t,null)))},d(a){a&&w(t),s.d()}}}function di(n){let t;return{c(){t=V("Verteidigung")},l(e){t=B(e,"Verteidigung")},m(e,r){$(e,t,r)},d(e){e&&w(t)}}}function _i(n){let t;return{c(){t=V("Angriff")},l(e){t=B(e,"Angriff")},m(e,r){$(e,t,r)},d(e){e&&w(t)}}}function Vt(n){let t,e="Angriff",r,s,a="Verteidigung",l,d;function u(){return n[12](n[16])}function f(){return n[13](n[16])}return{c(){t=x("button"),t.textContent=e,r=R(),s=x("button"),s.textContent=a},l(_){t=j(_,"BUTTON",{"data-svelte-h":!0}),le(t)!=="svelte-1hqe603"&&(t.textContent=e),r=G(_),s=j(_,"BUTTON",{"data-svelte-h":!0}),le(s)!=="svelte-1yuwb2t"&&(s.textContent=a)},m(_,i){$(_,t,i),$(_,r,i),$(_,s,i),l||(d=[Y(t,"click",u),Y(s,"click",f)],l=!0)},p(_,i){n=_},d(_){_&&(w(t),w(r),w(s)),l=!1,st(d)}}}function Bt(n){let t,e="Toggle Admin",r,s;function a(){return n[14](n[16])}return{c(){t=x("button"),t.textContent=e},l(l){t=j(l,"BUTTON",{"data-svelte-h":!0}),le(t)!=="svelte-mqfmin"&&(t.textContent=e)},m(l,d){$(l,t,d),r||(s=Y(t,"click",a),r=!0)},p(l,d){n=l},d(l){l&&w(t),r=!1,s()}}}function Nt(n){let t,e=n[16].name+"",r,s,a,l,d,u,f=n[16].isAdmin&&Rt(),_=n[16].isSideAssigned&&Gt(n),i=n[1]&&Vt(n),o=n[2]&&n[16].id!==n[4]&&Bt(n);return{c(){t=x("div"),r=V(e),s=R(),f&&f.c(),a=R(),_&&_.c(),l=R(),i&&i.c(),d=R(),o&&o.c(),u=R(),this.h()},l(c){t=j(c,"DIV",{class:!0});var p=D(t);r=B(p,e),s=G(p),f&&f.l(p),a=G(p),_&&_.l(p),l=G(p),i&&i.l(p),d=G(p),o&&o.l(p),u=G(p),p.forEach(w),this.h()},h(){P(t,"class","user")},m(c,p){$(c,t,p),I(t,r),I(t,s),f&&f.m(t,null),I(t,a),_&&_.m(t,null),I(t,l),i&&i.m(t,null),I(t,d),o&&o.m(t,null),I(t,u)},p(c,p){p&1&&e!==(e=c[16].name+"")&&ae(r,e),c[16].isAdmin?f||(f=Rt(),f.c(),f.m(t,a)):f&&(f.d(1),f=null),c[16].isSideAssigned?_?_.p(c,p):(_=Gt(c),_.c(),_.m(t,l)):_&&(_.d(1),_=null),c[1]?i?i.p(c,p):(i=Vt(c),i.c(),i.m(t,d)):i&&(i.d(1),i=null),c[2]&&c[16].id!==c[4]?o?o.p(c,p):(o=Bt(c),o.c(),o.m(t,u)):o&&(o.d(1),o=null)},d(c){c&&w(t),f&&f.d(),_&&_.d(),i&&i.d(),o&&o.d()}}}function qt(n){let t,e="Next",r,s;return{c(){t=x("button"),t.textContent=e},l(a){t=j(a,"BUTTON",{"data-svelte-h":!0}),le(t)!=="svelte-1ro0dni"&&(t.textContent=e)},m(a,l){$(a,t,l),r||(s=Y(t,"click",n[15]),r=!0)},p:C,d(a){a&&w(t),r=!1,s()}}}function pi(n){let t,e="Einteilung in Teams",r,s,a,l,d=J(n[0]),u=[];for(let _=0;_<d.length;_+=1)u[_]=Nt(Ht(n,d,_));let f=n[3]&&qt(n);return{c(){t=x("h1"),t.textContent=e,r=R(),s=x("div");for(let _=0;_<u.length;_+=1)u[_].c();a=R(),f&&f.c(),l=z(),this.h()},l(_){t=j(_,"H1",{"data-svelte-h":!0}),le(t)!=="svelte-15kivf7"&&(t.textContent=e),r=G(_),s=j(_,"DIV",{class:!0});var i=D(s);for(let o=0;o<u.length;o+=1)u[o].l(i);i.forEach(w),a=G(_),f&&f.l(_),l=z(),this.h()},h(){P(s,"class","users")},m(_,i){$(_,t,i),$(_,r,i),$(_,s,i);for(let o=0;o<u.length;o+=1)u[o]&&u[o].m(s,null);$(_,a,i),f&&f.m(_,i),$(_,l,i)},p(_,[i]){if(i&3095){d=J(_[0]);let o;for(o=0;o<d.length;o+=1){const c=Ht(_,d,o);u[o]?u[o].p(c,i):(u[o]=Nt(c),u[o].c(),u[o].m(s,null))}for(;o<u.length;o+=1)u[o].d(1);u.length=d.length}_[3]?f?f.p(_,i):(f=qt(_),f.c(),f.m(l.parentNode,l)):f&&(f.d(1),f=null)},i:C,o:C,d(_){_&&(w(t),w(r),w(s),w(a),w(l)),$e(u,_),f&&f.d(_)}}}function hi(n,t,e){let r,s,a,l;const{userId:d,machine:u}=ge(),f=X(u.service,y=>y.can({type:"assign side",otherUserId:"",side:"attacker"}));W(n,f,y=>e(1,s=y));const _=X(u.service,y=>y.can({type:"assign admin",otherUserId:"",isAdmin:!0}));W(n,_,y=>e(2,a=y));const i=X(u.service,y=>y.can({type:"next step"}));W(n,i,y=>e(3,l=y));const o=X(u.service,y=>y.context.users);W(n,o,y=>e(0,r=y));const c=(y,b)=>{u.send({type:"assign side",otherUserId:y,side:b})},p=(y,b)=>{u.send({type:"assign admin",otherUserId:y,isAdmin:b})};return[r,s,a,l,d,u,f,_,i,o,c,p,y=>c(y.id,"attacker"),y=>c(y.id,"defender"),y=>p(y.id,!y.isAdmin),()=>u.send({type:"next step"})]}class mi extends re{constructor(t){super(),ie(this,t,hi,pi,ee,{})}}const Wt={man:"man",woman:"woman",other:"other"},gi=n=>n!=="attacker";function Ut(n,t,e){const r=n.slice();return r[18]=t[e][0],r[19]=t[e][1],r}function Xt(n,t,e){const r=n.slice();return r[22]=t[e],r}function Qt(n){let t,e=n[22].name+"",r,s;return{c(){t=x("option"),r=V(e),this.h()},l(a){t=j(a,"OPTION",{});var l=D(t);r=B(l,e),l.forEach(w),this.h()},h(){t.__value=s=n[22].id,Ke(t,t.__value)},m(a,l){$(a,t,l),I(t,r)},p(a,l){l&8&&e!==(e=a[22].name+"")&&ae(r,e),l&8&&s!==(s=a[22].id)&&(t.__value=s,Ke(t,t.__value))},d(a){a&&w(t)}}}function Ct(n){let t,e=n[19]+"",r,s,a,l;function d(){return n[14](n[18])}return{c(){t=x("button"),r=V(e),this.h()},l(u){t=j(u,"BUTTON",{class:!0});var f=D(t);r=B(f,e),f.forEach(w),this.h()},h(){t.disabled=s=!n[2],P(t,"class","face svelte-u0xhbm"),wt(t,"active",n[18]===n[1])},m(u,f){$(u,t,f),I(t,r),a||(l=Y(t,"click",d),a=!0)},p(u,f){n=u,f&4&&s!==(s=!n[2])&&(t.disabled=s),f&2&&wt(t,"active",n[18]===n[1])},d(u){u&&w(t),a=!1,l()}}}function vi(n){let t,e,r,s="--PLEASE SELECT--",a,l,d,u,f,_,i,o,c,p=J(n[3]),m=[];for(let v=0;v<p.length;v+=1)m[v]=Qt(Xt(n,p,v));let g=J(Object.entries(Wt)),h=[];for(let v=0;v<g.length;v+=1)h[v]=Ct(Ut(n,g,v));return{c(){t=x("div"),e=x("select"),r=x("option"),r.textContent=s;for(let v=0;v<m.length;v+=1)m[v].c();l=R(),d=x("div");for(let v=0;v<h.length;v+=1)h[v].c();u=R(),f=x("button"),_=V("Close"),this.h()},l(v){t=j(v,"DIV",{class:!0});var y=D(t);e=j(y,"SELECT",{});var b=D(e);r=j(b,"OPTION",{"data-svelte-h":!0}),le(r)!=="svelte-108q7wa"&&(r.textContent=s);for(let T=0;T<m.length;T+=1)m[T].l(b);b.forEach(w),l=G(y),d=j(y,"DIV",{class:!0});var S=D(d);for(let T=0;T<h.length;T+=1)h[T].l(S);S.forEach(w),u=G(y),f=j(y,"BUTTON",{});var O=D(f);_=B(O,"Close"),O.forEach(w),y.forEach(w),this.h()},h(){r.__value="",Ke(r,r.__value),e.disabled=a=!n[2],P(d,"class","faces svelte-u0xhbm"),f.disabled=i=!n[2],P(t,"class","configurator svelte-u0xhbm")},m(v,y){$(v,t,y),I(t,e),I(e,r);for(let b=0;b<m.length;b+=1)m[b]&&m[b].m(e,null);bt(e,n[0]),I(t,l),I(t,d);for(let b=0;b<h.length;b+=1)h[b]&&h[b].m(d,null);I(t,u),I(t,f),I(f,_),o||(c=[Y(e,"input",n[13]),Y(f,"click",n[15])],o=!0)},p(v,[y]){if(y&8){p=J(v[3]);let b;for(b=0;b<p.length;b+=1){const S=Xt(v,p,b);m[b]?m[b].p(S,y):(m[b]=Qt(S),m[b].c(),m[b].m(e,null))}for(;b<m.length;b+=1)m[b].d(1);m.length=p.length}if(y&4&&a!==(a=!v[2])&&(e.disabled=a),y&9&&bt(e,v[0]),y&518){g=J(Object.entries(Wt));let b;for(b=0;b<g.length;b+=1){const S=Ut(v,g,b);h[b]?h[b].p(S,y):(h[b]=Ct(S),h[b].c(),h[b].m(d,null))}for(;b<h.length;b+=1)h[b].d(1);h.length=g.length}y&4&&i!==(i=!v[2])&&(f.disabled=i)},i:C,o:C,d(v){v&&w(t),$e(m,v),$e(h,v),o=!1,st(c)}}}function yi(n,t,e){let r,s,a,l,d,u,{playerId:f}=t;const _=gi(f)?"defender":"attacker",{machine:i}=ge(),o=X(i.service,({context:S})=>_==="attacker"?S.attack.attacker:S.defense.defenders[f]);W(n,o,S=>e(12,l=S));const c=X(i.service,({context:S})=>S.users.filter(O=>O.side===_));W(n,c,S=>e(3,u=S));const p=X(i.service,S=>S.can({type:"assign role",role:a,playerId:f,playingUserId:r,face:s}));W(n,p,S=>e(2,d=S));const m=()=>{i.send({type:"assign role",role:a,playerId:f,playingUserId:r,face:s})},g=S=>{e(1,s=S),m()},h=S=>{S&&(e(0,r=S),m())},v=S=>h(S.currentTarget.value),y=S=>g(S),b=()=>i.send({type:"stop editing player",side:_});return n.$$set=S=>{"playerId"in S&&e(11,f=S.playerId)},n.$$.update=()=>{n.$$.dirty&4096&&e(0,r=l.userId),n.$$.dirty&4096&&e(1,s=l.face),n.$$.dirty&4096&&(a=l.role)},[r,s,d,u,_,i,o,c,p,g,h,f,l,v,y,b]}class bi extends re{constructor(t){super(),ie(this,t,yi,vi,ee,{playerId:11})}}function Jt(n,t,e){const r=n.slice();return r[14]=t[e],r[16]=e,r}function wi(n){let t;return{c(){t=V("Nicht konfiguriert")},l(e){t=B(e,"Nicht konfiguriert")},m(e,r){$(e,t,r)},p:C,d(e){e&&w(t)}}}function Si(n){var s;let t=((s=n[2].find(r))==null?void 0:s.name)+"",e;function r(...a){return n[12](n[14],...a)}return{c(){e=V(t)},l(a){e=B(a,t)},m(a,l){$(a,e,l)},p(a,l){var d;n=a,l&6&&t!==(t=((d=n[2].find(r))==null?void 0:d.name)+"")&&ae(e,t)},d(a){a&&w(e)}}}function Yt(n){let t,e,r,s,a,l,d,u;function f(c,p){return c[14].isConfigured?Si:wi}let _=f(n),i=_(n);function o(){return n[13](n[16])}return{c(){t=x("div"),i.c(),e=R(),r=x("button"),s=V("Rolle bestimmen"),l=R(),this.h()},l(c){t=j(c,"DIV",{class:!0});var p=D(t);i.l(p),e=G(p),r=j(p,"BUTTON",{});var m=D(r);s=B(m,"Rolle bestimmen"),m.forEach(w),l=G(p),p.forEach(w),this.h()},h(){r.disabled=a=!n[3],P(t,"class","player")},m(c,p){$(c,t,p),i.m(t,null),I(t,e),I(t,r),I(r,s),I(t,l),d||(u=Y(r,"click",o),d=!0)},p(c,p){n=c,_===(_=f(n))&&i?i.p(n,p):(i.d(1),i=_(n),i&&(i.c(),i.m(t,e))),p&8&&a!==(a=!n[3])&&(r.disabled=a)},d(c){c&&w(t),i.d(),d=!1,u()}}}function Zt(n){let t=n[4],e,r,s=Kt(n);return{c(){s.c(),e=z()},l(a){s.l(a),e=z()},m(a,l){s.m(a,l),$(a,e,l),r=!0},p(a,l){l&16&&ee(t,t=a[4])?(ke(),H(s,1,1,C),Ae(),s=Kt(a),s.c(),F(s,1),s.m(e.parentNode,e)):s.p(a,l)},i(a){r||(F(s),r=!0)},o(a){H(s),r=!1},d(a){a&&w(e),s.d(a)}}}function Kt(n){let t,e;return t=new bi({props:{playerId:n[4]}}),{c(){ce(t.$$.fragment)},l(r){ue(t.$$.fragment,r)},m(r,s){fe(t,r,s),e=!0},p(r,s){const a={};s&16&&(a.playerId=r[4]),t.$set(a)},i(r){e||(F(t.$$.fragment,r),e=!0)},o(r){H(t.$$.fragment,r),e=!1},d(r){de(t,r)}}}function Ti(n){let t,e,r,s,a=J(n[1]),l=[];for(let u=0;u<a.length;u+=1)l[u]=Yt(Jt(n,a,u));let d=n[4]!==void 0&&Zt(n);return{c(){t=x("div");for(let u=0;u<l.length;u+=1)l[u].c();e=R(),d&&d.c(),r=z(),this.h()},l(u){t=j(u,"DIV",{class:!0});var f=D(t);for(let _=0;_<l.length;_+=1)l[_].l(f);f.forEach(w),e=G(u),d&&d.l(u),r=z(),this.h()},h(){P(t,"class","players svelte-c6773x")},m(u,f){$(u,t,f);for(let _=0;_<l.length;_+=1)l[_]&&l[_].m(t,null);$(u,e,f),d&&d.m(u,f),$(u,r,f),s=!0},p(u,[f]){if(f&1071){a=J(u[1]);let _;for(_=0;_<a.length;_+=1){const i=Jt(u,a,_);l[_]?l[_].p(i,f):(l[_]=Yt(i),l[_].c(),l[_].m(t,null))}for(;_<l.length;_+=1)l[_].d(1);l.length=a.length}u[4]!==void 0?d?(d.p(u,f),f&16&&F(d,1)):(d=Zt(u),d.c(),F(d,1),d.m(r.parentNode,r)):d&&(ke(),H(d,1,1,()=>{d=null}),Ae())},i(u){s||(F(d),s=!0)},o(u){H(d),s=!1},d(u){u&&(w(t),w(e),w(r)),$e(l,u),d&&d.d(u)}}}function ki(n,t,e){let r,s,a,l,d;const{machine:u}=ge(),f=X(u.service,({context:h})=>{const{side:v}=Fe(h);return v});W(n,f,h=>e(0,r=h));const _=X(u.service,({context:h})=>(r==="attacker"?h.attack:h.defense).editingPlayer);W(n,_,h=>e(4,d=h));const i=X(u.service,({context:h})=>r==="attacker"?[h.attack.attacker]:h.defense.defenders);W(n,i,h=>e(1,s=h));const o=X(u.service,h=>h.can({type:"start editing player",playerId:1}));W(n,o,h=>e(3,l=h));const c=h=>h,p=X(u.service,({context:h})=>h.users);return W(n,p,h=>e(2,a=h)),[r,s,a,l,d,u,f,_,i,o,c,p,(h,v)=>v.id===h.userId,h=>u.send({type:"start editing player",playerId:r==="attacker"?"attacker":c(h)})]}class Ai extends re{constructor(t){super(),ie(this,t,ki,Ti,ee,{})}}function Ii(n){let t;return{c(){t=V("Unknown state")},l(e){t=B(e,"Unknown state")},m(e,r){$(e,t,r)},i:C,o:C,d(e){e&&w(t)}}}function Ei(n){let t;return{c(){t=V("Waiting for other side")},l(e){t=B(e,"Waiting for other side")},m(e,r){$(e,t,r)},i:C,o:C,d(e){e&&w(t)}}}function Oi(n){let t,e;return t=new Ai({}),{c(){ce(t.$$.fragment)},l(r){ue(t.$$.fragment,r)},m(r,s){fe(t,r,s),e=!0},i(r){e||(F(t.$$.fragment,r),e=!0)},o(r){H(t.$$.fragment,r),e=!1},d(r){de(t,r)}}}function $i(n){let t,e;return t=new mi({}),{c(){ce(t.$$.fragment)},l(r){ue(t.$$.fragment,r)},m(r,s){fe(t,r,s),e=!0},i(r){e||(F(t.$$.fragment,r),e=!0)},o(r){H(t.$$.fragment,r),e=!1},d(r){de(t,r)}}}function Mi(n){let t,e,r,s;const a=[$i,Oi,Ei,Ii],l=[];function d(u,f){return u[0]==="Assigning sides"?0:u[0]==="Assigning roles"?1:u[0]==="Waiting for other side"?2:3}return t=d(n),e=l[t]=a[t](n),{c(){e.c(),r=z()},l(u){e.l(u),r=z()},m(u,f){l[t].m(u,f),$(u,r,f),s=!0},p(u,[f]){let _=t;t=d(u),t!==_&&(ke(),H(l[_],1,1,()=>{l[_]=null}),Ae(),e=l[t],e||(e=l[t]=a[t](u),e.c()),F(e,1),e.m(r.parentNode,r))},i(u){s||(F(e),s=!0)},o(u){H(e),s=!1},d(u){u&&w(r),l[t].d(u)}}}function Pi(n,t,e){let r;const{machine:s}=ge(),a=X(s.service,l=>{let d;return l.matches("Lobby.Assigning sides")?d="Assigning sides":l.matches("Lobby.Assigning roles")?d="Assigning roles":l.matches("Lobby.Waiting for other side")&&(d="Waiting for other side"),d});return W(n,a,l=>e(0,r=l)),[r,a]}class xi extends re{constructor(t){super(),ie(this,t,Pi,Mi,ee,{})}}const ji=n=>({}),zt=n=>({}),Di=n=>({}),en=n=>({}),Li=n=>({}),tn=n=>({});function Fi(n){let t;return{c(){t=V("...")},l(e){t=B(e,"...")},m(e,r){$(e,t,r)},i:C,o:C,d(e){e&&w(t)}}}function Hi(n){let t,e;return t=new xi({}),{c(){ce(t.$$.fragment)},l(r){ue(t.$$.fragment,r)},m(r,s){fe(t,r,s),e=!0},i(r){e||(F(t.$$.fragment,r),e=!0)},o(r){H(t.$$.fragment,r),e=!1},d(r){de(t,r)}}}function Ri(n){let t,e,r,s="The Hidden Threat",a,l,d,u,f,_,i,o,c,p,m,g,h,v,y;const b=n[8].items,S=Ue(b,n,n[7],tn),O=n[8].actions,T=Ue(O,n,n[7],en),L=[Hi,Fi],E=[];function Z(M,N){return M[3]==="Lobby"?0:1}c=Z(n),p=E[c]=L[c](n);const ve=n[8]["cursor-overlays"],Q=Ue(ve,n,n[7],zt);return{c(){t=x("div"),e=x("div"),r=x("div"),r.textContent=s,a=R(),l=x("div"),d=R(),u=x("div"),S&&S.c(),f=R(),_=x("div"),T&&T.c(),i=R(),o=x("div"),p.c(),m=R(),Q&&Q.c(),this.h()},l(M){t=j(M,"DIV",{class:!0});var N=D(t);e=j(N,"DIV",{class:!0});var q=D(e);r=j(q,"DIV",{class:!0,"data-svelte-h":!0}),le(r)!=="svelte-iqe0dn"&&(r.textContent=s),a=G(q),l=j(q,"DIV",{class:!0}),D(l).forEach(w),d=G(q),u=j(q,"DIV",{class:!0});var ht=D(u);S&&S.l(ht),ht.forEach(w),f=G(q),_=j(q,"DIV",{class:!0});var mt=D(_);T&&T.l(mt),mt.forEach(w),i=G(q),o=j(q,"DIV",{class:!0});var gt=D(o);p.l(gt),gt.forEach(w),m=G(q),Q&&Q.l(q),q.forEach(w),N.forEach(w),this.h()},h(){P(r,"class","name svelte-1sdy1r9"),P(l,"class","characters svelte-1sdy1r9"),P(u,"class","items svelte-1sdy1r9"),P(_,"class","actions svelte-1sdy1r9"),P(o,"class","content svelte-1sdy1r9"),P(e,"class","game svelte-1sdy1r9"),at(()=>n[10].call(e)),P(t,"class","game-wrapper svelte-1sdy1r9")},m(M,N){$(M,t,N),I(t,e),I(e,r),I(e,a),I(e,l),I(e,d),I(e,u),S&&S.m(u,null),I(e,f),I(e,_),T&&T.m(_,null),I(e,i),I(e,o),E[c].m(o,null),I(e,m),Q&&Q.m(e,null),n[9](e),g=fn(e,n[10].bind(e)),h=!0,v||(y=Y(e,"mousemove",n[4]),v=!0)},p(M,[N]){S&&S.p&&(!h||N&128)&&Xe(S,b,M,M[7],h?Ce(b,M[7],N,Li):Qe(M[7]),tn),T&&T.p&&(!h||N&128)&&Xe(T,O,M,M[7],h?Ce(O,M[7],N,Di):Qe(M[7]),en);let q=c;c=Z(M),c!==q&&(ke(),H(E[q],1,1,()=>{E[q]=null}),Ae(),p=E[c],p||(p=E[c]=L[c](M),p.c()),F(p,1),p.m(o,null)),Q&&Q.p&&(!h||N&128)&&Xe(Q,ve,M,M[7],h?Ce(ve,M[7],N,ji):Qe(M[7]),zt)},i(M){h||(F(S,M),F(T,M),F(p),F(Q,M),h=!0)},o(M){H(S,M),H(T,M),H(p),H(Q,M),h=!1},d(M){M&&w(t),S&&S.d(M),T&&T.d(M),E[c].d(),Q&&Q.d(M),n[9](null),g(),v=!1,y()}}}function Gi(n,t,e){let r,{$$slots:s={},$$scope:a}=t;const{machine:l}=ge();let{reportMousePosition:d}=t,u,f=1,_=1;const i=m=>{const g=window.matchMedia("(width < 1200px) or (height < 675px)").matches?.6:window.matchMedia("(width < 1200px) or (height < 675px)").matches?.8:1,h=(m.clientX-u.offsetLeft)/f,v=(m.clientY-u.offsetTop)/_;d([(h-(1-g)/2)/g,(v-(1-g)/2)/g])},o=X(l.service,m=>{let g;return m.matches("Lobby")&&(g="Lobby"),g});W(n,o,m=>e(3,r=m));function c(m){ot[m?"unshift":"push"](()=>{u=m,e(0,u)})}function p(){f=this.clientWidth,_=this.clientHeight,e(1,f),e(2,_)}return n.$$set=m=>{"reportMousePosition"in m&&e(6,d=m.reportMousePosition),"$$scope"in m&&e(7,a=m.$$scope)},[u,f,_,r,i,o,d,a,s,c,p]}class Vi extends re{constructor(t){super(),ie(this,t,Gi,Ri,ee,{reportMousePosition:6})}}var te=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bi(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Dn={};/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(n){(function(){var t=function(){this.init()};t.prototype={init:function(){var i=this||e;return i._counter=1e3,i._html5AudioPool=[],i.html5PoolSize=10,i._codecs={},i._howls=[],i._muted=!1,i._volume=1,i._canPlayEvent="canplaythrough",i._navigator=typeof window<"u"&&window.navigator?window.navigator:null,i.masterGain=null,i.noAudio=!1,i.usingWebAudio=!0,i.autoSuspend=!0,i.ctx=null,i.autoUnlock=!0,i._setup(),i},volume:function(i){var o=this||e;if(i=parseFloat(i),o.ctx||_(),typeof i<"u"&&i>=0&&i<=1){if(o._volume=i,o._muted)return o;o.usingWebAudio&&o.masterGain.gain.setValueAtTime(i,e.ctx.currentTime);for(var c=0;c<o._howls.length;c++)if(!o._howls[c]._webAudio)for(var p=o._howls[c]._getSoundIds(),m=0;m<p.length;m++){var g=o._howls[c]._soundById(p[m]);g&&g._node&&(g._node.volume=g._volume*i)}return o}return o._volume},mute:function(i){var o=this||e;o.ctx||_(),o._muted=i,o.usingWebAudio&&o.masterGain.gain.setValueAtTime(i?0:o._volume,e.ctx.currentTime);for(var c=0;c<o._howls.length;c++)if(!o._howls[c]._webAudio)for(var p=o._howls[c]._getSoundIds(),m=0;m<p.length;m++){var g=o._howls[c]._soundById(p[m]);g&&g._node&&(g._node.muted=i?!0:g._muted)}return o},stop:function(){for(var i=this||e,o=0;o<i._howls.length;o++)i._howls[o].stop();return i},unload:function(){for(var i=this||e,o=i._howls.length-1;o>=0;o--)i._howls[o].unload();return i.usingWebAudio&&i.ctx&&typeof i.ctx.close<"u"&&(i.ctx.close(),i.ctx=null,_()),i},codecs:function(i){return(this||e)._codecs[i.replace(/^x-/,"")]},_setup:function(){var i=this||e;if(i.state=i.ctx&&i.ctx.state||"suspended",i._autoSuspend(),!i.usingWebAudio)if(typeof Audio<"u")try{var o=new Audio;typeof o.oncanplaythrough>"u"&&(i._canPlayEvent="canplay")}catch{i.noAudio=!0}else i.noAudio=!0;try{var o=new Audio;o.muted&&(i.noAudio=!0)}catch{}return i.noAudio||i._setupCodecs(),i},_setupCodecs:function(){var i=this||e,o=null;try{o=typeof Audio<"u"?new Audio:null}catch{return i}if(!o||typeof o.canPlayType!="function")return i;var c=o.canPlayType("audio/mpeg;").replace(/^no$/,""),p=i._navigator?i._navigator.userAgent:"",m=p.match(/OPR\/([0-6].)/g),g=m&&parseInt(m[0].split("/")[1],10)<33,h=p.indexOf("Safari")!==-1&&p.indexOf("Chrome")===-1,v=p.match(/Version\/(.*?) /),y=h&&v&&parseInt(v[1],10)<15;return i._codecs={mp3:!!(!g&&(c||o.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!c,opus:!!o.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(o.canPlayType('audio/wav; codecs="1"')||o.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!o.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!o.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(o.canPlayType("audio/x-m4a;")||o.canPlayType("audio/m4a;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(o.canPlayType("audio/x-m4b;")||o.canPlayType("audio/m4b;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(o.canPlayType("audio/x-mp4;")||o.canPlayType("audio/mp4;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!y&&o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!y&&o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!o.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(o.canPlayType("audio/x-flac;")||o.canPlayType("audio/flac;")).replace(/^no$/,"")},i},_unlockAudio:function(){var i=this||e;if(!(i._audioUnlocked||!i.ctx)){i._audioUnlocked=!1,i.autoUnlock=!1,!i._mobileUnloaded&&i.ctx.sampleRate!==44100&&(i._mobileUnloaded=!0,i.unload()),i._scratchBuffer=i.ctx.createBuffer(1,1,22050);var o=function(c){for(;i._html5AudioPool.length<i.html5PoolSize;)try{var p=new Audio;p._unlocked=!0,i._releaseHtml5Audio(p)}catch{i.noAudio=!0;break}for(var m=0;m<i._howls.length;m++)if(!i._howls[m]._webAudio)for(var g=i._howls[m]._getSoundIds(),h=0;h<g.length;h++){var v=i._howls[m]._soundById(g[h]);v&&v._node&&!v._node._unlocked&&(v._node._unlocked=!0,v._node.load())}i._autoResume();var y=i.ctx.createBufferSource();y.buffer=i._scratchBuffer,y.connect(i.ctx.destination),typeof y.start>"u"?y.noteOn(0):y.start(0),typeof i.ctx.resume=="function"&&i.ctx.resume(),y.onended=function(){y.disconnect(0),i._audioUnlocked=!0,document.removeEventListener("touchstart",o,!0),document.removeEventListener("touchend",o,!0),document.removeEventListener("click",o,!0),document.removeEventListener("keydown",o,!0);for(var b=0;b<i._howls.length;b++)i._howls[b]._emit("unlock")}};return document.addEventListener("touchstart",o,!0),document.addEventListener("touchend",o,!0),document.addEventListener("click",o,!0),document.addEventListener("keydown",o,!0),i}},_obtainHtml5Audio:function(){var i=this||e;if(i._html5AudioPool.length)return i._html5AudioPool.pop();var o=new Audio().play();return o&&typeof Promise<"u"&&(o instanceof Promise||typeof o.then=="function")&&o.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(i){var o=this||e;return i._unlocked&&o._html5AudioPool.push(i),o},_autoSuspend:function(){var i=this;if(!(!i.autoSuspend||!i.ctx||typeof i.ctx.suspend>"u"||!e.usingWebAudio)){for(var o=0;o<i._howls.length;o++)if(i._howls[o]._webAudio){for(var c=0;c<i._howls[o]._sounds.length;c++)if(!i._howls[o]._sounds[c]._paused)return i}return i._suspendTimer&&clearTimeout(i._suspendTimer),i._suspendTimer=setTimeout(function(){if(i.autoSuspend){i._suspendTimer=null,i.state="suspending";var p=function(){i.state="suspended",i._resumeAfterSuspend&&(delete i._resumeAfterSuspend,i._autoResume())};i.ctx.suspend().then(p,p)}},3e4),i}},_autoResume:function(){var i=this;if(!(!i.ctx||typeof i.ctx.resume>"u"||!e.usingWebAudio))return i.state==="running"&&i.ctx.state!=="interrupted"&&i._suspendTimer?(clearTimeout(i._suspendTimer),i._suspendTimer=null):i.state==="suspended"||i.state==="running"&&i.ctx.state==="interrupted"?(i.ctx.resume().then(function(){i.state="running";for(var o=0;o<i._howls.length;o++)i._howls[o]._emit("resume")}),i._suspendTimer&&(clearTimeout(i._suspendTimer),i._suspendTimer=null)):i.state==="suspending"&&(i._resumeAfterSuspend=!0),i}};var e=new t,r=function(i){var o=this;if(!i.src||i.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}o.init(i)};r.prototype={init:function(i){var o=this;return e.ctx||_(),o._autoplay=i.autoplay||!1,o._format=typeof i.format!="string"?i.format:[i.format],o._html5=i.html5||!1,o._muted=i.mute||!1,o._loop=i.loop||!1,o._pool=i.pool||5,o._preload=typeof i.preload=="boolean"||i.preload==="metadata"?i.preload:!0,o._rate=i.rate||1,o._sprite=i.sprite||{},o._src=typeof i.src!="string"?i.src:[i.src],o._volume=i.volume!==void 0?i.volume:1,o._xhr={method:i.xhr&&i.xhr.method?i.xhr.method:"GET",headers:i.xhr&&i.xhr.headers?i.xhr.headers:null,withCredentials:i.xhr&&i.xhr.withCredentials?i.xhr.withCredentials:!1},o._duration=0,o._state="unloaded",o._sounds=[],o._endTimers={},o._queue=[],o._playLock=!1,o._onend=i.onend?[{fn:i.onend}]:[],o._onfade=i.onfade?[{fn:i.onfade}]:[],o._onload=i.onload?[{fn:i.onload}]:[],o._onloaderror=i.onloaderror?[{fn:i.onloaderror}]:[],o._onplayerror=i.onplayerror?[{fn:i.onplayerror}]:[],o._onpause=i.onpause?[{fn:i.onpause}]:[],o._onplay=i.onplay?[{fn:i.onplay}]:[],o._onstop=i.onstop?[{fn:i.onstop}]:[],o._onmute=i.onmute?[{fn:i.onmute}]:[],o._onvolume=i.onvolume?[{fn:i.onvolume}]:[],o._onrate=i.onrate?[{fn:i.onrate}]:[],o._onseek=i.onseek?[{fn:i.onseek}]:[],o._onunlock=i.onunlock?[{fn:i.onunlock}]:[],o._onresume=[],o._webAudio=e.usingWebAudio&&!o._html5,typeof e.ctx<"u"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(o),o._autoplay&&o._queue.push({event:"play",action:function(){o.play()}}),o._preload&&o._preload!=="none"&&o.load(),o},load:function(){var i=this,o=null;if(e.noAudio){i._emit("loaderror",null,"No audio support.");return}typeof i._src=="string"&&(i._src=[i._src]);for(var c=0;c<i._src.length;c++){var p,m;if(i._format&&i._format[c])p=i._format[c];else{if(m=i._src[c],typeof m!="string"){i._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}p=/^data:audio\/([^;,]+);/i.exec(m),p||(p=/\.([^.]+)$/.exec(m.split("?",1)[0])),p&&(p=p[1].toLowerCase())}if(p||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),p&&e.codecs(p)){o=i._src[c];break}}if(!o){i._emit("loaderror",null,"No codec support for selected audio sources.");return}return i._src=o,i._state="loading",window.location.protocol==="https:"&&o.slice(0,5)==="http:"&&(i._html5=!0,i._webAudio=!1),new s(i),i._webAudio&&l(i),i},play:function(i,o){var c=this,p=null;if(typeof i=="number")p=i,i=null;else{if(typeof i=="string"&&c._state==="loaded"&&!c._sprite[i])return null;if(typeof i>"u"&&(i="__default",!c._playLock)){for(var m=0,g=0;g<c._sounds.length;g++)c._sounds[g]._paused&&!c._sounds[g]._ended&&(m++,p=c._sounds[g]._id);m===1?i=null:p=null}}var h=p?c._soundById(p):c._inactiveSound();if(!h)return null;if(p&&!i&&(i=h._sprite||"__default"),c._state!=="loaded"){h._sprite=i,h._ended=!1;var v=h._id;return c._queue.push({event:"play",action:function(){c.play(v)}}),v}if(p&&!h._paused)return o||c._loadQueue("play"),h._id;c._webAudio&&e._autoResume();var y=Math.max(0,h._seek>0?h._seek:c._sprite[i][0]/1e3),b=Math.max(0,(c._sprite[i][0]+c._sprite[i][1])/1e3-y),S=b*1e3/Math.abs(h._rate),O=c._sprite[i][0]/1e3,T=(c._sprite[i][0]+c._sprite[i][1])/1e3;h._sprite=i,h._ended=!1;var L=function(){h._paused=!1,h._seek=y,h._start=O,h._stop=T,h._loop=!!(h._loop||c._sprite[i][2])};if(y>=T){c._ended(h);return}var E=h._node;if(c._webAudio){var Z=function(){c._playLock=!1,L(),c._refreshBuffer(h);var N=h._muted||c._muted?0:h._volume;E.gain.setValueAtTime(N,e.ctx.currentTime),h._playStart=e.ctx.currentTime,typeof E.bufferSource.start>"u"?h._loop?E.bufferSource.noteGrainOn(0,y,86400):E.bufferSource.noteGrainOn(0,y,b):h._loop?E.bufferSource.start(0,y,86400):E.bufferSource.start(0,y,b),S!==1/0&&(c._endTimers[h._id]=setTimeout(c._ended.bind(c,h),S)),o||setTimeout(function(){c._emit("play",h._id),c._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?Z():(c._playLock=!0,c.once("resume",Z),c._clearTimer(h._id))}else{var ve=function(){E.currentTime=y,E.muted=h._muted||c._muted||e._muted||E.muted,E.volume=h._volume*e.volume(),E.playbackRate=h._rate;try{var N=E.play();if(N&&typeof Promise<"u"&&(N instanceof Promise||typeof N.then=="function")?(c._playLock=!0,L(),N.then(function(){c._playLock=!1,E._unlocked=!0,o?c._loadQueue():c._emit("play",h._id)}).catch(function(){c._playLock=!1,c._emit("playerror",h._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),h._ended=!0,h._paused=!0})):o||(c._playLock=!1,L(),c._emit("play",h._id)),E.playbackRate=h._rate,E.paused){c._emit("playerror",h._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}i!=="__default"||h._loop?c._endTimers[h._id]=setTimeout(c._ended.bind(c,h),S):(c._endTimers[h._id]=function(){c._ended(h),E.removeEventListener("ended",c._endTimers[h._id],!1)},E.addEventListener("ended",c._endTimers[h._id],!1))}catch(q){c._emit("playerror",h._id,q)}};E.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(E.src=c._src,E.load());var Q=window&&window.ejecta||!E.readyState&&e._navigator.isCocoonJS;if(E.readyState>=3||Q)ve();else{c._playLock=!0,c._state="loading";var M=function(){c._state="loaded",ve(),E.removeEventListener(e._canPlayEvent,M,!1)};E.addEventListener(e._canPlayEvent,M,!1),c._clearTimer(h._id)}}return h._id},pause:function(i){var o=this;if(o._state!=="loaded"||o._playLock)return o._queue.push({event:"pause",action:function(){o.pause(i)}}),o;for(var c=o._getSoundIds(i),p=0;p<c.length;p++){o._clearTimer(c[p]);var m=o._soundById(c[p]);if(m&&!m._paused&&(m._seek=o.seek(c[p]),m._rateSeek=0,m._paused=!0,o._stopFade(c[p]),m._node))if(o._webAudio){if(!m._node.bufferSource)continue;typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),o._cleanBuffer(m._node)}else(!isNaN(m._node.duration)||m._node.duration===1/0)&&m._node.pause();arguments[1]||o._emit("pause",m?m._id:null)}return o},stop:function(i,o){var c=this;if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"stop",action:function(){c.stop(i)}}),c;for(var p=c._getSoundIds(i),m=0;m<p.length;m++){c._clearTimer(p[m]);var g=c._soundById(p[m]);g&&(g._seek=g._start||0,g._rateSeek=0,g._paused=!0,g._ended=!0,c._stopFade(p[m]),g._node&&(c._webAudio?g._node.bufferSource&&(typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),c._cleanBuffer(g._node)):(!isNaN(g._node.duration)||g._node.duration===1/0)&&(g._node.currentTime=g._start||0,g._node.pause(),g._node.duration===1/0&&c._clearSound(g._node))),o||c._emit("stop",g._id))}return c},mute:function(i,o){var c=this;if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"mute",action:function(){c.mute(i,o)}}),c;if(typeof o>"u")if(typeof i=="boolean")c._muted=i;else return c._muted;for(var p=c._getSoundIds(o),m=0;m<p.length;m++){var g=c._soundById(p[m]);g&&(g._muted=i,g._interval&&c._stopFade(g._id),c._webAudio&&g._node?g._node.gain.setValueAtTime(i?0:g._volume,e.ctx.currentTime):g._node&&(g._node.muted=e._muted?!0:i),c._emit("mute",g._id))}return c},volume:function(){var i=this,o=arguments,c,p;if(o.length===0)return i._volume;if(o.length===1||o.length===2&&typeof o[1]>"u"){var m=i._getSoundIds(),g=m.indexOf(o[0]);g>=0?p=parseInt(o[0],10):c=parseFloat(o[0])}else o.length>=2&&(c=parseFloat(o[0]),p=parseInt(o[1],10));var h;if(typeof c<"u"&&c>=0&&c<=1){if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"volume",action:function(){i.volume.apply(i,o)}}),i;typeof p>"u"&&(i._volume=c),p=i._getSoundIds(p);for(var v=0;v<p.length;v++)h=i._soundById(p[v]),h&&(h._volume=c,o[2]||i._stopFade(p[v]),i._webAudio&&h._node&&!h._muted?h._node.gain.setValueAtTime(c,e.ctx.currentTime):h._node&&!h._muted&&(h._node.volume=c*e.volume()),i._emit("volume",h._id))}else return h=p?i._soundById(p):i._sounds[0],h?h._volume:0;return i},fade:function(i,o,c,p){var m=this;if(m._state!=="loaded"||m._playLock)return m._queue.push({event:"fade",action:function(){m.fade(i,o,c,p)}}),m;i=Math.min(Math.max(0,parseFloat(i)),1),o=Math.min(Math.max(0,parseFloat(o)),1),c=parseFloat(c),m.volume(i,p);for(var g=m._getSoundIds(p),h=0;h<g.length;h++){var v=m._soundById(g[h]);if(v){if(p||m._stopFade(g[h]),m._webAudio&&!v._muted){var y=e.ctx.currentTime,b=y+c/1e3;v._volume=i,v._node.gain.setValueAtTime(i,y),v._node.gain.linearRampToValueAtTime(o,b)}m._startFadeInterval(v,i,o,c,g[h],typeof p>"u")}}return m},_startFadeInterval:function(i,o,c,p,m,g){var h=this,v=o,y=c-o,b=Math.abs(y/.01),S=Math.max(4,b>0?p/b:p),O=Date.now();i._fadeTo=c,i._interval=setInterval(function(){var T=(Date.now()-O)/p;O=Date.now(),v+=y*T,v=Math.round(v*100)/100,y<0?v=Math.max(c,v):v=Math.min(c,v),h._webAudio?i._volume=v:h.volume(v,i._id,!0),g&&(h._volume=v),(c<o&&v<=c||c>o&&v>=c)&&(clearInterval(i._interval),i._interval=null,i._fadeTo=null,h.volume(c,i._id),h._emit("fade",i._id))},S)},_stopFade:function(i){var o=this,c=o._soundById(i);return c&&c._interval&&(o._webAudio&&c._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(c._interval),c._interval=null,o.volume(c._fadeTo,i),c._fadeTo=null,o._emit("fade",i)),o},loop:function(){var i=this,o=arguments,c,p,m;if(o.length===0)return i._loop;if(o.length===1)if(typeof o[0]=="boolean")c=o[0],i._loop=c;else return m=i._soundById(parseInt(o[0],10)),m?m._loop:!1;else o.length===2&&(c=o[0],p=parseInt(o[1],10));for(var g=i._getSoundIds(p),h=0;h<g.length;h++)m=i._soundById(g[h]),m&&(m._loop=c,i._webAudio&&m._node&&m._node.bufferSource&&(m._node.bufferSource.loop=c,c&&(m._node.bufferSource.loopStart=m._start||0,m._node.bufferSource.loopEnd=m._stop,i.playing(g[h])&&(i.pause(g[h],!0),i.play(g[h],!0)))));return i},rate:function(){var i=this,o=arguments,c,p;if(o.length===0)p=i._sounds[0]._id;else if(o.length===1){var m=i._getSoundIds(),g=m.indexOf(o[0]);g>=0?p=parseInt(o[0],10):c=parseFloat(o[0])}else o.length===2&&(c=parseFloat(o[0]),p=parseInt(o[1],10));var h;if(typeof c=="number"){if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"rate",action:function(){i.rate.apply(i,o)}}),i;typeof p>"u"&&(i._rate=c),p=i._getSoundIds(p);for(var v=0;v<p.length;v++)if(h=i._soundById(p[v]),h){i.playing(p[v])&&(h._rateSeek=i.seek(p[v]),h._playStart=i._webAudio?e.ctx.currentTime:h._playStart),h._rate=c,i._webAudio&&h._node&&h._node.bufferSource?h._node.bufferSource.playbackRate.setValueAtTime(c,e.ctx.currentTime):h._node&&(h._node.playbackRate=c);var y=i.seek(p[v]),b=(i._sprite[h._sprite][0]+i._sprite[h._sprite][1])/1e3-y,S=b*1e3/Math.abs(h._rate);(i._endTimers[p[v]]||!h._paused)&&(i._clearTimer(p[v]),i._endTimers[p[v]]=setTimeout(i._ended.bind(i,h),S)),i._emit("rate",h._id)}}else return h=i._soundById(p),h?h._rate:i._rate;return i},seek:function(){var i=this,o=arguments,c,p;if(o.length===0)i._sounds.length&&(p=i._sounds[0]._id);else if(o.length===1){var m=i._getSoundIds(),g=m.indexOf(o[0]);g>=0?p=parseInt(o[0],10):i._sounds.length&&(p=i._sounds[0]._id,c=parseFloat(o[0]))}else o.length===2&&(c=parseFloat(o[0]),p=parseInt(o[1],10));if(typeof p>"u")return 0;if(typeof c=="number"&&(i._state!=="loaded"||i._playLock))return i._queue.push({event:"seek",action:function(){i.seek.apply(i,o)}}),i;var h=i._soundById(p);if(h)if(typeof c=="number"&&c>=0){var v=i.playing(p);v&&i.pause(p,!0),h._seek=c,h._ended=!1,i._clearTimer(p),!i._webAudio&&h._node&&!isNaN(h._node.duration)&&(h._node.currentTime=c);var y=function(){v&&i.play(p,!0),i._emit("seek",p)};if(v&&!i._webAudio){var b=function(){i._playLock?setTimeout(b,0):y()};setTimeout(b,0)}else y()}else if(i._webAudio){var S=i.playing(p)?e.ctx.currentTime-h._playStart:0,O=h._rateSeek?h._rateSeek-h._seek:0;return h._seek+(O+S*Math.abs(h._rate))}else return h._node.currentTime;return i},playing:function(i){var o=this;if(typeof i=="number"){var c=o._soundById(i);return c?!c._paused:!1}for(var p=0;p<o._sounds.length;p++)if(!o._sounds[p]._paused)return!0;return!1},duration:function(i){var o=this,c=o._duration,p=o._soundById(i);return p&&(c=o._sprite[p._sprite][1]/1e3),c},state:function(){return this._state},unload:function(){for(var i=this,o=i._sounds,c=0;c<o.length;c++)o[c]._paused||i.stop(o[c]._id),i._webAudio||(i._clearSound(o[c]._node),o[c]._node.removeEventListener("error",o[c]._errorFn,!1),o[c]._node.removeEventListener(e._canPlayEvent,o[c]._loadFn,!1),o[c]._node.removeEventListener("ended",o[c]._endFn,!1),e._releaseHtml5Audio(o[c]._node)),delete o[c]._node,i._clearTimer(o[c]._id);var p=e._howls.indexOf(i);p>=0&&e._howls.splice(p,1);var m=!0;for(c=0;c<e._howls.length;c++)if(e._howls[c]._src===i._src||i._src.indexOf(e._howls[c]._src)>=0){m=!1;break}return a&&m&&delete a[i._src],e.noAudio=!1,i._state="unloaded",i._sounds=[],i=null,null},on:function(i,o,c,p){var m=this,g=m["_on"+i];return typeof o=="function"&&g.push(p?{id:c,fn:o,once:p}:{id:c,fn:o}),m},off:function(i,o,c){var p=this,m=p["_on"+i],g=0;if(typeof o=="number"&&(c=o,o=null),o||c)for(g=0;g<m.length;g++){var h=c===m[g].id;if(o===m[g].fn&&h||!o&&h){m.splice(g,1);break}}else if(i)p["_on"+i]=[];else{var v=Object.keys(p);for(g=0;g<v.length;g++)v[g].indexOf("_on")===0&&Array.isArray(p[v[g]])&&(p[v[g]]=[])}return p},once:function(i,o,c){var p=this;return p.on(i,o,c,1),p},_emit:function(i,o,c){for(var p=this,m=p["_on"+i],g=m.length-1;g>=0;g--)(!m[g].id||m[g].id===o||i==="load")&&(setTimeout((function(h){h.call(this,o,c)}).bind(p,m[g].fn),0),m[g].once&&p.off(i,m[g].fn,m[g].id));return p._loadQueue(i),p},_loadQueue:function(i){var o=this;if(o._queue.length>0){var c=o._queue[0];c.event===i&&(o._queue.shift(),o._loadQueue()),i||c.action()}return o},_ended:function(i){var o=this,c=i._sprite;if(!o._webAudio&&i._node&&!i._node.paused&&!i._node.ended&&i._node.currentTime<i._stop)return setTimeout(o._ended.bind(o,i),100),o;var p=!!(i._loop||o._sprite[c][2]);if(o._emit("end",i._id),!o._webAudio&&p&&o.stop(i._id,!0).play(i._id),o._webAudio&&p){o._emit("play",i._id),i._seek=i._start||0,i._rateSeek=0,i._playStart=e.ctx.currentTime;var m=(i._stop-i._start)*1e3/Math.abs(i._rate);o._endTimers[i._id]=setTimeout(o._ended.bind(o,i),m)}return o._webAudio&&!p&&(i._paused=!0,i._ended=!0,i._seek=i._start||0,i._rateSeek=0,o._clearTimer(i._id),o._cleanBuffer(i._node),e._autoSuspend()),!o._webAudio&&!p&&o.stop(i._id,!0),o},_clearTimer:function(i){var o=this;if(o._endTimers[i]){if(typeof o._endTimers[i]!="function")clearTimeout(o._endTimers[i]);else{var c=o._soundById(i);c&&c._node&&c._node.removeEventListener("ended",o._endTimers[i],!1)}delete o._endTimers[i]}return o},_soundById:function(i){for(var o=this,c=0;c<o._sounds.length;c++)if(i===o._sounds[c]._id)return o._sounds[c];return null},_inactiveSound:function(){var i=this;i._drain();for(var o=0;o<i._sounds.length;o++)if(i._sounds[o]._ended)return i._sounds[o].reset();return new s(i)},_drain:function(){var i=this,o=i._pool,c=0,p=0;if(!(i._sounds.length<o)){for(p=0;p<i._sounds.length;p++)i._sounds[p]._ended&&c++;for(p=i._sounds.length-1;p>=0;p--){if(c<=o)return;i._sounds[p]._ended&&(i._webAudio&&i._sounds[p]._node&&i._sounds[p]._node.disconnect(0),i._sounds.splice(p,1),c--)}}},_getSoundIds:function(i){var o=this;if(typeof i>"u"){for(var c=[],p=0;p<o._sounds.length;p++)c.push(o._sounds[p]._id);return c}else return[i]},_refreshBuffer:function(i){var o=this;return i._node.bufferSource=e.ctx.createBufferSource(),i._node.bufferSource.buffer=a[o._src],i._panner?i._node.bufferSource.connect(i._panner):i._node.bufferSource.connect(i._node),i._node.bufferSource.loop=i._loop,i._loop&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop||0),i._node.bufferSource.playbackRate.setValueAtTime(i._rate,e.ctx.currentTime),o},_cleanBuffer:function(i){var o=this,c=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(e._scratchBuffer&&i.bufferSource&&(i.bufferSource.onended=null,i.bufferSource.disconnect(0),c))try{i.bufferSource.buffer=e._scratchBuffer}catch{}return i.bufferSource=null,o},_clearSound:function(i){var o=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);o||(i.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var s=function(i){this._parent=i,this.init()};s.prototype={init:function(){var i=this,o=i._parent;return i._muted=o._muted,i._loop=o._loop,i._volume=o._volume,i._rate=o._rate,i._seek=0,i._paused=!0,i._ended=!0,i._sprite="__default",i._id=++e._counter,o._sounds.push(i),i.create(),i},create:function(){var i=this,o=i._parent,c=e._muted||i._muted||i._parent._muted?0:i._volume;return o._webAudio?(i._node=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),i._node.gain.setValueAtTime(c,e.ctx.currentTime),i._node.paused=!0,i._node.connect(e.masterGain)):e.noAudio||(i._node=e._obtainHtml5Audio(),i._errorFn=i._errorListener.bind(i),i._node.addEventListener("error",i._errorFn,!1),i._loadFn=i._loadListener.bind(i),i._node.addEventListener(e._canPlayEvent,i._loadFn,!1),i._endFn=i._endListener.bind(i),i._node.addEventListener("ended",i._endFn,!1),i._node.src=o._src,i._node.preload=o._preload===!0?"auto":o._preload,i._node.volume=c*e.volume(),i._node.load()),i},reset:function(){var i=this,o=i._parent;return i._muted=o._muted,i._loop=o._loop,i._volume=o._volume,i._rate=o._rate,i._seek=0,i._rateSeek=0,i._paused=!0,i._ended=!0,i._sprite="__default",i._id=++e._counter,i},_errorListener:function(){var i=this;i._parent._emit("loaderror",i._id,i._node.error?i._node.error.code:0),i._node.removeEventListener("error",i._errorFn,!1)},_loadListener:function(){var i=this,o=i._parent;o._duration=Math.ceil(i._node.duration*10)/10,Object.keys(o._sprite).length===0&&(o._sprite={__default:[0,o._duration*1e3]}),o._state!=="loaded"&&(o._state="loaded",o._emit("load"),o._loadQueue()),i._node.removeEventListener(e._canPlayEvent,i._loadFn,!1)},_endListener:function(){var i=this,o=i._parent;o._duration===1/0&&(o._duration=Math.ceil(i._node.duration*10)/10,o._sprite.__default[1]===1/0&&(o._sprite.__default[1]=o._duration*1e3),o._ended(i)),i._node.removeEventListener("ended",i._endFn,!1)}};var a={},l=function(i){var o=i._src;if(a[o]){i._duration=a[o].duration,f(i);return}if(/^data:[^;]+;base64,/.test(o)){for(var c=atob(o.split(",")[1]),p=new Uint8Array(c.length),m=0;m<c.length;++m)p[m]=c.charCodeAt(m);u(p.buffer,i)}else{var g=new XMLHttpRequest;g.open(i._xhr.method,o,!0),g.withCredentials=i._xhr.withCredentials,g.responseType="arraybuffer",i._xhr.headers&&Object.keys(i._xhr.headers).forEach(function(h){g.setRequestHeader(h,i._xhr.headers[h])}),g.onload=function(){var h=(g.status+"")[0];if(h!=="0"&&h!=="2"&&h!=="3"){i._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");return}u(g.response,i)},g.onerror=function(){i._webAudio&&(i._html5=!0,i._webAudio=!1,i._sounds=[],delete a[o],i.load())},d(g)}},d=function(i){try{i.send()}catch{i.onerror()}},u=function(i,o){var c=function(){o._emit("loaderror",null,"Decoding audio data failed.")},p=function(m){m&&o._sounds.length>0?(a[o._src]=m,f(o,m)):c()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(i).then(p).catch(c):e.ctx.decodeAudioData(i,p,c)},f=function(i,o){o&&!i._duration&&(i._duration=o.duration),Object.keys(i._sprite).length===0&&(i._sprite={__default:[0,i._duration*1e3]}),i._state!=="loaded"&&(i._state="loaded",i._emit("load"),i._loadQueue())},_=function(){if(e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var i=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),o=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),c=o?parseInt(o[1],10):null;if(i&&c&&c<9){var p=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!p&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};n.Howler=e,n.Howl=r,typeof te<"u"?(te.HowlerGlobal=t,te.Howler=e,te.Howl=r,te.Sound=s):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=r,window.Sound=s)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var r=this;if(!r.ctx||!r.ctx.listener)return r;for(var s=r._howls.length-1;s>=0;s--)r._howls[s].stereo(e);return r},HowlerGlobal.prototype.pos=function(e,r,s){var a=this;if(!a.ctx||!a.ctx.listener)return a;if(r=typeof r!="number"?a._pos[1]:r,s=typeof s!="number"?a._pos[2]:s,typeof e=="number")a._pos=[e,r,s],typeof a.ctx.listener.positionX<"u"?(a.ctx.listener.positionX.setTargetAtTime(a._pos[0],Howler.ctx.currentTime,.1),a.ctx.listener.positionY.setTargetAtTime(a._pos[1],Howler.ctx.currentTime,.1),a.ctx.listener.positionZ.setTargetAtTime(a._pos[2],Howler.ctx.currentTime,.1)):a.ctx.listener.setPosition(a._pos[0],a._pos[1],a._pos[2]);else return a._pos;return a},HowlerGlobal.prototype.orientation=function(e,r,s,a,l,d){var u=this;if(!u.ctx||!u.ctx.listener)return u;var f=u._orientation;if(r=typeof r!="number"?f[1]:r,s=typeof s!="number"?f[2]:s,a=typeof a!="number"?f[3]:a,l=typeof l!="number"?f[4]:l,d=typeof d!="number"?f[5]:d,typeof e=="number")u._orientation=[e,r,s,a,l,d],typeof u.ctx.listener.forwardX<"u"?(u.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),u.ctx.listener.forwardY.setTargetAtTime(r,Howler.ctx.currentTime,.1),u.ctx.listener.forwardZ.setTargetAtTime(s,Howler.ctx.currentTime,.1),u.ctx.listener.upX.setTargetAtTime(a,Howler.ctx.currentTime,.1),u.ctx.listener.upY.setTargetAtTime(l,Howler.ctx.currentTime,.1),u.ctx.listener.upZ.setTargetAtTime(d,Howler.ctx.currentTime,.1)):u.ctx.listener.setOrientation(e,r,s,a,l,d);else return f;return u},Howl.prototype.init=function(e){return function(r){var s=this;return s._orientation=r.orientation||[1,0,0],s._stereo=r.stereo||null,s._pos=r.pos||null,s._pannerAttr={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:360,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:360,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:0,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:"inverse",maxDistance:typeof r.maxDistance<"u"?r.maxDistance:1e4,panningModel:typeof r.panningModel<"u"?r.panningModel:"HRTF",refDistance:typeof r.refDistance<"u"?r.refDistance:1,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:1},s._onstereo=r.onstereo?[{fn:r.onstereo}]:[],s._onpos=r.onpos?[{fn:r.onpos}]:[],s._onorientation=r.onorientation?[{fn:r.onorientation}]:[],e.call(this,r)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,r){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"stereo",action:function(){s.stereo(e,r)}}),s;var a=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof r>"u")if(typeof e=="number")s._stereo=e,s._pos=[e,0,0];else return s._stereo;for(var l=s._getSoundIds(r),d=0;d<l.length;d++){var u=s._soundById(l[d]);if(u)if(typeof e=="number")u._stereo=e,u._pos=[e,0,0],u._node&&(u._pannerAttr.panningModel="equalpower",(!u._panner||!u._panner.pan)&&t(u,a),a==="spatial"?typeof u._panner.positionX<"u"?(u._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):u._panner.setPosition(e,0,0):u._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),s._emit("stereo",u._id);else return u._stereo}return s},Howl.prototype.pos=function(e,r,s,a){var l=this;if(!l._webAudio)return l;if(l._state!=="loaded")return l._queue.push({event:"pos",action:function(){l.pos(e,r,s,a)}}),l;if(r=typeof r!="number"?0:r,s=typeof s!="number"?-.5:s,typeof a>"u")if(typeof e=="number")l._pos=[e,r,s];else return l._pos;for(var d=l._getSoundIds(a),u=0;u<d.length;u++){var f=l._soundById(d[u]);if(f)if(typeof e=="number")f._pos=[e,r,s],f._node&&((!f._panner||f._panner.pan)&&t(f,"spatial"),typeof f._panner.positionX<"u"?(f._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),f._panner.positionY.setValueAtTime(r,Howler.ctx.currentTime),f._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):f._panner.setPosition(e,r,s)),l._emit("pos",f._id);else return f._pos}return l},Howl.prototype.orientation=function(e,r,s,a){var l=this;if(!l._webAudio)return l;if(l._state!=="loaded")return l._queue.push({event:"orientation",action:function(){l.orientation(e,r,s,a)}}),l;if(r=typeof r!="number"?l._orientation[1]:r,s=typeof s!="number"?l._orientation[2]:s,typeof a>"u")if(typeof e=="number")l._orientation=[e,r,s];else return l._orientation;for(var d=l._getSoundIds(a),u=0;u<d.length;u++){var f=l._soundById(d[u]);if(f)if(typeof e=="number")f._orientation=[e,r,s],f._node&&(f._panner||(f._pos||(f._pos=l._pos||[0,0,-.5]),t(f,"spatial")),typeof f._panner.orientationX<"u"?(f._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),f._panner.orientationY.setValueAtTime(r,Howler.ctx.currentTime),f._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):f._panner.setOrientation(e,r,s)),l._emit("orientation",f._id);else return f._orientation}return l},Howl.prototype.pannerAttr=function(){var e=this,r=arguments,s,a,l;if(!e._webAudio)return e;if(r.length===0)return e._pannerAttr;if(r.length===1)if(typeof r[0]=="object")s=r[0],typeof a>"u"&&(s.pannerAttr||(s.pannerAttr={coneInnerAngle:s.coneInnerAngle,coneOuterAngle:s.coneOuterAngle,coneOuterGain:s.coneOuterGain,distanceModel:s.distanceModel,maxDistance:s.maxDistance,refDistance:s.refDistance,rolloffFactor:s.rolloffFactor,panningModel:s.panningModel}),e._pannerAttr={coneInnerAngle:typeof s.pannerAttr.coneInnerAngle<"u"?s.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof s.pannerAttr.coneOuterAngle<"u"?s.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof s.pannerAttr.coneOuterGain<"u"?s.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof s.pannerAttr.distanceModel<"u"?s.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof s.pannerAttr.maxDistance<"u"?s.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof s.pannerAttr.refDistance<"u"?s.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof s.pannerAttr.rolloffFactor<"u"?s.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof s.pannerAttr.panningModel<"u"?s.pannerAttr.panningModel:e._panningModel});else return l=e._soundById(parseInt(r[0],10)),l?l._pannerAttr:e._pannerAttr;else r.length===2&&(s=r[0],a=parseInt(r[1],10));for(var d=e._getSoundIds(a),u=0;u<d.length;u++)if(l=e._soundById(d[u]),l){var f=l._pannerAttr;f={coneInnerAngle:typeof s.coneInnerAngle<"u"?s.coneInnerAngle:f.coneInnerAngle,coneOuterAngle:typeof s.coneOuterAngle<"u"?s.coneOuterAngle:f.coneOuterAngle,coneOuterGain:typeof s.coneOuterGain<"u"?s.coneOuterGain:f.coneOuterGain,distanceModel:typeof s.distanceModel<"u"?s.distanceModel:f.distanceModel,maxDistance:typeof s.maxDistance<"u"?s.maxDistance:f.maxDistance,refDistance:typeof s.refDistance<"u"?s.refDistance:f.refDistance,rolloffFactor:typeof s.rolloffFactor<"u"?s.rolloffFactor:f.rolloffFactor,panningModel:typeof s.panningModel<"u"?s.panningModel:f.panningModel};var _=l._panner;_?(_.coneInnerAngle=f.coneInnerAngle,_.coneOuterAngle=f.coneOuterAngle,_.coneOuterGain=f.coneOuterGain,_.distanceModel=f.distanceModel,_.maxDistance=f.maxDistance,_.refDistance=f.refDistance,_.rolloffFactor=f.rolloffFactor,_.panningModel=f.panningModel):(l._pos||(l._pos=e._pos||[0,0,-.5]),t(l,"spatial"))}return e},Sound.prototype.init=function(e){return function(){var r=this,s=r._parent;r._orientation=s._orientation,r._stereo=s._stereo,r._pos=s._pos,r._pannerAttr=s._pannerAttr,e.call(this),r._stereo?s.stereo(r._stereo):r._pos&&s.pos(r._pos[0],r._pos[1],r._pos[2],r._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var r=this,s=r._parent;return r._orientation=s._orientation,r._stereo=s._stereo,r._pos=s._pos,r._pannerAttr=s._pannerAttr,r._stereo?s.stereo(r._stereo):r._pos?s.pos(r._pos[0],r._pos[1],r._pos[2],r._id):r._panner&&(r._panner.disconnect(0),r._panner=void 0,s._refreshBuffer(r)),e.call(this)}}(Sound.prototype.reset);var t=function(e,r){r=r||"spatial",r==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(Dn);let Ye;const nn={capture:[0,204],move:[704,316],select:[1519,153],silence:[2172,500]},Ni=()=>{if(!Ye){const n=Object.values(nn).map(t=>window.btoa(`${t[0]}:${t[1]}`)).join("-");Ye??(Ye=new Dn.Howl({src:[`/audio/sprite.mp3?v=${n}`],sprite:nn}))}return Ye},qi=n=>{Ni().play(n)};function Wi(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}var pt=Wi,Ui=typeof te=="object"&&te&&te.Object===Object&&te,Xi=Ui,Qi=Xi,Ci=typeof self=="object"&&self&&self.Object===Object&&self,Ji=Qi||Ci||Function("return this")(),Ln=Ji,Yi=Ln,Zi=function(){return Yi.Date.now()},Ki=Zi,zi=/\s/;function es(n){for(var t=n.length;t--&&zi.test(n.charAt(t)););return t}var ts=es,ns=ts,rs=/^\s+/;function is(n){return n&&n.slice(0,ns(n)+1).replace(rs,"")}var ss=is,os=Ln,as=os.Symbol,Fn=as,rn=Fn,Hn=Object.prototype,ls=Hn.hasOwnProperty,cs=Hn.toString,Oe=rn?rn.toStringTag:void 0;function us(n){var t=ls.call(n,Oe),e=n[Oe];try{n[Oe]=void 0;var r=!0}catch{}var s=cs.call(n);return r&&(t?n[Oe]=e:delete n[Oe]),s}var fs=us,ds=Object.prototype,_s=ds.toString;function ps(n){return _s.call(n)}var hs=ps,sn=Fn,ms=fs,gs=hs,vs="[object Null]",ys="[object Undefined]",on=sn?sn.toStringTag:void 0;function bs(n){return n==null?n===void 0?ys:vs:on&&on in Object(n)?ms(n):gs(n)}var ws=bs;function Ss(n){return n!=null&&typeof n=="object"}var Ts=Ss,ks=ws,As=Ts,Is="[object Symbol]";function Es(n){return typeof n=="symbol"||As(n)&&ks(n)==Is}var Os=Es,$s=ss,an=pt,Ms=Os,ln=0/0,Ps=/^[-+]0x[0-9a-f]+$/i,xs=/^0b[01]+$/i,js=/^0o[0-7]+$/i,Ds=parseInt;function Ls(n){if(typeof n=="number")return n;if(Ms(n))return ln;if(an(n)){var t=typeof n.valueOf=="function"?n.valueOf():n;n=an(t)?t+"":t}if(typeof n!="string")return n===0?n:+n;n=$s(n);var e=xs.test(n);return e||js.test(n)?Ds(n.slice(2),e?2:8):Ps.test(n)?ln:+n}var Fs=Ls,Hs=pt,Ze=Ki,cn=Fs,Rs="Expected a function",Gs=Math.max,Vs=Math.min;function Bs(n,t,e){var r,s,a,l,d,u,f=0,_=!1,i=!1,o=!0;if(typeof n!="function")throw new TypeError(Rs);t=cn(t)||0,Hs(e)&&(_=!!e.leading,i="maxWait"in e,a=i?Gs(cn(e.maxWait)||0,t):a,o="trailing"in e?!!e.trailing:o);function c(O){var T=r,L=s;return r=s=void 0,f=O,l=n.apply(L,T),l}function p(O){return f=O,d=setTimeout(h,t),_?c(O):l}function m(O){var T=O-u,L=O-f,E=t-T;return i?Vs(E,a-L):E}function g(O){var T=O-u,L=O-f;return u===void 0||T>=t||T<0||i&&L>=a}function h(){var O=Ze();if(g(O))return v(O);d=setTimeout(h,m(O))}function v(O){return d=void 0,o&&r?c(O):(r=s=void 0,l)}function y(){d!==void 0&&clearTimeout(d),f=0,r=u=s=d=void 0}function b(){return d===void 0?l:v(Ze())}function S(){var O=Ze(),T=g(O);if(r=arguments,s=this,u=O,T){if(d===void 0)return p(u);if(i)return clearTimeout(d),d=setTimeout(h,t),c(u)}return d===void 0&&(d=setTimeout(h,t)),l}return S.cancel=y,S.flush=b,S}var Ns=Bs,qs=Ns,Ws=pt,Us="Expected a function";function Xs(n,t,e){var r=!0,s=!0;if(typeof n!="function")throw new TypeError(Us);return Ws(e)&&(r="leading"in e?!!e.leading:r,s="trailing"in e?!!e.trailing:s),qs(n,t,{leading:r,maxWait:t,trailing:s})}var Qs=Xs;const Cs=Bi(Qs);function Js(n){let t,e,r={slot:"actions"};return t=new fi({props:r}),n[8](t),{c(){ce(t.$$.fragment)},l(s){ue(t.$$.fragment,s)},m(s,a){fe(t,s,a),e=!0},p(s,a){const l={};t.$set(l)},i(s){e||(F(t.$$.fragment,s),e=!0)},o(s){H(t.$$.fragment,s),e=!1},d(s){n[8](null),de(t,s)}}}function Ys(n){let t,e;return t=new si({props:{slot:"cursor-overlays",mousePositions:n[0]}}),{c(){ce(t.$$.fragment)},l(r){ue(t.$$.fragment,r)},m(r,s){fe(t,r,s),e=!0},p(r,s){const a={};s&1&&(a.mousePositions=r[0]),t.$set(a)},i(r){e||(F(t.$$.fragment,r),e=!0)},o(r){H(t.$$.fragment,r),e=!1},d(r){de(t,r)}}}function Zs(n){let t,e,r,s,a=n[2].log.join(`
`)+"",l,d,u=JSON.stringify(n[3],null,2)+"",f,_,i;return t=new Vi({props:{reportMousePosition:n[6],$$slots:{"cursor-overlays":[Ys],actions:[Js]},$$scope:{ctx:n}}}),{c(){ce(t.$$.fragment),e=R(),r=x("pre"),s=V(""),l=V(a),d=V(`

`),f=V(u),_=V(`
`)},l(o){ue(t.$$.fragment,o),e=G(o),r=j(o,"PRE",{});var c=D(r);s=B(c,""),l=B(c,a),d=B(c,`

`),f=B(c,u),_=B(c,`
`),c.forEach(w)},m(o,c){fe(t,o,c),$(o,e,c),$(o,r,c),I(r,s),I(r,l),I(r,d),I(r,f),I(r,_),i=!0},p(o,[c]){const p={};c&16387&&(p.$$scope={dirty:c,ctx:o}),t.$set(p),(!i||c&4)&&a!==(a=o[2].log.join(`
`)+"")&&ae(l,a),(!i||c&8)&&u!==(u=JSON.stringify(o[3],null,2)+"")&&ae(f,u)},i(o){i||(F(t.$$.fragment,o),i=!0)},o(o){H(t.$$.fragment,o),i=!1},d(o){o&&(w(e),w(r)),de(t,o)}}}function Ks(n,t,e){let r,s,{data:a}=t;const l=a.machineInput,d=l.gameId,u=l.userId,f=l.hostUserId,_={},i=Zr({gameId:d,userId:u,onMessage:h=>{h.type==="mouse position"?e(0,_[h.userId]=h.position,_):o.send(h)}});W(n,i,h=>e(2,r=h));const o=Xr(Yr({send:i.send,actions:{playSound:qi,showEmoji:({userId:h,emoji:v})=>p==null?void 0:p.showEmoji({userId:h,emoji:v})}}),{input:l});Qr({gameId:d,userId:u,hostUserId:f,machine:o});const c=o.state;W(n,c,h=>e(3,s=h)),un(()=>(i.open(),()=>{i.close()}));let p;const m=Cs(h=>{i.send({type:"mouse position",position:h})},50,{leading:!0,trailing:!0});function g(h){ot[h?"unshift":"push"](()=>{p=h,e(1,p)})}return n.$$set=h=>{"data"in h&&e(7,a=h.data)},[_,p,r,s,i,c,m,a,g]}class ro extends re{constructor(t){super(),ie(this,t,Ks,Zs,ee,{data:7})}}export{ro as component,no as universal};
